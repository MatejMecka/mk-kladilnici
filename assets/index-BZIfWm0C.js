var Tg=Object.defineProperty;var kg=(_,o,u)=>o in _?Tg(_,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[o]=u;var hu=(_,o,u)=>(kg(_,typeof o!="symbol"?o+"":o,u),u);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))p(b);new MutationObserver(b=>{for(const x of b)if(x.type==="childList")for(const y of x.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&p(y)}).observe(document,{childList:!0,subtree:!0});function u(b){const x={};return b.integrity&&(x.integrity=b.integrity),b.referrerPolicy&&(x.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?x.credentials="include":b.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function p(b){if(b.ep)return;b.ep=!0;const x=u(b);fetch(b.href,x)}})();function Bt(){}function Ig(_,o){for(const u in o)_[u]=o[u];return _}function Cg(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}function lf(_){return _()}function _p(){return Object.create(null)}function So(_){_.forEach(lf)}function Iu(_){return typeof _=="function"}function Ur(_,o){return _!=_?o==o:_!==o||_&&typeof _=="object"||typeof _=="function"}function Ag(_){return Object.keys(_).length===0}function cf(_,...o){if(_==null){for(const p of o)p(void 0);return Bt}const u=_.subscribe(...o);return u.unsubscribe?()=>u.unsubscribe():u}function Eg(_){let o;return cf(_,u=>o=u)(),o}function Hi(_,o,u){_.$$.on_destroy.push(cf(o,u))}function la(_,o,u,p){if(_){const b=hf(_,o,u,p);return _[0](b)}}function hf(_,o,u,p){return _[1]&&p?Ig(u.ctx.slice(),_[1](p(o))):u.ctx}function ca(_,o,u,p){if(_[2]&&p){const b=_[2](p(u));if(o.dirty===void 0)return b;if(typeof b=="object"){const x=[],y=Math.max(o.dirty.length,b.length);for(let l=0;l<y;l+=1)x[l]=o.dirty[l]|b[l];return x}return o.dirty|b}return o.dirty}function ha(_,o,u,p,b,x){if(b){const y=hf(o,u,p,x);_.p(y,b)}}function ua(_){if(_.ctx.length>32){const o=[],u=_.ctx.length/32;for(let p=0;p<u;p++)o[p]=-1;return o}return-1}function Pg(_){const o={};for(const u in _)o[u]=!0;return o}function yp(_){return _??""}function rs(_,o,u){return _.set(u),o}function Mg(_){return _&&Iu(_.destroy)?_.destroy:Bt}function _t(_,o){_.appendChild(o)}function Lt(_,o,u){_.insertBefore(o,u||null)}function Pt(_){_.parentNode&&_.parentNode.removeChild(_)}function zg(_,o){for(let u=0;u<_.length;u+=1)_[u]&&_[u].d(o)}function Tt(_){return document.createElement(_)}function Dn(_){return document.createTextNode(_)}function di(){return Dn(" ")}function ss(){return Dn("")}function El(_,o,u,p){return _.addEventListener(o,u,p),()=>_.removeEventListener(o,u,p)}function $t(_,o,u){u==null?_.removeAttribute(o):_.getAttribute(o)!==u&&_.setAttribute(o,u)}function Lg(_){return _===""?null:+_}function Dg(_){return Array.from(_.childNodes)}function To(_,o){o=""+o,_.data!==o&&(_.data=o)}function vp(_,o){_.value=o??""}function $c(_,o,u,p){u==null?_.style.removeProperty(o):_.style.setProperty(o,u,p?"important":"")}function xp(_,o,u){_.classList.toggle(o,!!u)}function Rg(_,o,{bubbles:u=!1,cancelable:p=!1}={}){return new CustomEvent(_,{detail:o,bubbles:u,cancelable:p})}let Dl;function is(_){Dl=_}function ko(){if(!Dl)throw new Error("Function called outside component initialization");return Dl}function uf(_){ko().$$.on_mount.push(_)}function ns(_){ko().$$.on_destroy.push(_)}function Cu(){const _=ko();return(o,u,{cancelable:p=!1}={})=>{const b=_.$$.callbacks[o];if(b){const x=Rg(o,u,{cancelable:p});return b.slice().forEach(y=>{y.call(_,x)}),!x.defaultPrevented}return!0}}function df(_,o){return ko().$$.context.set(_,o),o}function Og(_){return ko().$$.context.get(_)}function hn(_,o){const u=_.$$.callbacks[o.type];u&&u.slice().forEach(p=>p.call(this,o))}const go=[],Rl=[];let vo=[];const vu=[],pf=Promise.resolve();let xu=!1;function ff(){xu||(xu=!0,pf.then(Au))}function Fg(){return ff(),pf}function bu(_){vo.push(_)}function mf(_){vu.push(_)}const uu=new Set;let lo=0;function Au(){if(lo!==0)return;const _=Dl;do{try{for(;lo<go.length;){const o=go[lo];lo++,is(o),Bg(o.$$)}}catch(o){throw go.length=0,lo=0,o}for(is(null),go.length=0,lo=0;Rl.length;)Rl.pop()();for(let o=0;o<vo.length;o+=1){const u=vo[o];uu.has(u)||(uu.add(u),u())}vo.length=0}while(go.length);for(;vu.length;)vu.pop()();xu=!1,uu.clear(),is(_)}function Bg(_){if(_.fragment!==null){_.update(),So(_.before_update);const o=_.dirty;_.dirty=[-1],_.fragment&&_.fragment.p(_.ctx,o),_.after_update.forEach(bu)}}function jg(_){const o=[],u=[];vo.forEach(p=>_.indexOf(p)===-1?o.push(p):u.push(p)),u.forEach(p=>p()),vo=o}const Jc=new Set;let oa;function Br(){oa={r:0,c:[],p:oa}}function jr(){oa.r||So(oa.c),oa=oa.p}function Ge(_,o){_&&_.i&&(Jc.delete(_),_.i(o))}function nt(_,o,u,p){if(_&&_.o){if(Jc.has(_))return;Jc.add(_),oa.c.push(()=>{Jc.delete(_),p&&(u&&_.d(1),p())}),_.o(o)}else p&&p()}function Yc(_,o){const u=o.token={};function p(b,x,y,l){if(o.token!==u)return;o.resolved=l;let D=o.ctx;y!==void 0&&(D=D.slice(),D[y]=l);const U=b&&(o.current=b)(D);let N=!1;o.block&&(o.blocks?o.blocks.forEach((Z,K)=>{K!==x&&Z&&(Br(),nt(Z,1,1,()=>{o.blocks[K]===Z&&(o.blocks[K]=null)}),jr())}):o.block.d(1),U.c(),Ge(U,1),U.m(o.mount(),o.anchor),N=!0),o.block=U,o.blocks&&(o.blocks[x]=U),N&&Au()}if(Cg(_)){const b=ko();if(_.then(x=>{is(b),p(o.then,1,o.value,x),is(null)},x=>{if(is(b),p(o.catch,2,o.error,x),is(null),!o.hasCatch)throw x}),o.current!==o.pending)return p(o.pending,0),!0}else{if(o.current!==o.then)return p(o.then,1,o.value,_),!0;o.resolved=_}}function Qc(_,o,u){const p=o.slice(),{resolved:b}=_;_.current===_.then&&(p[_.value]=b),_.current===_.catch&&(p[_.error]=b),_.block.p(p,u)}function bp(_){return(_==null?void 0:_.length)!==void 0?_:Array.from(_)}function gf(_,o,u){const p=_.$$.props[o];p!==void 0&&(_.$$.bound[p]=u,u(_.$$.ctx[p]))}function Wi(_){_&&_.c()}function zi(_,o,u){const{fragment:p,after_update:b}=_.$$;p&&p.m(o,u),bu(()=>{const x=_.$$.on_mount.map(lf).filter(Iu);_.$$.on_destroy?_.$$.on_destroy.push(...x):So(x),_.$$.on_mount=[]}),b.forEach(bu)}function Li(_,o){const u=_.$$;u.fragment!==null&&(jg(u.after_update),So(u.on_destroy),u.fragment&&u.fragment.d(o),u.on_destroy=u.fragment=null,u.ctx=[])}function Ug(_,o){_.$$.dirty[0]===-1&&(go.push(_),ff(),_.$$.dirty.fill(0)),_.$$.dirty[o/31|0]|=1<<o%31}function dn(_,o,u,p,b,x,y=null,l=[-1]){const D=Dl;is(_);const U=_.$$={fragment:null,ctx:[],props:x,update:Bt,not_equal:b,bound:_p(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(D?D.$$.context:[])),callbacks:_p(),dirty:l,skip_bound:!1,root:o.target||D.$$.root};y&&y(U.root);let N=!1;if(U.ctx=u?u(_,o.props||{},(Z,K,...Ae)=>{const Te=Ae.length?Ae[0]:K;return U.ctx&&b(U.ctx[Z],U.ctx[Z]=Te)&&(!U.skip_bound&&U.bound[Z]&&U.bound[Z](Te),N&&Ug(_,Z)),K}):[],U.update(),N=!0,So(U.before_update),U.fragment=p?p(U.ctx):!1,o.target){if(o.hydrate){const Z=Dg(o.target);U.fragment&&U.fragment.l(Z),Z.forEach(Pt)}else U.fragment&&U.fragment.c();o.intro&&Ge(_.$$.fragment),zi(_,o.target,o.anchor),Au()}is(D)}class pn{constructor(){hu(this,"$$");hu(this,"$$set")}$destroy(){Li(this,1),this.$destroy=Bt}$on(o,u){if(!Iu(u))return Bt;const p=this.$$.callbacks[o]||(this.$$.callbacks[o]=[]);return p.push(u),()=>{const b=p.indexOf(u);b!==-1&&p.splice(b,1)}}$set(o){this.$$set&&!Ag(o)&&(this.$$.skip_bound=!0,this.$$set(o),this.$$.skip_bound=!1)}}const Vg="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Vg);const co=[];function du(_,o){return{subscribe:Ln(_,o).subscribe}}function Ln(_,o=Bt){let u;const p=new Set;function b(l){if(Ur(_,l)&&(_=l,u)){const D=!co.length;for(const U of p)U[1](),co.push(U,_);if(D){for(let U=0;U<co.length;U+=2)co[U][0](co[U+1]);co.length=0}}}function x(l){b(l(_))}function y(l,D=Bt){const U=[l,D];return p.add(U),p.size===1&&(u=o(b,x)||Bt),l(_),()=>{p.delete(U),p.size===0&&u&&(u(),u=null)}}return{set:b,update:x,subscribe:y}}let Ng=Date.now();function eh(_){return`${_}-${Ng++}`}const Eu=Symbol.for("svelte-maplibre");function Io(){return Og(Eu)}function qg(_){let o=new WeakMap;return u=>{var y;let p=o.get(u.originalEvent);if(p!==void 0)return p;let x=(y=u.target.queryRenderedFeatures(u.point).find(l=>{var D;return(D=_.get(l.layer.id))==null?void 0:D.interactive}))==null?void 0:y.layer.id;return o.set(u.originalEvent,x),x}}function Zg(){let _=new Map;return df(Eu,{map:Ln(null),source:du(null),layer:du(null),popupTarget:du(null),cluster:Ln(),loadedImages:Ln(new Set),minzoom:Ln(0),maxzoom:Ln(24),layerEvent:Ln(null),layerInfo:_,eventTopMost:qg(_)})}function wp(_){return{subscribe:_.subscribe}}function Pu({key:_,setPopupTarget:o=!1,setCluster:u=!1,setMouseEvent:p=!1}){let b=Io(),x=Ln(null),y=wp(x),l={...b,[_]:wp(x)};if(o&&(l.popupTarget=y),p){let D=Ln(null);l.layerEvent=D,b.layerEvent=D}return u&&(l.cluster=Ln()),df(Eu,l),{...b,self:x}}function Gg(){return Pu({key:"source",setCluster:!0})}function Hg(_=!0){return Pu({key:"layer",setPopupTarget:_,setMouseEvent:_})}function Wg(){return Pu({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function Kg(_){return"layerType"in _&&_.layerType==="deckgl"}var Xg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jg(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var _f={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.0.1/LICENSE.txt
 */(function(_,o){(function(u,p){_.exports=p()})(Xg,function(){var u={},p={};function b(y,l,D){if(p[y]=D,y==="index"){var U="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",N={};return p.shared(N),p.index(u,N),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([U],{type:"text/javascript"}))),u}}b("shared",["exports"],function(y){function l(i,e,r,s){return new(r||(r=Promise))(function(c,m){function g(I){try{S(s.next(I))}catch(A){m(A)}}function v(I){try{S(s.throw(I))}catch(A){m(A)}}function S(I){var A;I.done?c(I.value):(A=I.value,A instanceof r?A:new r(function(E){E(A)})).then(g,v)}S((s=s.apply(i,e||[])).next())})}function D(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var U=N;function N(i,e){this.x=i,this.y=e}N.prototype={clone:function(){return new N(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},N.convert=function(i){return i instanceof N?i:Array.isArray(i)?new N(i[0],i[1]):i};var Z=D(U),K=Ae;function Ae(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}Ae.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=c/m}var g=0,v=1;for(r=i,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<e));s++)i>c?g=r:v=r,r=.5*(v-g)+g;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Te=D(K);let je,Ue;function He(){return je==null&&(je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),je}function at(){if(Ue==null&&(Ue=!1,He())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let s=0;s<5*5;s++){const c=4*s;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(s%5,Math.floor(s/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){Ue=!0;break}}}return Ue||!1}function Ye(i,e,r,s){const c=new Te(i,e,r,s);return function(m){return c.solve(m)}}const Ie=Ye(.25,.1,.25,1);function vt(i,e,r){return Math.min(r,Math.max(e,i))}function Dt(i,e,r){const s=r-e,c=((i-e)%s+s)%s+e;return c===e?r:c}function yt(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let Je=1;function dt(i,e,r){const s={};for(const c in i)s[c]=e.call(r||this,i[c],c,i);return s}function si(i,e,r){const s={};for(const c in i)e.call(r||this,i[c],c,i)&&(s[c]=i[c]);return s}function _e(i){return Array.isArray(i)?i.map(_e):typeof i=="object"&&i?dt(i,_e):i}const kt={};function Mt(i){kt[i]||(typeof console<"u"&&console.warn(i),kt[i]=!0)}function Wt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function ai(i){let e=0;for(let r,s,c=0,m=i.length,g=m-1;c<m;g=c++)r=i[c],s=i[g],e+=(s.x-r.x)*(r.y+s.y);return e}function it(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let It=null;function ct(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const mi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Zt(i,e,r,s,c){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(i,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const v=g.startsWith("BGR"),S=new Uint8ClampedArray(s*c*4);if(yield m.copyTo(S,function(I,A,E,L,O){const B=4*Math.max(-A,0),V=(Math.max(0,E)-E)*L*4+B,X=4*L,$=Math.max(0,A),le=Math.max(0,E);return{rect:{x:$,y:le,width:Math.min(I.width,A+L)-$,height:Math.min(I.height,E+O)-le},layout:[{offset:V,stride:X}]}}(i,e,r,s,c)),v)for(let I=0;I<S.length;I+=4){const A=S[I];S[I]=S[I+2],S[I+2]=A}return S}finally{m.close()}})}let Nt,Ut;const gi="AbortError";function oi(){return new Error(gi)}const Di={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function li(i){return Di.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ci="global-dispatcher";class Ee extends Error{constructor(e,r,s,c){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=c}}const ot=()=>it(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,jt=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=li(i.url);if(s)return s(i,e);if(it(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,targetMapId:ci},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ot())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,c){return l(this,void 0,void 0,function*(){const m=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:ot(),signal:c.signal});s.type==="json"&&m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const I=yield g.blob();throw new Ee(g.status,g.statusText,s.url,I)}const v=s.type==="arrayBuffer"||s.type==="image"?g.arrayBuffer():s.type==="json"?g.json():g.text(),S=yield v;if(c.signal.aborted)throw oi();return{data:S,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(i,e);if(it(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,mustQueue:!0,targetMapId:ci},e)}var r;return function(s,c){return new Promise((m,g)=>{const v=new XMLHttpRequest;v.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(v.responseType="arraybuffer");for(const S in s.headers)v.setRequestHeader(S,s.headers[S]);s.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=s.credentials==="include",v.onerror=()=>{g(new Error(v.statusText))},v.onload=()=>{if(!c.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let S=v.response;if(s.type==="json")try{S=JSON.parse(v.response)}catch(I){return void g(I)}m({data:S,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const S=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});g(new Ee(v.status,v.statusText,s.url,S))}},c.signal.addEventListener("abort",()=>{v.abort(),g(oi())}),v.send(s.body)})}(i,e)};function er(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Er(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function ue(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class Rt{constructor(e,r={}){yt(this,r),this.type=e}}class qt extends Rt{constructor(e,r={}){super("error",yt({error:e},r))}}class Yi{on(e,r){return this._listeners=this._listeners||{},Er(e,r,this._listeners),this}off(e,r){return ue(e,r,this._listeners),ue(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Er(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new Rt(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const v of c)v.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const v of m)ue(s,v,this._oneTimeListeners),v.call(this,e);const g=this._eventedParent;g&&(yt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof qt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const tr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Sn(i,e){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return tr.forEach(s=>{s in e&&(r[s]=e[s])}),r}function Ct(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Ct(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Ct(i[r],e[r]))return!1;return!0}return i===e}function Qi(i,e){i.push(e)}function en(i,e,r){Qi(r,{command:"addSource",args:[i,e[i]]})}function as(i,e,r){Qi(e,{command:"removeSource",args:[i]}),r[i]=!0}function os(i,e,r,s){as(i,r,s),en(i,e,r)}function ls(i,e,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Ct(i[r][s],e[r][s]))return!1;for(s in e[r])if(Object.prototype.hasOwnProperty.call(e[r],s)&&s!=="data"&&!Ct(i[r][s],e[r][s]))return!1;return!0}function Rn(i,e,r,s,c,m){i=i||{},e=e||{};for(const g in i)Object.prototype.hasOwnProperty.call(i,g)&&(Ct(i[g],e[g])||r.push({command:m,args:[s,g,e[g],c]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(Ct(i[g],e[g])||r.push({command:m,args:[s,g,e[g],c]}))}function pa(i){return i.id}function On(i,e){return i[e.id]=e,i}class Pe{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function tn(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}class Pr extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ps{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new Ps(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ir={kind:"null"},Le={kind:"number"},gt={kind:"string"},pt={kind:"boolean"},Ai={kind:"color"},rn={kind:"object"},ht={kind:"value"},Fn={kind:"collator"},Ri={kind:"formatted"},J={kind:"padding"},z={kind:"resolvedImage"},R={kind:"variableAnchorOffsetCollection"};function j(i,e){return{kind:"array",itemType:i,N:e}}function G(i){if(i.kind==="array"){const e=G(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const re=[ir,Le,gt,pt,Ai,Ri,rn,j(ht),J,z,R];function ne(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ne(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of re)if(!ne(r,e))return null}}return`Expected ${G(i)} but found ${G(e)} instead.`}function oe(i,e){return e.some(r=>r.kind===i.kind)}function te(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ce(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const be=.96422,ge=.82521,ye=4/29,Qe=6/29,et=3*Qe*Qe,ut=Qe*Qe*Qe,lt=Math.PI/180,At=180/Math.PI;function Kt(i){return(i%=360)<0&&(i+=360),i}function hi([i,e,r,s]){let c,m;const g=ft((.2225045*(i=Ei(i))+.7168786*(e=Ei(e))+.0606169*(r=Ei(r)))/1);i===e&&e===r?c=m=g:(c=ft((.4360747*i+.3850649*e+.1430804*r)/be),m=ft((.0139322*i+.0971045*e+.7141733*r)/ge));const v=116*g-16;return[v<0?0:v,500*(c-g),200*(g-m),s]}function Ei(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ft(i){return i>ut?Math.pow(i,1/3):i/et+ye}function _i([i,e,r,s]){let c=(i+16)/116,m=isNaN(e)?c:c+e/500,g=isNaN(r)?c:c-r/200;return c=1*cr(c),m=be*cr(m),g=ge*cr(g),[Oi(3.1338561*m-1.6168667*c-.4906146*g),Oi(-.9787684*m+1.9161415*c+.033454*g),Oi(.0719453*m-.2289914*c+1.4052427*g),s]}function Oi(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function cr(i){return i>Qe?i*i*i:et*(i-ye)}function vr(i){return parseInt(i.padEnd(2,i),16)/255}function Ki(i,e){return nn(e?i/100:i,0,1)}function nn(i,e,r){return Math.min(Math.max(e,i),r)}function Ul(i){return!i.some(Number.isNaN)}const sh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Gt{constructor(e,r,s,c=1,m=!0){this.r=e,this.g=r,this.b=s,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,r,s,c]))}static parse(e){if(e instanceof Gt)return e;if(typeof e!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=sh[s];if(c){const[g,v,S]=c;return[g/255,v/255,S/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const g=s.length<6?1:2;let v=1;return[vr(s.slice(v,v+=g)),vr(s.slice(v,v+=g)),vr(s.slice(v,v+=g)),vr(s.slice(v,v+g)||"ff")]}if(s.startsWith("rgb")){const g=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[v,S,I,A,E,L,O,B,V,X,$,le]=g,ee=[A||" ",O||" ",X].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const se=[I,L,V].join(""),me=se==="%%%"?100:se===""?255:0;if(me){const xe=[nn(+S/me,0,1),nn(+E/me,0,1),nn(+B/me,0,1),$?Ki(+$,le):1];if(Ul(xe))return xe}}return}}const m=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,v,S,I,A,E,L,O,B]=m,V=[S||" ",A||" ",L].join("");if(V==="  "||V==="  /"||V===",,"||V===",,,"){const X=[+v,nn(+I,0,100),nn(+E,0,100),O?Ki(+O,B):1];if(Ul(X))return function([$,le,ee,se]){function me(xe){const Be=(xe+$/30)%12,We=le*Math.min(ee,1-ee);return ee-We*Math.max(-1,Math.min(Be-3,9-Be,1))}return $=Kt($),le/=100,ee/=100,[me(0),me(8),me(4),se]}(X)}}}(e);return r?new Gt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:s,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[e/m,r/m,s/m,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,s,c,m]=hi(e),g=Math.sqrt(s*s+c*c);return[Math.round(1e4*g)?Kt(Math.atan2(c,s)*At):NaN,g,r,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",hi(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,s,c]=this.rgb;return`rgba(${[e,r,s].map(m=>Math.round(255*m)).join(",")},${c})`}}Gt.black=new Gt(0,0,0,1),Gt.white=new Gt(1,1,1,1),Gt.transparent=new Gt(0,0,0,0),Gt.red=new Gt(1,0,0,1);class Ao{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Eo{constructor(e,r,s,c,m){this.text=e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=m}}class Mr{constructor(e){this.sections=e}static fromString(e){return new Mr([new Eo(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Mr?e:Mr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class xr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof xr)return e;if(typeof e=="number")return new xr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new xr(e)}}toString(){return JSON.stringify(this.values)}}const Ms=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Vr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const s=e[r],c=e[r+1];if(typeof s!="string"||!Ms.has(s)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Vr(e)}}toString(){return JSON.stringify(this.values)}}class Nr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Nr({name:e,available:!1}):null}}function cs(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fa(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Gt||i instanceof Ao||i instanceof Mr||i instanceof xr||i instanceof Vr||i instanceof Nr)return!0;if(Array.isArray(i)){for(const e of i)if(!fa(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!fa(i[e]))return!1;return!0}return!1}function Pi(i){if(i===null)return ir;if(typeof i=="string")return gt;if(typeof i=="boolean")return pt;if(typeof i=="number")return Le;if(i instanceof Gt)return Ai;if(i instanceof Ao)return Fn;if(i instanceof Mr)return Ri;if(i instanceof xr)return J;if(i instanceof Vr)return R;if(i instanceof Nr)return z;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const c=Pi(s);if(r){if(r===c)continue;r=ht;break}r=c}return j(r||ht,e)}return rn}function zs(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Gt||i instanceof Mr||i instanceof xr||i instanceof Vr||i instanceof Nr?i.toString():JSON.stringify(i)}class Tn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!fa(e[1]))return r.error("invalid value");const s=e[1];let c=Pi(s);const m=r.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Tn(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class pi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ma={string:gt,number:Le,boolean:pt,object:rn};class zr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const m=e[0];if(m==="array"){let v,S;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in ma)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=ma[I],c++}else v=ht;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],c++}s=j(v,S)}else{if(!ma[m])throw new Error(`Types doesn't contain name = ${m}`);s=ma[m]}const g=[];for(;c<e.length;c++){const v=r.parse(e[c],c,ht);if(!v)return null;g.push(v)}return new zr(s,g)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!ne(this.type,Pi(s)))return s;if(r===this.args.length-1)throw new pi(`Expected value to be of type ${G(this.type)}, but found ${G(Pi(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ga={"to-boolean":pt,"to-color":Ai,"to-number":Le,"to-string":gt};class sn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!ga[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=ga[s],m=[];for(let g=1;g<e.length;g++){const v=r.parse(e[g],g,ht);if(!v)return null;m.push(v)}return new sn(c,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof Gt)return r;if(typeof r=="string"){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:cs(r[0],r[1],r[2],r[3]),!s))return new Gt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new pi(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(e);const c=xr.parse(r);if(c)return c}throw new pi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(e);const c=Vr.parse(r);if(c)return c}throw new pi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new pi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Mr.fromString(zs(this.args[0].evaluate(e)));case"resolvedImage":return Nr.fromString(zs(this.args[0].evaluate(e)));default:return zs(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ls=["Unknown","Point","LineString","Polygon"];class Ht{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ls[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Gt.parse(e)),r}}class _a{constructor(e,r,s=[],c,m=new Ps,g=[]){this.registry=e,this.path=s,this.key=s.map(v=>`[${v}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=r}parse(e,r,s,c,m={}){return r?this.concat(r,s,c)._parse(e,m):this._parse(e,m)}_parse(e,r){function s(c,m,g){return g==="assert"?new zr(m,[c]):g==="coerce"?new sn(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,S=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||S.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(v.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(v,S))return null}else g=s(g,v,r.typeAnnotation||"coerce");else g=s(g,v,r.typeAnnotation||"coerce");else g=s(g,v,r.typeAnnotation||"coerce");else g=s(g,v,r.typeAnnotation||"assert")}if(!(g instanceof Tn)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const v=new Ht;try{g=new Tn(g.type,g.evaluate(v))}catch(S){return this.error(S.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c=typeof e=="number"?this.path.concat(e):this.path,m=s?this.scope.concat(s):this.scope;return new _a(this.registry,this._isConstant,c,r||null,m,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Pr(s,e))}checkSubtype(e,r){const s=ne(e,r);return s&&this.error(s),s}}class hs{constructor(e,r,s){this.type=Fn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,pt);if(!c)return null;const m=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,pt);if(!m)return null;let g=null;return s.locale&&(g=r.parse(s.locale,1,gt),!g)?null:new hs(c,m,g)}evaluate(e){return new Ao(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const kn=8192;function ya(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ds(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ah(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*kn),Math.round(s*c*kn)]}function Vl(i,e,r){const s=i[0]-e[0],c=i[1]-e[1],m=i[0]-r[0],g=i[1]-r[1];return s*g-m*c==0&&s*m<=0&&c*g<=0}function va(i,e){let r=!1;for(let g=0,v=e.length;g<v;g++){const S=e[g];for(let I=0,A=S.length;I<A-1;I++){if(Vl(i,S[I],S[I+1]))return!1;(c=S[I])[1]>(s=i)[1]!=(m=S[I+1])[1]>s[1]&&s[0]<(m[0]-c[0])*(s[1]-c[1])/(m[1]-c[1])+c[0]&&(r=!r)}}var s,c,m;return r}function oh(i,e){for(let r=0;r<e.length;r++)if(va(i,e[r]))return!0;return!1}function Nl(i,e,r,s){const c=s[0]-r[0],m=s[1]-r[1],g=(i[0]-r[0])*m-c*(i[1]-r[1]),v=(e[0]-r[0])*m-c*(e[1]-r[1]);return g>0&&v<0||g<0&&v>0}function lh(i,e,r){for(const I of r)for(let A=0;A<I.length-1;++A)if((v=[(g=I[A+1])[0]-(m=I[A])[0],g[1]-m[1]])[0]*(S=[(c=e)[0]-(s=i)[0],c[1]-s[1]])[1]-v[1]*S[0]!=0&&Nl(s,c,m,g)&&Nl(m,g,s,c))return!0;var s,c,m,g,v,S;return!1}function ql(i,e){for(let r=0;r<i.length;++r)if(!va(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(lh(i[r],i[r+1],e))return!1;return!0}function Zl(i,e){for(let r=0;r<e.length;r++)if(ql(i,e[r]))return!0;return!1}function xa(i,e,r){const s=[];for(let c=0;c<i.length;c++){const m=[];for(let g=0;g<i[c].length;g++){const v=ah(i[c][g],r);ya(e,v),m.push(v)}s.push(m)}return s}function Gl(i,e,r){const s=[];for(let c=0;c<i.length;c++){const m=xa(i[c],e,r);s.push(m)}return s}function Hl(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const c=.5*s;let m=i[0]-r[0]>c?-s:r[0]-i[0]>c?s:0;m===0&&(m=i[0]-r[2]>c?-s:r[2]-i[0]>c?s:0),i[0]+=m}ya(e,i)}function ba(i,e,r,s){const c=Math.pow(2,s.z)*kn,m=[s.x*kn,s.y*kn],g=[];for(const v of i)for(const S of v){const I=[S.x+m[0],S.y+m[1]];Hl(I,e,r,c),g.push(I)}return g}function Wl(i,e,r,s){const c=Math.pow(2,s.z)*kn,m=[s.x*kn,s.y*kn],g=[];for(const S of i){const I=[];for(const A of S){const E=[A.x+m[0],A.y+m[1]];ya(e,E),I.push(E)}g.push(I)}if(e[2]-e[0]<=c/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of g)for(const I of S)Hl(I,e,r,c)}var v;return g}class Bn{constructor(e,r){this.type=pt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(fa(e[1])){const s=e[1];if(s.type==="FeatureCollection"){const c=[];for(const m of s.features){const{type:g,coordinates:v}=m.geometry;g==="Polygon"&&c.push(v),g==="MultiPolygon"&&c.push(...v)}if(c.length)return new Bn(s,{type:"MultiPolygon",coordinates:c})}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Bn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Bn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(s.type==="Polygon"){const v=xa(s.coordinates,m,g),S=ba(r.geometry(),c,m,g);if(!Ds(c,m))return!1;for(const I of S)if(!va(I,v))return!1}if(s.type==="MultiPolygon"){const v=Gl(s.coordinates,m,g),S=ba(r.geometry(),c,m,g);if(!Ds(c,m))return!1;for(const I of S)if(!oh(I,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(s.type==="Polygon"){const v=xa(s.coordinates,m,g),S=Wl(r.geometry(),c,m,g);if(!Ds(c,m))return!1;for(const I of S)if(!ql(I,v))return!1}if(s.type==="MultiPolygon"){const v=Gl(s.coordinates,m,g),S=Wl(r.geometry(),c,m,g);if(!Ds(c,m))return!1;for(const I of S)if(!Zl(I,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class wa{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new wa(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Lr{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],c=Lr.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,v=g.filter(([I])=>!Array.isArray(I)||I.length===e.length-1);let S=null;for(const[I,A]of v){S=new _a(r.registry,Rs,r.path,null,r.scope);const E=[];let L=!1;for(let O=1;O<e.length;O++){const B=e[O],V=Array.isArray(I)?I[O-1]:I.type,X=S.parse(B,1+E.length,V);if(!X){L=!0;break}E.push(X)}if(!L)if(Array.isArray(I)&&I.length!==E.length)S.error(`Expected ${I.length} arguments, but found ${E.length} instead.`);else{for(let O=0;O<E.length;O++){const B=Array.isArray(I)?I[O]:I.type,V=E[O];S.concat(O+1).checkSubtype(B,V.type)}if(S.errors.length===0)return new Lr(s,m,A,E)}}if(v.length===1)r.errors.push(...S.errors);else{const I=(v.length?v:g).map(([E])=>{return L=E,Array.isArray(L)?`(${L.map(G).join(", ")})`:`(${G(L.type)}...)`;var L}).join(" | "),A=[];for(let E=1;E<e.length;E++){const L=r.parse(e[E],1+A.length);if(!L)return null;A.push(G(L.type))}r.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){Lr.definitions=r;for(const s in r)e[s]=Lr}}function Rs(i){if(i instanceof wa)return Rs(i.boundExpression);if(i instanceof Lr&&i.name==="error"||i instanceof hs||i instanceof Bn)return!1;const e=i instanceof sn||i instanceof zr;let r=!0;return i.eachChild(s=>{r=e?r&&Rs(s):r&&s instanceof Tn}),!!r&&Sa(i)&&Fs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Sa(i){if(i instanceof Lr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Bn)return!1;let e=!0;return i.eachChild(r=>{e&&!Sa(r)&&(e=!1)}),e}function Os(i){if(i instanceof Lr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Os(r)&&(e=!1)}),e}function Fs(i,e){if(i instanceof Lr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Fs(s,e)&&(r=!1)}),r}function Bs(i,e){const r=i.length-1;let s,c,m=0,g=r,v=0;for(;m<=g;)if(v=Math.floor((m+g)/2),s=i[v],c=i[v+1],s<=e){if(v===r||e<c)return v;m=v+1}else{if(!(s>e))throw new pi("Input is not a number.");g=v-1}return 0}class js{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,m]of s)this.labels.push(c),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Le);if(!s)return null;const c=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let g=1;g<e.length;g+=2){const v=g===1?-1/0:e[g],S=e[g+1],I=g,A=g+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(c.length&&c[c.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const E=r.parse(S,A,m);if(!E)return null;m=m||E.type,c.push([v,E])}return new js(m,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const m=r.length;return c>=r[m-1]?s[m-1].evaluate(e):s[Bs(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ch(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var hh=Kl;function Kl(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}Kl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=c/m}var g=0,v=1;for(r=i,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<e));s++)i>c?g=r:v=r,r=.5*(v-g)+g;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var uh=ch(hh);function jn(i,e,r){return i+r*(e-i)}function Ta(i,e,r){return i.map((s,c)=>jn(s,e[c],r))}const hr={number:jn,color:function(i,e,r,s="rgb"){switch(s){case"rgb":{const[c,m,g,v]=Ta(i.rgb,e.rgb,r);return new Gt(c,m,g,v,!1)}case"hcl":{const[c,m,g,v]=i.hcl,[S,I,A,E]=e.hcl;let L,O;if(isNaN(c)||isNaN(S))isNaN(c)?isNaN(S)?L=NaN:(L=S,g!==1&&g!==0||(O=I)):(L=c,A!==1&&A!==0||(O=m));else{let le=S-c;S>c&&le>180?le-=360:S<c&&c-S>180&&(le+=360),L=c+r*le}const[B,V,X,$]=function([le,ee,se,me]){return le=isNaN(le)?0:le*lt,_i([se,Math.cos(le)*ee,Math.sin(le)*ee,me])}([L,O??jn(m,I,r),jn(g,A,r),jn(v,E,r)]);return new Gt(B,V,X,$,!1)}case"lab":{const[c,m,g,v]=_i(Ta(i.lab,e.lab,r));return new Gt(c,m,g,v,!1)}}},array:Ta,padding:function(i,e,r){return new xr(Ta(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const s=i.values,c=e.values;if(s.length!==c.length)throw new pi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const m=[];for(let g=0;g<s.length;g+=2){if(s[g]!==c[g])throw new pi(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${s[g]}, to[${g}]: ${c[g]}`);m.push(s[g]);const[v,S]=s[g+1],[I,A]=c[g+1];m.push([jn(v,I,r),jn(S,A,r)])}return new Vr(m)}};class rr{constructor(e,r,s,c,m){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[g,v]of m)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(e,r,s,c){let m=0;if(e.name==="exponential")m=Ot(r,e.base,s,c);else if(e.name==="linear")m=Ot(r,1,s,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new uh(g[0],g[1],g[2],g[3]).solve(Ot(r,1,s,c))}return m}static parse(e,r){let[s,c,m,...g]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const I=c[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:I}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const I=c.slice(1);if(I.length!==4||I.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,Le),!m)return null;const v=[];let S=null;s==="interpolate-hcl"||s==="interpolate-lab"?S=Ai:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let I=0;I<g.length;I+=2){const A=g[I],E=g[I+1],L=I+3,O=I+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const B=r.parse(E,O,S);if(!B)return null;S=S||B.type,v.push([A,B])}return ce(S,Le)||ce(S,Ai)||ce(S,J)||ce(S,R)||ce(S,j(Le))?new rr(S,s,c,m,v):r.error(`Type ${G(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const m=r.length;if(c>=r[m-1])return s[m-1].evaluate(e);const g=Bs(r,c),v=rr.interpolationFactor(this.interpolation,c,r[g],r[g+1]),S=s[g].evaluate(e),I=s[g+1].evaluate(e);switch(this.operator){case"interpolate":return hr[this.type.kind](S,I,v);case"interpolate-hcl":return hr.color(S,I,v,"hcl");case"interpolate-lab":return hr.color(S,I,v,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ot(i,e,r,s){const c=s-r,m=i-r;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class ka{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const m=[];for(const v of e.slice(1)){const S=r.parse(v,1+m.length,s,void 0,{typeAnnotation:"omit"});if(!S)return null;s=s||S.type,m.push(S)}if(!s)throw new Error("No output type");const g=c&&m.some(v=>ne(c,v.type));return new ka(g?ht:s,m)}evaluate(e){let r,s=null,c=0;for(const m of this.args)if(c++,s=m.evaluate(e),s&&s instanceof Nr&&!s.available&&(r||(r=s.name),s=null,c===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Ia{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=r.parse(e[m+1],m+1);if(!v)return null;s.push([g,v])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new Ia(s,c):null}outputDefined(){return this.result.outputDefined()}}class Po{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Le),c=r.parse(e[2],2,j(r.expectedType||ht));return s&&c?new Po(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new pi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new pi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new pi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Mo{constructor(e,r){this.type=pt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ht),c=r.parse(e[2],2,ht);return s&&c?oe(s.type,[pt,gt,Le,ir,ht])?new Mo(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${G(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!te(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${G(Pi(r))} instead.`);if(!te(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${G(Pi(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ca{constructor(e,r,s){this.type=Le,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ht),c=r.parse(e[2],2,ht);if(!s||!c)return null;if(!oe(s.type,[pt,gt,Le,ir,ht]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${G(s.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Le);return m?new Ca(s,c,m):null}return new Ca(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!te(r,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${G(Pi(r))} instead.`);if(!te(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${G(Pi(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class zo{constructor(e,r,s,c,m,g){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=m,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const m={},g=[];for(let I=2;I<e.length-1;I+=2){let A=e[I];const E=e[I+1];Array.isArray(A)||(A=[A]);const L=r.concat(I);if(A.length===0)return L.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return L.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,Pi(B)))return null}else s=Pi(B);if(m[String(B)]!==void 0)return L.error("Branch labels must be unique.");m[String(B)]=g.length}const O=r.parse(E,I,c);if(!O)return null;c=c||O.type,g.push(O)}const v=r.parse(e[1],1,ht);if(!v)return null;const S=r.parse(e[e.length-1],e.length-1,c);return S?v.type.kind!=="value"&&r.concat(1).checkSubtype(s,v.type)?null:new zo(s,c,v,m,g,S):null}evaluate(e){const r=this.input.evaluate(e);return(Pi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Lo{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const v=r.parse(e[g],g,pt);if(!v)return null;const S=r.parse(e[g+1],g+1,s);if(!S)return null;c.push([v,S]),s=s||S.type}const m=r.parse(e[e.length-1],e.length-1,s);if(!m)return null;if(!s)throw new Error("Can't infer output type");return new Lo(s,c,m)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Aa{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ht),c=r.parse(e[2],2,Le);if(!s||!c)return null;if(!oe(s.type,[j(ht),gt,ht]))return r.error(`Expected first argument to be of type array or string, but found ${G(s.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Le);return m?new Aa(s.type,s,c,m):null}return new Aa(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!te(r,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${G(Pi(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Xl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jl(i,e,r,s){return s.compare(e,r)===0}function us(i,e,r){const s=i!=="=="&&i!=="!=";return class yf{constructor(m,g,v){this.type=pt,this.lhs=m,this.rhs=g,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const v=m[0];let S=g.parse(m[1],1,ht);if(!S)return null;if(!Xl(v,S.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${G(S.type)}'.`);let I=g.parse(m[2],2,ht);if(!I)return null;if(!Xl(v,I.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${G(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return g.error(`Cannot compare types '${G(S.type)}' and '${G(I.type)}'.`);s&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new zr(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new zr(S.type,[I])));let A=null;if(m.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(m[3],3,Fn),!A)return null}return new yf(S,I,A)}evaluate(m){const g=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(s&&this.hasUntypedArgument){const S=Pi(g),I=Pi(v);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new pi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const S=Pi(g),I=Pi(v);if(S.kind!=="string"||I.kind!=="string")return e(m,g,v)}return this.collator?r(m,g,v,this.collator.evaluate(m)):e(m,g,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const dh=us("==",function(i,e,r){return e===r},Jl),ph=us("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!Jl(0,e,r,s)}),fh=us("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),mh=us(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),gh=us("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),_h=us(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class Do{constructor(e,r,s,c,m){this.type=gt,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Le);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=r.parse(c.locale,1,gt),!m))return null;let g=null;if(c.currency&&(g=r.parse(c.currency,1,gt),!g))return null;let v=null;if(c["min-fraction-digits"]&&(v=r.parse(c["min-fraction-digits"],1,Le),!v))return null;let S=null;return c["max-fraction-digits"]&&(S=r.parse(c["max-fraction-digits"],1,Le),!S)?null:new Do(s,m,g,v,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ea{constructor(e){this.type=Ri,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=e.length-1;++g){const v=e[g];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let S=null;if(v["font-scale"]&&(S=r.parse(v["font-scale"],1,Le),!S))return null;let I=null;if(v["text-font"]&&(I=r.parse(v["text-font"],1,j(gt)),!I))return null;let A=null;if(v["text-color"]&&(A=r.parse(v["text-color"],1,Ai),!A))return null;const E=c[c.length-1];E.scale=S,E.font=I,E.textColor=A}else{const S=r.parse(e[g],1,ht);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:S,scale:null,font:null,textColor:null})}}return new Ea(c)}evaluate(e){return new Mr(this.sections.map(r=>{const s=r.content.evaluate(e);return Pi(s)===z?new Eo("",s,null,null,null):new Eo(zs(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Ro{constructor(e){this.type=z,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,gt);return s?new Ro(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Nr.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class Oo{constructor(e){this.type=Le,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${G(s.type)} instead.`):new Oo(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new pi(`Expected value to be of type string or array, but found ${G(Pi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ds={"==":dh,"!=":ph,">":mh,"<":fh,">=":_h,"<=":gh,array:zr,at:Po,boolean:zr,case:Lo,coalesce:ka,collator:hs,format:Ea,image:Ro,in:Mo,"index-of":Ca,interpolate:rr,"interpolate-hcl":rr,"interpolate-lab":rr,length:Oo,let:Ia,literal:Tn,match:zo,number:zr,"number-format":Do,object:zr,slice:Aa,step:js,string:zr,"to-boolean":sn,"to-color":sn,"to-number":sn,"to-string":sn,var:wa,within:Bn};function Yl(i,[e,r,s,c]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const m=c?c.evaluate(i):1,g=cs(e,r,s,m);if(g)throw new pi(g);return new Gt(e/255,r/255,s/255,m,!1)}function Ql(i,e){return i in e}function Fo(i,e){const r=e[i];return r===void 0?null:r}function Un(i){return{type:i}}function $l(i){return{result:"success",value:i}}function ps(i){return{result:"error",value:i}}function fs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ec(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Bo(i){return!!i.expression&&i.expression.interpolated}function zt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Pa(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function yh(i){return i}function tc(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",c=s||!(s||i.property!==void 0),m=i.type||(Bo(e)?"exponential":"interval");if(r||e.type==="padding"){const A=r?Gt.parse:xr.parse;(i=tn({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],A(E[1])])),i.default=A(i.default?i.default:e.default)}if(i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;let v,S,I;if(m==="exponential")v=Et;else if(m==="interval")v=vh;else if(m==="categorical"){v=Si,S=Object.create(null);for(const A of i.stops)S[A[0]]=A[1];I=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);v=jo}if(s){const A={},E=[];for(let B=0;B<i.stops.length;B++){const V=i.stops[B],X=V[0].zoom;A[X]===void 0&&(A[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},E.push(X)),A[X].stops.push([V[0].value,V[1]])}const L=[];for(const B of E)L.push([A[B].zoom,tc(A[B],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:rr.interpolationFactor.bind(void 0,O),zoomStops:L.map(B=>B[0]),evaluate:({zoom:B},V)=>Et({stops:L,base:i.base},e,B).evaluate(B,V)}}if(c){const A=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:rr.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(E=>E[0]),evaluate:({zoom:E})=>v(i,e,E,S,I)}}return{kind:"source",evaluate(A,E){const L=E&&E.properties?E.properties[i.property]:void 0;return L===void 0?Us(i.default,e.default):v(i,e,L,S,I)}}}function Us(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Si(i,e,r,s,c){return Us(typeof r===c?s[r]:void 0,i.default,e.default)}function vh(i,e,r){if(zt(r)!=="number")return Us(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=Bs(i.stops.map(m=>m[0]),r);return i.stops[c][1]}function Et(i,e,r){const s=i.base!==void 0?i.base:1;if(zt(r)!=="number")return Us(i.default,e.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const m=Bs(i.stops.map(A=>A[0]),r),g=function(A,E,L,O){const B=O-L,V=A-L;return B===0?0:E===1?V/B:(Math.pow(E,V)-1)/(Math.pow(E,B)-1)}(r,s,i.stops[m][0],i.stops[m+1][0]),v=i.stops[m][1],S=i.stops[m+1][1],I=hr[e.type]||yh;return typeof v.evaluate=="function"?{evaluate(...A){const E=v.evaluate.apply(void 0,A),L=S.evaluate.apply(void 0,A);if(E!==void 0&&L!==void 0)return I(E,L,g,i.colorSpace)}}:I(v,S,g,i.colorSpace)}function jo(i,e,r){switch(e.type){case"color":r=Gt.parse(r);break;case"formatted":r=Mr.fromString(r.toString());break;case"resolvedImage":r=Nr.fromString(r.toString());break;case"padding":r=xr.parse(r);break;default:zt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Us(r,i.default,e.default)}Lr.register(ds,{error:[{kind:"error"},[gt],(i,[e])=>{throw new pi(e.evaluate(i))}],typeof:[gt,[ht],(i,[e])=>G(Pi(e.evaluate(i)))],"to-rgba":[j(Le,4),[Ai],(i,[e])=>{const[r,s,c,m]=e.evaluate(i).rgb;return[255*r,255*s,255*c,m]}],rgb:[Ai,[Le,Le,Le],Yl],rgba:[Ai,[Le,Le,Le,Le],Yl],has:{type:pt,overloads:[[[gt],(i,[e])=>Ql(e.evaluate(i),i.properties())],[[gt,rn],(i,[e,r])=>Ql(e.evaluate(i),r.evaluate(i))]]},get:{type:ht,overloads:[[[gt],(i,[e])=>Fo(e.evaluate(i),i.properties())],[[gt,rn],(i,[e,r])=>Fo(e.evaluate(i),r.evaluate(i))]]},"feature-state":[ht,[gt],(i,[e])=>Fo(e.evaluate(i),i.featureState||{})],properties:[rn,[],i=>i.properties()],"geometry-type":[gt,[],i=>i.geometryType()],id:[ht,[],i=>i.id()],zoom:[Le,[],i=>i.globals.zoom],"heatmap-density":[Le,[],i=>i.globals.heatmapDensity||0],"line-progress":[Le,[],i=>i.globals.lineProgress||0],accumulated:[ht,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Le,Un(Le),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[Le,Un(Le),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:Le,overloads:[[[Le,Le],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Le],(i,[e])=>-e.evaluate(i)]]},"/":[Le,[Le,Le],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Le,[Le,Le],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Le,[Le],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Le,[Le],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Le,[Le],(i,[e])=>Math.log(e.evaluate(i))],log2:[Le,[Le],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Le,[Le],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Le,[Le],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Le,[Le],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Le,[Le],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Le,[Le],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Le,[Le],(i,[e])=>Math.atan(e.evaluate(i))],min:[Le,Un(Le),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Le,Un(Le),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Le,[Le],(i,[e])=>Math.abs(e.evaluate(i))],round:[Le,[Le],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Le,[Le],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Le,[Le],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[pt,[gt,ht],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[pt,[ht],(i,[e])=>i.id()===e.value],"filter-type-==":[pt,[gt],(i,[e])=>i.geometryType()===e.value],"filter-<":[pt,[gt,ht],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[pt,[ht],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[pt,[gt,ht],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[pt,[ht],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[pt,[gt,ht],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[pt,[ht],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[pt,[gt,ht],(i,[e,r])=>{const s=i.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[pt,[ht],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[pt,[ht],(i,[e])=>e.value in i.properties()],"filter-has-id":[pt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[pt,[j(gt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[pt,[j(ht)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[pt,[gt,j(ht)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[pt,[gt,j(ht)],(i,[e,r])=>function(s,c,m,g){for(;m<=g;){const v=m+g>>1;if(c[v]===s)return!0;c[v]>s?g=v-1:m=v+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:pt,overloads:[[[pt,pt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Un(pt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:pt,overloads:[[[pt,pt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Un(pt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[pt,[pt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[pt,[gt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[gt,[gt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[gt,[gt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[gt,Un(ht),(i,e)=>e.map(r=>zs(r.evaluate(i))).join("")],"resolved-locale":[gt,[Fn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ei{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new Ht,this._defaultValue=r?(s=r).type==="color"&&Pa(s.default)?new Gt(0,0,0,0):s.type==="color"?Gt.parse(s.default)||null:s.type==="padding"?xr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Vr.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,m,g){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,m,g){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Qt(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ds}function Vn(i,e){const r=new _a(ds,Rs,[],e?function(c){const m={color:Ai,string:gt,number:Le,enum:gt,boolean:pt,formatted:Ri,padding:J,resolvedImage:z,variableAnchorOffsetCollection:R};return c.type==="array"?j(m[c.value]||ht,c.length):m[c.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?$l(new ei(s,e)):ps(r.errors)}class Ma{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Os(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,m,g)}evaluate(e,r,s,c,m,g){return this._styleExpression.evaluate(e,r,s,c,m,g)}}class Uo{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Os(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,m,g)}evaluate(e,r,s,c,m,g){return this._styleExpression.evaluate(e,r,s,c,m,g)}interpolationFactor(e,r,s){return this.interpolationType?rr.interpolationFactor(this.interpolationType,e,r,s):0}}function ic(i,e){const r=Vn(i,e);if(r.result==="error")return r;const s=r.value.expression,c=Sa(s);if(!c&&!fs(e))return ps([new Pr("","data expressions not supported")]);const m=Fs(s,["zoom"]);if(!m&&!ec(e))return ps([new Pr("","zoom expressions not supported")]);const g=La(s);return g||m?g instanceof Pr?ps([g]):g instanceof rr&&!Bo(e)?ps([new Pr("",'"interpolate" expressions cannot be used with this property')]):$l(g?new Uo(c?"camera":"composite",r.value,g.labels,g instanceof rr?g.interpolation:void 0):new Ma(c?"constant":"source",r.value)):ps([new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class za{constructor(e,r){this._parameters=e,this._specification=r,tn(this,tc(this._parameters,this._specification))}static deserialize(e){return new za(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function La(i){let e=null;if(i instanceof Ia)e=La(i.result);else if(i instanceof ka){for(const r of i.args)if(e=La(r),e)break}else(i instanceof js||i instanceof rr)&&i.input instanceof Lr&&i.input.name==="zoom"&&(e=i);return e instanceof Pr||i.eachChild(r=>{const s=La(r);s instanceof Pr?e=s:!e&&s?e=new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Da(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Da(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const rc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ra(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Da(i)||(i=Fa(i));const e=Vn(i,rc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,c)=>e.value.evaluate(r,s,{},c),needGeometry:Oa(i)}}function nc(i,e){return i<e?-1:i>e?1:0}function Oa(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Oa(i[e]))return!0;return!1}function Fa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Vo(i[1],i[2],"=="):e==="!="?Ba(Vo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Vo(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Fa))):e==="all"?["all"].concat(i.slice(1).map(Fa)):e==="none"?["all"].concat(i.slice(1).map(Fa).map(Ba)):e==="in"?sc(i[1],i.slice(2)):e==="!in"?Ba(sc(i[1],i.slice(2))):e==="has"?ac(i[1]):e==="!has"?Ba(ac(i[1])):e!=="within"||i;var r}function Vo(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function sc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(nc)]]:["filter-in-small",i,["literal",e]]}}function ac(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ba(i){return["!",i]}function No(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const m of i)c+=`${No(m)},`;return`${c}]`}const r=Object.keys(i).sort();let s="{";for(let c=0;c<r.length;c++)s+=`${JSON.stringify(r[c])}:${No(i[r[c]])},`;return`${s}}`}function xh(i){let e="";for(const r of tr)e+=`/${No(i[r])}`;return e}function oc(i){const e=i.value;return e?[new Pe(i.key,e,"constants have been deprecated as of v8")]:[]}function yi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function In(i){if(Array.isArray(i))return i.map(In);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=In(i[r]);return e}return yi(i)}function ur(i){const e=i.key,r=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},m=i.style,g=i.styleSpec,v=i.validateSpec;let S=[];const I=zt(r);if(I!=="object")return[new Pe(e,r,`object expected, ${I} found`)];for(const A in r){const E=A.split(".")[0],L=s[E]||s["*"];let O;if(c[E])O=c[E];else if(s[E])O=v;else if(c["*"])O=c["*"];else{if(!s["*"]){S.push(new Pe(e,r[A],`unknown property "${A}"`));continue}O=v}S=S.concat(O({key:(e&&`${e}.`)+A,value:r[A],valueSpec:L,style:m,styleSpec:g,object:r,objectKey:A,validateSpec:v},r))}for(const A in s)c[A]||s[A].required&&s[A].default===void 0&&r[A]===void 0&&S.push(new Pe(e,r,`missing required property "${A}"`));return S}function qo(i){const e=i.value,r=i.valueSpec,s=i.style,c=i.styleSpec,m=i.key,g=i.arrayElementValidator||i.validateSpec;if(zt(e)!=="array")return[new Pe(m,e,`array expected, ${zt(e)} found`)];if(r.length&&e.length!==r.length)return[new Pe(m,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Pe(m,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let v={type:r.value,values:r.values};c.$version<7&&(v.function=r.function),zt(r.value)==="object"&&(v=r.value);let S=[];for(let I=0;I<e.length;I++)S=S.concat(g({array:e,arrayIndex:I,value:e[I],valueSpec:v,validateSpec:i.validateSpec,style:s,styleSpec:c,key:`${m}[${I}]`}));return S}function ja(i){const e=i.key,r=i.value,s=i.valueSpec;let c=zt(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new Pe(e,r,`number expected, ${c} found`)]:"minimum"in s&&r<s.minimum?[new Pe(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Pe(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function lc(i){const e=i.valueSpec,r=yi(i.value.type);let s,c,m,g={};const v=r!=="categorical"&&i.value.property===void 0,S=!v,I=zt(i.value.stops)==="array"&&zt(i.value.stops[0])==="array"&&zt(i.value.stops[0][0])==="object",A=ur({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new Pe(O.key,O.value,'identity function may not have a "stops" property')];let B=[];const V=O.value;return B=B.concat(qo({key:O.key,value:V,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:E})),zt(V)==="array"&&V.length===0&&B.push(new Pe(O.key,V,"array must have at least one stop")),B},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&v&&A.push(new Pe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||A.push(new Pe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Bo(i.valueSpec)&&A.push(new Pe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!fs(i.valueSpec)?A.push(new Pe(i.key,i.value,"property functions not supported")):v&&!ec(i.valueSpec)&&A.push(new Pe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!I||i.value.property!==void 0||A.push(new Pe(i.key,i.value,'"property" property is required')),A;function E(O){let B=[];const V=O.value,X=O.key;if(zt(V)!=="array")return[new Pe(X,V,`array expected, ${zt(V)} found`)];if(V.length!==2)return[new Pe(X,V,`array length 2 expected, length ${V.length} found`)];if(I){if(zt(V[0])!=="object")return[new Pe(X,V,`object expected, ${zt(V[0])} found`)];if(V[0].zoom===void 0)return[new Pe(X,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new Pe(X,V,"object stop key must have value")];if(m&&m>yi(V[0].zoom))return[new Pe(X,V[0].zoom,"stop zoom values must appear in ascending order")];yi(V[0].zoom)!==m&&(m=yi(V[0].zoom),c=void 0,g={}),B=B.concat(ur({key:`${X}[0]`,value:V[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:ja,value:L}}))}else B=B.concat(L({key:`${X}[0]`,value:V[0],valueSpec:{},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},V));return Qt(In(V[1]))?B.concat([new Pe(`${X}[1]`,V[1],"expressions are not allowed in function stops.")]):B.concat(O.validateSpec({key:`${X}[1]`,value:V[1],valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function L(O,B){const V=zt(O.value),X=yi(O.value),$=O.value!==null?O.value:B;if(s){if(V!==s)return[new Pe(O.key,$,`${V} stop domain type must match previous stop domain type ${s}`)]}else s=V;if(V!=="number"&&V!=="string"&&V!=="boolean")return[new Pe(O.key,$,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&r!=="categorical"){let le=`number expected, ${V} found`;return fs(e)&&r===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(O.key,$,le)]}return r!=="categorical"||V!=="number"||isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&V==="number"&&c!==void 0&&X<c?[new Pe(O.key,$,"stop domain values must appear in ascending order")]:(c=X,r==="categorical"&&X in g?[new Pe(O.key,$,"stop domain values must be unique")]:(g[X]=!0,[])):[new Pe(O.key,$,`integer expected, found ${X}`)]}}function Cn(i){const e=(i.expressionContext==="property"?ic:Vn)(In(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new Pe(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Pe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Os(r))return[new Pe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Os(r))return[new Pe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Fs(r,["zoom","feature-state"]))return[new Pe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Sa(r))return[new Pe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function An(i){const e=i.key,r=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(yi(r))===-1&&c.push(new Pe(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(yi(r))===-1&&c.push(new Pe(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function ms(i){return Da(In(i.value))?Cn(tn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ua(i)}function Ua(i){const e=i.value,r=i.key;if(zt(e)!=="array")return[new Pe(r,e,`array expected, ${zt(e)} found`)];const s=i.styleSpec;let c,m=[];if(e.length<1)return[new Pe(r,e,"filter array must have at least 1 element")];switch(m=m.concat(An({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),yi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&yi(e[1])==="$type"&&m.push(new Pe(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Pe(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=zt(e[1]),c!=="string"&&m.push(new Pe(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=zt(e[g]),yi(e[1])==="$type"?m=m.concat(An({key:`${r}[${g}]`,value:e[g],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Pe(`${r}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(Ua({key:`${r}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=zt(e[1]),e.length!==2?m.push(new Pe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Pe(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=zt(e[1]),e.length!==2?m.push(new Pe(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&m.push(new Pe(`${r}[1]`,e[1],`object expected, ${c} found`))}return m}function Zo(i,e){const r=i.key,s=i.validateSpec,c=i.style,m=i.styleSpec,g=i.value,v=i.objectKey,S=m[`${e}_${i.layerType}`];if(!S)return[];const I=v.match(/^(.*)-transition$/);if(e==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return s({key:r,value:g,valueSpec:m.transition,style:c,styleSpec:m});const A=i.valueSpec||S[v];if(!A)return[new Pe(r,g,`unknown property "${v}"`)];let E;if(zt(g)==="string"&&fs(A)&&!A.tokens&&(E=/^{([^}]+)}$/.exec(g)))return[new Pe(r,g,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const L=[];return i.layerType==="symbol"&&(v==="text-field"&&c&&!c.glyphs&&L.push(new Pe(r,g,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Pa(In(g))&&yi(g.type)==="identity"&&L.push(new Pe(r,g,'"text-font" does not support identity functions'))),L.concat(s({key:i.key,value:g,valueSpec:A,style:c,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:v}))}function Go(i){return Zo(i,"paint")}function Vs(i){return Zo(i,"layout")}function cc(i){let e=[];const r=i.value,s=i.key,c=i.style,m=i.styleSpec;r.type||r.ref||e.push(new Pe(s,r,'either "type" or "ref" is required'));let g=yi(r.type);const v=yi(r.ref);if(r.id){const S=yi(r.id);for(let I=0;I<i.arrayIndex;I++){const A=c.layers[I];yi(A.id)===S&&e.push(new Pe(s,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let S;["type","source","source-layer","filter","layout"].forEach(I=>{I in r&&e.push(new Pe(s,r[I],`"${I}" is prohibited for ref layers`))}),c.layers.forEach(I=>{yi(I.id)===v&&(S=I)}),S?S.ref?e.push(new Pe(s,r.ref,"ref cannot reference another ref layer")):g=yi(S.type):e.push(new Pe(s,r.ref,`ref layer "${v}" not found`))}else if(g!=="background")if(r.source){const S=c.sources&&c.sources[r.source],I=S&&yi(S.type);S?I==="vector"&&g==="raster"?e.push(new Pe(s,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&g==="hillshade"?e.push(new Pe(s,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&g!=="raster"?e.push(new Pe(s,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&g!=="hillshade"?e.push(new Pe(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&S.lineMetrics||e.push(new Pe(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Pe(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Pe(s,r.source,`source "${r.source}" not found`))}else e.push(new Pe(s,r,'missing required property "source"'));return e=e.concat(ur({key:s,value:r,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:ms,layout:S=>ur({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Vs(tn({layerType:g},I))}}),paint:S=>ur({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Go(tn({layerType:g},I))}})}})),e}function Nn(i){const e=i.value,r=i.key,s=zt(e);return s!=="string"?[new Pe(r,e,`string expected, ${s} found`)]:[]}const hc={promoteId:function({key:i,value:e}){if(zt(e)==="string")return Nn({key:i,value:e});{const r=[];for(const s in e)r.push(...Nn({key:`${i}.${s}`,value:e[s]}));return r}}};function uc(i){const e=i.value,r=i.key,s=i.styleSpec,c=i.style,m=i.validateSpec;if(!e.type)return[new Pe(r,e,'"type" is required')];const g=yi(e.type);let v;switch(g){case"vector":case"raster":return v=ur({key:r,value:e,valueSpec:s[`source_${g.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:hc,validateSpec:m}),v;case"raster-dem":return v=function(S){var I;const A=(I=S.sourceName)!==null&&I!==void 0?I:"",E=S.value,L=S.styleSpec,O=L.source_raster_dem,B=S.style;let V=[];const X=zt(E);if(E===void 0)return V;if(X!=="object")return V.push(new Pe("source_raster_dem",E,`object expected, ${X} found`)),V;const $=yi(E.encoding)==="custom",le=["redFactor","greenFactor","blueFactor","baseShift"],ee=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const se in E)!$&&le.includes(se)?V.push(new Pe(se,E[se],`In "${A}": "${se}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):O[se]?V=V.concat(S.validateSpec({key:se,value:E[se],valueSpec:O[se],validateSpec:S.validateSpec,style:B,styleSpec:L})):V.push(new Pe(se,E[se],`unknown property "${se}"`));return V}({sourceName:r,value:e,style:i.style,styleSpec:s,validateSpec:m}),v;case"geojson":if(v=ur({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,validateSpec:m,objectElementValidators:hc}),e.cluster)for(const S in e.clusterProperties){const[I,A]=e.clusterProperties[S],E=typeof I=="string"?[I,["accumulated"],["get",S]]:I;v.push(...Cn({key:`${r}.${S}.map`,value:A,validateSpec:m,expressionContext:"cluster-map"})),v.push(...Cn({key:`${r}.${S}.reduce`,value:E,validateSpec:m,expressionContext:"cluster-reduce"}))}return v;case"video":return ur({key:r,value:e,valueSpec:s.source_video,style:c,validateSpec:m,styleSpec:s});case"image":return ur({key:r,value:e,valueSpec:s.source_image,style:c,validateSpec:m,styleSpec:s});case"canvas":return[new Pe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return An({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:m,styleSpec:s})}}function dc(i){const e=i.value,r=i.styleSpec,s=r.light,c=i.style;let m=[];const g=zt(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Pe("light",e,`object expected, ${g} found`)]),m;for(const v in e){const S=v.match(/^(.*)-transition$/);m=m.concat(S&&s[S[1]]&&s[S[1]].transition?i.validateSpec({key:v,value:e[v],valueSpec:r.transition,validateSpec:i.validateSpec,style:c,styleSpec:r}):s[v]?i.validateSpec({key:v,value:e[v],valueSpec:s[v],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Pe(v,e[v],`unknown property "${v}"`)])}return m}function Ns(i){const e=i.value,r=i.styleSpec,s=r.sky,c=i.style,m=zt(e);if(e===void 0)return[];if(m!=="object")return[new Pe("sky",e,`object expected, ${m} found`)];let g=[];for(const v in e)g=g.concat(s[v]?qn({key:v,value:e[v],valueSpec:s[v],style:c,styleSpec:r}):[new Pe(v,e[v],`unknown property "${v}"`)]);return g}function qs(i){const e=i.value,r=i.styleSpec,s=r.terrain,c=i.style;let m=[];const g=zt(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Pe("terrain",e,`object expected, ${g} found`)]),m;for(const v in e)m=m.concat(s[v]?i.validateSpec({key:v,value:e[v],valueSpec:s[v],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Pe(v,e[v],`unknown property "${v}"`)]);return m}function br(i){let e=[];const r=i.value,s=i.key;if(Array.isArray(r)){const c=[],m=[];for(const g in r)r[g].id&&c.includes(r[g].id)&&e.push(new Pe(s,r,`all the sprites' ids must be unique, but ${r[g].id} is duplicated`)),c.push(r[g].id),r[g].url&&m.includes(r[g].url)&&e.push(new Pe(s,r,`all the sprites' URLs must be unique, but ${r[g].url} is duplicated`)),m.push(r[g].url),e=e.concat(ur({key:`${s}[${g}]`,value:r[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Nn({key:s,value:r})}const gs={"*":()=>[],array:qo,boolean:function(i){const e=i.value,r=i.key,s=zt(e);return s!=="boolean"?[new Pe(r,e,`boolean expected, ${s} found`)]:[]},number:ja,color:function(i){const e=i.key,r=i.value,s=zt(r);return s!=="string"?[new Pe(e,r,`color expected, ${s} found`)]:Gt.parse(String(r))?[]:[new Pe(e,r,`color expected, "${r}" found`)]},constants:oc,enum:An,filter:ms,function:lc,layer:cc,object:ur,source:uc,light:dc,sky:Ns,terrain:qs,string:Nn,formatted:function(i){return Nn(i).length===0?[]:Cn(i)},resolvedImage:function(i){return Nn(i).length===0?[]:Cn(i)},padding:function(i){const e=i.key,r=i.value;if(zt(r)==="array"){if(r.length<1||r.length>4)return[new Pe(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let c=[];for(let m=0;m<r.length;m++)c=c.concat(i.validateSpec({key:`${e}[${m}]`,value:r[m],validateSpec:i.validateSpec,valueSpec:s}));return c}return ja({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,s=zt(r),c=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Pe(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<r.length;g+=2)m=m.concat(An({key:`${e}[${g}]`,value:r[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(qo({key:`${e}[${g+1}]`,value:r[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return m},sprite:br};function qn(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=qn,r.expression&&Pa(yi(e))?lc(i):r.expression&&Qt(In(e))?Cn(i):r.type&&gs[r.type]?gs[r.type](i):ur(tn({},i,{valueSpec:r.type?s[r.type]:r}))}function pc(i){const e=i.value,r=i.key,s=Nn(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new Pe(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new Pe(r,e,'"glyphs" url must include a "{range}" token'))),s}function Hr(i,e=fe){let r=[];return r=r.concat(qn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:qn,objectElementValidators:{glyphs:pc,"*":()=>[]}})),i.constants&&(r=r.concat(oc({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:qn}))),Ho(r)}function wr(i){return function(e){return i({...e,validateSpec:qn})}}function Ho(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function qr(i){return function(...e){return Ho(i.apply(this,e))}}Hr.source=qr(wr(uc)),Hr.sprite=qr(wr(br)),Hr.glyphs=qr(wr(pc)),Hr.light=qr(wr(dc)),Hr.sky=qr(wr(Ns)),Hr.terrain=qr(wr(qs)),Hr.layer=qr(wr(cc)),Hr.filter=qr(wr(ms)),Hr.paintProperty=qr(wr(Go)),Hr.layoutProperty=qr(wr(Vs));const Zs=Hr,Wo=Zs.light,bh=Zs.paintProperty,Gs=Zs.layoutProperty;function fc(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new qt(new Error(s.message))),r=!0;return r}class Zn{constructor(e,r,s){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(r=g[1])+2*(s=g[2]);for(let S=0;S<this.d*this.d;S++){const I=g[3+S],A=g[3+S+1];c.push(I===A?null:g.subarray(I,A))}const v=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],v),this.bboxes=g.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const m=s/r*e;this.min=-m,this.max=e+m}insert(e,r,s,c,m){this._forEachCell(r,s,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,c,m,g){this.cells[m].push(g)}query(e,r,s,c,m){const g=this.min,v=this.max;if(e<=g&&r<=g&&v<=s&&v<=c&&!m)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,r,s,c,this._queryCell,S,{},m),S}}_queryCell(e,r,s,c,m,g,v,S){const I=this.cells[m];if(I!==null){const A=this.keys,E=this.bboxes;for(let L=0;L<I.length;L++){const O=I[L];if(v[O]===void 0){const B=4*O;(S?S(E[B+0],E[B+1],E[B+2],E[B+3]):e<=E[B+2]&&r<=E[B+3]&&s>=E[B+0]&&c>=E[B+1])?(v[O]=!0,g.push(A[O])):v[O]=!1}}}}_forEachCell(e,r,s,c,m,g,v,S){const I=this._convertToCellCoord(e),A=this._convertToCellCoord(r),E=this._convertToCellCoord(s),L=this._convertToCellCoord(c);for(let O=I;O<=E;O++)for(let B=A;B<=L;B++){const V=this.d*B+O;if((!S||S(this._convertFromCellCoord(O),this._convertFromCellCoord(B),this._convertFromCellCoord(O+1),this._convertFromCellCoord(B+1)))&&m.call(this,e,r,s,c,V,g,v,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let g=0;g<this.cells.length;g++)s+=this.cells[g].length;const c=new Int32Array(r+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=r;for(let g=0;g<e.length;g++){const v=e[g];c[3+g]=m,c.set(v,m),m+=v.length}return c[3+e.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+e.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new Zn(e.buffer)}}const fn={};function Ve(i,e,r={}){if(fn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),fn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ve("Object",Object),Ve("TransferableGridIndex",Zn),Ve("Color",Gt),Ve("Error",Error),Ve("AJAXError",Ee),Ve("ResolvedImage",Nr),Ve("StylePropertyFunction",za),Ve("StyleExpression",ei,{omit:["_evaluator"]}),Ve("ZoomDependentExpression",Uo),Ve("ZoomConstantExpression",Ma),Ve("CompoundExpression",Lr,{omit:["_evaluate"]});for(const i in ds)ds[i]._classRegistryKey||Ve(`Expression_${i}`,ds[i]);function Ko(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function _s(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error)return i;if(Ko(i)||ct(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(_s(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${r.name}`);if(!fn[s])throw new Error(`${s} is not registered.`);const c=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in i){if(!i.hasOwnProperty(m)||fn[s].omit.indexOf(m)>=0)continue;const g=i[m];c[m]=fn[s].shallow.indexOf(m)>=0?g:_s(g,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof i)}function Hs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Ko(i)||ct(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Hs);if(typeof i=="object"){const e=i.$name||"Object";if(!fn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=fn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const m=i[c];s[c]=fn[e].shallow.indexOf(c)>=0?m:Hs(m)}return s}throw new Error("can't deserialize object of type "+typeof i)}class Va{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Oe={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Na(i){for(const e of i)if(qa(e.charCodeAt(0)))return!0;return!1}function mc(i){for(const e of i)if(!gc(e.charCodeAt(0)))return!1;return!0}function gc(i){return!(Oe.Arabic(i)||Oe["Arabic Supplement"](i)||Oe["Arabic Extended-A"](i)||Oe["Arabic Presentation Forms-A"](i)||Oe["Arabic Presentation Forms-B"](i))}function qa(i){return!(i!==746&&i!==747&&(i<4352||!(Oe["Bopomofo Extended"](i)||Oe.Bopomofo(i)||Oe["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Oe["CJK Compatibility Ideographs"](i)||Oe["CJK Compatibility"](i)||Oe["CJK Radicals Supplement"](i)||Oe["CJK Strokes"](i)||!(!Oe["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Oe["CJK Unified Ideographs Extension A"](i)||Oe["CJK Unified Ideographs"](i)||Oe["Enclosed CJK Letters and Months"](i)||Oe["Hangul Compatibility Jamo"](i)||Oe["Hangul Jamo Extended-A"](i)||Oe["Hangul Jamo Extended-B"](i)||Oe["Hangul Jamo"](i)||Oe["Hangul Syllables"](i)||Oe.Hiragana(i)||Oe["Ideographic Description Characters"](i)||Oe.Kanbun(i)||Oe["Kangxi Radicals"](i)||Oe["Katakana Phonetic Extensions"](i)||Oe.Katakana(i)&&i!==12540||!(!Oe["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Oe["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Oe["Unified Canadian Aboriginal Syllabics"](i)||Oe["Unified Canadian Aboriginal Syllabics Extended"](i)||Oe["Vertical Forms"](i)||Oe["Yijing Hexagram Symbols"](i)||Oe["Yi Syllables"](i)||Oe["Yi Radicals"](i))))}function Za(i){return!(qa(i)||function(e){return!!(Oe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Oe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Oe["Letterlike Symbols"](e)||Oe["Number Forms"](e)||Oe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Oe["Control Pictures"](e)&&e!==9251||Oe["Optical Character Recognition"](e)||Oe["Enclosed Alphanumerics"](e)||Oe["Geometric Shapes"](e)||Oe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Oe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Oe["CJK Symbols and Punctuation"](e)||Oe.Katakana(e)||Oe["Private Use Area"](e)||Oe["CJK Compatibility Forms"](e)||Oe["Small Form Variants"](e)||Oe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Xo(i){return i>=1424&&i<=2303||Oe["Arabic Presentation Forms-A"](i)||Oe["Arabic Presentation Forms-B"](i)}function wh(i,e){return!(!e&&Xo(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Oe.Khmer(i))}function _c(i){for(const e of i)if(Xo(e.charCodeAt(0)))return!0;return!1}const Gn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ti{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Va,this.transition={})}isSupportedScript(e){return function(r,s){for(const c of r)if(!wh(c.charCodeAt(0),s))return!1;return!0}(e,Gn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Ws{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(Pa(s))return new za(s,c);if(Qt(s)){const m=ic(s,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=s;return c.type==="color"&&typeof s=="string"?m=Gt.parse(s):c.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(m=Vr.parse(s)):m=xr.parse(s),{kind:"constant",evaluate:()=>m}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Ga{constructor(e){this.property=e,this.value=new Ws(e,void 0)}transitioned(e,r){return new vc(this.property,this.value,r,yt({},e.transition,this.transition),e.now)}untransitioned(){return new vc(this.property,this.value,null,{},0)}}class yc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return _e(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ga(this._values[e].property)),this._values[e].value=new Ws(this._values[e].property,r===null?void 0:_e(r))}getTransition(e){return _e(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ga(this._values[e].property)),this._values[e].transition=_e(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new Jo(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new Jo(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class vc{constructor(e,r,s,c,m){this.property=e,this.value=r,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,m=this.value.possiblyEvaluate(e,r,s),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(e,r,s);{const v=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,s),m,function(S){if(S<=0)return 0;if(S>=1)return 1;const I=S*S,A=I*S;return 4*(S<.5?A:3*(S-I)+A-.75)}(v))}}return m}}class Jo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new Ks(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class xc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return _e(this._values[e].value)}setValue(e,r){this._values[e]=new Ws(this._values[e].property,r===null?void 0:_e(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new Ks(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,r,s);return c}}class Wr{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class Ks{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ke{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const c=hr[this.specification.type];return c?c(e,r,s):e}}class st{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new Wr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Wr(this,{kind:"constant",value:void 0},e.parameters);const c=hr[this.specification.type];if(c){const m=c(e.value.value,r.value.value,s);return new Wr(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,r,s,c,m,g){return e.kind==="constant"?e.value:e.evaluate(r,s,c,m,g)}}class ys extends st{possiblyEvaluate(e,r,s,c){if(e.value===void 0)return new Wr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},s,c),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,v=this._calculate(g,g,g,r);return new Wr(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Wr(this,{kind:"constant",value:m},r)}return new Wr(this,e.expression,r)}evaluate(e,r,s,c,m,g){if(e.kind==="source"){const v=e.evaluate(r,s,c,m,g);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Yo{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},s,c);return this._calculate(m,m,m,r)}return this._calculate(e.expression.evaluate(new ti(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ti(Math.floor(r.zoom),r)),e.expression.evaluate(new ti(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Qo{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class dr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Ws(s,void 0),m=this.defaultTransitionablePropertyValues[r]=new Ga(s);this.defaultTransitioningPropertyValues[r]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}Ve("DataDrivenProperty",st),Ve("DataConstantProperty",Ke),Ve("CrossFadedDataDrivenProperty",ys),Ve("CrossFadedProperty",Yo),Ve("ColorRampProperty",Qo);const $o="-transition";class Kr extends Yi{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new xc(r.layout)),r.paint)){this._transitionablePaint=new yc(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ks(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(Gs,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith($o)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(bh,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith($o))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[e],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),v=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,v,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),si(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,c,m={}){return(!m||m.validate!==!1)&&fc(this,e.call(Zs,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Wr&&fs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Sh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xs{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ti(i,e=1){let r=0,s=0;return{members:i.map(c=>{const m=Sh[c.type].BYTES_PER_ELEMENT,g=r=bc(r,Math.max(e,m)),v=c.components||1;return s=Math.max(s,m),r+=m*v,{name:c.name,type:c.type,components:v,offset:g}}),size:bc(r,Math.max(s,e)),alignment:e}}function bc(i,e){return Math.ceil(i/e)*e}class an extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}an.prototype.bytesPerElement=4,Ve("StructArrayLayout2i4",an);class Ha extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=c,e}}Ha.prototype.bytesPerElement=6,Ve("StructArrayLayout3i6",Ha);class el extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c)}emplace(e,r,s,c,m){const g=4*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=c,this.int16[g+3]=m,e}}el.prototype.bytesPerElement=8,Ve("StructArrayLayout4i8",el);class tl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,c,m,g)}emplace(e,r,s,c,m,g,v){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=v,e}}tl.prototype.bytesPerElement=12,Ve("StructArrayLayout2i4i12",tl);class il extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,c,m,g)}emplace(e,r,s,c,m,g,v){const S=4*e,I=8*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.uint8[I+4]=c,this.uint8[I+5]=m,this.uint8[I+6]=g,this.uint8[I+7]=v,e}}il.prototype.bytesPerElement=8,Ve("StructArrayLayout2i4ub8",il);class vs extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}vs.prototype.bytesPerElement=8,Ve("StructArrayLayout2f8",vs);class rl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g,v,S,I,A){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,s,c,m,g,v,S,I,A)}emplace(e,r,s,c,m,g,v,S,I,A,E){const L=10*e;return this.uint16[L+0]=r,this.uint16[L+1]=s,this.uint16[L+2]=c,this.uint16[L+3]=m,this.uint16[L+4]=g,this.uint16[L+5]=v,this.uint16[L+6]=S,this.uint16[L+7]=I,this.uint16[L+8]=A,this.uint16[L+9]=E,e}}rl.prototype.bytesPerElement=20,Ve("StructArrayLayout10ui20",rl);class nl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g,v,S,I,A,E,L){const O=this.length;return this.resize(O+1),this.emplace(O,e,r,s,c,m,g,v,S,I,A,E,L)}emplace(e,r,s,c,m,g,v,S,I,A,E,L,O){const B=12*e;return this.int16[B+0]=r,this.int16[B+1]=s,this.int16[B+2]=c,this.int16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=v,this.uint16[B+6]=S,this.uint16[B+7]=I,this.int16[B+8]=A,this.int16[B+9]=E,this.int16[B+10]=L,this.int16[B+11]=O,e}}nl.prototype.bytesPerElement=24,Ve("StructArrayLayout4i4ui4i24",nl);class mn extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=c,e}}mn.prototype.bytesPerElement=12,Ve("StructArrayLayout3f12",mn);class Wa extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Wa.prototype.bytesPerElement=4,Ve("StructArrayLayout1ul4",Wa);class Js extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g,v,S,I){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,s,c,m,g,v,S,I)}emplace(e,r,s,c,m,g,v,S,I,A){const E=10*e,L=5*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=c,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=v,this.uint32[L+3]=S,this.uint16[E+8]=I,this.uint16[E+9]=A,e}}Js.prototype.bytesPerElement=20,Ve("StructArrayLayout6i1ul2ui20",Js);class Ka extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,c,m,g)}emplace(e,r,s,c,m,g,v){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=s,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=v,e}}Ka.prototype.bytesPerElement=12,Ve("StructArrayLayout2i2i2i12",Ka);class Ys extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,c,m)}emplace(e,r,s,c,m,g){const v=4*e,S=8*e;return this.float32[v+0]=r,this.float32[v+1]=s,this.float32[v+2]=c,this.int16[S+6]=m,this.int16[S+7]=g,e}}Ys.prototype.bytesPerElement=16,Ve("StructArrayLayout2f1f2i16",Ys);class sl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c)}emplace(e,r,s,c,m){const g=12*e,v=3*e;return this.uint8[g+0]=r,this.uint8[g+1]=s,this.float32[v+1]=c,this.float32[v+2]=m,e}}sl.prototype.bytesPerElement=12,Ve("StructArrayLayout2ub2f12",sl);class Hn extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=s,this.uint16[m+2]=c,e}}Hn.prototype.bytesPerElement=6,Ve("StructArrayLayout3ui6",Hn);class Wn extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g,v,S,I,A,E,L,O,B,V,X,$){const le=this.length;return this.resize(le+1),this.emplace(le,e,r,s,c,m,g,v,S,I,A,E,L,O,B,V,X,$)}emplace(e,r,s,c,m,g,v,S,I,A,E,L,O,B,V,X,$,le){const ee=24*e,se=12*e,me=48*e;return this.int16[ee+0]=r,this.int16[ee+1]=s,this.uint16[ee+2]=c,this.uint16[ee+3]=m,this.uint32[se+2]=g,this.uint32[se+3]=v,this.uint32[se+4]=S,this.uint16[ee+10]=I,this.uint16[ee+11]=A,this.uint16[ee+12]=E,this.float32[se+7]=L,this.float32[se+8]=O,this.uint8[me+36]=B,this.uint8[me+37]=V,this.uint8[me+38]=X,this.uint32[se+10]=$,this.int16[ee+22]=le,e}}Wn.prototype.bytesPerElement=48,Ve("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Wn);class al extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,m,g,v,S,I,A,E,L,O,B,V,X,$,le,ee,se,me,xe,Be,We,Fe,Re,Me,qe){const ze=this.length;return this.resize(ze+1),this.emplace(ze,e,r,s,c,m,g,v,S,I,A,E,L,O,B,V,X,$,le,ee,se,me,xe,Be,We,Fe,Re,Me,qe)}emplace(e,r,s,c,m,g,v,S,I,A,E,L,O,B,V,X,$,le,ee,se,me,xe,Be,We,Fe,Re,Me,qe,ze){const ke=32*e,$e=16*e;return this.int16[ke+0]=r,this.int16[ke+1]=s,this.int16[ke+2]=c,this.int16[ke+3]=m,this.int16[ke+4]=g,this.int16[ke+5]=v,this.int16[ke+6]=S,this.int16[ke+7]=I,this.uint16[ke+8]=A,this.uint16[ke+9]=E,this.uint16[ke+10]=L,this.uint16[ke+11]=O,this.uint16[ke+12]=B,this.uint16[ke+13]=V,this.uint16[ke+14]=X,this.uint16[ke+15]=$,this.uint16[ke+16]=le,this.uint16[ke+17]=ee,this.uint16[ke+18]=se,this.uint16[ke+19]=me,this.uint16[ke+20]=xe,this.uint16[ke+21]=Be,this.uint16[ke+22]=We,this.uint32[$e+12]=Fe,this.float32[$e+13]=Re,this.float32[$e+14]=Me,this.uint16[ke+30]=qe,this.uint16[ke+31]=ze,e}}al.prototype.bytesPerElement=64,Ve("StructArrayLayout8i15ui1ul2f2ui64",al);class Qs extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Qs.prototype.bytesPerElement=4,Ve("StructArrayLayout1f4",Qs);class Kn extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const m=3*e;return this.uint16[6*e+0]=r,this.float32[m+1]=s,this.float32[m+2]=c,e}}Kn.prototype.bytesPerElement=12,Ve("StructArrayLayout1ui2f12",Kn);class ol extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const m=4*e;return this.uint32[2*e+0]=r,this.uint16[m+2]=s,this.uint16[m+3]=c,e}}ol.prototype.bytesPerElement=8,Ve("StructArrayLayout1ul2ui8",ol);class ll extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}ll.prototype.bytesPerElement=4,Ve("StructArrayLayout2ui4",ll);class Xa extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Xa.prototype.bytesPerElement=2,Ve("StructArrayLayout1ui2",Xa);class cl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c)}emplace(e,r,s,c,m){const g=4*e;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=c,this.float32[g+3]=m,e}}cl.prototype.bytesPerElement=16,Ve("StructArrayLayout4f16",cl);class d extends Xs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Z(this.anchorPointX,this.anchorPointY)}}d.prototype.size=20;class t extends Js{get(e){return new d(this,e)}}Ve("CollisionBoxArray",t);class n extends Xs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}n.prototype.size=48;class a extends Wn{get(e){return new n(this,e)}}Ve("PlacedSymbolArray",a);class h extends Xs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class f extends al{get(e){return new h(this,e)}}Ve("SymbolInstanceArray",f);class w extends Qs{getoffsetX(e){return this.float32[1*e+0]}}Ve("GlyphOffsetArray",w);class T extends Ha{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ve("SymbolLineVertexArray",T);class k extends Xs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}k.prototype.size=12;class C extends Kn{get(e){return new k(this,e)}}Ve("TextAnchorOffsetArray",C);class P extends Xs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}P.prototype.size=8;class M extends ol{get(e){return new P(this,e)}}Ve("FeatureIndexArray",M);class F extends an{}class H extends an{}class W extends an{}class Y extends tl{}class q extends il{}class ie extends vs{}class he extends rl{}class Q extends nl{}class ae extends mn{}class pe extends Wa{}class de extends Ka{}class ve extends sl{}class Se extends Hn{}class we extends ll{}const Ce=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ne}=Ce;class rt{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let m=this.segments[this.segments.length-1];return e>rt.MAX_VERTEX_ARRAY_LENGTH&&Mt(`Max vertices per segment is ${rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>rt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new rt([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function De(i,e){return 256*(i=vt(Math.floor(i),0,255))+vt(Math.floor(e),0,255)}rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ve("SegmentVector",rt);const tt=Ti([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ze={exports:{}},ii={exports:{}};ii.exports=function(i,e){var r,s,c,m,g,v,S,I;for(s=i.length-(r=3&i.length),c=e,g=3432918353,v=461845907,I=0;I<s;)S=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,c=27492+(65535&(m=5*(65535&(c=(c^=S=(65535&(S=(S=(65535&S)*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,r){case 3:S^=(255&i.charCodeAt(I+2))<<16;case 2:S^=(255&i.charCodeAt(I+1))<<8;case 1:c^=S=(65535&(S=(S=(65535&(S^=255&i.charCodeAt(I)))*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var bt=ii.exports,mt={exports:{}};mt.exports=function(i,e){for(var r,s=i.length,c=e^s,m=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++m;switch(s){case 3:c^=(255&i.charCodeAt(m+2))<<16;case 2:c^=(255&i.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var wt=bt,ki=mt.exports;Ze.exports=wt,Ze.exports.murmur3=wt,Ze.exports.murmur2=ki;var Xt=D(Ze.exports);class pr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(Xi(e)),this.positions.push(r,s,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Xi(e);let s=0,c=this.ids.length-1;for(;s<c;){const g=s+c>>1;this.ids[g]>=r?c=g:s=g+1}const m=[];for(;this.ids[s]===r;)m.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return m}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return xi(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new pr;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Xi(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Xt(String(i))}function xi(i,e,r,s){for(;r<s;){const c=i[r+s>>1];let m=r-1,g=s+1;for(;;){do m++;while(i[m]<c);do g--;while(i[g]>c);if(m>=g)break;nr(i,m,g),nr(e,3*m,3*g),nr(e,3*m+1,3*g+1),nr(e,3*m+2,3*g+2)}g-r<s-g?(xi(i,e,r,g),r=g+1):(xi(i,e,g+1,s),s=g)}}function nr(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}Ve("FeaturePositionMap",pr);class sr{constructor(e,r){this.gl=e.gl,this.location=r}}class Zr extends sr{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class En extends sr{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class xs extends sr{constructor(e,r){super(e,r),this.current=Gt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const bs=new Float32Array(16);function Pn(i){return[De(255*i.r,255*i.g),De(255*i.b,255*i.a)]}class Fi{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new xs(e,r):new Zr(e,r)}}class Ii{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new En(e,r):new Zr(e,r)}}class bi{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,m){const g=this.paintVertexArray.length,v=this.expression.evaluate(new ti(0),r,{},c,[],m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,v)}updatePaintArray(e,r,s,c){const m=this.expression.evaluate({zoom:0},s,c);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if(this.type==="color"){const c=Pn(s);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fr{constructor(e,r,s,c,m,g){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,r,s,c,m){const g=this.expression.evaluate(new ti(this.zoom),r,{},c,[],m),v=this.expression.evaluate(new ti(this.zoom+1),r,{},c,[],m),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,g,v)}updatePaintArray(e,r,s,c){const m=this.expression.evaluate({zoom:this.zoom},s,c),g=this.expression.evaluate({zoom:this.zoom+1},s,c);this._setPaintValue(e,r,m,g)}_setPaintValue(e,r,s,c){if(this.type==="color"){const m=Pn(s),g=Pn(c);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,m[0],m[1],g[0],g[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=vt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Zr(e,r)}}class ri{constructor(e,r,s,c,m,g){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,m){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,r,s,c){if(!c||!s)return;const{min:m,mid:g,max:v}=s,S=c[m],I=c[g],A=c[v];if(S&&I&&A)for(let E=e;E<r;E++)this.zoomInPaintVertexArray.emplace(E,I.tl[0],I.tl[1],I.br[0],I.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],I.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,I.tl[0],I.tl[1],I.br[0],I.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],I.pixelRatio,A.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,tt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,tt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Bi{constructor(e,r,s){this.binders={},this._buffers=[];const c=[];for(const m in e.paint._values){if(!s(m))continue;const g=e.paint.get(m);if(!(g instanceof Wr&&fs(g.property.specification)))continue;const v=ji(m,e.type),S=g.value,I=g.property.specification.type,A=g.property.useIntegerZoom,E=g.property.specification["property-type"],L=E==="cross-faded"||E==="cross-faded-data-driven";if(S.kind==="constant")this.binders[m]=L?new Ii(S.value,v):new Fi(S.value,v,I),c.push(`/u_${m}`);else if(S.kind==="source"||L){const O=wc(m,I,"source");this.binders[m]=L?new ri(S,I,A,r,O,e.id):new bi(S,v,I,O),c.push(`/a_${m}`)}else{const O=wc(m,I,"composite");this.binders[m]=new fr(S,v,I,A,r,O),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof bi||r instanceof fr?r.maxValue:0}populatePaintArrays(e,r,s,c,m){for(const g in this.binders){const v=this.binders[g];(v instanceof bi||v instanceof fr||v instanceof ri)&&v.populatePaintArray(e,r,s,c,m)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof Ii&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,c,m){let g=!1;for(const v in e){const S=r.getPositions(v);for(const I of S){const A=s.feature(I.index);for(const E in this.binders){const L=this.binders[E];if((L instanceof bi||L instanceof fr||L instanceof ri)&&L.expression.isStateDependent===!0){const O=c.paint.get(E);L.expression=O.value,L.updatePaintArray(I.start,I.end,A,e[v],m),g=!0}}}}return g}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Fi||s instanceof Ii)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof bi||s instanceof fr)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name);else if(s instanceof ri)for(let c=0;c<tt.members.length;c++)e.push(tt.members[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Fi||s instanceof Ii||s instanceof fr)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof Fi||m instanceof Ii||m instanceof fr){for(const g of m.uniformNames)if(r[g]){const v=m.getBinding(e,r[g],g);s.push({name:g,property:c,binding:v})}}}return s}setUniforms(e,r,s,c){for(const{name:m,property:g,binding:v}of r)this.binders[g].setUniform(v,c,s.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof ri){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof bi||s instanceof fr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof bi||s instanceof fr||s instanceof ri)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof bi||r instanceof fr||r instanceof ri)&&r.destroy()}}}class Ji{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Bi(c,r,s);this.needsUpload=!1,this._featureMap=new pr,this._bufferOffset=0}populatePaintArrays(e,r,s,c,m,g){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,c,m,g);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ji(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function wc(i,e,r){const s={color:{source:vs,composite:cl},number:{source:Qs,composite:vs}},c=function(m){return{"line-pattern":{source:he,composite:he},"fill-pattern":{source:he,composite:he},"fill-extrusion-pattern":{source:he,composite:he}}[m]}(i);return c&&c[r]||s[e][r]}Ve("ConstantBinder",Fi),Ve("CrossFadedConstantBinder",Ii),Ve("SourceExpressionBinder",bi),Ve("CrossFadedCompositeBinder",ri),Ve("CompositeExpressionBinder",fr),Ve("ProgramConfiguration",Bi,{omit:["_buffers"]}),Ve("ProgramConfigurationSet",Ji);const wi=8192,hl=Math.pow(2,14)-1,Sc=-hl-1;function Xn(i){const e=wi/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const c=r[s];for(let m=0;m<c.length;m++){const g=c[m],v=Math.round(g.x*e),S=Math.round(g.y*e);g.x=vt(v,Sc,hl),g.y=vt(S,Sc,hl),(v<g.x||v>g.x+1||S<g.y||S>g.y+1)&&Mt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Jn(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Xn(i):[]}}function gn(i,e,r,s,c){i.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}class Ja{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new H,this.indexArray=new Se,this.segments=new rt,this.programConfigurations=new Ji(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const c=this.layers[0],m=[];let g=null,v=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),v=!g.isConstant());for(const{feature:S,id:I,index:A,sourceLayerIndex:E}of e){const L=this.layers[0]._featureFilter.needGeometry,O=Jn(S,L);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),O,s))continue;const B=v?g.evaluate(O,{},s):void 0,V={id:I,properties:S.properties,type:S.type,sourceLayerIndex:E,index:A,geometry:L?O.geometry:Xn(S),patterns:{},sortKey:B};m.push(V)}v&&m.sort((S,I)=>S.sortKey-I.sortKey);for(const S of m){const{geometry:I,index:A,sourceLayerIndex:E}=S,L=e[A].feature;this.addFeature(S,I,A,s),r.featureIndex.insert(L,I,A,E,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ne),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c){for(const m of r)for(const g of m){const v=g.x,S=g.y;if(v<0||v>=wi||S<0||S>=wi)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=I.vertexLength;gn(this.layoutVertexArray,v,S,-1,-1),gn(this.layoutVertexArray,v,S,1,-1),gn(this.layoutVertexArray,v,S,1,1),gn(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c)}}function ul(i,e){for(let r=0;r<i.length;r++)if(Qa(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Qa(i,e[r]))return!0;return!!$s(i,e)}function Tc(i,e,r){return!!Qa(i,e)||!!Th(e,i,r)}function Ya(i,e){if(i.length===1)return qu(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(Qa(i,s[c]))return!0}for(let r=0;r<i.length;r++)if(qu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if($s(i,e[r]))return!0;return!1}function kc(i,e,r){if(i.length>1){if($s(i,e))return!0;for(let s=0;s<e.length;s++)if(Th(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Th(i[s],e,r))return!0;return!1}function $s(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],c=i[r+1];for(let m=0;m<e.length-1;m++)if(Lf(s,c,e[m],e[m+1]))return!0}return!1}function Lf(i,e,r,s){return Wt(i,r,s)!==Wt(e,r,s)&&Wt(i,e,r)!==Wt(i,e,s)}function Th(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Nu(i,e[c-1],e[c])<s)return!0;return!1}function Nu(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const c=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function qu(i,e){let r,s,c,m=!1;for(let g=0;g<i.length;g++){r=i[g];for(let v=0,S=r.length-1;v<r.length;S=v++)s=r[v],c=r[S],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(m=!m)}return m}function Qa(i,e){let r=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const m=i[s],g=i[c];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(r=!r)}return r}function Df(i,e,r){const s=r[0],c=r[2];if(i.x<s.x&&e.x<s.x||i.x>c.x&&e.x>c.x||i.y<s.y&&e.y<s.y||i.y>c.y&&e.y>c.y)return!1;const m=Wt(i,e,r[0]);return m!==Wt(i,e,r[1])||m!==Wt(i,e,r[2])||m!==Wt(i,e,r[3])}function dl(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Ic(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Cc(i,e,r,s,c){if(!e[0]&&!e[1])return i;const m=Z.convert(e)._mult(c);r==="viewport"&&m._rotate(-s);const g=[];for(let v=0;v<i.length;v++)g.push(i[v].sub(m));return g}let Zu,Gu;Ve("CircleBucket",Ja,{omit:["layers"]});var Rf={get paint(){return Gu=Gu||new dr({"circle-radius":new st(fe.paint_circle["circle-radius"]),"circle-color":new st(fe.paint_circle["circle-color"]),"circle-blur":new st(fe.paint_circle["circle-blur"]),"circle-opacity":new st(fe.paint_circle["circle-opacity"]),"circle-translate":new Ke(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(fe.paint_circle["circle-stroke-opacity"])})},get layout(){return Zu=Zu||new dr({"circle-sort-key":new st(fe.layout_circle["circle-sort-key"])})}},Sr=1e-6,$a=typeof Float32Array<"u"?Float32Array:Array;function kh(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Hu(i,e,r){var s=e[0],c=e[1],m=e[2],g=e[3],v=e[4],S=e[5],I=e[6],A=e[7],E=e[8],L=e[9],O=e[10],B=e[11],V=e[12],X=e[13],$=e[14],le=e[15],ee=r[0],se=r[1],me=r[2],xe=r[3];return i[0]=ee*s+se*v+me*E+xe*V,i[1]=ee*c+se*S+me*L+xe*X,i[2]=ee*m+se*I+me*O+xe*$,i[3]=ee*g+se*A+me*B+xe*le,i[4]=(ee=r[4])*s+(se=r[5])*v+(me=r[6])*E+(xe=r[7])*V,i[5]=ee*c+se*S+me*L+xe*X,i[6]=ee*m+se*I+me*O+xe*$,i[7]=ee*g+se*A+me*B+xe*le,i[8]=(ee=r[8])*s+(se=r[9])*v+(me=r[10])*E+(xe=r[11])*V,i[9]=ee*c+se*S+me*L+xe*X,i[10]=ee*m+se*I+me*O+xe*$,i[11]=ee*g+se*A+me*B+xe*le,i[12]=(ee=r[12])*s+(se=r[13])*v+(me=r[14])*E+(xe=r[15])*V,i[13]=ee*c+se*S+me*L+xe*X,i[14]=ee*m+se*I+me*O+xe*$,i[15]=ee*g+se*A+me*B+xe*le,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var pl,Of=Hu;function Ac(i,e,r){var s=e[0],c=e[1],m=e[2],g=e[3];return i[0]=r[0]*s+r[4]*c+r[8]*m+r[12]*g,i[1]=r[1]*s+r[5]*c+r[9]*m+r[13]*g,i[2]=r[2]*s+r[6]*c+r[10]*m+r[14]*g,i[3]=r[3]*s+r[7]*c+r[11]*m+r[15]*g,i}pl=new $a(4),$a!=Float32Array&&(pl[0]=0,pl[1]=0,pl[2]=0,pl[3]=0);class Ff extends Kr{constructor(e){super(e,Rf)}createBucket(e){return new Ja(e)}queryRadius(e){const r=e;return dl("circle-radius",this,r)+dl("circle-stroke-width",this,r)+Ic(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,s,c,m,g,v,S){const I=Cc(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,v),A=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),E=this.paint.get("circle-pitch-alignment")==="map",L=E?I:function(B,V){return B.map(X=>Wu(X,V))}(I,S),O=E?A*v:A;for(const B of c)for(const V of B){const X=E?V:Wu(V,S);let $=O;const le=Ac([],[V.x,V.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?$*=le[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&($*=g.cameraToCenterDistance/le[3]),Tc(L,X,$))return!0}return!1}}function Wu(i,e){const r=Ac([],[i.x,i.y,0,1],e);return new Z(r[0]/r[3],r[1]/r[3])}class Ku extends Ja{}let Xu;Ve("HeatmapBucket",Ku,{omit:["layers"]});var Bf={get paint(){return Xu=Xu||new dr({"heatmap-radius":new st(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qo(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(fe.paint_heatmap["heatmap-opacity"])})}};function Ih(i,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*s}`)}else c=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=c,i}function Ju(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const c=Ih({},{width:e,height:r},s);Ch(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=c.data}function Ch(i,e,r,s,c,m){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,v=e.data;if(g===v)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<c.height;S++){const I=((r.y+S)*i.width+r.x)*m,A=((s.y+S)*e.width+s.x)*m;for(let E=0;E<c.width*m;E++)v[A+E]=g[I+E]}return e}class fl{constructor(e,r){Ih(this,e,1,r)}resize(e){Ju(this,e,1)}clone(){return new fl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,m){Ch(e,r,s,c,m,1)}}class Xr{constructor(e,r){Ih(this,e,4,r)}resize(e){Ju(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Xr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,m){Ch(e,r,s,c,m,4)}}function Yu(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new Xr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const m=(g,v,S)=>{e[i.evaluationKey]=S;const I=i.expression.evaluate(e);c.data[g+v+0]=Math.floor(255*I.r/I.a),c.data[g+v+1]=Math.floor(255*I.g/I.a),c.data[g+v+2]=Math.floor(255*I.b/I.a),c.data[g+v+3]=Math.floor(255*I.a)};if(i.clips)for(let g=0,v=0;g<s;++g,v+=4*r)for(let S=0,I=0;S<r;S++,I+=4){const A=S/(r-1),{start:E,end:L}=i.clips[g];m(v,I,E*(1-A)+L*A)}else for(let g=0,v=0;g<r;g++,v+=4)m(0,v,g/(r-1));return c}Ve("AlphaImage",fl),Ve("RGBAImage",Xr);class jf extends Kr{createBucket(e){return new Ku(e)}constructor(e){super(e,Bf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Yu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Qu;var Uf={get paint(){return Qu=Qu||new dr({"hillshade-illumination-direction":new Ke(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(fe.paint_hillshade["hillshade-accent-color"])})}};class Vf extends Kr{constructor(e){super(e,Uf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Nf=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:qf}=Nf;var Ah={exports:{}};function Ec(i,e,r){r=r||2;var s,c,m,g,v,S,I,A=e&&e.length,E=A?e[0]*r:i.length,L=$u(i,0,E,r,!0),O=[];if(!L||L.next===L.prev)return O;if(A&&(L=function(V,X,$,le){var ee,se,me,xe=[];for(ee=0,se=X.length;ee<se;ee++)(me=$u(V,X[ee]*le,ee<se-1?X[ee+1]*le:V.length,le,!1))===me.next&&(me.steiner=!0),xe.push(Yf(me));for(xe.sort(Kf),ee=0;ee<xe.length;ee++)$=Xf(xe[ee],$);return $}(i,e,L,r)),i.length>80*r){s=m=i[0],c=g=i[1];for(var B=r;B<E;B+=r)(v=i[B])<s&&(s=v),(S=i[B+1])<c&&(c=S),v>m&&(m=v),S>g&&(g=S);I=(I=Math.max(m-s,g-c))!==0?32767/I:0}return ml(L,O,r,s,c,I,0),O}function $u(i,e,r,s,c){var m,g;if(c===Mh(i,e,r,s)>0)for(m=e;m<r;m+=s)g=id(m,i[m],i[m+1],g);else for(m=r-s;m>=e;m-=s)g=id(m,i[m],i[m+1],g);return g&&Pc(g,g.next)&&(_l(g),g=g.next),g}function ea(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Pc(s,s.next)&&Ci(s.prev,s,s.next)!==0)s=s.next;else{if(_l(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function ml(i,e,r,s,c,m,g){if(i){!g&&m&&function(A,E,L,O){var B=A;do B.z===0&&(B.z=Eh(B.x,B.y,E,L,O)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(V){var X,$,le,ee,se,me,xe,Be,We=1;do{for($=V,V=null,se=null,me=0;$;){for(me++,le=$,xe=0,X=0;X<We&&(xe++,le=le.nextZ);X++);for(Be=We;xe>0||Be>0&&le;)xe!==0&&(Be===0||!le||$.z<=le.z)?(ee=$,$=$.nextZ,xe--):(ee=le,le=le.nextZ,Be--),se?se.nextZ=ee:V=ee,ee.prevZ=se,se=ee;$=le}se.nextZ=null,We*=2}while(me>1)}(B)}(i,s,c,m);for(var v,S,I=i;i.prev!==i.next;)if(v=i.prev,S=i.next,m?Gf(i,s,c,m):Zf(i))e.push(v.i/r|0),e.push(i.i/r|0),e.push(S.i/r|0),_l(i),i=S.next,I=S.next;else if((i=S)===I){g?g===1?ml(i=Hf(ea(i),e,r),e,r,s,c,m,2):g===2&&Wf(i,e,r,s,c,m):ml(ea(i),e,r,s,c,m,1);break}}}function Zf(i){var e=i.prev,r=i,s=i.next;if(Ci(e,r,s)>=0)return!1;for(var c=e.x,m=r.x,g=s.x,v=e.y,S=r.y,I=s.y,A=c<m?c<g?c:g:m<g?m:g,E=v<S?v<I?v:I:S<I?S:I,L=c>m?c>g?c:g:m>g?m:g,O=v>S?v>I?v:I:S>I?S:I,B=s.next;B!==e;){if(B.x>=A&&B.x<=L&&B.y>=E&&B.y<=O&&eo(c,v,m,S,g,I,B.x,B.y)&&Ci(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function Gf(i,e,r,s){var c=i.prev,m=i,g=i.next;if(Ci(c,m,g)>=0)return!1;for(var v=c.x,S=m.x,I=g.x,A=c.y,E=m.y,L=g.y,O=v<S?v<I?v:I:S<I?S:I,B=A<E?A<L?A:L:E<L?E:L,V=v>S?v>I?v:I:S>I?S:I,X=A>E?A>L?A:L:E>L?E:L,$=Eh(O,B,e,r,s),le=Eh(V,X,e,r,s),ee=i.prevZ,se=i.nextZ;ee&&ee.z>=$&&se&&se.z<=le;){if(ee.x>=O&&ee.x<=V&&ee.y>=B&&ee.y<=X&&ee!==c&&ee!==g&&eo(v,A,S,E,I,L,ee.x,ee.y)&&Ci(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,se.x>=O&&se.x<=V&&se.y>=B&&se.y<=X&&se!==c&&se!==g&&eo(v,A,S,E,I,L,se.x,se.y)&&Ci(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ee&&ee.z>=$;){if(ee.x>=O&&ee.x<=V&&ee.y>=B&&ee.y<=X&&ee!==c&&ee!==g&&eo(v,A,S,E,I,L,ee.x,ee.y)&&Ci(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;se&&se.z<=le;){if(se.x>=O&&se.x<=V&&se.y>=B&&se.y<=X&&se!==c&&se!==g&&eo(v,A,S,E,I,L,se.x,se.y)&&Ci(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Hf(i,e,r){var s=i;do{var c=s.prev,m=s.next.next;!Pc(c,m)&&ed(c,s,s.next,m)&&gl(c,m)&&gl(m,c)&&(e.push(c.i/r|0),e.push(s.i/r|0),e.push(m.i/r|0),_l(s),_l(s.next),s=i=m),s=s.next}while(s!==i);return ea(s)}function Wf(i,e,r,s,c,m){var g=i;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&Qf(g,v)){var S=td(g,v);return g=ea(g,g.next),S=ea(S,S.next),ml(g,e,r,s,c,m,0),void ml(S,e,r,s,c,m,0)}v=v.next}g=g.next}while(g!==i)}function Kf(i,e){return i.x-e.x}function Xf(i,e){var r=function(c,m){var g,v=m,S=c.x,I=c.y,A=-1/0;do{if(I<=v.y&&I>=v.next.y&&v.next.y!==v.y){var E=v.x+(I-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(E<=S&&E>A&&(A=E,g=v.x<v.next.x?v:v.next,E===S))return g}v=v.next}while(v!==m);if(!g)return null;var L,O=g,B=g.x,V=g.y,X=1/0;v=g;do S>=v.x&&v.x>=B&&S!==v.x&&eo(I<V?S:A,I,B,V,I<V?A:S,I,v.x,v.y)&&(L=Math.abs(I-v.y)/(S-v.x),gl(v,c)&&(L<X||L===X&&(v.x>g.x||v.x===g.x&&Jf(g,v)))&&(g=v,X=L)),v=v.next;while(v!==O);return g}(i,e);if(!r)return e;var s=td(r,i);return ea(s,s.next),ea(r,r.next)}function Jf(i,e){return Ci(i.prev,i,e.prev)<0&&Ci(e.next,i,i.next)<0}function Eh(i,e,r,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Yf(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function eo(i,e,r,s,c,m,g,v){return(c-g)*(e-v)>=(i-g)*(m-v)&&(i-g)*(s-v)>=(r-g)*(e-v)&&(r-g)*(m-v)>=(c-g)*(s-v)}function Qf(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&ed(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(i,e)&&(gl(i,e)&&gl(e,i)&&function(r,s){var c=r,m=!1,g=(r.x+s.x)/2,v=(r.y+s.y)/2;do c.y>v!=c.next.y>v&&c.next.y!==c.y&&g<(c.next.x-c.x)*(v-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==r);return m}(i,e)&&(Ci(i.prev,i,e.prev)||Ci(i,e.prev,e))||Pc(i,e)&&Ci(i.prev,i,i.next)>0&&Ci(e.prev,e,e.next)>0)}function Ci(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Pc(i,e){return i.x===e.x&&i.y===e.y}function ed(i,e,r,s){var c=zc(Ci(i,e,r)),m=zc(Ci(i,e,s)),g=zc(Ci(r,s,i)),v=zc(Ci(r,s,e));return c!==m&&g!==v||!(c!==0||!Mc(i,r,e))||!(m!==0||!Mc(i,s,e))||!(g!==0||!Mc(r,i,s))||!(v!==0||!Mc(r,e,s))}function Mc(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function zc(i){return i>0?1:i<0?-1:0}function gl(i,e){return Ci(i.prev,i,i.next)<0?Ci(i,e,i.next)>=0&&Ci(i,i.prev,e)>=0:Ci(i,e,i.prev)<0||Ci(i,i.next,e)<0}function td(i,e){var r=new Ph(i.i,i.x,i.y),s=new Ph(e.i,e.x,e.y),c=i.next,m=e.prev;return i.next=e,e.prev=i,r.next=c,c.prev=r,s.next=r,r.prev=s,m.next=s,s.prev=m,s}function id(i,e,r,s){var c=new Ph(i,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function _l(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ph(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mh(i,e,r,s){for(var c=0,m=e,g=r-s;m<r;m+=s)c+=(i[g]-i[m])*(i[m+1]+i[g+1]),g=m;return c}Ah.exports=Ec,Ah.exports.default=Ec,Ec.deviation=function(i,e,r,s){var c=e&&e.length,m=Math.abs(Mh(i,0,c?e[0]*r:i.length,r));if(c)for(var g=0,v=e.length;g<v;g++)m-=Math.abs(Mh(i,e[g]*r,g<v-1?e[g+1]*r:i.length,r));var S=0;for(g=0;g<s.length;g+=3){var I=s[g]*r,A=s[g+1]*r,E=s[g+2]*r;S+=Math.abs((i[I]-i[E])*(i[A+1]-i[I+1])-(i[I]-i[A])*(i[E+1]-i[I+1]))}return m===0&&S===0?0:Math.abs((S-m)/m)},Ec.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<i.length;c++){for(var m=0;m<i[c].length;m++)for(var g=0;g<e;g++)r.vertices.push(i[c][m][g]);c>0&&r.holes.push(s+=i[c-1].length)}return r};var rd=D(Ah.exports);function $f(i,e,r,s,c){nd(i,e,r||0,s||i.length-1,c||em)}function nd(i,e,r,s,c){for(;s>r;){if(s-r>600){var m=s-r+1,g=e-r+1,v=Math.log(m),S=.5*Math.exp(2*v/3),I=.5*Math.sqrt(v*S*(m-S)/m)*(g-m/2<0?-1:1);nd(i,e,Math.max(r,Math.floor(e-g*S/m+I)),Math.min(s,Math.floor(e+(m-g)*S/m+I)),c)}var A=i[e],E=r,L=s;for(yl(i,r,e),c(i[s],A)>0&&yl(i,r,s);E<L;){for(yl(i,E,L),E++,L--;c(i[E],A)<0;)E++;for(;c(i[L],A)>0;)L--}c(i[r],A)===0?yl(i,r,L):yl(i,++L,s),L<=e&&(r=L+1),e<=L&&(s=L-1)}}function yl(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function em(i,e){return i<e?-1:i>e?1:0}function zh(i,e){const r=i.length;if(r<=1)return[i];const s=[];let c,m;for(let g=0;g<r;g++){const v=ai(i[g]);v!==0&&(i[g].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(c&&s.push(c),c=[i[g]]):c.push(i[g]))}if(c&&s.push(c),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||($f(s[g],e,1,s[g].length-1,tm),s[g]=s[g].slice(0,e));return s}function tm(i,e){return e.area-i.area}function Lh(i,e,r){const s=r.patternDependencies;let c=!1;for(const m of e){const g=m.paint.get(`${i}-pattern`);g.isConstant()||(c=!0);const v=g.constantOr(null);v&&(c=!0,s[v.to]=!0,s[v.from]=!0)}return c}function Dh(i,e,r,s,c){const m=c.patternDependencies;for(const g of e){const v=g.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let S=v.evaluate({zoom:s-1},r,{},c.availableImages),I=v.evaluate({zoom:s},r,{},c.availableImages),A=v.evaluate({zoom:s+1},r,{},c.availableImages);S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,A=A&&A.name?A.name:A,m[S]=!0,m[I]=!0,m[A]=!0,r.patterns[g.id]={min:S,mid:I,max:A}}}return r}class Rh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new W,this.indexArray=new Se,this.indexArray2=new we,this.programConfigurations=new Ji(e.layers,e.zoom),this.segments=new rt,this.segments2=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Lh("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:v,id:S,index:I,sourceLayerIndex:A}of e){const E=this.layers[0]._featureFilter.needGeometry,L=Jn(v,E);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),L,s))continue;const O=m?c.evaluate(L,{},s,r.availableImages):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:A,index:I,geometry:E?L.geometry:Xn(v),patterns:{},sortKey:O};g.push(B)}m&&g.sort((v,S)=>v.sortKey-S.sortKey);for(const v of g){const{geometry:S,index:I,sourceLayerIndex:A}=v;if(this.hasPattern){const E=Dh("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(v,S,I,s,{});r.featureIndex.insert(e[I].feature,S,I,A,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,m){for(const g of zh(r,500)){let v=0;for(const O of g)v+=O.length;const S=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),I=S.vertexLength,A=[],E=[];for(const O of g){if(O.length===0)continue;O!==g[0]&&E.push(A.length/2);const B=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),V=B.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(V+O.length-1,V),A.push(O[0].x),A.push(O[0].y);for(let X=1;X<O.length;X++)this.layoutVertexArray.emplaceBack(O[X].x,O[X].y),this.indexArray2.emplaceBack(V+X-1,V+X),A.push(O[X].x),A.push(O[X].y);B.vertexLength+=O.length,B.primitiveLength+=O.length}const L=rd(A,E);for(let O=0;O<L.length;O+=3)this.indexArray.emplaceBack(I+L[O],I+L[O+1],I+L[O+2]);S.vertexLength+=v,S.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,c)}}let sd,ad;Ve("FillBucket",Rh,{omit:["layers","patternFeatures"]});var im={get paint(){return ad=ad||new dr({"fill-antialias":new Ke(fe.paint_fill["fill-antialias"]),"fill-opacity":new st(fe.paint_fill["fill-opacity"]),"fill-color":new st(fe.paint_fill["fill-color"]),"fill-outline-color":new st(fe.paint_fill["fill-outline-color"]),"fill-translate":new Ke(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ys(fe.paint_fill["fill-pattern"])})},get layout(){return sd=sd||new dr({"fill-sort-key":new st(fe.layout_fill["fill-sort-key"])})}};class rm extends Kr{constructor(e){super(e,im)}recalculate(e,r){super.recalculate(e,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Rh(e)}queryRadius(){return Ic(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,s,c,m,g,v){return Ya(Cc(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,v),c)}isTileClipped(){return!0}}const nm=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sm=Ti([{name:"a_centroid",components:2,type:"Int16"}],4),{members:am}=nm;var ws={},om=U,od=to;function to(i,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=c,i.readFields(lm,this,e)}function lm(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,c){for(var m=s.readVarint()+s.pos;s.pos<m;){var g=c._keys[s.readVarint()],v=c._values[s.readVarint()];c.properties[g]=v}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function cm(i){for(var e,r,s=0,c=0,m=i.length,g=m-1;c<m;g=c++)s+=((r=i[g]).x-(e=i[c]).x)*(e.y+r.y);return s}to.types=["Unknown","Point","LineString","Polygon"],to.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,c=0,m=0,g=0,v=[];i.pos<r;){if(c<=0){var S=i.readVarint();s=7&S,c=S>>3}if(c--,s===1||s===2)m+=i.readSVarint(),g+=i.readSVarint(),s===1&&(e&&v.push(e),e=[]),e.push(new om(m,g));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&v.push(e),v},to.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,c=0,m=0,g=1/0,v=-1/0,S=1/0,I=-1/0;i.pos<e;){if(s<=0){var A=i.readVarint();r=7&A,s=A>>3}if(s--,r===1||r===2)(c+=i.readSVarint())<g&&(g=c),c>v&&(v=c),(m+=i.readSVarint())<S&&(S=m),m>I&&(I=m);else if(r!==7)throw new Error("unknown command "+r)}return[g,S,v,I]},to.prototype.toGeoJSON=function(i,e,r){var s,c,m=this.extent*Math.pow(2,r),g=this.extent*i,v=this.extent*e,S=this.loadGeometry(),I=to.types[this.type];function A(O){for(var B=0;B<O.length;B++){var V=O[B];O[B]=[360*(V.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+v)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(s=0;s<S.length;s++)E[s]=S[s][0];A(S=E);break;case 2:for(s=0;s<S.length;s++)A(S[s]);break;case 3:for(S=function(O){var B=O.length;if(B<=1)return[O];for(var V,X,$=[],le=0;le<B;le++){var ee=cm(O[le]);ee!==0&&(X===void 0&&(X=ee<0),X===ee<0?(V&&$.push(V),V=[O[le]]):V.push(O[le]))}return V&&$.push(V),$}(S),s=0;s<S.length;s++)for(c=0;c<S[s].length;c++)A(S[s][c])}S.length===1?S=S[0]:I="Multi"+I;var L={type:"Feature",geometry:{type:I,coordinates:S},properties:this.properties};return"id"in this&&(L.id=this.id),L};var hm=od,ld=cd;function cd(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(um,this,e),this.length=this._features.length}function um(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var c=null,m=s.readVarint()+s.pos;s.pos<m;){var g=s.readVarint()>>3;c=g===1?s.readString():g===2?s.readFloat():g===3?s.readDouble():g===4?s.readVarint64():g===5?s.readVarint():g===6?s.readSVarint():g===7?s.readBoolean():null}return c}(r))}cd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new hm(this._pbf,e,this.extent,this._keys,this._values)};var dm=ld;function pm(i,e,r){if(i===3){var s=new dm(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}ws.VectorTile=function(i,e){this.layers=i.readFields(pm,{},e)},ws.VectorTileFeature=od,ws.VectorTileLayer=ld;const fm=ws.VectorTileFeature.types,Oh=Math.pow(2,13);function vl(i,e,r,s,c,m,g,v){i.emplaceBack(e,r,2*Math.floor(s*Oh)+g,c*Oh*2,m*Oh*2,Math.round(v))}class Fh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.centroidVertexArray=new F,this.indexArray=new Se,this.programConfigurations=new Ji(e.layers,e.zoom),this.segments=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=Lh("fill-extrusion",this.layers,r);for(const{feature:c,id:m,index:g,sourceLayerIndex:v}of e){const S=this.layers[0]._featureFilter.needGeometry,I=Jn(c,S);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),I,s))continue;const A={id:m,sourceLayerIndex:v,index:g,geometry:S?I.geometry:Xn(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Dh("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,g,s,{}),r.featureIndex.insert(c,A.geometry,g,v,this.index,!0)}}addFeatures(e,r,s){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,am),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,sm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,c,m){const g={x:0,y:0,vertexCount:0};for(const v of zh(r,500)){let S=0;for(const B of v)S+=B.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of v){if(B.length===0||gm(B))continue;let V=0;for(let X=0;X<B.length;X++){const $=B[X];if(X>=1){const le=B[X-1];if(!mm($,le)){I.vertexLength+4>rt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=$.sub(le)._perp()._unit(),se=le.dist($);V+se>32768&&(V=0),vl(this.layoutVertexArray,$.x,$.y,ee.x,ee.y,0,0,V),vl(this.layoutVertexArray,$.x,$.y,ee.x,ee.y,0,1,V),g.x+=2*$.x,g.y+=2*$.y,g.vertexCount+=2,V+=se,vl(this.layoutVertexArray,le.x,le.y,ee.x,ee.y,0,0,V),vl(this.layoutVertexArray,le.x,le.y,ee.x,ee.y,0,1,V),g.x+=2*le.x,g.y+=2*le.y,g.vertexCount+=2;const me=I.vertexLength;this.indexArray.emplaceBack(me,me+2,me+1),this.indexArray.emplaceBack(me+1,me+2,me+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+S>rt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),fm[e.type]!=="Polygon")continue;const A=[],E=[],L=I.vertexLength;for(const B of v)if(B.length!==0){B!==v[0]&&E.push(A.length/2);for(let V=0;V<B.length;V++){const X=B[V];vl(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),g.x+=X.x,g.y+=X.y,g.vertexCount+=1,A.push(X.x),A.push(X.y)}}const O=rd(A,E);for(let B=0;B<O.length;B+=3)this.indexArray.emplaceBack(L+O[B],L+O[B+2],L+O[B+1]);I.primitiveLength+=O.length/3,I.vertexLength+=S}for(let v=0;v<g.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,c)}}function mm(i,e){return i.x===e.x&&(i.x<0||i.x>wi)||i.y===e.y&&(i.y<0||i.y>wi)}function gm(i){return i.every(e=>e.x<0)||i.every(e=>e.x>wi)||i.every(e=>e.y<0)||i.every(e=>e.y>wi)}let hd;Ve("FillExtrusionBucket",Fh,{omit:["layers","features"]});var _m={get paint(){return hd=hd||new dr({"fill-extrusion-opacity":new Ke(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ys(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ym extends Kr{constructor(e){super(e,_m)}createBucket(e){return new Fh(e)}queryRadius(){return Ic(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,s,c,m,g,v,S){const I=Cc(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,v),A=this.paint.get("fill-extrusion-height").evaluate(r,s),E=this.paint.get("fill-extrusion-base").evaluate(r,s),L=function(B,V,X,$){const le=[];for(const ee of B){const se=[ee.x,ee.y,0,1];Ac(se,se,V),le.push(new Z(se[0]/se[3],se[1]/se[3]))}return le}(I,S),O=function(B,V,X,$){const le=[],ee=[],se=$[8]*V,me=$[9]*V,xe=$[10]*V,Be=$[11]*V,We=$[8]*X,Fe=$[9]*X,Re=$[10]*X,Me=$[11]*X;for(const qe of B){const ze=[],ke=[];for(const $e of qe){const Xe=$e.x,xt=$e.y,ni=$[0]*Xe+$[4]*xt+$[12],ui=$[1]*Xe+$[5]*xt+$[13],Vi=$[2]*Xe+$[6]*xt+$[14],Gr=$[3]*Xe+$[7]*xt+$[15],Tr=Vi+xe,Mi=Gr+Be,$i=ni+We,or=ui+Fe,kr=Vi+Re,Ir=Gr+Me,Ni=new Z((ni+se)/Mi,(ui+me)/Mi);Ni.z=Tr/Mi,ze.push(Ni);const qi=new Z($i/Ir,or/Ir);qi.z=kr/Ir,ke.push(qi)}le.push(ze),ee.push(ke)}return[le,ee]}(c,E,A,S);return function(B,V,X){let $=1/0;Ya(X,V)&&($=ud(X,V[0]));for(let le=0;le<V.length;le++){const ee=V[le],se=B[le];for(let me=0;me<ee.length-1;me++){const xe=ee[me],Be=[xe,ee[me+1],se[me+1],se[me],xe];ul(X,Be)&&($=Math.min($,ud(X,Be)))}}return $!==1/0&&$}(O[0],O[1],L)}}function xl(i,e){return i.x*e.x+i.y*e.y}function ud(i,e){if(i.length===1){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const m=e[r],g=i[0],v=c.sub(s),S=m.sub(s),I=g.sub(s),A=xl(v,v),E=xl(v,S),L=xl(S,S),O=xl(I,v),B=xl(I,S),V=A*L-E*E,X=(L*O-E*B)/V,$=(A*B-E*O)/V,le=s.z*(1-X-$)+c.z*X+m.z*$;if(isFinite(le))return le}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const vm=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xm}=vm,bm=Ti([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:wm}=bm,Sm=ws.VectorTileFeature.types,Tm=Math.cos(Math.PI/180*37.5),dd=Math.pow(2,14)/.5;class Bh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new q,this.layoutVertexArray2=new ie,this.indexArray=new Se,this.programConfigurations=new Ji(e.layers,e.zoom),this.segments=new rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Lh("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:v,id:S,index:I,sourceLayerIndex:A}of e){const E=this.layers[0]._featureFilter.needGeometry,L=Jn(v,E);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),L,s))continue;const O=m?c.evaluate(L,{},s):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:A,index:I,geometry:E?L.geometry:Xn(v),patterns:{},sortKey:O};g.push(B)}m&&g.sort((v,S)=>v.sortKey-S.sortKey);for(const v of g){const{geometry:S,index:I,sourceLayerIndex:A}=v;if(this.hasPattern){const E=Dh("line",this.layers,v,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(v,S,I,s,{});r.featureIndex.insert(e[I].feature,S,I,A,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,wm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,m){const g=this.layers[0].layout,v=g.get("line-join").evaluate(e,{}),S=g.get("line-cap"),I=g.get("line-miter-limit"),A=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const E of r)this.addLine(E,e,v,S,I,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,c)}addLine(e,r,s,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<e.length-1;$++)this.totalDistance+=e[$].dist(e[$+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Sm[r.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let I=0;for(;I<S-1&&e[I].equals(e[I+1]);)I++;if(S<(v?3:2))return;s==="bevel"&&(m=1.05);const A=this.overscaling<=16?15*wi/(512*this.overscaling):0,E=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let L,O,B,V,X;this.e1=this.e2=-1,v&&(L=e[S-2],X=e[I].sub(L)._unit()._perp());for(let $=I;$<S;$++){if(B=$===S-1?v?e[I+1]:void 0:e[$+1],B&&e[$].equals(B))continue;X&&(V=X),L&&(O=L),L=e[$],X=B?B.sub(L)._unit()._perp():V,V=V||X;let le=V.add(X);le.x===0&&le.y===0||le._unit();const ee=V.x*X.x+V.y*X.y,se=le.x*X.x+le.y*X.y,me=se!==0?1/se:1/0,xe=2*Math.sqrt(2-2*se),Be=se<Tm&&O&&B,We=V.x*X.y-V.y*X.x>0;if(Be&&$>I){const Me=L.dist(O);if(Me>2*A){const qe=L.sub(L.sub(O)._mult(A/Me)._round());this.updateDistance(O,qe),this.addCurrentVertex(qe,V,0,0,E),O=qe}}const Fe=O&&B;let Re=Fe?s:v?"butt":c;if(Fe&&Re==="round"&&(me<g?Re="miter":me<=2&&(Re="fakeround")),Re==="miter"&&me>m&&(Re="bevel"),Re==="bevel"&&(me>2&&(Re="flipbevel"),me<m&&(Re="miter")),O&&this.updateDistance(O,L),Re==="miter")le._mult(me),this.addCurrentVertex(L,le,0,0,E);else if(Re==="flipbevel"){if(me>100)le=X.mult(-1);else{const Me=me*V.add(X).mag()/V.sub(X).mag();le._perp()._mult(Me*(We?-1:1))}this.addCurrentVertex(L,le,0,0,E),this.addCurrentVertex(L,le.mult(-1),0,0,E)}else if(Re==="bevel"||Re==="fakeround"){const Me=-Math.sqrt(me*me-1),qe=We?Me:0,ze=We?0:Me;if(O&&this.addCurrentVertex(L,V,qe,ze,E),Re==="fakeround"){const ke=Math.round(180*xe/Math.PI/20);for(let $e=1;$e<ke;$e++){let Xe=$e/ke;if(Xe!==.5){const ni=Xe-.5;Xe+=Xe*ni*(Xe-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*ni*ni+(.848013+ee*(.215638*ee-1.06021)))}const xt=X.sub(V)._mult(Xe)._add(V)._unit()._mult(We?-1:1);this.addHalfVertex(L,xt.x,xt.y,!1,We,0,E)}}B&&this.addCurrentVertex(L,X,-qe,-ze,E)}else if(Re==="butt")this.addCurrentVertex(L,le,0,0,E);else if(Re==="square"){const Me=O?1:-1;this.addCurrentVertex(L,le,Me,Me,E)}else Re==="round"&&(O&&(this.addCurrentVertex(L,V,0,0,E),this.addCurrentVertex(L,V,1,1,E,!0)),B&&(this.addCurrentVertex(L,X,-1,-1,E,!0),this.addCurrentVertex(L,X,0,0,E)));if(Be&&$<S-1){const Me=L.dist(B);if(Me>2*A){const qe=L.add(B.sub(L)._mult(A/Me)._round());this.updateDistance(L,qe),this.addCurrentVertex(qe,X,0,0,E),L=qe}}}}addCurrentVertex(e,r,s,c,m,g=!1){const v=r.y*c-r.x,S=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,g,!1,s,m),this.addHalfVertex(e,v,S,g,!0,-c,m),this.distance>dd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,s,c,m,g))}addHalfVertex({x:e,y:r},s,c,m,g,v,S){const I=.5*(this.lineClips?this.scaledDistance*(dd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(v===0?0:v<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),S.primitiveLength++),g?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let pd,fd;Ve("LineBucket",Bh,{omit:["layers","patternFeatures"]});var md={get paint(){return fd=fd||new dr({"line-opacity":new st(fe.paint_line["line-opacity"]),"line-color":new st(fe.paint_line["line-color"]),"line-translate":new Ke(fe.paint_line["line-translate"]),"line-translate-anchor":new Ke(fe.paint_line["line-translate-anchor"]),"line-width":new st(fe.paint_line["line-width"]),"line-gap-width":new st(fe.paint_line["line-gap-width"]),"line-offset":new st(fe.paint_line["line-offset"]),"line-blur":new st(fe.paint_line["line-blur"]),"line-dasharray":new Yo(fe.paint_line["line-dasharray"]),"line-pattern":new ys(fe.paint_line["line-pattern"]),"line-gradient":new Qo(fe.paint_line["line-gradient"])})},get layout(){return pd=pd||new dr({"line-cap":new Ke(fe.layout_line["line-cap"]),"line-join":new st(fe.layout_line["line-join"]),"line-miter-limit":new Ke(fe.layout_line["line-miter-limit"]),"line-round-limit":new Ke(fe.layout_line["line-round-limit"]),"line-sort-key":new st(fe.layout_line["line-sort-key"])})}};class km extends st{possiblyEvaluate(e,r){return r=new ti(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,s,c){return r=yt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,s,c)}}let Lc;class Im extends Kr{constructor(e){super(e,md),this.gradientVersion=0,Lc||(Lc=new km(md.paint.properties["line-width"].specification),Lc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof js,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Lc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Bh(e)}queryRadius(e){const r=e,s=gd(dl("line-width",this,r),dl("line-gap-width",this,r)),c=dl("line-offset",this,r);return s/2+Math.abs(c)+Ic(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,s,c,m,g,v){const S=Cc(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,v),I=v/2*gd(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),A=this.paint.get("line-offset").evaluate(r,s);return A&&(c=function(E,L){const O=[];for(let B=0;B<E.length;B++){const V=E[B],X=[];for(let $=0;$<V.length;$++){const le=V[$-1],ee=V[$],se=V[$+1],me=$===0?new Z(0,0):ee.sub(le)._unit()._perp(),xe=$===V.length-1?new Z(0,0):se.sub(ee)._unit()._perp(),Be=me._add(xe)._unit(),We=Be.x*xe.x+Be.y*xe.y;We!==0&&Be._mult(1/We),X.push(Be._mult(L)._add(ee))}O.push(X)}return O}(c,A*v)),function(E,L,O){for(let B=0;B<L.length;B++){const V=L[B];if(E.length>=3){for(let X=0;X<V.length;X++)if(Qa(E,V[X]))return!0}if(kc(E,V,O))return!0}return!1}(S,c,I)}isTileClipped(){return!0}}function gd(i,e){return e>0?e+2*i:i}const Cm=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Am=Ti([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Em=Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ti([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _d=Ti([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pm=Ti([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Mm(i,e,r){return i.sections.forEach(s=>{s.text=function(c,m,g){const v=m.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?c=c.toLocaleUpperCase():v==="lowercase"&&(c=c.toLocaleLowerCase()),Gn.applyArabicShaping&&(c=Gn.applyArabicShaping(c)),c}(s.text,e,r)}),i}Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ti([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ti([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const bl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ui=24,yd=Jt,vd=function(i,e,r,s,c){var m,g,v=8*c-s-1,S=(1<<v)-1,I=S>>1,A=-7,E=r?c-1:0,L=r?-1:1,O=i[e+E];for(E+=L,m=O&(1<<-A)-1,O>>=-A,A+=v;A>0;m=256*m+i[e+E],E+=L,A-=8);for(g=m&(1<<-A)-1,m>>=-A,A+=s;A>0;g=256*g+i[e+E],E+=L,A-=8);if(m===0)m=1-I;else{if(m===S)return g?NaN:1/0*(O?-1:1);g+=Math.pow(2,s),m-=I}return(O?-1:1)*g*Math.pow(2,m-s)},xd=function(i,e,r,s,c,m){var g,v,S,I=8*m-c-1,A=(1<<I)-1,E=A>>1,L=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=s?0:m-1,B=s?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,g=A):(g=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-g))<1&&(g--,S*=2),(e+=g+E>=1?L/S:L*Math.pow(2,1-E))*S>=2&&(g++,S/=2),g+E>=A?(v=0,g=A):g+E>=1?(v=(e*S-1)*Math.pow(2,c),g+=E):(v=e*Math.pow(2,E-1)*Math.pow(2,c),g=0));c>=8;i[r+O]=255&v,O+=B,v/=256,c-=8);for(g=g<<c|v,I+=c;I>0;i[r+O]=255&g,O+=B,g/=256,I-=8);i[r+O-B]|=128*V};function Jt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Jt.Varint=0,Jt.Fixed64=1,Jt.Bytes=2,Jt.Fixed32=5;var jh=4294967296,bd=1/jh,wd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yn(i){return i.type===Jt.Bytes?i.readVarint()+i.pos:i.pos+1}function io(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Sd(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=i;c--)r.buf[c+s]=r.buf[c]}function zm(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Lm(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Dm(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Rm(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Om(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Fm(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Bm(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function jm(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Um(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Dc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function ro(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Td(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}Jt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,m=this.pos;this.type=7&s,i(c,e,this),this.pos===m&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Dc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Td(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Dc(this.buf,this.pos)+Dc(this.buf,this.pos+4)*jh;return this.pos+=8,i},readSFixed64:function(){var i=Dc(this.buf,this.pos)+Td(this.buf,this.pos+4)*jh;return this.pos+=8,i},readFloat:function(){var i=vd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=vd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,m,g){var v,S,I=g.buf;if(v=(112&(S=I[g.pos++]))>>4,S<128||(v|=(127&(S=I[g.pos++]))<<3,S<128)||(v|=(127&(S=I[g.pos++]))<<10,S<128)||(v|=(127&(S=I[g.pos++]))<<17,S<128)||(v|=(127&(S=I[g.pos++]))<<24,S<128)||(v|=(1&(S=I[g.pos++]))<<31,S<128))return io(c,v,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&wd?function(r,s,c){return wd.decode(r.subarray(s,c))}(this.buf,e,i):function(r,s,c){for(var m="",g=s;g<c;){var v,S,I,A=r[g],E=null,L=A>239?4:A>223?3:A>191?2:1;if(g+L>c)break;L===1?A<128&&(E=A):L===2?(192&(v=r[g+1]))==128&&(E=(31&A)<<6|63&v)<=127&&(E=null):L===3?(S=r[g+2],(192&(v=r[g+1]))==128&&(192&S)==128&&((E=(15&A)<<12|(63&v)<<6|63&S)<=2047||E>=55296&&E<=57343)&&(E=null)):L===4&&(S=r[g+2],I=r[g+3],(192&(v=r[g+1]))==128&&(192&S)==128&&(192&I)==128&&((E=(15&A)<<18|(63&v)<<12|(63&S)<<6|63&I)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,L=1):E>65535&&(E-=65536,m+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),m+=String.fromCharCode(E),g+=L}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Jt.Bytes)return i.push(this.readVarint(e));var r=Yn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Jt.Bytes)return i.push(this.readSVarint());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Jt.Bytes)return i.push(this.readBoolean());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Jt.Bytes)return i.push(this.readFloat());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Jt.Bytes)return i.push(this.readDouble());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Jt.Bytes)return i.push(this.readFixed32());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Jt.Bytes)return i.push(this.readSFixed32());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Jt.Bytes)return i.push(this.readFixed64());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Jt.Bytes)return i.push(this.readSFixed64());var e=Yn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Jt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Jt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Jt.Fixed32)this.pos+=4;else{if(e!==Jt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ro(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ro(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ro(this.buf,-1&i,this.pos),ro(this.buf,Math.floor(i*bd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ro(this.buf,-1&i,this.pos),ro(this.buf,Math.floor(i*bd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,g,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)}(s,0,r),function(m,g){var v=(7&m)<<4;g.buf[g.pos++]|=v|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,c,m){for(var g,v,S=0;S<c.length;S++){if((g=c.charCodeAt(S))>55295&&g<57344){if(!v){g>56319||S+1===c.length?(s[m++]=239,s[m++]=191,s[m++]=189):v=g;continue}if(g<56320){s[m++]=239,s[m++]=191,s[m++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(s[m++]=239,s[m++]=191,s[m++]=189,v=null);g<128?s[m++]=g:(g<2048?s[m++]=g>>6|192:(g<65536?s[m++]=g>>12|224:(s[m++]=g>>18|240,s[m++]=g>>12&63|128),s[m++]=g>>6&63|128),s[m++]=63&g|128)}return m}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Sd(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),xd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),xd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&Sd(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Jt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,zm,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Lm,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Om,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Dm,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Rm,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Fm,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Bm,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,jm,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Um,e)},writeBytesField:function(i,e){this.writeTag(i,Jt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Jt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Jt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Jt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Jt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Jt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Jt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Jt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Jt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Jt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Uh=D(yd);const Vh=3;function Vm(i,e,r){i===1&&r.readMessage(Nm,e)}function Nm(i,e,r){if(i===3){const{id:s,bitmap:c,width:m,height:g,left:v,top:S,advance:I}=r.readMessage(qm,{});e.push({id:s,bitmap:new fl({width:m+2*Vh,height:g+2*Vh},c),metrics:{width:m,height:g,left:v,top:S,advance:I}})}}function qm(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const kd=Vh;function Id(i){let e=0,r=0;for(const g of i)e+=g.w*g.h,r=Math.max(r,g.w);i.sort((g,v)=>v.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,m=0;for(const g of i)for(let v=s.length-1;v>=0;v--){const S=s[v];if(!(g.w>S.w||g.h>S.h)){if(g.x=S.x,g.y=S.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===S.w&&g.h===S.h){const I=s.pop();v<s.length&&(s[v]=I)}else g.h===S.h?(S.x+=g.w,S.w-=g.w):g.w===S.w?(S.y+=g.h,S.h-=g.h):(s.push({x:S.x+g.w,y:S.y,w:S.w-g.w,h:g.h}),S.y+=g.h,S.h-=g.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}const Dr=1;class Nh{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:m,content:g}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=m,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+Dr,this.paddedRect.y+Dr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Dr,this.paddedRect.y+this.paddedRect.h-Dr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Dr)/this.pixelRatio,(this.paddedRect.h-2*Dr)/this.pixelRatio]}}class Cd{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,s,m),this.addImages(r,c,m);const{w:g,h:v}=Id(m),S=new Xr({width:g||1,height:v||1});for(const I in e){const A=e[I],E=s[I].paddedRect;Xr.copy(A.data,S,{x:0,y:0},{x:E.x+Dr,y:E.y+Dr},A.data)}for(const I in r){const A=r[I],E=c[I].paddedRect,L=E.x+Dr,O=E.y+Dr,B=A.data.width,V=A.data.height;Xr.copy(A.data,S,{x:0,y:0},{x:L,y:O},A.data),Xr.copy(A.data,S,{x:0,y:V-1},{x:L,y:O-1},{width:B,height:1}),Xr.copy(A.data,S,{x:0,y:0},{x:L,y:O+V},{width:B,height:1}),Xr.copy(A.data,S,{x:B-1,y:0},{x:L-1,y:O},{width:1,height:V}),Xr.copy(A.data,S,{x:0,y:0},{x:L+B,y:O},{width:1,height:V})}this.image=S,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const m=e[c],g={x:0,y:0,w:m.data.width+2*Dr,h:m.data.height+2*Dr};s.push(g),r[c]=new Nh(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,m]=e.tl;s.update(r.data,void 0,{x:c,y:m})}}var Ss;Ve("ImagePosition",Nh),Ve("ImageAtlas",Cd),y.ah=void 0,(Ss=y.ah||(y.ah={}))[Ss.none=0]="none",Ss[Ss.horizontal=1]="horizontal",Ss[Ss.vertical=2]="vertical",Ss[Ss.horizontalOnly=3]="horizontalOnly";const wl=-17;class Sl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Sl;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Sl;return r.imageName=e,r}}class no{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new no;for(let c=0;c<e.sections.length;c++){const m=e.sections[c];m.image?s.addImageSection(m):s.addTextSection(m,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const c=e.charCodeAt(s+1)||null,m=e.charCodeAt(s-1)||null;r+=c&&Za(c)&&!bl[e[s+1]]||m&&Za(m)&&!bl[e[s-1]]||!bl[e[s]]?e[s]:bl[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&Oc[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Oc[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new no;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Sl.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Mt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Sl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Mt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rc(i,e,r,s,c,m,g,v,S,I,A,E,L,O,B,V){const X=no.fromFeature(i,c);let $;E===y.ah.vertical&&X.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:ee}=Gn;if(le&&X.sections.length===1){$=[];const xe=le(X.toString(),qh(X,I,m,e,s,O,B));for(const Be of xe){const We=new no;We.text=Be,We.sections=X.sections;for(let Fe=0;Fe<Be.length;Fe++)We.sectionIndex.push(0);$.push(We)}}else if(ee){$=[];const xe=ee(X.text,X.sectionIndex,qh(X,I,m,e,s,O,B));for(const Be of xe){const We=new no;We.text=Be[0],We.sectionIndex=Be[1],We.sections=X.sections,$.push(We)}}else $=function(xe,Be){const We=[],Fe=xe.text;let Re=0;for(const Me of Be)We.push(xe.substring(Re,Me)),Re=Me;return Re<Fe.length&&We.push(xe.substring(Re,Fe.length)),We}(X,qh(X,I,m,e,s,O,B));const se=[],me={positionedLines:se,text:X.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(xe,Be,We,Fe,Re,Me,qe,ze,ke,$e,Xe,xt){let ni=0,ui=wl,Vi=0,Gr=0;const Tr=ze==="right"?1:ze==="left"?0:.5;let Mi=0;for(const Ni of Re){Ni.trim();const qi=Ni.getMaxScale(),mr=(qi-1)*Ui,Cr={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Mi]=Cr;const gr=Cr.positionedGlyphs;let Rr=0;if(!Ni.length()){ui+=Me,++Mi;continue}for(let Zi=0;Zi<Ni.length();Zi++){const St=Ni.getSection(Zi),_r=Ni.getSectionIndex(Zi),lr=Ni.getCharCode(Zi);let Gi=0,on=null,_n=null,yn=null,Qn=Ui;const ln=!(ke===y.ah.horizontal||!Xe&&!qa(lr)||Xe&&(Oc[lr]||($i=lr,Oe.Arabic($i)||Oe["Arabic Supplement"]($i)||Oe["Arabic Extended-A"]($i)||Oe["Arabic Presentation Forms-A"]($i)||Oe["Arabic Presentation Forms-B"]($i))));if(St.imageName){const Yr=Fe[St.imageName];if(!Yr)continue;yn=St.imageName,xe.iconsInText=xe.iconsInText||!0,_n=Yr.paddedRect;const Fr=Yr.displaySize;St.scale=St.scale*Ui/xt,on={width:Fr[0],height:Fr[1],left:Dr,top:-kd,advance:ln?Fr[1]:Fr[0]},Gi=mr+(Ui-Fr[1]*St.scale),Qn=on.advance;const $n=ln?Fr[0]*St.scale-Ui*qi:Fr[1]*St.scale-Ui*qi;$n>0&&$n>Rr&&(Rr=$n)}else{const Yr=We[St.fontStack],Fr=Yr&&Yr[lr];if(Fr&&Fr.rect)_n=Fr.rect,on=Fr.metrics;else{const $n=Be[St.fontStack],Al=$n&&$n[lr];if(!Al)continue;on=Al.metrics}Gi=(qi-St.scale)*Ui}ln?(xe.verticalizable=!0,gr.push({glyph:lr,imageName:yn,x:ni,y:ui+Gi,vertical:ln,scale:St.scale,fontStack:St.fontStack,sectionIndex:_r,metrics:on,rect:_n}),ni+=Qn*St.scale+$e):(gr.push({glyph:lr,imageName:yn,x:ni,y:ui+Gi,vertical:ln,scale:St.scale,fontStack:St.fontStack,sectionIndex:_r,metrics:on,rect:_n}),ni+=on.advance*St.scale+$e)}gr.length!==0&&(Vi=Math.max(ni-$e,Vi),Hm(gr,0,gr.length-1,Tr,Rr)),ni=0;const Or=Me*qi+Rr;Cr.lineOffset=Math.max(Rr,mr),ui+=Or,Gr=Math.max(Or,Gr),++Mi}var $i;const or=ui-wl,{horizontalAlign:kr,verticalAlign:Ir}=Zh(qe);(function(Ni,qi,mr,Cr,gr,Rr,Or,Zi,St){const _r=(qi-mr)*gr;let lr=0;lr=Rr!==Or?-Zi*Cr-wl:(-Cr*St+.5)*Or;for(const Gi of Ni)for(const on of Gi.positionedGlyphs)on.x+=_r,on.y+=lr})(xe.positionedLines,Tr,kr,Ir,Vi,Gr,Me,or,Re.length),xe.top+=-Ir*or,xe.bottom=xe.top+or,xe.left+=-kr*Vi,xe.right=xe.left+Vi}(me,e,r,s,$,g,v,S,E,I,L,V),!function(xe){for(const Be of xe)if(Be.positionedGlyphs.length!==0)return!1;return!0}(se)&&me}const Oc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ad(i,e,r,s,c,m){if(e.imageName){const g=s[e.imageName];return g?g.displaySize[0]*e.scale*Ui/m+c:0}{const g=r[e.fontStack],v=g&&g[i];return v?v.metrics.advance*e.scale+c:0}}function Ed(i,e,r,s){const c=Math.pow(i-e,2);return s?i<e?c/2:2*c:c+Math.abs(r)*r}function Gm(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Pd(i,e,r,s,c,m){let g=null,v=Ed(e,r,c,m);for(const S of s){const I=Ed(e-S.x,r,c,m)+S.badness;I<=v&&(g=S,v=I)}return{index:i,x:e,priorBreak:g,badness:v}}function Md(i){return i?Md(i.priorBreak).concat(i.index):[]}function qh(i,e,r,s,c,m,g){if(m!=="point")return[];if(!i)return[];const v=[],S=function(L,O,B,V,X,$){let le=0;for(let ee=0;ee<L.length();ee++){const se=L.getSection(ee);le+=Ad(L.getCharCode(ee),se,V,X,O,$)}return le/Math.max(1,Math.ceil(le/B))}(i,e,r,s,c,g),I=i.text.indexOf("​")>=0;let A=0;for(let L=0;L<i.length();L++){const O=i.getSection(L),B=i.getCharCode(L);if(Oc[B]||(A+=Ad(B,O,s,c,e,g)),L<i.length()-1){const V=!((E=B)<11904||!(Oe["Bopomofo Extended"](E)||Oe.Bopomofo(E)||Oe["CJK Compatibility Forms"](E)||Oe["CJK Compatibility Ideographs"](E)||Oe["CJK Compatibility"](E)||Oe["CJK Radicals Supplement"](E)||Oe["CJK Strokes"](E)||Oe["CJK Symbols and Punctuation"](E)||Oe["CJK Unified Ideographs Extension A"](E)||Oe["CJK Unified Ideographs"](E)||Oe["Enclosed CJK Letters and Months"](E)||Oe["Halfwidth and Fullwidth Forms"](E)||Oe.Hiragana(E)||Oe["Ideographic Description Characters"](E)||Oe["Kangxi Radicals"](E)||Oe["Katakana Phonetic Extensions"](E)||Oe.Katakana(E)||Oe["Vertical Forms"](E)||Oe["Yi Radicals"](E)||Oe["Yi Syllables"](E)));(Zm[B]||V||O.imageName)&&v.push(Pd(L+1,A,S,v,Gm(B,i.getCharCode(L+1),V&&I),!1))}}var E;return Md(Pd(i.length(),A,S,v,0,!0))}function Zh(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Hm(i,e,r,s,c){if(!s&&!c)return;const m=i[r],g=(i[r].x+m.metrics.advance*m.scale)*s;for(let v=e;v<=r;v++)i[v].x-=g,i[v].y+=c}function Wm(i,e,r){const{horizontalAlign:s,verticalAlign:c}=Zh(r),m=e[0]-i.displaySize[0]*s,g=e[1]-i.displaySize[1]*c;return{image:i,top:g,bottom:g+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function zd(i,e,r,s,c,m){const g=i.image;let v;if(g.content){const X=g.content,$=g.pixelRatio||1;v=[X[0]/$,X[1]/$,g.displaySize[0]-X[2]/$,g.displaySize[1]-X[3]/$]}const S=e.left*m,I=e.right*m;let A,E,L,O;r==="width"||r==="both"?(O=c[0]+S-s[3],E=c[0]+I+s[1]):(O=c[0]+(S+I-g.displaySize[0])/2,E=O+g.displaySize[0]);const B=e.top*m,V=e.bottom*m;return r==="height"||r==="both"?(A=c[1]+B-s[0],L=c[1]+V+s[2]):(A=c[1]+(B+V-g.displaySize[1])/2,L=A+g.displaySize[1]),{image:g,top:A,right:E,bottom:L,left:O,collisionPadding:v}}const Tl=255,Mn=128,Ts=Tl*Mn;function Ld(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ti(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let m=0;for(;m<s.length&&s[m]<=i;)m++;m=Math.max(0,m-1);let g=m;for(;g<s.length&&s[g]<i+1;)g++;g=Math.min(s.length-1,g);const v=s[m],S=s[g];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:S,interpolationType:c}:{kind:"camera",minZoom:v,maxZoom:S,minSize:r.evaluate(new ti(v)),maxSize:r.evaluate(new ti(S)),interpolationType:c}}}function Gh(i,e,r){let s="never";const c=i.get(e);return c?s=c:i.get(r)&&(s="always"),s}const Km=ws.VectorTileFeature.types,Xm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fc(i,e,r,s,c,m,g,v,S,I,A,E,L){const O=v?Math.min(Ts,Math.round(v[0])):0,B=v?Math.min(Ts,Math.round(v[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),m,g,(O<<1)+(S?1:0),B,16*I,16*A,256*E,256*L)}function Hh(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Jm(i){for(const e of i.sections)if(_c(e.text))return!0;return!1}class Wh{constructor(e){this.layoutVertexArray=new Q,this.indexArray=new Se,this.programConfigurations=e,this.segments=new rt,this.dynamicLayoutVertexArray=new ae,this.opacityVertexArray=new pe,this.hasVisibleVertices=!1,this.placedSymbolArray=new a}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Am.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Xm,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ve("SymbolBuffers",Wh);class Kh{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new rt,this.collisionVertexArray=new ve}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Em.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ve("CollisionBuffers",Kh);class so{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=kh([]),this.placementViewportMatrix=kh([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ld(this.zoom,r["text-size"]),this.iconSizeData=Ld(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=Gh(s,"text-overlap","text-allow-overlap")!=="never"||Gh(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(g=>y.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new Wh(new Ji(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Wh(new Ji(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new w,this.lineVertexArray=new T,this.symbolInstances=new f,this.textAnchorOffsets=new C}calculateGlyphDependencies(e,r,s,c,m){for(let g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,(s||c)&&m){const v=bl[e.charAt(g)];v&&(r[v.charCodeAt(0)]=!0)}}populate(e,r,s){const c=this.layers[0],m=c.layout,g=m.get("text-font"),v=m.get("text-field"),S=m.get("icon-image"),I=(v.value.kind!=="constant"||v.value.value instanceof Mr&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),A=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,E=m.get("symbol-sort-key");if(this.features=[],!I&&!A)return;const L=r.iconDependencies,O=r.glyphDependencies,B=r.availableImages,V=new ti(this.zoom);for(const{feature:X,id:$,index:le,sourceLayerIndex:ee}of e){const se=c._featureFilter.needGeometry,me=Jn(X,se);if(!c._featureFilter.filter(V,me,s))continue;let xe,Be;if(se||(me.geometry=Xn(X)),I){const Fe=c.getValueAndResolveTokens("text-field",me,s,B),Re=Mr.factory(Fe);Jm(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||Gn.getRTLTextPluginStatus()==="unavailable"||this.hasRTLText&&Gn.isParsed())&&(xe=Mm(Re,c,me))}if(A){const Fe=c.getValueAndResolveTokens("icon-image",me,s,B);Be=Fe instanceof Nr?Fe:Nr.fromString(Fe)}if(!xe&&!Be)continue;const We=this.sortFeaturesByKey?E.evaluate(me,{},s):void 0;if(this.features.push({id:$,text:xe,icon:Be,index:le,sourceLayerIndex:ee,geometry:me.geometry,properties:X.properties,type:Km[X.type],sortKey:We}),Be&&(L[Be.name]=!0),xe){const Fe=g.evaluate(me,{},s).join(","),Re=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(y.ah.vertical)>=0;for(const Me of xe.sections)if(Me.image)L[Me.image.name]=!0;else{const qe=Na(xe.toString()),ze=Me.fontStack||Fe,ke=O[ze]=O[ze]||{};this.calculateGlyphDependencies(Me.text,ke,Re,this.allowVerticalPlacement,qe)}}}m.get("symbol-placement")==="line"&&(this.features=function(X){const $={},le={},ee=[];let se=0;function me(Fe){ee.push(X[Fe]),se++}function xe(Fe,Re,Me){const qe=le[Fe];return delete le[Fe],le[Re]=qe,ee[qe].geometry[0].pop(),ee[qe].geometry[0]=ee[qe].geometry[0].concat(Me[0]),qe}function Be(Fe,Re,Me){const qe=$[Re];return delete $[Re],$[Fe]=qe,ee[qe].geometry[0].shift(),ee[qe].geometry[0]=Me[0].concat(ee[qe].geometry[0]),qe}function We(Fe,Re,Me){const qe=Me?Re[0][Re[0].length-1]:Re[0][0];return`${Fe}:${qe.x}:${qe.y}`}for(let Fe=0;Fe<X.length;Fe++){const Re=X[Fe],Me=Re.geometry,qe=Re.text?Re.text.toString():null;if(!qe){me(Fe);continue}const ze=We(qe,Me),ke=We(qe,Me,!0);if(ze in le&&ke in $&&le[ze]!==$[ke]){const $e=Be(ze,ke,Me),Xe=xe(ze,ke,ee[$e].geometry);delete $[ze],delete le[ke],le[We(qe,ee[Xe].geometry,!0)]=Xe,ee[$e].geometry=null}else ze in le?xe(ze,ke,Me):ke in $?Be(ze,ke,Me):(me(Fe),$[ze]=se-1,le[ke]=se-1)}return ee.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,$)=>X.sortKey-$.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),m=e.dist(r[e.segment]);const g={};for(let v=e.segment+1;v<r.length;v++)g[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:c},v<r.length-1&&(c+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)g[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:m},v>0&&(m+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const S=g[v];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,m,g,v,S,I,A,E,L){const O=e.indexArray,B=e.layoutVertexArray,V=e.segments.prepareSegment(4*r.length,B,O,this.canOverlap?g.sortKey:void 0),X=this.glyphOffsetArray.length,$=V.vertexLength,le=this.allowVerticalPlacement&&v===y.ah.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let se=0;se<r.length;se++){const{tl:me,tr:xe,bl:Be,br:We,tex:Fe,pixelOffsetTL:Re,pixelOffsetBR:Me,minFontScaleX:qe,minFontScaleY:ze,glyphOffset:ke,isSDF:$e,sectionIndex:Xe}=r[se],xt=V.vertexLength,ni=ke[1];Fc(B,S.x,S.y,me.x,ni+me.y,Fe.x,Fe.y,s,$e,Re.x,Re.y,qe,ze),Fc(B,S.x,S.y,xe.x,ni+xe.y,Fe.x+Fe.w,Fe.y,s,$e,Me.x,Re.y,qe,ze),Fc(B,S.x,S.y,Be.x,ni+Be.y,Fe.x,Fe.y+Fe.h,s,$e,Re.x,Me.y,qe,ze),Fc(B,S.x,S.y,We.x,ni+We.y,Fe.x+Fe.w,Fe.y+Fe.h,s,$e,Me.x,Me.y,qe,ze),Hh(e.dynamicLayoutVertexArray,S,le),O.emplaceBack(xt,xt+1,xt+2),O.emplaceBack(xt+1,xt+2,xt+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),se!==r.length-1&&Xe===r[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,g,g.index,{},L,ee&&ee[Xe])}e.placedSymbolArray.emplaceBack(S.x,S.y,X,this.glyphOffsetArray.length-X,$,I,A,S.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],v,0,!1,0,E)}_addCollisionDebugVertex(e,r,s,c,m,g){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,r,s,c,m,g,v){const S=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),I=S.vertexLength,A=m.layoutVertexArray,E=m.collisionVertexArray,L=v.anchorX,O=v.anchorY;this._addCollisionDebugVertex(A,E,g,L,O,new Z(e,r)),this._addCollisionDebugVertex(A,E,g,L,O,new Z(s,r)),this._addCollisionDebugVertex(A,E,g,L,O,new Z(s,c)),this._addCollisionDebugVertex(A,E,g,L,O,new Z(e,c)),S.vertexLength+=4;const B=m.indexArray;B.emplaceBack(I,I+1),B.emplaceBack(I+1,I+2),B.emplaceBack(I+2,I+3),B.emplaceBack(I+3,I),S.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,c){for(let m=e;m<r;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kh(de,_d.members,we),this.iconCollisionBox=new Kh(de,_d.members,we);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,c,m,g,v,S,I){const A={};for(let E=r;E<s;E++){const L=e.get(E);A.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.textFeatureIndex=L.featureIndex;break}for(let E=c;E<m;E++){const L=e.get(E);A.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.verticalTextFeatureIndex=L.featureIndex;break}for(let E=g;E<v;E++){const L=e.get(E);A.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.iconFeatureIndex=L.featureIndex;break}for(let E=S;E<I;E++){const L=e.get(E);A.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.verticalIconFeatureIndex=L.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let m=s.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],m=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const S=this.symbolInstances.get(v);c.push(0|Math.round(r*S.anchorX+s*S.anchorY)),m.push(S.featureIndex)}return g.sort((v,S)=>c[v]-c[S]||m[S]-m[v]),g}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Dd,Rd;Ve("SymbolBucket",so,{omit:["layers","collisionBoxArray","features","compareText"]}),so.MAX_GLYPHS=65535,so.addDynamicAttributes=Hh;var Xh={get paint(){return Rd=Rd||new dr({"icon-opacity":new st(fe.paint_symbol["icon-opacity"]),"icon-color":new st(fe.paint_symbol["icon-color"]),"icon-halo-color":new st(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(fe.paint_symbol["text-opacity"]),"text-color":new st(fe.paint_symbol["text-color"],{runtimeType:Ai,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new st(fe.paint_symbol["text-halo-color"]),"text-halo-width":new st(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new st(fe.paint_symbol["text-halo-blur"]),"text-translate":new Ke(fe.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(fe.paint_symbol["text-translate-anchor"])})},get layout(){return Dd=Dd||new dr({"symbol-placement":new Ke(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ke(fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ke(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(fe.layout_symbol["icon-size"]),"icon-text-fit":new Ke(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(fe.layout_symbol["icon-image"]),"icon-rotate":new st(fe.layout_symbol["icon-rotate"]),"icon-padding":new st(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new st(fe.layout_symbol["icon-offset"]),"icon-anchor":new st(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(fe.layout_symbol["text-rotation-alignment"]),"text-field":new st(fe.layout_symbol["text-field"]),"text-font":new st(fe.layout_symbol["text-font"]),"text-size":new st(fe.layout_symbol["text-size"]),"text-max-width":new st(fe.layout_symbol["text-max-width"]),"text-line-height":new Ke(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new st(fe.layout_symbol["text-letter-spacing"]),"text-justify":new st(fe.layout_symbol["text-justify"]),"text-radial-offset":new st(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new st(fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new st(fe.layout_symbol["text-anchor"]),"text-max-angle":new Ke(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(fe.layout_symbol["text-writing-mode"]),"text-rotate":new st(fe.layout_symbol["text-rotate"]),"text-padding":new Ke(fe.layout_symbol["text-padding"]),"text-keep-upright":new Ke(fe.layout_symbol["text-keep-upright"]),"text-transform":new st(fe.layout_symbol["text-transform"]),"text-offset":new st(fe.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(fe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ke(fe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ke(fe.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(fe.layout_symbol["text-optional"])})}};class Od{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ir,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ve("FormatSectionOverride",Od,{omit:["defaultValue"]});class Bc extends Kr{constructor(e){super(e,Xh)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const m of s)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const m=this.layout.get(e).evaluate(r,{},s,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Qt(g.value)||!m?m:function(v,S){return S.replace(/{([^{}]+)}/g,(I,A)=>v&&A in v?String(v[A]):"")}(r.properties,m)}createBucket(e){return new so(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Xh.paint.overridableProperties){if(!Bc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Od(r),c=new ei(s,r.property.specification);let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new Ma("source",c):new Uo("composite",c,r.value.zoomStops),this.paint._values[e]=new Wr(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Bc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=Xh.paint.properties[r];let m=!1;const g=v=>{for(const S of v)if(c.overrides&&c.overrides.hasOverride(S))return void(m=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Mr)g(s.value.value.sections);else if(s.value.kind==="source"){const v=I=>{m||(I instanceof Tn&&Pi(I.value)===Ri?g(I.value.sections):I instanceof Ea?g(I.sections):I.eachChild(v))},S=s.value;S._styleExpression&&v(S._styleExpression.expression)}return m}}let Fd;var Ym={get paint(){return Fd=Fd||new dr({"background-color":new Ke(fe.paint_background["background-color"]),"background-pattern":new Yo(fe.paint_background["background-pattern"]),"background-opacity":new Ke(fe.paint_background["background-opacity"])})}};class Qm extends Kr{constructor(e){super(e,Ym)}}let Bd;var $m={get paint(){return Bd=Bd||new dr({"raster-opacity":new Ke(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(fe.paint_raster["raster-saturation"]),"raster-contrast":new Ke(fe.paint_raster["raster-contrast"]),"raster-resampling":new Ke(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(fe.paint_raster["raster-fade-duration"])})}};class eg extends Kr{constructor(e){super(e,$m)}}class tg extends Kr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ig{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Jh=63710088e-1;class ks{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ks(Dt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,m=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return Jh*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof ks)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ks(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ks(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const jd=2*Math.PI*Jh;function Ud(i){return jd*Math.cos(i*Math.PI/180)}function Vd(i){return(180+i)/360}function Nd(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function qd(i,e){return i/Ud(e)}function Yh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class jc{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=ks.convert(e);return new jc(Vd(s.lng),Nd(s.lat),qd(r,s.lat))}toLngLat(){return new ks(360*this.x-180,Yh(this.y))}toAltitude(){return this.z*Ud(Yh(this.y))}meterInMercatorCoordinateUnits(){return 1/jd*(e=Yh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Zd(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Qh{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=kl(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const c=(g=this.y,v=this.z,S=Zd(256*(m=this.x),256*(g=Math.pow(2,v)-g-1),v),I=Zd(256*(m+1),256*(g+1),v),S[0]+","+S[1]+","+I[0]+","+I[1]);var m,g,v,S,I;const A=function(E,L,O){let B,V="";for(let X=E;X>0;X--)B=1<<X-1,V+=(L&B?1:0)+(O&B?2:0);return V}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Z((e.x*r-this.x)*wi,(e.y*r-this.y)*wi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gd{constructor(e,r){this.wrap=e,this.canonical=r,this.key=kl(e,r.z,r.z,r.x,r.y)}}class Jr{constructor(e,r,s,c,m){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Qh(s,+c,+m),this.key=kl(r,e,s,c,m)}clone(){return new Jr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Jr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?kl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):kl(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Jr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Jr(r,this.wrap,r,s,c),new Jr(r,this.wrap,r,s+1,c),new Jr(r,this.wrap,r,s,c+1),new Jr(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Jr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Jr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new jc(e.x-this.wrap,e.y))}}function kl(i,e,r,s,c){(i*=2)<0&&(i=-1*i-1);const m=1<<r;return(m*m*i+m*c+s).toString(36)+r.toString(36)+e.toString(36)}Ve("CanonicalTileID",Qh),Ve("OverscaledTileID",Jr,{omit:["posMatrix"]});class Hd{constructor(e,r,s,c=1,m=1,g=1,v=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Mt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const S=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<S;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(S,I)]=this.data[this._idx(S-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,S)]=this.data[this._idx(I,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<S;I++)for(let A=0;A<S;A++){const E=this.get(I,A);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(e,r){const s=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return this.unpack(s[c],s[c+1],s[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,s){return e*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Xr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,m=r*this.dim+this.dim,g=s*this.dim,v=s*this.dim+this.dim;switch(r){case-1:c=m-1;break;case 1:m=c+1}switch(s){case-1:g=v-1;break;case 1:v=g+1}const S=-r*this.dim,I=-s*this.dim;for(let A=g;A<v;A++)for(let E=c;E<m;E++)this.data[this._idx(E,A)]=e.data[this._idx(E+S,A+I)]}}Ve("DEMData",Hd);class Wd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Kd{constructor(e,r,s,c,m){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=c,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Xd{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Zn(wi,16,0),this.grid3D=new Zn(wi,16,0),this.featureIndexArray=new M,this.promoteId=r}insert(e,r,s,c,m,g){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,m);const S=g?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const A=r[I],E=[1/0,1/0,-1/0,-1/0];for(let L=0;L<A.length;L++){const O=A[L];E[0]=Math.min(E[0],O.x),E[1]=Math.min(E[1],O.y),E[2]=Math.max(E[2],O.x),E[3]=Math.max(E[3],O.y)}E[0]<wi&&E[1]<wi&&E[2]>=0&&E[3]>=0&&S.insert(v,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ws.VectorTile(new Uh(this.rawTileData)).layers,this.sourceLayerCoder=new Wd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,c){this.loadVTLayers();const m=e.params||{},g=wi/e.tileSize/e.scale,v=Ra(m.filter),S=e.queryGeometry,I=e.queryPadding*g,A=Yd(S),E=this.grid.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I),L=Yd(e.cameraQueryGeometry),O=this.grid3D.query(L.minX-I,L.minY-I,L.maxX+I,L.maxY+I,(X,$,le,ee)=>function(se,me,xe,Be,We){for(const Re of se)if(me<=Re.x&&xe<=Re.y&&Be>=Re.x&&We>=Re.y)return!0;const Fe=[new Z(me,xe),new Z(me,We),new Z(Be,We),new Z(Be,xe)];if(se.length>2){for(const Re of Fe)if(Qa(se,Re))return!0}for(let Re=0;Re<se.length-1;Re++)if(Df(se[Re],se[Re+1],Fe))return!0;return!1}(e.cameraQueryGeometry,X-I,$-I,le+I,ee+I));for(const X of O)E.push(X);E.sort(rg);const B={};let V;for(let X=0;X<E.length;X++){const $=E[X];if($===V)continue;V=$;const le=this.featureIndexArray.get($);let ee=null;this.loadMatchingFeature(B,le.bucketIndex,le.sourceLayerIndex,le.featureIndex,v,m.layers,m.availableImages,r,s,c,(se,me,xe)=>(ee||(ee=Xn(se)),me.queryIntersectsFeature(S,se,xe,ee,this.z,e.transform,g,e.pixelPosMatrix)))}return B}loadMatchingFeature(e,r,s,c,m,g,v,S,I,A,E){const L=this.bucketLayerIDs[r];if(g&&!function(X,$){for(let le=0;le<X.length;le++)if($.indexOf(X[le])>=0)return!0;return!1}(g,L))return;const O=this.sourceLayerCoder.decode(s),B=this.vtLayers[O].feature(c);if(m.needGeometry){const X=Jn(B,!0);if(!m.filter(new ti(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!m.filter(new ti(this.tileID.overscaledZ),B))return;const V=this.getId(B,O);for(let X=0;X<L.length;X++){const $=L[X];if(g&&g.indexOf($)<0)continue;const le=S[$];if(!le)continue;let ee={};V&&A&&(ee=A.getState(le.sourceLayer||"_geojsonTileLayer",V));const se=yt({},I[$]);se.paint=Jd(se.paint,le.paint,B,ee,v),se.layout=Jd(se.layout,le.layout,B,ee,v);const me=!E||E(B,le,ee);if(!me)continue;const xe=new Kd(B,this.z,this.x,this.y,V);xe.layer=se;let Be=e[$];Be===void 0&&(Be=e[$]=[]),Be.push({featureIndex:c,feature:xe,intersectionZ:me})}}lookupSymbolFeatures(e,r,s,c,m,g,v,S){const I={};this.loadVTLayers();const A=Ra(m);for(const E of e)this.loadMatchingFeature(I,s,c,E,A,g,v,S,r);return I}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function Jd(i,e,r,s,c){return dt(i,(m,g)=>{const v=e instanceof Ks?e.get(g):null;return v&&v.evaluate?v.evaluate(r,s,c):v})}function Yd(i){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const m of i)e=Math.min(e,m.x),r=Math.min(r,m.y),s=Math.max(s,m.x),c=Math.max(c,m.y);return{minX:e,minY:r,maxX:s,maxY:c}}function rg(i,e){return e-i}function Qd(i,e,r,s,c){const m=[];for(let g=0;g<i.length;g++){const v=i[g];let S;for(let I=0;I<v.length-1;I++){let A=v[I],E=v[I+1];A.x<e&&E.x<e||(A.x<e?A=new Z(e,A.y+(e-A.x)/(E.x-A.x)*(E.y-A.y))._round():E.x<e&&(E=new Z(e,A.y+(e-A.x)/(E.x-A.x)*(E.y-A.y))._round()),A.y<r&&E.y<r||(A.y<r?A=new Z(A.x+(r-A.y)/(E.y-A.y)*(E.x-A.x),r)._round():E.y<r&&(E=new Z(A.x+(r-A.y)/(E.y-A.y)*(E.x-A.x),r)._round()),A.x>=s&&E.x>=s||(A.x>=s?A=new Z(s,A.y+(s-A.x)/(E.x-A.x)*(E.y-A.y))._round():E.x>=s&&(E=new Z(s,A.y+(s-A.x)/(E.x-A.x)*(E.y-A.y))._round()),A.y>=c&&E.y>=c||(A.y>=c?A=new Z(A.x+(c-A.y)/(E.y-A.y)*(E.x-A.x),c)._round():E.y>=c&&(E=new Z(A.x+(c-A.y)/(E.y-A.y)*(E.x-A.x),c)._round()),S&&A.equals(S[S.length-1])||(S=[A],m.push(S)),S.push(E)))))}}return m}Ve("FeatureIndex",Xd,{omit:["rawTileData","sourceLayerCoder"]});class Is extends Z{constructor(e,r,s,c){super(e,r),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new Is(this.x,this.y,this.angle,this.segment)}}function $d(i,e,r,s,c){if(e.segment===void 0||r===0)return!0;let m=e,g=e.segment+1,v=0;for(;v>-r/2;){if(g--,g<0)return!1;v-=i[g].dist(m),m=i[g]}v+=i[g].dist(i[g+1]),g++;const S=[];let I=0;for(;v<r/2;){const A=i[g],E=i[g+1];if(!E)return!1;let L=i[g-1].angleTo(A)-A.angleTo(E);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:L}),I+=L;v-S[0].distance>s;)I-=S.shift().angleDelta;if(I>c)return!1;g++,v+=A.dist(E)}return!0}function ep(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function tp(i,e,r){return i?.6*e*r:0}function ip(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function ng(i,e,r,s,c,m){const g=tp(r,c,m),v=ip(r,s)*m;let S=0;const I=ep(i)/2;for(let A=0;A<i.length-1;A++){const E=i[A],L=i[A+1],O=E.dist(L);if(S+O>I){const B=(I-S)/O,V=hr.number(E.x,L.x,B),X=hr.number(E.y,L.y,B),$=new Is(V,X,L.angleTo(E),A);return $._round(),!g||$d(i,$,v,g,e)?$:void 0}S+=O}}function sg(i,e,r,s,c,m,g,v,S){const I=tp(s,m,g),A=ip(s,c),E=A*g,L=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return e-E<e/4&&(e=E+e/4),rp(i,L?e/2*v%e:(A/2+2*m)*g*v%e,e,I,r,E,L,!1,S)}function rp(i,e,r,s,c,m,g,v,S){const I=m/2,A=ep(i);let E=0,L=e-r,O=[];for(let B=0;B<i.length-1;B++){const V=i[B],X=i[B+1],$=V.dist(X),le=X.angleTo(V);for(;L+r<E+$;){L+=r;const ee=(L-E)/$,se=hr.number(V.x,X.x,ee),me=hr.number(V.y,X.y,ee);if(se>=0&&se<S&&me>=0&&me<S&&L-I>=0&&L+I<=A){const xe=new Is(se,me,le,B);xe._round(),s&&!$d(i,xe,m,s,c)||O.push(xe)}}E+=$}return v||O.length||g||(O=rp(i,E/2,r,s,c,m,g,!0,S)),O}Ve("Anchor",Is);const ao=Dr;function np(i,e,r,s){const c=[],m=i.image,g=m.pixelRatio,v=m.paddedRect.w-2*ao,S=m.paddedRect.h-2*ao,I=i.right-i.left,A=i.bottom-i.top,E=m.stretchX||[[0,v]],L=m.stretchY||[[0,S]],O=(Me,qe)=>Me+qe[1]-qe[0],B=E.reduce(O,0),V=L.reduce(O,0),X=v-B,$=S-V;let le=0,ee=B,se=0,me=V,xe=0,Be=X,We=0,Fe=$;if(m.content&&s){const Me=m.content;le=Uc(E,0,Me[0]),se=Uc(L,0,Me[1]),ee=Uc(E,Me[0],Me[2]),me=Uc(L,Me[1],Me[3]),xe=Me[0]-le,We=Me[1]-se,Be=Me[2]-Me[0]-ee,Fe=Me[3]-Me[1]-me}const Re=(Me,qe,ze,ke)=>{const $e=Vc(Me.stretch-le,ee,I,i.left),Xe=Nc(Me.fixed-xe,Be,Me.stretch,B),xt=Vc(qe.stretch-se,me,A,i.top),ni=Nc(qe.fixed-We,Fe,qe.stretch,V),ui=Vc(ze.stretch-le,ee,I,i.left),Vi=Nc(ze.fixed-xe,Be,ze.stretch,B),Gr=Vc(ke.stretch-se,me,A,i.top),Tr=Nc(ke.fixed-We,Fe,ke.stretch,V),Mi=new Z($e,xt),$i=new Z(ui,xt),or=new Z(ui,Gr),kr=new Z($e,Gr),Ir=new Z(Xe/g,ni/g),Ni=new Z(Vi/g,Tr/g),qi=e*Math.PI/180;if(qi){const gr=Math.sin(qi),Rr=Math.cos(qi),Or=[Rr,-gr,gr,Rr];Mi._matMult(Or),$i._matMult(Or),kr._matMult(Or),or._matMult(Or)}const mr=Me.stretch+Me.fixed,Cr=qe.stretch+qe.fixed;return{tl:Mi,tr:$i,bl:kr,br:or,tex:{x:m.paddedRect.x+ao+mr,y:m.paddedRect.y+ao+Cr,w:ze.stretch+ze.fixed-mr,h:ke.stretch+ke.fixed-Cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ir,pixelOffsetBR:Ni,minFontScaleX:Be/g/I,minFontScaleY:Fe/g/A,isSDF:r}};if(s&&(m.stretchX||m.stretchY)){const Me=sp(E,X,B),qe=sp(L,$,V);for(let ze=0;ze<Me.length-1;ze++){const ke=Me[ze],$e=Me[ze+1];for(let Xe=0;Xe<qe.length-1;Xe++)c.push(Re(ke,qe[Xe],$e,qe[Xe+1]))}}else c.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:S+1}));return c}function Uc(i,e,r){let s=0;for(const c of i)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function sp(i,e,r){const s=[{fixed:-ao,stretch:0}];for(const[c,m]of i){const g=s[s.length-1];s.push({fixed:c-g.stretch,stretch:g.stretch}),s.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return s.push({fixed:e+ao,stretch:r}),s}function Vc(i,e,r,s){return i/e*r+s}function Nc(i,e,r,s){return i-e*r/s}class qc{constructor(e,r,s,c,m,g,v,S,I,A){if(this.boxStartIndex=e.length,I){let E=g.top,L=g.bottom;const O=g.collisionPadding;O&&(E-=O[1],L+=O[3]);let B=L-E;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let E=g.top*v-S[0],L=g.bottom*v+S[2],O=g.left*v-S[3],B=g.right*v+S[1];const V=g.collisionPadding;if(V&&(O-=V[0]*v,E-=V[1]*v,B+=V[2]*v,L+=V[3]*v),A){const X=new Z(O,E),$=new Z(B,E),le=new Z(O,L),ee=new Z(B,L),se=A*Math.PI/180;X._rotate(se),$._rotate(se),le._rotate(se),ee._rotate(se),O=Math.min(X.x,$.x,le.x,ee.x),B=Math.max(X.x,$.x,le.x,ee.x),E=Math.min(X.y,$.y,le.y,ee.y),L=Math.max(X.y,$.y,le.y,ee.y)}e.emplaceBack(r.x,r.y,O,E,B,L,s,c,m)}this.boxEndIndex=e.length}}class ag{constructor(e=[],r=og){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const m=e-1>>1,g=r[m];if(s(c,g)>=0)break;r[e]=g,e=m}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,m=r[e];for(;e<c;){let g=1+(e<<1),v=r[g];const S=g+1;if(S<this.length&&s(r[S],v)<0&&(g=S,v=r[S]),s(v,m)>=0)break;r[e]=v,e=g}r[e]=m}}function og(i,e){return i<e?-1:i>e?1:0}function lg(i,e=1,r=!1){let s=1/0,c=1/0,m=-1/0,g=-1/0;const v=i[0];for(let O=0;O<v.length;O++){const B=v[O];(!O||B.x<s)&&(s=B.x),(!O||B.y<c)&&(c=B.y),(!O||B.x>m)&&(m=B.x),(!O||B.y>g)&&(g=B.y)}const S=Math.min(m-s,g-c);let I=S/2;const A=new ag([],cg);if(S===0)return new Z(s,c);for(let O=s;O<m;O+=S)for(let B=c;B<g;B+=S)A.push(new oo(O+I,B+I,I,i));let E=function(O){let B=0,V=0,X=0;const $=O[0];for(let le=0,ee=$.length,se=ee-1;le<ee;se=le++){const me=$[le],xe=$[se],Be=me.x*xe.y-xe.x*me.y;V+=(me.x+xe.x)*Be,X+=(me.y+xe.y)*Be,B+=3*Be}return new oo(V/B,X/B,0,O)}(i),L=A.length;for(;A.length;){const O=A.pop();(O.d>E.d||!E.d)&&(E=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,L)),O.max-E.d<=e||(I=O.h/2,A.push(new oo(O.p.x-I,O.p.y-I,I,i)),A.push(new oo(O.p.x+I,O.p.y-I,I,i)),A.push(new oo(O.p.x-I,O.p.y+I,I,i)),A.push(new oo(O.p.x+I,O.p.y+I,I,i)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${E.d}`)),E.p}function cg(i,e){return e.max-i.max}function oo(i,e,r,s){this.p=new Z(i,e),this.h=r,this.d=function(c,m){let g=!1,v=1/0;for(let S=0;S<m.length;S++){const I=m[S];for(let A=0,E=I.length,L=E-1;A<E;L=A++){const O=I[A],B=I[L];O.y>c.y!=B.y>c.y&&c.x<(B.x-O.x)*(c.y-O.y)/(B.y-O.y)+O.x&&(g=!g),v=Math.min(v,Nu(c,O,B))}}return(g?1:-1)*Math.sqrt(v)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var ar;y.ap=void 0,(ar=y.ap||(y.ap={}))[ar.center=1]="center",ar[ar.left=2]="left",ar[ar.right=3]="right",ar[ar.top=4]="top",ar[ar.bottom=5]="bottom",ar[ar["top-left"]=6]="top-left",ar[ar["top-right"]=7]="top-right",ar[ar["bottom-left"]=8]="bottom-left",ar[ar["bottom-right"]=9]="bottom-right";const Cs=7,$h=Number.POSITIVE_INFINITY;function ap(i,e){return e[1]!==$h?function(r,s,c){let m=0,g=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":g=c-Cs;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Cs}switch(r){case"top-right":case"bottom-right":case"right":m=-s;break;case"top-left":case"bottom-left":case"left":m=s}return[m,g]}(i,e[0],e[1]):function(r,s){let c=0,m=0;s<0&&(s=0);const g=s/Math.SQRT2;switch(r){case"top-right":case"top-left":m=g-Cs;break;case"bottom-right":case"bottom-left":m=-g+Cs;break;case"bottom":m=-s+Cs;break;case"top":m=s-Cs}switch(r){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=s;break;case"right":c=-s}return[c,m]}(i,e[0])}function op(i,e,r){var s;const c=i.layout,m=(s=c.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(e,{},r);if(m){const v=m.values,S=[];for(let I=0;I<v.length;I+=2){const A=S[I]=v[I],E=v[I+1].map(L=>L*Ui);A.startsWith("top")?E[1]-=Cs:A.startsWith("bottom")&&(E[1]+=Cs),S[I+1]=E}return new Vr(S)}const g=c.get("text-variable-anchor");if(g){let v;v=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},r)*Ui,$h]:c.get("text-offset").evaluate(e,{},r).map(I=>I*Ui);const S=[];for(const I of g)S.push(I,ap(I,v));return new Vr(S)}return null}function eu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hg(i,e,r,s,c,m,g,v,S,I,A){let E=m.textMaxSize.evaluate(e,{});E===void 0&&(E=g);const L=i.layers[0].layout,O=L.get("icon-offset").evaluate(e,{},A),B=cp(r.horizontal),V=g/24,X=i.tilePixelRatio*V,$=i.tilePixelRatio*E/24,le=i.tilePixelRatio*v,ee=i.tilePixelRatio*L.get("symbol-spacing"),se=L.get("text-padding")*i.tilePixelRatio,me=function(ke,$e,Xe,xt=1){const ni=ke.get("icon-padding").evaluate($e,{},Xe),ui=ni&&ni.values;return[ui[0]*xt,ui[1]*xt,ui[2]*xt,ui[3]*xt]}(L,e,A,i.tilePixelRatio),xe=L.get("text-max-angle")/180*Math.PI,Be=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",We=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Fe=L.get("symbol-placement"),Re=ee/2,Me=L.get("icon-text-fit");let qe;s&&Me!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(qe=zd(s,r.vertical,Me,L.get("icon-text-fit-padding"),O,V)),B&&(s=zd(s,B,Me,L.get("icon-text-fit-padding"),O,V)));const ze=(ke,$e)=>{$e.x<0||$e.x>=wi||$e.y<0||$e.y>=wi||function(Xe,xt,ni,ui,Vi,Gr,Tr,Mi,$i,or,kr,Ir,Ni,qi,mr,Cr,gr,Rr,Or,Zi,St,_r,lr,Gi,on){const _n=Xe.addToLineVertexArray(xt,ni);let yn,Qn,ln,Yr,Fr=0,$n=0,Al=0,pp=0,lu=-1,cu=-1;const es={};let fp=Xt("");if(Xe.allowVerticalPlacement&&ui.vertical){const yr=Mi.layout.get("text-rotate").evaluate(St,{},Gi)+90;ln=new qc($i,xt,or,kr,Ir,ui.vertical,Ni,qi,mr,yr),Tr&&(Yr=new qc($i,xt,or,kr,Ir,Tr,gr,Rr,mr,yr))}if(Vi){const yr=Mi.layout.get("icon-rotate").evaluate(St,{}),Qr=Mi.layout.get("icon-text-fit")!=="none",ta=np(Vi,yr,lr,Qr),xn=Tr?np(Tr,yr,lr,Qr):void 0;Qn=new qc($i,xt,or,kr,Ir,Vi,gr,Rr,!1,yr),Fr=4*ta.length;const ia=Xe.iconSizeData;let zn=null;ia.kind==="source"?(zn=[Mn*Mi.layout.get("icon-size").evaluate(St,{})],zn[0]>Ts&&Mt(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Tl}. Reduce your "icon-size".`)):ia.kind==="composite"&&(zn=[Mn*_r.compositeIconSizes[0].evaluate(St,{},Gi),Mn*_r.compositeIconSizes[1].evaluate(St,{},Gi)],(zn[0]>Ts||zn[1]>Ts)&&Mt(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Tl}. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,ta,zn,Zi,Or,St,y.ah.none,xt,_n.lineStartIndex,_n.lineLength,-1,Gi),lu=Xe.icon.placedSymbolArray.length-1,xn&&($n=4*xn.length,Xe.addSymbols(Xe.icon,xn,zn,Zi,Or,St,y.ah.vertical,xt,_n.lineStartIndex,_n.lineLength,-1,Gi),cu=Xe.icon.placedSymbolArray.length-1)}const mp=Object.keys(ui.horizontal);for(const yr of mp){const Qr=ui.horizontal[yr];if(!yn){fp=Xt(Qr.text);const xn=Mi.layout.get("text-rotate").evaluate(St,{},Gi);yn=new qc($i,xt,or,kr,Ir,Qr,Ni,qi,mr,xn)}const ta=Qr.positionedLines.length===1;if(Al+=lp(Xe,xt,Qr,Gr,Mi,mr,St,Cr,_n,ui.vertical?y.ah.horizontal:y.ah.horizontalOnly,ta?mp:[yr],es,lu,_r,Gi),ta)break}ui.vertical&&(pp+=lp(Xe,xt,ui.vertical,Gr,Mi,mr,St,Cr,_n,y.ah.vertical,["vertical"],es,cu,_r,Gi));const pg=yn?yn.boxStartIndex:Xe.collisionBoxArray.length,fg=yn?yn.boxEndIndex:Xe.collisionBoxArray.length,mg=ln?ln.boxStartIndex:Xe.collisionBoxArray.length,gg=ln?ln.boxEndIndex:Xe.collisionBoxArray.length,_g=Qn?Qn.boxStartIndex:Xe.collisionBoxArray.length,yg=Qn?Qn.boxEndIndex:Xe.collisionBoxArray.length,vg=Yr?Yr.boxStartIndex:Xe.collisionBoxArray.length,xg=Yr?Yr.boxEndIndex:Xe.collisionBoxArray.length;let vn=-1;const Gc=(yr,Qr)=>yr&&yr.circleDiameter?Math.max(yr.circleDiameter,Qr):Qr;vn=Gc(yn,vn),vn=Gc(ln,vn),vn=Gc(Qn,vn),vn=Gc(Yr,vn);const gp=vn>-1?1:0;gp&&(vn*=on/Ui),Xe.glyphOffsetArray.length>=so.MAX_GLYPHS&&Mt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),St.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,St.sortKey);const bg=op(Mi,St,Gi),[wg,Sg]=function(yr,Qr){const ta=yr.length,xn=Qr==null?void 0:Qr.values;if((xn==null?void 0:xn.length)>0)for(let ia=0;ia<xn.length;ia+=2){const zn=xn[ia+1];yr.emplaceBack(y.ap[xn[ia]],zn[0],zn[1])}return[ta,yr.length]}(Xe.textAnchorOffsets,bg);Xe.symbolInstances.emplaceBack(xt.x,xt.y,es.right>=0?es.right:-1,es.center>=0?es.center:-1,es.left>=0?es.left:-1,es.vertical||-1,lu,cu,fp,pg,fg,mg,gg,_g,yg,vg,xg,or,Al,pp,Fr,$n,gp,0,Ni,vn,wg,Sg)}(i,$e,ke,r,s,c,qe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,X,[se,se,se,se],Be,S,le,me,We,O,e,m,I,A,g)};if(Fe==="line")for(const ke of Qd(e.geometry,0,0,wi,wi)){const $e=sg(ke,ee,xe,r.vertical||B,s,24,$,i.overscaling,wi);for(const Xe of $e)B&&ug(i,B.text,Re,Xe)||ze(ke,Xe)}else if(Fe==="line-center"){for(const ke of e.geometry)if(ke.length>1){const $e=ng(ke,xe,r.vertical||B,s,24,$);$e&&ze(ke,$e)}}else if(e.type==="Polygon")for(const ke of zh(e.geometry,0)){const $e=lg(ke,16);ze(ke[0],new Is($e.x,$e.y,0))}else if(e.type==="LineString")for(const ke of e.geometry)ze(ke,new Is(ke[0].x,ke[0].y,0));else if(e.type==="Point")for(const ke of e.geometry)for(const $e of ke)ze([$e],new Is($e.x,$e.y,0))}function lp(i,e,r,s,c,m,g,v,S,I,A,E,L,O,B){const V=function(le,ee,se,me,xe,Be,We,Fe){const Re=me.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,Me=[];for(const qe of ee.positionedLines)for(const ze of qe.positionedGlyphs){if(!ze.rect)continue;const ke=ze.rect||{};let $e=kd+1,Xe=!0,xt=1,ni=0;const ui=(xe||Fe)&&ze.vertical,Vi=ze.metrics.advance*ze.scale/2;if(Fe&&ee.verticalizable&&(ni=qe.lineOffset/2-(ze.imageName?-(Ui-ze.metrics.width*ze.scale)/2:(ze.scale-1)*Ui)),ze.imageName){const Zi=We[ze.imageName];Xe=Zi.sdf,xt=Zi.pixelRatio,$e=Dr/xt}const Gr=xe?[ze.x+Vi,ze.y]:[0,0];let Tr=xe?[0,0]:[ze.x+Vi+se[0],ze.y+se[1]-ni],Mi=[0,0];ui&&(Mi=Tr,Tr=[0,0]);const $i=ze.metrics.isDoubleResolution?2:1,or=(ze.metrics.left-$e)*ze.scale-Vi+Tr[0],kr=(-ze.metrics.top-$e)*ze.scale+Tr[1],Ir=or+ke.w/$i*ze.scale/xt,Ni=kr+ke.h/$i*ze.scale/xt,qi=new Z(or,kr),mr=new Z(Ir,kr),Cr=new Z(or,Ni),gr=new Z(Ir,Ni);if(ui){const Zi=new Z(-Vi,Vi-wl),St=-Math.PI/2,_r=Ui/2-Vi,lr=new Z(5-wl-_r,-(ze.imageName?_r:0)),Gi=new Z(...Mi);qi._rotateAround(St,Zi)._add(lr)._add(Gi),mr._rotateAround(St,Zi)._add(lr)._add(Gi),Cr._rotateAround(St,Zi)._add(lr)._add(Gi),gr._rotateAround(St,Zi)._add(lr)._add(Gi)}if(Re){const Zi=Math.sin(Re),St=Math.cos(Re),_r=[St,-Zi,Zi,St];qi._matMult(_r),mr._matMult(_r),Cr._matMult(_r),gr._matMult(_r)}const Rr=new Z(0,0),Or=new Z(0,0);Me.push({tl:qi,tr:mr,bl:Cr,br:gr,tex:ke,writingMode:ee.writingMode,glyphOffset:Gr,sectionIndex:ze.sectionIndex,isSDF:Xe,pixelOffsetTL:Rr,pixelOffsetBR:Or,minFontScaleX:0,minFontScaleY:0})}return Me}(0,r,v,c,m,g,s,i.allowVerticalPlacement),X=i.textSizeData;let $=null;X.kind==="source"?($=[Mn*c.layout.get("text-size").evaluate(g,{})],$[0]>Ts&&Mt(`${i.layerIds[0]}: Value for "text-size" is >= ${Tl}. Reduce your "text-size".`)):X.kind==="composite"&&($=[Mn*O.compositeTextSizes[0].evaluate(g,{},B),Mn*O.compositeTextSizes[1].evaluate(g,{},B)],($[0]>Ts||$[1]>Ts)&&Mt(`${i.layerIds[0]}: Value for "text-size" is >= ${Tl}. Reduce your "text-size".`)),i.addSymbols(i.text,V,$,v,m,g,I,e,S.lineStartIndex,S.lineLength,L,B);for(const le of A)E[le]=i.text.placedSymbolArray.length-1;return 4*V.length}function cp(i){for(const e in i)return i[e];return null}function ug(i,e,r,s){const c=i.compareText;if(e in c){const m=c[e];for(let g=m.length-1;g>=0;g--)if(s.dist(m[g])<r)return!0}else c[e]=[];return c[e].push(s),!1}const hp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class tu{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=hp[15&s];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new tu(v,g,m,e)}constructor(e,r=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=hp.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return iu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:v}=this,S=[0,m.length-1,0],I=[];for(;S.length;){const A=S.pop()||0,E=S.pop()||0,L=S.pop()||0;if(E-L<=v){for(let X=L;X<=E;X++){const $=g[2*X],le=g[2*X+1];$>=e&&$<=s&&le>=r&&le<=c&&I.push(m[X])}continue}const O=L+E>>1,B=g[2*O],V=g[2*O+1];B>=e&&B<=s&&V>=r&&V<=c&&I.push(m[O]),(A===0?e<=B:r<=V)&&(S.push(L),S.push(O-1),S.push(1-A)),(A===0?s>=B:c>=V)&&(S.push(O+1),S.push(E),S.push(1-A))}return I}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,v=[0,c.length-1,0],S=[],I=s*s;for(;v.length;){const A=v.pop()||0,E=v.pop()||0,L=v.pop()||0;if(E-L<=g){for(let X=L;X<=E;X++)dp(m[2*X],m[2*X+1],e,r)<=I&&S.push(c[X]);continue}const O=L+E>>1,B=m[2*O],V=m[2*O+1];dp(B,V,e,r)<=I&&S.push(c[O]),(A===0?e-s<=B:r-s<=V)&&(v.push(L),v.push(O-1),v.push(1-A)),(A===0?e+s>=B:r+s>=V)&&(v.push(O+1),v.push(E),v.push(1-A))}return S}}function iu(i,e,r,s,c,m){if(c-s<=r)return;const g=s+c>>1;up(i,e,g,s,c,m),iu(i,e,r,s,g-1,1-m),iu(i,e,r,g+1,c,1-m)}function up(i,e,r,s,c,m){for(;c>s;){if(c-s>600){const I=c-s+1,A=r-s+1,E=Math.log(I),L=.5*Math.exp(2*E/3),O=.5*Math.sqrt(E*L*(I-L)/I)*(A-I/2<0?-1:1);up(i,e,r,Math.max(s,Math.floor(r-A*L/I+O)),Math.min(c,Math.floor(r+(I-A)*L/I+O)),m)}const g=e[2*r+m];let v=s,S=c;for(Il(i,e,s,r),e[2*c+m]>g&&Il(i,e,s,c);v<S;){for(Il(i,e,v,S),v++,S--;e[2*v+m]<g;)v++;for(;e[2*S+m]>g;)S--}e[2*s+m]===g?Il(i,e,s,S):(S++,Il(i,e,S,c)),S<=r&&(s=S+1),r<=S&&(c=S-1)}}function Il(i,e,r,s){ru(i,r,s),ru(e,2*r,2*s),ru(e,2*r+1,2*s+1)}function ru(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}function dp(i,e,r,s){const c=i-r,m=e-s;return c*c+m*m}var nu;y.bc=void 0,(nu=y.bc||(y.bc={})).create="create",nu.load="load",nu.fullLoad="fullLoad";let Zc=null,Cl=[];const su=1e3/60,au="loadTime",ou="fullLoadTime",dg={mark(i){performance.mark(i)},frame(i){const e=i;Zc!=null&&Cl.push(e-Zc),Zc=e},clearMetrics(){Zc=null,Cl=[],performance.clearMeasures(au),performance.clearMeasures(ou);for(const i in y.bc)performance.clearMarks(y.bc[i])},getPerformanceMetrics(){performance.measure(au,y.bc.create,y.bc.load),performance.measure(ou,y.bc.create,y.bc.fullLoad);const i=performance.getEntriesByName(au)[0].duration,e=performance.getEntriesByName(ou)[0].duration,r=Cl.length,s=1/(Cl.reduce((m,g)=>m+g,0)/r/1e3),c=Cl.filter(m=>m>su).reduce((m,g)=>m+(g-su)/su,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};y.$=rt,y.A=$a,y.B=function(i){if(It==null){const e=i.navigator?i.navigator.userAgent:null;It=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return It},y.C=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ig(()=>this.process()),this.subscription=function(r,s,c,m){return r.addEventListener(s,c,!1),{unsubscribe:()=>{r.removeEventListener(s,c,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=it(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}sendAsync(i,e){return new Promise((r,s)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:r,reject:s},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const v={id:c,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const m=[],g=Object.assign(Object.assign({},i),{id:c,sourceMapId:this.mapId,origin:location.origin,data:_s(i.data,m)});this.target.postMessage(g,{transfer:m})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(it(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return l(this,void 0,void 0,function*(){if(e.type==="<response>"){const c=this.resolveRejects[i];return delete this.resolveRejects[i],c?void(e.error?c.reject(Hs(e.error)):c.resolve(Hs(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Hs(e.data),s=new AbortController;this.abortControllers[i]=s;try{const c=yield this.messageHandlers[e.type](e.sourceMapId,r,s);this.completeTask(i,null,c)}catch(c){this.completeTask(i,c)}})}completeTask(i,e,r){const s=[];delete this.abortControllers[i];const c={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?_s(e):null,data:_s(r,s)};this.target.postMessage(c,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},y.D=Ke,y.E=Yi,y.F=function(){var i=new $a(16);return $a!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},y.G=ci,y.H=function(i,e,r){var s,c,m,g,v,S,I,A,E,L,O,B,V=r[0],X=r[1],$=r[2];return e===i?(i[12]=e[0]*V+e[4]*X+e[8]*$+e[12],i[13]=e[1]*V+e[5]*X+e[9]*$+e[13],i[14]=e[2]*V+e[6]*X+e[10]*$+e[14],i[15]=e[3]*V+e[7]*X+e[11]*$+e[15]):(c=e[1],m=e[2],g=e[3],v=e[4],S=e[5],I=e[6],A=e[7],E=e[8],L=e[9],O=e[10],B=e[11],i[0]=s=e[0],i[1]=c,i[2]=m,i[3]=g,i[4]=v,i[5]=S,i[6]=I,i[7]=A,i[8]=E,i[9]=L,i[10]=O,i[11]=B,i[12]=s*V+v*X+E*$+e[12],i[13]=c*V+S*X+L*$+e[13],i[14]=m*V+I*X+O*$+e[14],i[15]=g*V+A*X+B*$+e[15]),i},y.I=Nh,y.J=function(i,e,r){var s=r[0],c=r[1],m=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},y.K=Hu,y.L=function(i,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in i&&(r[c]=i[c])}return r},y.M=ks,y.N=Vd,y.O=Nd,y.P=Z,y.Q=Jr,y.R=Xr,y.S=He,y.T=yc,y.U=at,y.V=Zt,y.W=wi,y.X=Ti,y.Y=jc,y.Z=class extends el{},y._=l,y.a=Di,y.a$=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},y.a0=Qh,y.a1=Pe,y.a2=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const s of i){const c=window.document.createElement("source");er(s)||(e.crossOrigin="Anonymous"),c.src=s,e.appendChild(c)}})},y.a3=function(){return Je++},y.a4=t,y.a5=so,y.a6=Ra,y.a7=Jn,y.a8=ti,y.a9=Kd,y.aA=_e,y.aB=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Ct(i.version,e.version))return[{command:"setStyle",args:[e]}];Ct(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Ct(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Ct(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Ct(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Ct(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Ct(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Ct(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Ct(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Ct(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Ct(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]});const s={},c=[];(function(g,v,S,I){let A;for(A in v=v||{},g=g||{})Object.prototype.hasOwnProperty.call(g,A)&&(Object.prototype.hasOwnProperty.call(v,A)||as(A,S,I));for(A in v)Object.prototype.hasOwnProperty.call(v,A)&&(Object.prototype.hasOwnProperty.call(g,A)?Ct(g[A],v[A])||(g[A].type==="geojson"&&v[A].type==="geojson"&&ls(g,v,A)?Qi(S,{command:"setGeoJSONSourceData",args:[A,v[A].data]}):os(A,v,S,I)):en(A,v,S))})(i.sources,e.sources,c,s);const m=[];i.layers&&i.layers.forEach(g=>{"source"in g&&s[g.source]?r.push({command:"removeLayer",args:[g.id]}):m.push(g)}),r=r.concat(c),function(g,v,S){v=v||[];const I=(g=g||[]).map(pa),A=v.map(pa),E=g.reduce(On,{}),L=v.reduce(On,{}),O=I.slice(),B=Object.create(null);let V,X,$,le,ee;for(let se=0,me=0;se<I.length;se++)V=I[se],Object.prototype.hasOwnProperty.call(L,V)?me++:(Qi(S,{command:"removeLayer",args:[V]}),O.splice(O.indexOf(V,me),1));for(let se=0,me=0;se<A.length;se++)V=A[A.length-1-se],O[O.length-1-se]!==V&&(Object.prototype.hasOwnProperty.call(E,V)?(Qi(S,{command:"removeLayer",args:[V]}),O.splice(O.lastIndexOf(V,O.length-me),1)):me++,le=O[O.length-se],Qi(S,{command:"addLayer",args:[L[V],le]}),O.splice(O.length-se,0,V),B[V]=!0);for(let se=0;se<A.length;se++)if(V=A[se],X=E[V],$=L[V],!B[V]&&!Ct(X,$))if(Ct(X.source,$.source)&&Ct(X["source-layer"],$["source-layer"])&&Ct(X.type,$.type)){for(ee in Rn(X.layout,$.layout,S,V,null,"setLayoutProperty"),Rn(X.paint,$.paint,S,V,null,"setPaintProperty"),Ct(X.filter,$.filter)||Qi(S,{command:"setFilter",args:[V,$.filter]}),Ct(X.minzoom,$.minzoom)&&Ct(X.maxzoom,$.maxzoom)||Qi(S,{command:"setLayerZoomRange",args:[V,$.minzoom,$.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Rn(X[ee],$[ee],S,V,ee.slice(6),"setPaintProperty"):Ct(X[ee],$[ee])||Qi(S,{command:"setLayerProperty",args:[V,ee,$[ee]]}));for(ee in $)Object.prototype.hasOwnProperty.call($,ee)&&!Object.prototype.hasOwnProperty.call(X,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Rn(X[ee],$[ee],S,V,ee.slice(6),"setPaintProperty"):Ct(X[ee],$[ee])||Qi(S,{command:"setLayerProperty",args:[V,ee,$[ee]]}))}else Qi(S,{command:"removeLayer",args:[V]}),le=O[O.lastIndexOf(V)+1],Qi(S,{command:"addLayer",args:[$,le]})}(m,e.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[e]}]}return r},y.aC=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},y.aD=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(!i(e[s],r[s]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const s in e)if(!i(e[s],r[s]))return!1;return!0}return e===r},y.aE=dt,y.aF=si,y.aG=class extends sr{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},y.aH=Zr,y.aI=class extends sr{constructor(i,e){super(i,e),this.current=bs}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},y.aJ=En,y.aK=class extends sr{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},y.aL=class extends sr{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},y.aM=xs,y.aN=function(i,e,r,s,c,m,g){var v=1/(e-r),S=1/(s-c),I=1/(m-g);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+r)*v,i[13]=(c+s)*S,i[14]=(g+m)*I,i[15]=1,i},y.aO=Gt,y.aP=Of,y.aQ=class extends Ys{},y.aR=Pm,y.aS=class extends Hn{},y.aT=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},y.aU=Yu,y.aV=F,y.aW=class extends Xa{},y.aX=Se,y.aY=function(i,e){var r=i[0],s=i[1],c=i[2],m=i[3],g=i[4],v=i[5],S=i[6],I=i[7],A=i[8],E=i[9],L=i[10],O=i[11],B=i[12],V=i[13],X=i[14],$=i[15],le=e[0],ee=e[1],se=e[2],me=e[3],xe=e[4],Be=e[5],We=e[6],Fe=e[7],Re=e[8],Me=e[9],qe=e[10],ze=e[11],ke=e[12],$e=e[13],Xe=e[14],xt=e[15];return Math.abs(r-le)<=Sr*Math.max(1,Math.abs(r),Math.abs(le))&&Math.abs(s-ee)<=Sr*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(c-se)<=Sr*Math.max(1,Math.abs(c),Math.abs(se))&&Math.abs(m-me)<=Sr*Math.max(1,Math.abs(m),Math.abs(me))&&Math.abs(g-xe)<=Sr*Math.max(1,Math.abs(g),Math.abs(xe))&&Math.abs(v-Be)<=Sr*Math.max(1,Math.abs(v),Math.abs(Be))&&Math.abs(S-We)<=Sr*Math.max(1,Math.abs(S),Math.abs(We))&&Math.abs(I-Fe)<=Sr*Math.max(1,Math.abs(I),Math.abs(Fe))&&Math.abs(A-Re)<=Sr*Math.max(1,Math.abs(A),Math.abs(Re))&&Math.abs(E-Me)<=Sr*Math.max(1,Math.abs(E),Math.abs(Me))&&Math.abs(L-qe)<=Sr*Math.max(1,Math.abs(L),Math.abs(qe))&&Math.abs(O-ze)<=Sr*Math.max(1,Math.abs(O),Math.abs(ze))&&Math.abs(B-ke)<=Sr*Math.max(1,Math.abs(B),Math.abs(ke))&&Math.abs(V-$e)<=Sr*Math.max(1,Math.abs(V),Math.abs($e))&&Math.abs(X-Xe)<=Sr*Math.max(1,Math.abs(X),Math.abs(Xe))&&Math.abs($-xt)<=Sr*Math.max(1,Math.abs($),Math.abs(xt))},y.aZ=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},y.a_=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},y.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,m)=>{const g=c||m;return e[s]=!g||g.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},y.ab=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},y.ac=vt,y.ad=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),m=e[0],g=e[1],v=e[2],S=e[3],I=e[4],A=e[5],E=e[6],L=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*c+I*s,i[1]=g*c+A*s,i[2]=v*c+E*s,i[3]=S*c+L*s,i[4]=I*c-m*s,i[5]=A*c-g*s,i[6]=E*c-v*s,i[7]=L*c-S*s,i},y.ae=function(i){var e=new $a(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},y.af=Ac,y.ag=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=i,v=c?vt(rr.interpolationFactor(c,e,m,g),0,1):0;i.kind==="camera"?s=hr.number(i.minSize,i.maxSize,v):r=v}return{uSizeT:r,uSize:s}},y.ai=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/Mn:i.kind==="composite"?hr.number(s/Mn,c/Mn,r):e},y.aj=Hh,y.ak=function(i,e,r,s){const c=e.y-i.y,m=e.x-i.x,g=s.y-r.y,v=s.x-r.x,S=g*m-v*c;if(S===0)return null;const I=(v*(i.y-r.y)-g*(i.x-r.x))/S;return new Z(i.x+I*m,i.y+I*c)},y.al=Qd,y.am=ul,y.an=kh,y.ao=Ui,y.aq=Gh,y.ar=function(i,e){var r=e[0],s=e[1],c=e[2],m=e[3],g=e[4],v=e[5],S=e[6],I=e[7],A=e[8],E=e[9],L=e[10],O=e[11],B=e[12],V=e[13],X=e[14],$=e[15],le=r*v-s*g,ee=r*S-c*g,se=r*I-m*g,me=s*S-c*v,xe=s*I-m*v,Be=c*I-m*S,We=A*V-E*B,Fe=A*X-L*B,Re=A*$-O*B,Me=E*X-L*V,qe=E*$-O*V,ze=L*$-O*X,ke=le*ze-ee*qe+se*Me+me*Re-xe*Fe+Be*We;return ke?(i[0]=(v*ze-S*qe+I*Me)*(ke=1/ke),i[1]=(c*qe-s*ze-m*Me)*ke,i[2]=(V*Be-X*xe+$*me)*ke,i[3]=(L*xe-E*Be-O*me)*ke,i[4]=(S*Re-g*ze-I*Fe)*ke,i[5]=(r*ze-c*Re+m*Fe)*ke,i[6]=(X*se-B*Be-$*ee)*ke,i[7]=(A*Be-L*se+O*ee)*ke,i[8]=(g*qe-v*Re+I*We)*ke,i[9]=(s*Re-r*qe-m*We)*ke,i[10]=(B*xe-V*se+$*le)*ke,i[11]=(E*se-A*xe-O*le)*ke,i[12]=(v*Fe-g*Me-S*We)*ke,i[13]=(r*Me-s*Fe+c*We)*ke,i[14]=(V*ee-B*me-X*le)*ke,i[15]=(A*me-E*ee+L*le)*ke,i):null},y.as=eu,y.at=Zh,y.au=tu,y.av=function(){const i={},e=fe.$version;for(const r in fe.$root){const s=fe.$root[r];if(s.required){let c=null;c=r==="version"?e:s.type==="array"?[]:{},c!=null&&(i[r]=c)}}return i},y.aw=Va,y.ax=ot,y.ay=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Sn(i[r],e[i[r].ref]));return i},y.az=function(i){if(i.type==="custom")return new tg(i);switch(i.type){case"background":return new Qm(i);case"circle":return new Ff(i);case"fill":return new rm(i);case"fill-extrusion":return new ym(i);case"heatmap":return new jf(i);case"hillshade":return new Vf(i);case"line":return new Im(i);case"raster":return new eg(i);case"symbol":return new Bc(i)}},y.b=ct,y.b0=Dt,y.b1=Gd,y.b2=qd,y.b3=function(i,e,r,s,c){var m,g=1/Math.tan(e/2);return i[0]=g/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+s)*(m=1/(s-c)),i[14]=2*c*s*m):(i[10]=-1,i[14]=-2*s),i},y.b4=function(i,e,r){var s=Math.sin(r),c=Math.cos(r),m=e[4],g=e[5],v=e[6],S=e[7],I=e[8],A=e[9],E=e[10],L=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*c+I*s,i[5]=g*c+A*s,i[6]=v*c+E*s,i[7]=S*c+L*s,i[8]=I*c-m*s,i[9]=A*c-g*s,i[10]=E*c-v*s,i[11]=L*c-S*s,i},y.b5=Ye,y.b6=Ie,y.b7=function(i){return i*Math.PI/180},y.b8=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},y.b9=class extends Ha{},y.ba=Jh,y.bb=dg,y.bd=Ee,y.be=function(i,e){Di.REGISTERED_PROTOCOLS[i]=e},y.bf=function(i){delete Di.REGISTERED_PROTOCOLS[i]},y.bg=function(i,e){const r={};for(let c=0;c<i.length;c++){const m=e&&e[i[c].id]||xh(i[c]);e&&(e[i[c].id]=m);let g=r[m];g||(g=r[m]=[]),g.push(i[c])}const s=[];for(const c in r)s.push(r[c]);return s},y.bh=Ve,y.bi=Wd,y.bj=Xd,y.bk=Cd,y.bl=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=wi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,s=e._unevaluatedLayout._values,c={layoutIconSize:s["icon-size"].possiblyEvaluate(new ti(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new ti(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new ti(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=i.bucket.textSizeData;c.compositeTextSizes=[s["text-size"].possiblyEvaluate(new ti(I),i.canonical),s["text-size"].possiblyEvaluate(new ti(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:A}=i.bucket.iconSizeData;c.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new ti(I),i.canonical),s["icon-size"].possiblyEvaluate(new ti(A),i.canonical)]}const m=r.get("text-line-height")*Ui,g=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),S=r.get("text-size");for(const I of i.bucket.features){const A=r.get("text-font").evaluate(I,{},i.canonical).join(","),E=S.evaluate(I,{},i.canonical),L=c.layoutTextSize.evaluate(I,{},i.canonical),O=c.layoutIconSize.evaluate(I,{},i.canonical),B={horizontal:{},vertical:void 0},V=I.text;let X,$=[0,0];if(V){const se=V.toString(),me=r.get("text-letter-spacing").evaluate(I,{},i.canonical)*Ui,xe=mc(se)?me:0,Be=r.get("text-anchor").evaluate(I,{},i.canonical),We=op(e,I,i.canonical);if(!We){const ze=r.get("text-radial-offset").evaluate(I,{},i.canonical);$=ze?ap(Be,[ze*Ui,$h]):r.get("text-offset").evaluate(I,{},i.canonical).map(ke=>ke*Ui)}let Fe=g?"center":r.get("text-justify").evaluate(I,{},i.canonical);const Re=r.get("symbol-placement"),Me=Re==="point"?r.get("text-max-width").evaluate(I,{},i.canonical)*Ui:0,qe=()=>{i.bucket.allowVerticalPlacement&&Na(se)&&(B.vertical=Rc(V,i.glyphMap,i.glyphPositions,i.imagePositions,A,Me,m,Be,"left",xe,$,y.ah.vertical,!0,Re,L,E))};if(!g&&We){const ze=new Set;if(Fe==="auto")for(let $e=0;$e<We.values.length;$e+=2)ze.add(eu(We.values[$e]));else ze.add(Fe);let ke=!1;for(const $e of ze)if(!B.horizontal[$e])if(ke)B.horizontal[$e]=B.horizontal[0];else{const Xe=Rc(V,i.glyphMap,i.glyphPositions,i.imagePositions,A,Me,m,"center",$e,xe,$,y.ah.horizontal,!1,Re,L,E);Xe&&(B.horizontal[$e]=Xe,ke=Xe.positionedLines.length===1)}qe()}else{Fe==="auto"&&(Fe=eu(Be));const ze=Rc(V,i.glyphMap,i.glyphPositions,i.imagePositions,A,Me,m,Be,Fe,xe,$,y.ah.horizontal,!1,Re,L,E);ze&&(B.horizontal[Fe]=ze),qe(),Na(se)&&g&&v&&(B.vertical=Rc(V,i.glyphMap,i.glyphPositions,i.imagePositions,A,Me,m,Be,Fe,xe,$,y.ah.vertical,!1,Re,L,E))}}let le=!1;if(I.icon&&I.icon.name){const se=i.imageMap[I.icon.name];se&&(X=Wm(i.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},i.canonical),r.get("icon-anchor").evaluate(I,{},i.canonical)),le=!!se.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=le:i.bucket.sdfIcons!==le&&Mt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=cp(B.horizontal)||B.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||X)&&hg(i.bucket,I,B,X,i.imageMap,c,L,O,$,le,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},y.bm=Bh,y.bn=Rh,y.bo=Fh,y.bp=ws,y.bq=Uh,y.br=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},y.bs=function(i,e,r,s,c){return l(this,void 0,void 0,function*(){if(at())try{return yield Zt(i,e,r,s,c)}catch{}return function(m,g,v,S,I){const A=m.width,E=m.height;Nt&&Ut||(Nt=new OffscreenCanvas(A,E),Ut=Nt.getContext("2d",{willReadFrequently:!0})),Nt.width=A,Nt.height=E,Ut.drawImage(m,0,0,A,E);const L=Ut.getImageData(g,v,S,I);return Ut.clearRect(0,0,A,E),L.data}(i,e,r,s,c)})},y.bt=Hd,y.bu=D,y.bv=U,y.bw=yd,y.bx=Vn,y.by=function(i){return i.message===gi},y.bz=Gn,y.c=oi,y.d=i=>l(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),y.e=yt,y.f=i=>new Promise((e,r)=>{const s=new Image;s.onload=()=>{e(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=mi})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(c):mi}),y.g=li,y.h=(i,e)=>jt(yt(i,{type:"json"}),e),y.i=it,y.j=qt,y.k=Rt,y.l=(i,e)=>jt(yt(i,{type:"arrayBuffer"}),e),y.m=jt,y.n=function(i){return new Uh(i).readFields(Vm,[])},y.o=fl,y.p=Id,y.q=dr,y.r=Wo,y.s=er,y.t=fc,y.u=Oe,y.v=fe,y.w=Mt,y.x=Zs,y.y=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},y.z=hr}),b("worker",["./shared"],function(y){class l{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,R){for(const G of z){this._layerConfigs[G.id]=G;const re=this._layers[G.id]=y.az(G);re._featureFilter=y.a6(re.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of R)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const j=y.bg(Object.values(this._layerConfigs),this.keyCache);for(const G of j){const re=G.map(ge=>this._layers[ge.id]),ne=re[0];if(ne.visibility==="none")continue;const oe=ne.source||"";let te=this.familiesBySource[oe];te||(te=this.familiesBySource[oe]={});const ce=ne.sourceLayer||"_geojsonTileLayer";let be=te[ce];be||(be=te[ce]=[]),be.push(re)}}}class D{constructor(z){const R={},j=[];for(const oe in z){const te=z[oe],ce=R[oe]={};for(const be in te){const ge=te[+be];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const ye={x:0,y:0,w:ge.bitmap.width+2,h:ge.bitmap.height+2};j.push(ye),ce[be]={rect:ye,metrics:ge.metrics}}}const{w:G,h:re}=y.p(j),ne=new y.o({width:G||1,height:re||1});for(const oe in z){const te=z[oe];for(const ce in te){const be=te[+ce];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const ge=R[oe][ce].rect;y.o.copy(be.bitmap,ne,{x:0,y:0},{x:ge.x+1,y:ge.y+1},be.bitmap)}}this.image=ne,this.positions=R}}y.bh("GlyphAtlas",D);class U{constructor(z){this.tileID=new y.Q(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId,this.inFlightDependencies=[]}parse(z,R,j,G){return y._(this,void 0,void 0,function*(){this.status="parsing",this.data=z,this.collisionBoxArray=new y.a4;const re=new y.bi(Object.keys(z.layers).sort()),ne=new y.bj(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const oe={},te={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},ce=R.familiesBySource[this.source];for(const ft in ce){const _i=z.layers[ft];if(!_i)continue;_i.version===1&&y.w(`Vector tile source "${this.source}" layer "${ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oi=re.encode(ft),cr=[];for(let vr=0;vr<_i.length;vr++){const Ki=_i.feature(vr),nn=ne.getId(Ki,ft);cr.push({feature:Ki,id:nn,index:vr,sourceLayerIndex:Oi})}for(const vr of ce[ft]){const Ki=vr[0];Ki.source!==this.source&&y.w(`layer.source = ${Ki.source} does not equal this.source = ${this.source}`),Ki.minzoom&&this.zoom<Math.floor(Ki.minzoom)||Ki.maxzoom&&this.zoom>=Ki.maxzoom||Ki.visibility!=="none"&&(N(vr,this.zoom,j),(oe[Ki.id]=Ki.createBucket({index:ne.bucketLayerIDs.length,layers:vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oi,sourceID:this.source})).populate(cr,te,this.tileID.canonical),ne.bucketLayerIDs.push(vr.map(nn=>nn.id)))}}const be=y.aE(te.glyphDependencies,ft=>Object.keys(ft).map(Number));this.inFlightDependencies.forEach(ft=>ft==null?void 0:ft.abort()),this.inFlightDependencies=[];let ge=Promise.resolve({});if(Object.keys(be).length){const ft=new AbortController;this.inFlightDependencies.push(ft),ge=G.sendAsync({type:"getGlyphs",data:{stacks:be,source:this.source,tileID:this.tileID,type:"glyphs"}},ft)}const ye=Object.keys(te.iconDependencies);let Qe=Promise.resolve({});if(ye.length){const ft=new AbortController;this.inFlightDependencies.push(ft),Qe=G.sendAsync({type:"getImages",data:{icons:ye,source:this.source,tileID:this.tileID,type:"icons"}},ft)}const et=Object.keys(te.patternDependencies);let ut=Promise.resolve({});if(et.length){const ft=new AbortController;this.inFlightDependencies.push(ft),ut=G.sendAsync({type:"getImages",data:{icons:et,source:this.source,tileID:this.tileID,type:"patterns"}},ft)}const[lt,At,Kt]=yield Promise.all([ge,Qe,ut]),hi=new D(lt),Ei=new y.bk(At,Kt);for(const ft in oe){const _i=oe[ft];_i instanceof y.a5?(N(_i.layers,this.zoom,j),y.bl({bucket:_i,glyphMap:lt,glyphPositions:hi.positions,imageMap:At,imagePositions:Ei.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):_i.hasPattern&&(_i instanceof y.bm||_i instanceof y.bn||_i instanceof y.bo)&&(N(_i.layers,this.zoom,j),_i.addFeatures(te,this.tileID.canonical,Ei.patternPositions))}return this.status="done",{buckets:Object.values(oe).filter(ft=>!ft.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hi.image,imageAtlas:Ei,glyphMap:this.returnDependencies?lt:null,iconMap:this.returnDependencies?At:null,glyphPositions:this.returnDependencies?hi.positions:null}})}}function N(J,z,R){const j=new y.a8(z);for(const G of J)G.recalculate(j,R)}class Z{constructor(z,R,j){this.actor=z,this.layerIndex=R,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(z,R){return y._(this,void 0,void 0,function*(){const j=yield y.l(z.request,R);try{return{vectorTile:new y.bp.VectorTile(new y.bq(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(G){const re=new Uint8Array(j.data);let ne=`Unable to parse the tile at ${z.request.url}, `;throw ne+=re[0]===31&&re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${G.messge}`,new Error(ne)}})}loadTile(z){return y._(this,void 0,void 0,function*(){const R=z.uid,j=!!(z&&z.request&&z.request.collectResourceTiming)&&new y.br(z.request),G=new U(z);this.loading[R]=G;const re=new AbortController;G.abort=re;try{const ne=yield this.loadVectorTile(z,re);if(delete this.loading[R],!ne)return null;const oe=ne.rawData,te={};ne.expires&&(te.expires=ne.expires),ne.cacheControl&&(te.cacheControl=ne.cacheControl);const ce={};if(j){const ge=j.finish();ge&&(ce.resourceTiming=JSON.parse(JSON.stringify(ge)))}G.vectorTile=ne.vectorTile;const be=G.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=G,this.fetching[R]={rawTileData:oe,cacheControl:te,resourceTiming:ce};try{const ge=yield be;return y.e({rawTileData:oe.slice(0)},ge,te,ce)}finally{delete this.fetching[R]}}catch(ne){throw delete this.loading[R],G.status="done",this.loaded[R]=G,ne}})}reloadTile(z){return y._(this,void 0,void 0,function*(){const R=z.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[R];if(j.showCollisionBoxes=z.showCollisionBoxes,j.status==="parsing"){const G=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let re;if(this.fetching[R]){const{rawTileData:ne,cacheControl:oe,resourceTiming:te}=this.fetching[R];delete this.fetching[R],re=y.e({rawTileData:ne.slice(0)},G,oe,te)}else re=G;return re}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(z){return y._(this,void 0,void 0,function*(){const R=this.loading,j=z.uid;R&&R[j]&&R[j].abort&&(R[j].abort.abort(),delete R[j])})}removeTile(z){return y._(this,void 0,void 0,function*(){this.loaded&&this.loaded[z.uid]&&delete this.loaded[z.uid]})}}class K{constructor(){this.loaded={}}loadTile(z){return y._(this,void 0,void 0,function*(){const{uid:R,encoding:j,rawImageData:G,redFactor:re,greenFactor:ne,blueFactor:oe,baseShift:te}=z,ce=G.width+2,be=G.height+2,ge=y.b(G)?new y.R({width:ce,height:be},yield y.bs(G,-1,-1,ce,be)):G,ye=new y.bt(R,ge,j,re,ne,oe,te);return this.loaded=this.loaded||{},this.loaded[R]=ye,ye})}removeTile(z){const R=this.loaded,j=z.uid;R&&R[j]&&delete R[j]}}function Ae(J,z){if(J.length!==0){Te(J[0],z);for(var R=1;R<J.length;R++)Te(J[R],!z)}}function Te(J,z){for(var R=0,j=0,G=0,re=J.length,ne=re-1;G<re;ne=G++){var oe=(J[G][0]-J[ne][0])*(J[ne][1]+J[G][1]),te=R+oe;j+=Math.abs(R)>=Math.abs(oe)?R-te+oe:oe-te+R,R=te}R+j>=0!=!!z&&J.reverse()}var je=y.bu(function J(z,R){var j,G=z&&z.type;if(G==="FeatureCollection")for(j=0;j<z.features.length;j++)J(z.features[j],R);else if(G==="GeometryCollection")for(j=0;j<z.geometries.length;j++)J(z.geometries[j],R);else if(G==="Feature")J(z.geometry,R);else if(G==="Polygon")Ae(z.coordinates,R);else if(G==="MultiPolygon")for(j=0;j<z.coordinates.length;j++)Ae(z.coordinates[j],R);return z});const Ue=y.bp.VectorTileFeature.prototype.toGeoJSON;var He={exports:{}},at=y.bv,Ye=y.bp.VectorTileFeature,Ie=vt;function vt(J,z){this.options=z||{},this.features=J,this.length=J.length}function Dt(J,z){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=z||4096}vt.prototype.feature=function(J){return new Dt(this.features[J],this.options.extent)},Dt.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var z=0;z<J.length;z++){for(var R=J[z],j=[],G=0;G<R.length;G++)j.push(new at(R[G][0],R[G][1]));this.geometry.push(j)}return this.geometry},Dt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,z=1/0,R=-1/0,j=1/0,G=-1/0,re=0;re<J.length;re++)for(var ne=J[re],oe=0;oe<ne.length;oe++){var te=ne[oe];z=Math.min(z,te.x),R=Math.max(R,te.x),j=Math.min(j,te.y),G=Math.max(G,te.y)}return[z,j,R,G]},Dt.prototype.toGeoJSON=Ye.prototype.toGeoJSON;var yt=y.bw,Je=Ie;function dt(J){var z=new yt;return function(R,j){for(var G in R.layers)j.writeMessage(3,si,R.layers[G])}(J,z),z.finish()}function si(J,z){var R;z.writeVarintField(15,J.version||1),z.writeStringField(1,J.name||""),z.writeVarintField(5,J.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<J.length;R++)j.feature=J.feature(R),z.writeMessage(2,_e,j);var G=j.keys;for(R=0;R<G.length;R++)z.writeStringField(3,G[R]);var re=j.values;for(R=0;R<re.length;R++)z.writeMessage(4,it,re[R])}function _e(J,z){var R=J.feature;R.id!==void 0&&z.writeVarintField(1,R.id),z.writeMessage(2,kt,J),z.writeVarintField(3,R.type),z.writeMessage(4,ai,R)}function kt(J,z){var R=J.feature,j=J.keys,G=J.values,re=J.keycache,ne=J.valuecache;for(var oe in R.properties){var te=R.properties[oe],ce=re[oe];if(te!==null){ce===void 0&&(j.push(oe),re[oe]=ce=j.length-1),z.writeVarint(ce);var be=typeof te;be!=="string"&&be!=="boolean"&&be!=="number"&&(te=JSON.stringify(te));var ge=be+":"+te,ye=ne[ge];ye===void 0&&(G.push(te),ne[ge]=ye=G.length-1),z.writeVarint(ye)}}}function Mt(J,z){return(z<<3)+(7&J)}function Wt(J){return J<<1^J>>31}function ai(J,z){for(var R=J.loadGeometry(),j=J.type,G=0,re=0,ne=R.length,oe=0;oe<ne;oe++){var te=R[oe],ce=1;j===1&&(ce=te.length),z.writeVarint(Mt(1,ce));for(var be=j===3?te.length-1:te.length,ge=0;ge<be;ge++){ge===1&&j!==1&&z.writeVarint(Mt(2,be-1));var ye=te[ge].x-G,Qe=te[ge].y-re;z.writeVarint(Wt(ye)),z.writeVarint(Wt(Qe)),G+=ye,re+=Qe}j===3&&z.writeVarint(Mt(7,1))}}function it(J,z){var R=typeof J;R==="string"?z.writeStringField(1,J):R==="boolean"?z.writeBooleanField(7,J):R==="number"&&(J%1!=0?z.writeDoubleField(3,J):J<0?z.writeSVarintField(6,J):z.writeVarintField(5,J))}He.exports=dt,He.exports.fromVectorTileJs=dt,He.exports.fromGeojsonVt=function(J,z){z=z||{};var R={};for(var j in J)R[j]=new Je(J[j].features,z),R[j].name=j,R[j].version=z.version,R[j].extent=z.extent;return dt({layers:R})},He.exports.GeoJSONWrapper=Je;var It=y.bu(He.exports);const ct={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},mi=Math.fround||(Zt=new Float32Array(1),J=>(Zt[0]=+J,Zt[0]));var Zt;const Nt=3,Ut=5,gi=6;class oi{constructor(z){this.options=Object.assign(Object.create(ct),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:R,minZoom:j,maxZoom:G}=this.options;R&&console.time("total time");const re=`prepare ${z.length} points`;R&&console.time(re),this.points=z;const ne=[];for(let te=0;te<z.length;te++){const ce=z[te];if(!ce.geometry)continue;const[be,ge]=ce.geometry.coordinates,ye=mi(ci(be)),Qe=mi(Ee(ge));ne.push(ye,Qe,1/0,te,-1,1),this.options.reduce&&ne.push(0)}let oe=this.trees[G+1]=this._createTree(ne);R&&console.timeEnd(re);for(let te=G;te>=j;te--){const ce=+Date.now();oe=this.trees[te]=this._createTree(this._cluster(oe,te)),R&&console.log("z%d: %d clusters in %dms",te,oe.numItems,+Date.now()-ce)}return R&&console.timeEnd("total time"),this}getClusters(z,R){let j=((z[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,z[1]));let re=z[2]===180?180:((z[2]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)j=-180,re=180;else if(j>re){const ge=this.getClusters([j,G,180,ne],R),ye=this.getClusters([-180,G,re,ne],R);return ge.concat(ye)}const oe=this.trees[this._limitZoom(R)],te=oe.range(ci(j),Ee(ne),ci(re),Ee(G)),ce=oe.data,be=[];for(const ge of te){const ye=this.stride*ge;be.push(ce[ye+Ut]>1?Di(ce,ye,this.clusterProps):this.points[ce[ye+Nt]])}return be}getChildren(z){const R=this._getOriginId(z),j=this._getOriginZoom(z),G="No cluster with the specified id.",re=this.trees[j];if(!re)throw new Error(G);const ne=re.data;if(R*this.stride>=ne.length)throw new Error(G);const oe=this.options.radius/(this.options.extent*Math.pow(2,j-1)),te=re.within(ne[R*this.stride],ne[R*this.stride+1],oe),ce=[];for(const be of te){const ge=be*this.stride;ne[ge+4]===z&&ce.push(ne[ge+Ut]>1?Di(ne,ge,this.clusterProps):this.points[ne[ge+Nt]])}if(ce.length===0)throw new Error(G);return ce}getLeaves(z,R,j){const G=[];return this._appendLeaves(G,z,R=R||10,j=j||0,0),G}getTile(z,R,j){const G=this.trees[this._limitZoom(z)],re=Math.pow(2,z),{extent:ne,radius:oe}=this.options,te=oe/ne,ce=(j-te)/re,be=(j+1+te)/re,ge={features:[]};return this._addTileFeatures(G.range((R-te)/re,ce,(R+1+te)/re,be),G.data,R,j,re,ge),R===0&&this._addTileFeatures(G.range(1-te/re,ce,1,be),G.data,re,j,re,ge),R===re-1&&this._addTileFeatures(G.range(0,ce,te/re,be),G.data,-1,j,re,ge),ge.features.length?ge:null}getClusterExpansionZoom(z){let R=this._getOriginZoom(z)-1;for(;R<=this.options.maxZoom;){const j=this.getChildren(z);if(R++,j.length!==1)break;z=j[0].properties.cluster_id}return R}_appendLeaves(z,R,j,G,re){const ne=this.getChildren(R);for(const oe of ne){const te=oe.properties;if(te&&te.cluster?re+te.point_count<=G?re+=te.point_count:re=this._appendLeaves(z,te.cluster_id,j,G,re):re<G?re++:z.push(oe),z.length===j)break}return re}_createTree(z){const R=new y.au(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<z.length;j+=this.stride)R.add(z[j],z[j+1]);return R.finish(),R.data=z,R}_addTileFeatures(z,R,j,G,re,ne){for(const oe of z){const te=oe*this.stride,ce=R[te+Ut]>1;let be,ge,ye;if(ce)be=li(R,te,this.clusterProps),ge=R[te],ye=R[te+1];else{const ut=this.points[R[te+Nt]];be=ut.properties;const[lt,At]=ut.geometry.coordinates;ge=ci(lt),ye=Ee(At)}const Qe={type:1,geometry:[[Math.round(this.options.extent*(ge*re-j)),Math.round(this.options.extent*(ye*re-G))]],tags:be};let et;et=ce||this.options.generateId?R[te+Nt]:this.points[R[te+Nt]].id,et!==void 0&&(Qe.id=et),ne.features.push(Qe)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,R){const{radius:j,extent:G,reduce:re,minPoints:ne}=this.options,oe=j/(G*Math.pow(2,R)),te=z.data,ce=[],be=this.stride;for(let ge=0;ge<te.length;ge+=be){if(te[ge+2]<=R)continue;te[ge+2]=R;const ye=te[ge],Qe=te[ge+1],et=z.within(te[ge],te[ge+1],oe),ut=te[ge+Ut];let lt=ut;for(const At of et){const Kt=At*be;te[Kt+2]>R&&(lt+=te[Kt+Ut])}if(lt>ut&&lt>=ne){let At,Kt=ye*ut,hi=Qe*ut,Ei=-1;const ft=((ge/be|0)<<5)+(R+1)+this.points.length;for(const _i of et){const Oi=_i*be;if(te[Oi+2]<=R)continue;te[Oi+2]=R;const cr=te[Oi+Ut];Kt+=te[Oi]*cr,hi+=te[Oi+1]*cr,te[Oi+4]=ft,re&&(At||(At=this._map(te,ge,!0),Ei=this.clusterProps.length,this.clusterProps.push(At)),re(At,this._map(te,Oi)))}te[ge+4]=ft,ce.push(Kt/lt,hi/lt,1/0,ft,-1,lt),re&&ce.push(Ei)}else{for(let At=0;At<be;At++)ce.push(te[ge+At]);if(lt>1)for(const At of et){const Kt=At*be;if(!(te[Kt+2]<=R)){te[Kt+2]=R;for(let hi=0;hi<be;hi++)ce.push(te[Kt+hi])}}}}return ce}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,R,j){if(z[R+Ut]>1){const ne=this.clusterProps[z[R+gi]];return j?Object.assign({},ne):ne}const G=this.points[z[R+Nt]].properties,re=this.options.map(G);return j&&re===G?Object.assign({},re):re}}function Di(J,z,R){return{type:"Feature",id:J[z+Nt],properties:li(J,z,R),geometry:{type:"Point",coordinates:[(j=J[z],360*(j-.5)),ot(J[z+1])]}};var j}function li(J,z,R){const j=J[z+Ut],G=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,re=J[z+gi],ne=re===-1?{}:Object.assign({},R[re]);return Object.assign(ne,{cluster:!0,cluster_id:J[z+Nt],point_count:j,point_count_abbreviated:G})}function ci(J){return J/360+.5}function Ee(J){const z=Math.sin(J*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function ot(J){const z=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function jt(J,z,R,j){for(var G,re=j,ne=R-z>>1,oe=R-z,te=J[z],ce=J[z+1],be=J[R],ge=J[R+1],ye=z+3;ye<R;ye+=3){var Qe=er(J[ye],J[ye+1],te,ce,be,ge);if(Qe>re)G=ye,re=Qe;else if(Qe===re){var et=Math.abs(ye-ne);et<oe&&(G=ye,oe=et)}}re>j&&(G-z>3&&jt(J,z,G,j),J[G+2]=re,R-G>3&&jt(J,G,R,j))}function er(J,z,R,j,G,re){var ne=G-R,oe=re-j;if(ne!==0||oe!==0){var te=((J-R)*ne+(z-j)*oe)/(ne*ne+oe*oe);te>1?(R=G,j=re):te>0&&(R+=ne*te,j+=oe*te)}return(ne=J-R)*ne+(oe=z-j)*oe}function Er(J,z,R,j){var G={id:J===void 0?null:J,type:z,geometry:R,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(re){var ne=re.geometry,oe=re.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")ue(re,ne);else if(oe==="Polygon"||oe==="MultiLineString")for(var te=0;te<ne.length;te++)ue(re,ne[te]);else if(oe==="MultiPolygon")for(te=0;te<ne.length;te++)for(var ce=0;ce<ne[te].length;ce++)ue(re,ne[te][ce])}(G),G}function ue(J,z){for(var R=0;R<z.length;R+=3)J.minX=Math.min(J.minX,z[R]),J.minY=Math.min(J.minY,z[R+1]),J.maxX=Math.max(J.maxX,z[R]),J.maxY=Math.max(J.maxY,z[R+1])}function Rt(J,z,R,j){if(z.geometry){var G=z.geometry.coordinates,re=z.geometry.type,ne=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),oe=[],te=z.id;if(R.promoteId?te=z.properties[R.promoteId]:R.generateId&&(te=j||0),re==="Point")qt(G,oe);else if(re==="MultiPoint")for(var ce=0;ce<G.length;ce++)qt(G[ce],oe);else if(re==="LineString")Yi(G,oe,ne,!1);else if(re==="MultiLineString"){if(R.lineMetrics){for(ce=0;ce<G.length;ce++)Yi(G[ce],oe=[],ne,!1),J.push(Er(te,"LineString",oe,z.properties));return}fe(G,oe,ne,!1)}else if(re==="Polygon")fe(G,oe,ne,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(ce=0;ce<z.geometry.geometries.length;ce++)Rt(J,{id:te,geometry:z.geometry.geometries[ce],properties:z.properties},R,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ce=0;ce<G.length;ce++){var be=[];fe(G[ce],be,ne,!0),oe.push(be)}}J.push(Er(te,re,oe,z.properties))}}function qt(J,z){z.push(tr(J[0])),z.push(Sn(J[1])),z.push(0)}function Yi(J,z,R,j){for(var G,re,ne=0,oe=0;oe<J.length;oe++){var te=tr(J[oe][0]),ce=Sn(J[oe][1]);z.push(te),z.push(ce),z.push(0),oe>0&&(ne+=j?(G*ce-te*re)/2:Math.sqrt(Math.pow(te-G,2)+Math.pow(ce-re,2))),G=te,re=ce}var be=z.length-3;z[2]=1,jt(z,0,be,R),z[be+2]=1,z.size=Math.abs(ne),z.start=0,z.end=z.size}function fe(J,z,R,j){for(var G=0;G<J.length;G++){var re=[];Yi(J[G],re,R,j),z.push(re)}}function tr(J){return J/360+.5}function Sn(J){var z=Math.sin(J*Math.PI/180),R=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return R<0?0:R>1?1:R}function Ct(J,z,R,j,G,re,ne,oe){if(j/=z,re>=(R/=z)&&ne<j)return J;if(ne<R||re>=j)return null;for(var te=[],ce=0;ce<J.length;ce++){var be=J[ce],ge=be.geometry,ye=be.type,Qe=G===0?be.minX:be.minY,et=G===0?be.maxX:be.maxY;if(Qe>=R&&et<j)te.push(be);else if(!(et<R||Qe>=j)){var ut=[];if(ye==="Point"||ye==="MultiPoint")Qi(ge,ut,R,j,G);else if(ye==="LineString")en(ge,ut,R,j,G,!1,oe.lineMetrics);else if(ye==="MultiLineString")os(ge,ut,R,j,G,!1);else if(ye==="Polygon")os(ge,ut,R,j,G,!0);else if(ye==="MultiPolygon")for(var lt=0;lt<ge.length;lt++){var At=[];os(ge[lt],At,R,j,G,!0),At.length&&ut.push(At)}if(ut.length){if(oe.lineMetrics&&ye==="LineString"){for(lt=0;lt<ut.length;lt++)te.push(Er(be.id,ye,ut[lt],be.tags));continue}ye!=="LineString"&&ye!=="MultiLineString"||(ut.length===1?(ye="LineString",ut=ut[0]):ye="MultiLineString"),ye!=="Point"&&ye!=="MultiPoint"||(ye=ut.length===3?"Point":"MultiPoint"),te.push(Er(be.id,ye,ut,be.tags))}}}return te.length?te:null}function Qi(J,z,R,j,G){for(var re=0;re<J.length;re+=3){var ne=J[re+G];ne>=R&&ne<=j&&(z.push(J[re]),z.push(J[re+1]),z.push(J[re+2]))}}function en(J,z,R,j,G,re,ne){for(var oe,te,ce=as(J),be=G===0?Rn:pa,ge=J.start,ye=0;ye<J.length-3;ye+=3){var Qe=J[ye],et=J[ye+1],ut=J[ye+2],lt=J[ye+3],At=J[ye+4],Kt=G===0?Qe:et,hi=G===0?lt:At,Ei=!1;ne&&(oe=Math.sqrt(Math.pow(Qe-lt,2)+Math.pow(et-At,2))),Kt<R?hi>R&&(te=be(ce,Qe,et,lt,At,R),ne&&(ce.start=ge+oe*te)):Kt>j?hi<j&&(te=be(ce,Qe,et,lt,At,j),ne&&(ce.start=ge+oe*te)):ls(ce,Qe,et,ut),hi<R&&Kt>=R&&(te=be(ce,Qe,et,lt,At,R),Ei=!0),hi>j&&Kt<=j&&(te=be(ce,Qe,et,lt,At,j),Ei=!0),!re&&Ei&&(ne&&(ce.end=ge+oe*te),z.push(ce),ce=as(J)),ne&&(ge+=oe)}var ft=J.length-3;Qe=J[ft],et=J[ft+1],ut=J[ft+2],(Kt=G===0?Qe:et)>=R&&Kt<=j&&ls(ce,Qe,et,ut),ft=ce.length-3,re&&ft>=3&&(ce[ft]!==ce[0]||ce[ft+1]!==ce[1])&&ls(ce,ce[0],ce[1],ce[2]),ce.length&&z.push(ce)}function as(J){var z=[];return z.size=J.size,z.start=J.start,z.end=J.end,z}function os(J,z,R,j,G,re){for(var ne=0;ne<J.length;ne++)en(J[ne],z,R,j,G,re,!1)}function ls(J,z,R,j){J.push(z),J.push(R),J.push(j)}function Rn(J,z,R,j,G,re){var ne=(re-z)/(j-z);return J.push(re),J.push(R+(G-R)*ne),J.push(1),ne}function pa(J,z,R,j,G,re){var ne=(re-R)/(G-R);return J.push(z+(j-z)*ne),J.push(re),J.push(1),ne}function On(J,z){for(var R=[],j=0;j<J.length;j++){var G,re=J[j],ne=re.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")G=Pe(re.geometry,z);else if(ne==="MultiLineString"||ne==="Polygon"){G=[];for(var oe=0;oe<re.geometry.length;oe++)G.push(Pe(re.geometry[oe],z))}else if(ne==="MultiPolygon")for(G=[],oe=0;oe<re.geometry.length;oe++){for(var te=[],ce=0;ce<re.geometry[oe].length;ce++)te.push(Pe(re.geometry[oe][ce],z));G.push(te)}R.push(Er(re.id,ne,G,re.tags))}return R}function Pe(J,z){var R=[];R.size=J.size,J.start!==void 0&&(R.start=J.start,R.end=J.end);for(var j=0;j<J.length;j+=3)R.push(J[j]+z,J[j+1],J[j+2]);return R}function tn(J,z){if(J.transformed)return J;var R,j,G,re=1<<J.z,ne=J.x,oe=J.y;for(R=0;R<J.features.length;R++){var te=J.features[R],ce=te.geometry,be=te.type;if(te.geometry=[],be===1)for(j=0;j<ce.length;j+=2)te.geometry.push(Pr(ce[j],ce[j+1],z,re,ne,oe));else for(j=0;j<ce.length;j++){var ge=[];for(G=0;G<ce[j].length;G+=2)ge.push(Pr(ce[j][G],ce[j][G+1],z,re,ne,oe));te.geometry.push(ge)}}return J.transformed=!0,J}function Pr(J,z,R,j,G,re){return[Math.round(R*(J*j-G)),Math.round(R*(z*j-re))]}function Ps(J,z,R,j,G){for(var re=z===G.maxZoom?0:G.tolerance/((1<<z)*G.extent),ne={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:j,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<J.length;oe++){ne.numFeatures++,ir(ne,J[oe],re,G);var te=J[oe].minX,ce=J[oe].minY,be=J[oe].maxX,ge=J[oe].maxY;te<ne.minX&&(ne.minX=te),ce<ne.minY&&(ne.minY=ce),be>ne.maxX&&(ne.maxX=be),ge>ne.maxY&&(ne.maxY=ge)}return ne}function ir(J,z,R,j){var G=z.geometry,re=z.type,ne=[];if(re==="Point"||re==="MultiPoint")for(var oe=0;oe<G.length;oe+=3)ne.push(G[oe]),ne.push(G[oe+1]),J.numPoints++,J.numSimplified++;else if(re==="LineString")Le(ne,G,J,R,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(oe=0;oe<G.length;oe++)Le(ne,G[oe],J,R,re==="Polygon",oe===0);else if(re==="MultiPolygon")for(var te=0;te<G.length;te++){var ce=G[te];for(oe=0;oe<ce.length;oe++)Le(ne,ce[oe],J,R,!0,oe===0)}if(ne.length){var be=z.tags||null;if(re==="LineString"&&j.lineMetrics){for(var ge in be={},z.tags)be[ge]=z.tags[ge];be.mapbox_clip_start=G.start/G.size,be.mapbox_clip_end=G.end/G.size}var ye={geometry:ne,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:be};z.id!==null&&(ye.id=z.id),J.features.push(ye)}}function Le(J,z,R,j,G,re){var ne=j*j;if(j>0&&z.size<(G?ne:j))R.numPoints+=z.length/3;else{for(var oe=[],te=0;te<z.length;te+=3)(j===0||z[te+2]>ne)&&(R.numSimplified++,oe.push(z[te]),oe.push(z[te+1])),R.numPoints++;G&&function(ce,be){for(var ge=0,ye=0,Qe=ce.length,et=Qe-2;ye<Qe;et=ye,ye+=2)ge+=(ce[ye]-ce[et])*(ce[ye+1]+ce[et+1]);if(ge>0===be)for(ye=0,Qe=ce.length;ye<Qe/2;ye+=2){var ut=ce[ye],lt=ce[ye+1];ce[ye]=ce[Qe-2-ye],ce[ye+1]=ce[Qe-1-ye],ce[Qe-2-ye]=ut,ce[Qe-1-ye]=lt}}(oe,re),J.push(oe)}}function gt(J,z){var R=(z=this.options=function(G,re){for(var ne in re)G[ne]=re[ne];return G}(Object.create(this.options),z)).debug;if(R&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(G,re){var ne=[];if(G.type==="FeatureCollection")for(var oe=0;oe<G.features.length;oe++)Rt(ne,G.features[oe],re,oe);else Rt(ne,G.type==="Feature"?G:{geometry:G},re);return ne}(J,z);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(G,re){var ne=re.buffer/re.extent,oe=G,te=Ct(G,1,-1-ne,ne,0,-1,2,re),ce=Ct(G,1,1-ne,2+ne,0,-1,2,re);return(te||ce)&&(oe=Ct(G,1,-ne,1+ne,0,-1,2,re)||[],te&&(oe=On(te,1).concat(oe)),ce&&(oe=oe.concat(On(ce,-1)))),oe}(j,z),j.length&&this.splitTile(j,0,0,0),R&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function pt(J,z,R){return 32*((1<<J)*R+z)+J}function Ai(J,z){return z?J.properties[z]:J.id}function rn(J,z){if(J==null)return!0;if(J.type==="Feature")return Ai(J,z)!=null;if(J.type==="FeatureCollection"){const R=new Set;for(const j of J.features){const G=Ai(j,z);if(G==null||R.has(G))return!1;R.add(G)}return!0}return!1}function ht(J,z){const R=new Map;if(J!=null)if(J.type==="Feature")R.set(Ai(J,z),J);else for(const j of J.features)R.set(Ai(j,z),j);return R}gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(J,z,R,j,G,re,ne){for(var oe=[J,z,R,j],te=this.options,ce=te.debug;oe.length;){j=oe.pop(),R=oe.pop(),z=oe.pop(),J=oe.pop();var be=1<<z,ge=pt(z,R,j),ye=this.tiles[ge];if(!ye&&(ce>1&&console.time("creation"),ye=this.tiles[ge]=Ps(J,z,R,j,te),this.tileCoords.push({z,x:R,y:j}),ce)){ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,R,j,ye.numFeatures,ye.numPoints,ye.numSimplified),console.timeEnd("creation"));var Qe="z"+z;this.stats[Qe]=(this.stats[Qe]||0)+1,this.total++}if(ye.source=J,G){if(z===te.maxZoom||z===G)continue;var et=1<<G-z;if(R!==Math.floor(re/et)||j!==Math.floor(ne/et))continue}else if(z===te.indexMaxZoom||ye.numPoints<=te.indexMaxPoints)continue;if(ye.source=null,J.length!==0){ce>1&&console.time("clipping");var ut,lt,At,Kt,hi,Ei,ft=.5*te.buffer/te.extent,_i=.5-ft,Oi=.5+ft,cr=1+ft;ut=lt=At=Kt=null,hi=Ct(J,be,R-ft,R+Oi,0,ye.minX,ye.maxX,te),Ei=Ct(J,be,R+_i,R+cr,0,ye.minX,ye.maxX,te),J=null,hi&&(ut=Ct(hi,be,j-ft,j+Oi,1,ye.minY,ye.maxY,te),lt=Ct(hi,be,j+_i,j+cr,1,ye.minY,ye.maxY,te),hi=null),Ei&&(At=Ct(Ei,be,j-ft,j+Oi,1,ye.minY,ye.maxY,te),Kt=Ct(Ei,be,j+_i,j+cr,1,ye.minY,ye.maxY,te),Ei=null),ce>1&&console.timeEnd("clipping"),oe.push(ut||[],z+1,2*R,2*j),oe.push(lt||[],z+1,2*R,2*j+1),oe.push(At||[],z+1,2*R+1,2*j),oe.push(Kt||[],z+1,2*R+1,2*j+1)}}},gt.prototype.getTile=function(J,z,R){var j=this.options,G=j.extent,re=j.debug;if(J<0||J>24)return null;var ne=1<<J,oe=pt(J,z=(z%ne+ne)%ne,R);if(this.tiles[oe])return tn(this.tiles[oe],G);re>1&&console.log("drilling down to z%d-%d-%d",J,z,R);for(var te,ce=J,be=z,ge=R;!te&&ce>0;)ce--,be=Math.floor(be/2),ge=Math.floor(ge/2),te=this.tiles[pt(ce,be,ge)];return te&&te.source?(re>1&&console.log("found parent tile z%d-%d-%d",ce,be,ge),re>1&&console.time("drilling down"),this.splitTile(te.source,ce,be,ge,J,z,R),re>1&&console.timeEnd("drilling down"),this.tiles[oe]?tn(this.tiles[oe],G):null):null};class Fn extends Z{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(z,R){return y._(this,void 0,void 0,function*(){const j=z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const G=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!G)return null;const re=new class{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.W,this.length=oe.length,this._features=oe}feature(oe){return new class{constructor(te){this._feature=te,this.extent=y.W,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ce of this._feature.geometry)te.push([new y.P(ce[0],ce[1])]);return te}{const te=[];for(const ce of this._feature.geometry){const be=[];for(const ge of ce)be.push(new y.P(ge[0],ge[1]));te.push(be)}return te}}toGeoJSON(te,ce,be){return Ue.call(this,te,ce,be)}}(this._features[oe])}}(G.features);let ne=It(re);return ne.byteOffset===0&&ne.byteLength===ne.buffer.byteLength||(ne=new Uint8Array(ne)),{vectorTile:re,rawData:ne.buffer}})}loadData(z){var R;return y._(this,void 0,void 0,function*(){(R=this._pendingRequest)===null||R===void 0||R.abort();const j=!!(z&&z.request&&z.request.collectResourceTiming)&&new y.br(z.request);this._pendingRequest=new AbortController;try{let G=yield this.loadGeoJSON(z,this._pendingRequest);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`);if(je(G,!0),z.filter){const ne=y.bx(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(te=>`${te.key}: ${te.message}`).join(", "));G={type:"FeatureCollection",features:G.features.filter(te=>ne.value.evaluate({zoom:0},te))}}this._geoJSONIndex=z.cluster?new oi(function({superclusterOptions:ne,clusterProperties:oe}){if(!oe||!ne)return ne;const te={},ce={},be={accumulated:null,zoom:0},ge={properties:null},ye=Object.keys(oe);for(const Qe of ye){const[et,ut]=oe[Qe],lt=y.bx(ut),At=y.bx(typeof et=="string"?[et,["accumulated"],["get",Qe]]:et);te[Qe]=lt.value,ce[Qe]=At.value}return ne.map=Qe=>{ge.properties=Qe;const et={};for(const ut of ye)et[ut]=te[ut].evaluate(be,ge);return et},ne.reduce=(Qe,et)=>{ge.properties=et;for(const ut of ye)be.accumulated=Qe[ut],Qe[ut]=ce[ut].evaluate(be,ge)},ne}(z)).load(G.features):function(ne,oe){return new gt(ne,oe)}(G,z.geojsonVtOptions),this.loaded={};const re={};if(j){const ne=j.finish();ne&&(re.resourceTiming={},re.resourceTiming[z.source]=JSON.parse(JSON.stringify(ne)))}return re}catch(G){if(delete this._pendingRequest,y.by(G))return{abandoned:!0};throw G}})}reloadTile(z){const R=this.loaded;return R&&R[z.uid]?super.reloadTile(z):this.loadTile(z)}loadGeoJSON(z,R){return y._(this,void 0,void 0,function*(){const{promoteId:j}=z;if(z.request){const G=yield y.h(z.request,R);return this._dataUpdateable=rn(G.data,j)?ht(G.data,j):void 0,G.data}if(typeof z.data=="string")try{const G=JSON.parse(z.data);return this._dataUpdateable=rn(G,j)?ht(G,j):void 0,G}catch{throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`)}if(!z.dataDiff)throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${z.source}`);return function(G,re,ne){var oe,te,ce,be;if(re.removeAll&&G.clear(),re.remove)for(const ge of re.remove)G.delete(ge);if(re.add)for(const ge of re.add){const ye=Ai(ge,ne);ye!=null&&G.set(ye,ge)}if(re.update)for(const ge of re.update){let ye=G.get(ge.id);if(ye==null)continue;const Qe=!ge.removeAllProperties&&(((oe=ge.removeProperties)===null||oe===void 0?void 0:oe.length)>0||((te=ge.addOrUpdateProperties)===null||te===void 0?void 0:te.length)>0);if((ge.newGeometry||ge.removeAllProperties||Qe)&&(ye=Object.assign({},ye),G.set(ge.id,ye),Qe&&(ye.properties=Object.assign({},ye.properties))),ge.newGeometry&&(ye.geometry=ge.newGeometry),ge.removeAllProperties)ye.properties={};else if(((ce=ge.removeProperties)===null||ce===void 0?void 0:ce.length)>0)for(const et of ge.removeProperties)Object.prototype.hasOwnProperty.call(ye.properties,et)&&delete ye.properties[et];if(((be=ge.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0)for(const{key:et,value:ut}of ge.addOrUpdateProperties)ye.properties[et]=ut}}(this._dataUpdateable,z.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(z){return y._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(z){return this._geoJSONIndex.getClusterExpansionZoom(z.clusterId)}getClusterChildren(z){return this._geoJSONIndex.getChildren(z.clusterId)}getClusterLeaves(z){return this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset)}}class Ri{constructor(z){this.self=z,this.actor=new y.C(z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,j)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=j},this.self.addProtocol=y.be,this.self.removeProtocol=y.bf,this.self.registerRTLTextPlugin=R=>{if(y.bz.isParsed())throw new Error("RTL text plugin already registered.");y.bz.setMethods(R)},this.actor.registerMessageHandler("loadDEMTile",(R,j)=>this._getDEMWorkerSource(R,j.source).loadTile(j)),this.actor.registerMessageHandler("removeDEMTile",(R,j)=>y._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,j.source).removeTile(j)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(R,j)=>y._(this,void 0,void 0,function*(){return this._getWorkerSource(R,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("getClusterChildren",(R,j)=>y._(this,void 0,void 0,function*(){return this._getWorkerSource(R,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("getClusterLeaves",(R,j)=>y._(this,void 0,void 0,function*(){return this._getWorkerSource(R,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("loadData",(R,j)=>this._getWorkerSource(R,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("loadTile",(R,j)=>this._getWorkerSource(R,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("reloadTile",(R,j)=>this._getWorkerSource(R,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("abortTile",(R,j)=>this._getWorkerSource(R,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("removeTile",(R,j)=>this._getWorkerSource(R,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("removeSource",(R,j)=>y._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][j.type]||!this.workerSources[R][j.type][j.source])return;const G=this.workerSources[R][j.type][j.source];delete this.workerSources[R][j.type][j.source],G.removeSource!==void 0&&G.removeSource(j)})),this.actor.registerMessageHandler("setReferrer",(R,j)=>y._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("syncRTLPluginState",(R,j)=>this._syncRTLPluginState(R,j)),this.actor.registerMessageHandler("importScript",(R,j)=>y._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("setImages",(R,j)=>this._setImages(R,j)),this.actor.registerMessageHandler("updateLayers",(R,j)=>y._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("setLayers",(R,j)=>y._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(j)}))}_setImages(z,R){return y._(this,void 0,void 0,function*(){this.availableImages[z]=R;for(const j in this.workerSources[z]){const G=this.workerSources[z][j];for(const re in G)G[re].availableImages=R}})}_syncRTLPluginState(z,R){return y._(this,void 0,void 0,function*(){y.bz.setState(R);const j=y.bz.getPluginURL();if(R.pluginStatus==="loaded"&&!y.bz.isParsed()&&j!=null){this.self.importScripts(j);const G=y.bz.isParsed();if(G)return G;throw new Error(`RTL Text Plugin failed to import scripts from ${j}`)}return!1})}_getAvailableImages(z){let R=this.availableImages[z];return R||(R=[]),R}_getLayerIndex(z){let R=this.layerIndexes[z];return R||(R=this.layerIndexes[z]=new l),R}_getWorkerSource(z,R,j){if(this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][R]||(this.workerSources[z][R]={}),!this.workerSources[z][R][j]){const G={sendAsync:(re,ne)=>(re.targetMapId=z,this.actor.sendAsync(re,ne))};switch(R){case"vector":this.workerSources[z][R][j]=new Z(G,this._getLayerIndex(z),this._getAvailableImages(z));break;case"geojson":this.workerSources[z][R][j]=new Fn(G,this._getLayerIndex(z),this._getAvailableImages(z));break;default:this.workerSources[z][R][j]=new this.externalWorkerSourceTypes[R](G,this._getLayerIndex(z),this._getAvailableImages(z))}}return this.workerSources[z][R][j]}_getDEMWorkerSource(z,R){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][R]||(this.demWorkerSources[z][R]=new K),this.demWorkerSources[z][R]}}return y.i(self)&&(self.worker=new Ri(self)),Ri}),b("index",["exports","./shared"],function(y,l){var D="4.0.1";let U,N;const Z={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:d=>new Promise((t,n)=>{const a=requestAnimationFrame(t);d.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(l.c())})}),getImageData(d,t=0){return this.getImageCanvasContext(d).getImageData(-t,-t,d.width+2*t,d.height+2*t)},getImageCanvasContext(d){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=d.width,t.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(U||(U=document.createElement("a")),U.href=d,U.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(N==null&&(N=matchMedia("(prefers-reduced-motion: reduce)")),N.matches)}};class K{static testProp(t){if(!K.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in K.docStyle)return t[n];return t[0]}static create(t,n,a){const h=window.document.createElement(t);return n!==void 0&&(h.className=n),a&&a.appendChild(h),h}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){K.docStyle&&K.selectProp&&(K.userSelect=K.docStyle[K.selectProp],K.docStyle[K.selectProp]="none")}static enableDrag(){K.docStyle&&K.selectProp&&(K.docStyle[K.selectProp]=K.userSelect)}static setTransform(t,n){t.style[K.transformProp]=n}static addEventListener(t,n,a,h={}){t.addEventListener(n,a,"passive"in h?h:h.capture)}static removeEventListener(t,n,a,h={}){t.removeEventListener(n,a,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",K.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",K.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",K.suppressClickInternal,!0)},0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,a){const h=n.boundingClientRect;return new l.P((a.clientX-h.left)/n.x-t.clientLeft,(a.clientY-h.top)/n.y-t.clientTop)}static mousePos(t,n){const a=K.getScale(t);return K.getPoint(t,a,n)}static touchPos(t,n){const a=[],h=K.getScale(t);for(let f=0;f<n.length;f++)a.push(K.getPoint(t,h,n[f]));return a}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}K.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,K.selectProp=K.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),K.transformProp=K.testProp(["transform","WebkitTransform"]);const Ae={supported:!1,testSupport:function(d){!Ue&&je&&(He?at(d):Te=d)}};let Te,je,Ue=!1,He=!1;function at(d){const t=d.createTexture();d.bindTexture(d.TEXTURE_2D,t);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,je),d.isContextLost())return;Ae.supported=!0}catch{}d.deleteTexture(t),Ue=!0}var Ye,Ie;typeof document<"u"&&(je=document.createElement("img"),je.onload=function(){Te&&at(Te),Te=null,He=!0},je.onerror=function(){Ue=!0,Te=null},je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let t,n,a,h;d.resetRequestQueue=()=>{t=[],n=0,a=0,h={}},d.addThrottleControl=k=>{const C=a++;return h[C]=k,C},d.removeThrottleControl=k=>{delete h[k],w()},d.getImage=(k,C,P=!0)=>new Promise((M,F)=>{Ae.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),l.e(k,{type:"image"}),t.push({abortController:C,requestParameters:k,supportImageRefresh:P,state:"queued",onError:H=>{F(H)},onSuccess:H=>{M(H)}}),w()});const f=k=>l._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:C,supportImageRefresh:P,onError:M,onSuccess:F,abortController:H}=k,W=P===!1&&!l.i(self)&&!l.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((ie,he)=>ie&&he==="accept",!0));n++;const Y=W?T(C,H):l.m(C,H);try{const ie=yield Y;delete k.abortController,k.state="completed",ie.data instanceof HTMLImageElement||l.b(ie.data)?F(ie):ie.data&&F({data:yield(q=ie.data,typeof createImageBitmap=="function"?l.d(q):l.f(q)),cacheControl:ie.cacheControl,expires:ie.expires})}catch(ie){delete k.abortController,M(ie)}finally{n--,w()}var q}),w=()=>{const k=(()=>{for(const C of Object.keys(h))if(h[C]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=n;C<k&&t.length>0;C++){const P=t.shift();P.abortController.signal.aborted?C--:f(P)}},T=(k,C)=>new Promise((P,M)=>{const F=new Image,H=k.url,W=k.credentials;W&&W==="include"?F.crossOrigin="use-credentials":(W&&W==="same-origin"||!l.s(H))&&(F.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{F.src="",M(l.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,P({data:F})},F.onerror=()=>{F.onerror=F.onload=null,C.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=H})}(Ye||(Ye={})),Ye.resetRequestQueue(),function(d){d.Glyphs="Glyphs",d.Image="Image",d.Source="Source",d.SpriteImage="SpriteImage",d.SpriteJSON="SpriteJSON",d.Style="Style",d.Tile="Tile",d.Unknown="Unknown"}(Ie||(Ie={}));class vt{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,a){const h=function(f){const w=f.match(Dt);if(!w)throw new Error(`Unable to parse URL "${f}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(t);return h.path+=`${n}${a}`,function(f){const w=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${w}`}(h)}setTransformRequest(t){this._transformRequestFn=t}}const Dt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yt(d){var t=new l.A(3);return t[0]=d[0],t[1]=d[1],t[2]=d[2],t}var Je,dt=function(d,t,n){return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],d};Je=new l.A(3),l.A!=Float32Array&&(Je[0]=0,Je[1]=0,Je[2]=0);var si=function(d){var t=d[0],n=d[1];return t*t+n*n};function _e(d){const t=[];if(typeof d=="string")t.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:a,url:h}of d){const f=`${a}${h}`;n.indexOf(f)===-1&&(n.push(f),t.push({id:a,url:h}))}}return t}(function(){var d=new l.A(2);l.A!=Float32Array&&(d[0]=0,d[1]=0)})();class kt{constructor(t,n,a,h){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(n,h)}update(t,n,a){const{width:h,height:f}=t,w=!(this.size&&this.size[0]===h&&this.size[1]===f||a),{context:T}=this,{gl:k}=T;if(this.useMipmap=!!(n&&n.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!n||n.premultiply!==!1)),w)this.size=[h,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,t):k.texImage2D(k.TEXTURE_2D,0,this.format,h,f,0,this.format,k.UNSIGNED_BYTE,t.data);else{const{x:C,y:P}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?k.texSubImage2D(k.TEXTURE_2D,0,C,P,k.RGBA,k.UNSIGNED_BYTE,t):k.texSubImage2D(k.TEXTURE_2D,0,C,P,h,f,k.RGBA,k.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(t,n,a){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),a!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,a||t),this.filter=t),n!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Mt(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Wt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new l.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let a=!0;const h=n.data||n.spriteData;return this._validateStretch(n.stretchX,h&&h.width)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,h&&h.height)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,n){if(!t)return!0;let a=0;for(const h of t){if(h[0]<a||h[1]<h[0]||n<h[1])return!1;a=h[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const a=n.spriteData,h=a&&a.width||n.data.width,f=a&&a.height||n.data.height;return!(t[0]<0||h<t[0]||t[1]<0||f<t[1]||t[2]<0||h<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,a=!0){const h=this.getImage(t);if(a&&(h.data.width!==n.data.width||h.data.height!==n.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=h.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((n,a)=>{let h=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(h=!1);this.isLoaded()||h?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})})}_getImagesForIds(t){const n={};for(const a of t){let h=this.getImage(a);h||(this.fire(new l.k("styleimagemissing",{id:a})),h=this.getImage(a)),h?n[a]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:l.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],a=this.getImage(t);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const h={w:a.data.width+2,h:a.data.height+2,x:0,y:0},f=new l.I(h,a);this.patterns[t]={bin:h,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new kt(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:n,h:a}=l.p(t),h=this.atlasImage;h.resize({width:n||1,height:a||1});for(const f in this.patterns){const{bin:w}=this.patterns[f],T=w.x+1,k=w.y+1,C=this.getImage(f).data,P=C.width,M=C.height;l.R.copy(C,h,{x:0,y:0},{x:T,y:k},{width:P,height:M}),l.R.copy(C,h,{x:0,y:M-1},{x:T,y:k-1},{width:P,height:1}),l.R.copy(C,h,{x:0,y:0},{x:T,y:k+M},{width:P,height:1}),l.R.copy(C,h,{x:P-1,y:0},{x:T-1,y:k},{width:1,height:M}),l.R.copy(C,h,{x:0,y:0},{x:T+P,y:k},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||l.w(`Image with ID: "${n}" was not found`),Mt(a)&&this.updateImage(n,a)}}}const ai=1e20;function it(d,t,n,a,h,f,w,T,k){for(let C=t;C<t+a;C++)It(d,n*f+C,f,h,w,T,k);for(let C=n;C<n+h;C++)It(d,C*f+t,1,a,w,T,k)}function It(d,t,n,a,h,f,w){f[0]=0,w[0]=-ai,w[1]=ai,h[0]=d[t];for(let T=1,k=0,C=0;T<a;T++){h[T]=d[t+T*n];const P=T*T;do{const M=f[k];C=(h[T]-h[M]+P-M*M)/(T-M)/2}while(C<=w[k]&&--k>-1);k++,f[k]=T,w[k]=C,w[k+1]=ai}for(let T=0,k=0;T<a;T++){for(;w[k+1]<T;)k++;const C=f[k],P=T-C;d[t+T*n]=h[C]+P*P}}class ct{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,function*(){const n=[];for(const f in t)for(const w of t[f])n.push(this._getAndCacheGlyphsPromise(f,w));const a=yield Promise.all(n),h={};for(const{stack:f,id:w,glyph:T}of a)h[f]||(h[f]={}),h[f][w]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return h})}_getAndCacheGlyphsPromise(t,n){return l._(this,void 0,void 0,function*(){let a=this.entries[t];a||(a=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=a.glyphs[n];if(h!==void 0)return{stack:t,id:n,glyph:h};if(h=this._tinySDF(a,t,n),h)return a.glyphs[n]=h,{stack:t,id:n,glyph:h};const f=Math.floor(n/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[f])return{stack:t,id:n,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[f]){const T=ct.loadGlyphRange(t,f,this.url,this.requestManager);a.requests[f]=T}const w=yield a.requests[f];for(const T in w)this._doesCharSupportLocalGlyph(+T)||(a.glyphs[+T]=w[+T]);return a.ranges[f]=!0,{stack:t,id:n,glyph:w[n]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](t)||l.u["Hangul Syllables"](t)||l.u.Hiragana(t)||l.u.Katakana(t))}_tinySDF(t,n,a){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let f=t.tinySDF;if(!f){let T="400";/bold/i.test(n)?T="900":/medium/i.test(n)?T="500":/light/i.test(n)&&(T="200"),f=t.tinySDF=new ct.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:T})}const w=f.draw(String.fromCharCode(a));return{id:a,bitmap:new l.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}ct.loadGlyphRange=function(d,t,n,a){return l._(this,void 0,void 0,function*(){const h=256*t,f=h+255,w=a.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${h}-${f}`),Ie.Glyphs),T=yield l.l(w,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${f}`);const k={};for(const C of l.n(T.data))k[C.id]=C;return k})},ct.TinySDF=class{constructor({fontSize:d=24,buffer:t=3,radius:n=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=n;const T=this.size=d+4*t,k=this._createCanvas(T),C=this.ctx=k.getContext("2d",{willReadFrequently:!0});C.font=`${w} ${f} ${d}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(d){const t=document.createElement("canvas");return t.width=t.height=d,t}draw(d){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(d),w=Math.ceil(n),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),k=Math.min(this.size-this.buffer,w+Math.ceil(a)),C=T+2*this.buffer,P=k+2*this.buffer,M=Math.max(C*P,0),F=new Uint8ClampedArray(M),H={data:F,width:C,height:P,glyphWidth:T,glyphHeight:k,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(T===0||k===0)return H;const{ctx:W,buffer:Y,gridInner:q,gridOuter:ie}=this;W.clearRect(Y,Y,T,k),W.fillText(d,Y,Y+w);const he=W.getImageData(Y,Y,T,k);ie.fill(ai,0,M),q.fill(0,0,M);for(let Q=0;Q<k;Q++)for(let ae=0;ae<T;ae++){const pe=he.data[4*(Q*T+ae)+3]/255;if(pe===0)continue;const de=(Q+Y)*C+ae+Y;if(pe===1)ie[de]=0,q[de]=ai;else{const ve=.5-pe;ie[de]=ve>0?ve*ve:0,q[de]=ve<0?ve*ve:0}}it(ie,0,0,C,P,C,this.f,this.v,this.z),it(q,Y,Y,T,k,C,this.f,this.v,this.z);for(let Q=0;Q<M;Q++){const ae=Math.sqrt(ie[Q])-Math.sqrt(q[Q]);F[Q]=Math.round(255-255*(ae/this.radius+this.cutoff))}return H}};class mi{constructor(){this.specification=l.v.light.position}possiblyEvaluate(t,n){return l.y(t.expression.evaluate(n))}interpolate(t,n,a){return{x:l.z.number(t.x,n.x,a),y:l.z.number(t.y,n.y,a),z:l.z.number(t.z,n.z,a)}}}let Zt;class Nt extends l.E{constructor(t){super(),Zt=Zt||new l.q({anchor:new l.D(l.v.light.anchor),position:new mi,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Zt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(l.r,t,n))for(const a in t){const h=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),h):this._transitionable.setValue(a,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,a){return(!a||a.validate!==!1)&&l.t(this,t.call(l.x,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class Ut{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const a=t.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,n)),this.dashEntry[a]}getDashRanges(t,n,a){const h=[];let f=t.length%2==1?-t[t.length-1]*a:0,w=t[0]*a,T=!0;h.push({left:f,right:w,isDash:T,zeroLength:t[0]===0});let k=t[0];for(let C=1;C<t.length;C++){T=!T;const P=t[C];f=k*a,k+=P,w=k*a,h.push({left:f,right:w,isDash:T,zeroLength:P===0})}return h}addRoundDash(t,n,a){const h=n/2;for(let f=-a;f<=a;f++){const w=this.width*(this.nextRow+a+f);let T=0,k=t[T];for(let C=0;C<this.width;C++){C/k.right>1&&(k=t[++T]);const P=Math.abs(C-k.left),M=Math.abs(C-k.right),F=Math.min(P,M);let H;const W=f/a*(h+1);if(k.isDash){const Y=h-Math.abs(W);H=Math.sqrt(F*F+Y*Y)}else H=h-Math.sqrt(F*F+W*W);this.data[w+C]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(t){for(let T=t.length-1;T>=0;--T){const k=t[T],C=t[T+1];k.zeroLength?t.splice(T,1):C&&C.isDash===k.isDash&&(C.left=k.left,t.splice(T,1))}const n=t[0],a=t[t.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const h=this.width*this.nextRow;let f=0,w=t[f];for(let T=0;T<this.width;T++){T/w.right>1&&(w=t[++f]);const k=Math.abs(T-w.left),C=Math.abs(T-w.right),P=Math.min(k,C);this.data[h+T]=Math.max(0,Math.min(255,(w.isDash?P:-P)+128))}}addDash(t,n){const a=n?7:0,h=2*a+1;if(this.nextRow+h>this.height)return l.w("LineAtlas out of space"),null;let f=0;for(let T=0;T<t.length;T++)f+=t[T];if(f!==0){const T=this.width/f,k=this.getDashRanges(t,this.width,T);n?this.addRoundDash(k,T,a):this.addRegularDash(k)}const w={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:f};return this.nextRow+=h,this.dirty=!0,w}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const gi="maplibre_preloaded_worker_pool";class oi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<oi.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gi]}numActive(){return Object.keys(this.active).length}}const Di=Math.floor(Z.hardwareConcurrency/2);let li,ci;function Ee(){return li||(li=new oi),li}oi.workerCount=l.B(globalThis)?Math.max(Math.min(Di,3),1):1;class ot{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let h=0;h<a.length;h++){const f=new l.C(a[h],n);f.name=`Worker ${h}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const a=[];for(const h of this.actors)a.push(h.sendAsync({type:t,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const a of this.actors)a.registerMessageHandler(t,n)}}function jt(){return ci||(ci=new ot(Ee(),l.G),ci.registerMessageHandler("getResource",(d,t,n)=>l.m(t,n))),ci}function er(d,t){const n=l.F();return l.H(n,n,[1,1,0]),l.J(n,n,[.5*d.width,.5*d.height,1]),l.K(n,n,d.calculatePosMatrix(t.toUnwrapped()))}function Er(d,t,n,a,h,f){const w=function(M,F,H){if(M)for(const W of M){const Y=F[W];if(Y&&Y.source===H&&Y.type==="fill-extrusion")return!0}else for(const W in F){const Y=F[W];if(Y.source===H&&Y.type==="fill-extrusion")return!0}return!1}(h&&h.layers,t,d.id),T=f.maxPitchScaleFactor(),k=d.tilesIn(a,T,w);k.sort(ue);const C=[];for(const M of k)C.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(t,n,d._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,h,f,T,er(d.transform,M.tileID))});const P=function(M){const F={},H={};for(const W of M){const Y=W.queryResults,q=W.wrappedTileID,ie=H[q]=H[q]||{};for(const he in Y){const Q=Y[he],ae=ie[he]=ie[he]||{},pe=F[he]=F[he]||[];for(const de of Q)ae[de.featureIndex]||(ae[de.featureIndex]=!0,pe.push(de))}}return F}(C);for(const M in P)P[M].forEach(F=>{const H=F.feature,W=d.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=W});return P}function ue(d,t){const n=d.tileID,a=t.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Rt(d,t,n){return l._(this,void 0,void 0,function*(){let a=d;if(d.url?a=(yield l.h(t.transformRequest(d.url,Ie.Source),n)).data:yield Z.frameAsync(n),!a)return null;const h=l.L(l.e(a,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(h.vectorLayerIds=a.vector_layers.map(f=>f.id)),h})}class qt{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.M?new l.M(t.lng,t.lat):l.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.M?new l.M(t.lng,t.lat):l.M.convert(t),this}extend(t){const n=this._sw,a=this._ne;let h,f;if(t instanceof l.M)h=t,f=t;else{if(!(t instanceof qt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(qt.convert(t)):this.extend(l.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.M.convert(t)):this;if(h=t._sw,f=t._ne,!h||!f)return this}return n||a?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new l.M(h.lng,h.lat),this._ne=new l.M(f.lng,f.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:a}=l.M.convert(t);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(t){return t instanceof qt?t:t&&new qt(t)}static fromLngLat(t,n=0){const a=360*n/40075017,h=a/Math.cos(Math.PI/180*t.lat);return new qt(new l.M(t.lng-h,t.lat-a),new l.M(t.lng+h,t.lat+a))}}class Yi{constructor(t,n,a){this.bounds=qt.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),a=Math.floor(l.N(this.bounds.getWest())*n),h=Math.floor(l.O(this.bounds.getNorth())*n),f=Math.ceil(l.N(this.bounds.getEast())*n),w=Math.ceil(l.O(this.bounds.getSouth())*n);return t.x>=a&&t.x<f&&t.y>=h&&t.y<w}}class fe extends l.E{constructor(t,n,a,h){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(n,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Rt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new Yi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,Ie.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let h="reloadTile";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((f,w)=>{t.reloadPromise={resolve:f,reject:w}})}else t.actor=this.dispatcher.getActor(),h="loadTile";t.abortController=new AbortController;try{const f=yield t.actor.sendAsync({type:h,data:a},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,f)}catch(f){if(delete t.abortController,t.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const a=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(a.resolve).catch(a.reject)}}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"abortTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class tr extends l.E{constructor(t,n,a,h){super(),this.id=t,this.dispatcher=a,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},n),l.e(this,l.L(n,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Rt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(l.e(this,t),t.bounds&&(this.tileBounds=new Yi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const a=yield Ye.getImage(this.map._requestManager.transformRequest(n,Ie.Tile),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&t.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const h=this.map.painter.context,f=h.gl,w=a.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new kt(h,w,f.RGBA,{useMipmap:!0}),t.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),h.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(a){if(delete t.abortController,t.aborted)t.state="unloaded";else if(a)throw t.state="errored",a}})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Sn extends tr{constructor(t,n,a,h){super(t,n,a,h),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return l._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,Ie.Tile);t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield Ye.getImage(a,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const f=h.data;this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const w=l.b(f)&&l.S()?f:yield this.readImageNow(f),T={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const k=yield t.actor.sendAsync({type:"loadDEMTile",data:T});t.dem=k,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}})}readImageNow(t){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const n=t.width+2,a=t.height+2;try{return new l.R({width:n,height:a},yield l.V(t,-1,-1,n,a))}catch{}}return Z.getImageData(t,1)})}_getNeighboringTiles(t){const n=t.canonical,a=Math.pow(2,n.z),h=(n.x-1+a)%a,f=n.x===0?t.wrap-1:t.wrap,w=(n.x+1+a)%a,T=n.x+1===a?t.wrap+1:t.wrap,k={};return k[new l.Q(t.overscaledZ,f,n.z,h,n.y).key]={backfilled:!1},k[new l.Q(t.overscaledZ,T,n.z,w,n.y).key]={backfilled:!1},n.y>0&&(k[new l.Q(t.overscaledZ,f,n.z,h,n.y-1).key]={backfilled:!1},k[new l.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},k[new l.Q(t.overscaledZ,T,n.z,w,n.y-1).key]={backfilled:!1}),n.y+1<a&&(k[new l.Q(t.overscaledZ,f,n.z,h,n.y+1).key]={backfilled:!1},k[new l.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},k[new l.Q(t.overscaledZ,T,n.z,w,n.y+1).key]={backfilled:!1}),k}unloadTile(t){return l._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Ct extends l.E{constructor(t,n,a,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(h),this._data=n.data,this._options=l.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const f=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*f,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*f,extent:l.W,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:l.W,radius:(n.clusterRadius||50)*f,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,a){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:a}})}_updateWorkerData(t){return l._(this,void 0,void 0,function*(){const n=l.e({type:this.type},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(Z.resolveURL(this._data),Ie.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"loadData",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let h=null;a.resourceTiming&&a.resourceTiming[this.id]&&(h=a.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&l.e(f,{resourceTiming:h}),this.fire(new l.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(t){return l._(this,void 0,void 0,function*(){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const a={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:n,data:a},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,n==="reloadTile")})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Qi=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class en extends l.E{constructor(t,n,a,h){super(),this.id=t,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=n}load(t){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Ye.getImage(this.map._requestManager.transformRequest(this.url,Ie.Image),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this.fire(new l.j(n))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(l.Y.fromLngLat);this.tileID=function(h){let f=1/0,w=1/0,T=-1/0,k=-1/0;for(const F of h)f=Math.min(f,F.x),w=Math.min(w,F.y),T=Math.max(T,F.x),k=Math.max(k,F.y);const C=Math.max(T-f,k-w),P=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,P);return new l.a0(P,Math.floor((f+T)/2*M),Math.floor((w+k)/2*M))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(h=>this.tileID.getTilePoint(h)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,l.W,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,l.W),this._boundsArray.emplaceBack(a[2].x,a[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Qi.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new kt(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const h in this.tiles){const f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,a=!0)}a&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class as extends en{constructor(t,n,a,h){super(t,n,a,h),this.roundZoom=!0,this.type="video",this.options=n}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,Ie.Source).url);try{const n=yield l.a2(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new l.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Qi.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new kt(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const h in this.tiles){const f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,a=!0)}a&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class os extends en{constructor(t,n,a,h){super(t,n,a,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(w=>typeof w!="number"))||this.fire(new l.j(new l.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Qi.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new kt(n,this.canvas,a.RGBA,{premultiply:!0});let h=!1;for(const f in this.tiles){const w=this.tiles[f];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,h=!0)}h&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const ls={},Rn=d=>{switch(d){case"geojson":return Ct;case"image":return en;case"raster":return tr;case"raster-dem":return Sn;case"vector":return fe;case"video":return as;case"canvas":return os}return ls[d]};class pa extends l.E{constructor(){super(...arguments),this.pluginStatus="unavailable",this.pluginURL=null,this.dispatcher=jt(),this.queue=[]}_sendPluginStateToWorker(){return l._(this,void 0,void 0,function*(){yield this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}),this.fire(new l.k("pluginStateChange",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}))})}getRTLTextPluginStatus(){return this.pluginStatus}clearRTLTextPlugin(){this.pluginStatus="unavailable",this.pluginURL=null}setRTLTextPlugin(t,n=!1){return l._(this,void 0,void 0,function*(){if(this.pluginStatus==="deferred"||this.pluginStatus==="loading"||this.pluginStatus==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");this.pluginURL=Z.resolveURL(t),this.pluginStatus="deferred",yield this._sendPluginStateToWorker(),n||(yield this._downloadRTLTextPlugin())})}_downloadRTLTextPlugin(){return l._(this,void 0,void 0,function*(){if(this.pluginStatus!=="deferred"||!this.pluginURL)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");try{this.pluginStatus="loading",yield this._sendPluginStateToWorker(),yield l.l({url:this.pluginURL},new AbortController),this.pluginStatus="loaded"}catch{this.pluginStatus="error"}yield this._sendPluginStateToWorker()})}lazyLoadRTLTextPlugin(){return l._(this,void 0,void 0,function*(){this.pluginStatus==="deferred"&&(yield this._downloadRTLTextPlugin())})}}let On=null;function Pe(){return On||(On=new pa),On}class tn{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.a3(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,f){const w={};if(!f)return w;for(const T of h){const k=T.layerIds.map(C=>f.getLayer(C)).filter(Boolean);if(k.length!==0){T.layers=k,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(C=>k.filter(P=>P.id===C)[0]));for(const C of k)w[C.id]=T}}return w}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof l.a5){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof l.a5&&f.hasRTLText){this.hasRTLText=!0,Pe().lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const a in this.buckets){const h=this.buckets[a];h.uploadPending()&&h.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kt(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kt(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,a,h,f,w,T,k,C,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:f,scale:w,tileSize:this.tileSize,pixelPosMatrix:P,transform:k,params:T,queryPadding:this.queryPadding*C},t,n,a):{}}querySourceFeatures(t,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const h=a.loadVTLayers(),f=n&&n.sourceLayer?n.sourceLayer:"",w=h._geojsonTileLayer||h[f];if(!w)return;const T=l.a6(n&&n.filter),{z:k,x:C,y:P}=this.tileID.canonical,M={z:k,x:C,y:P};for(let F=0;F<w.length;F++){const H=w.feature(F);if(T.needGeometry){const q=l.a7(H,!0);if(!T.filter(new l.a8(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!T.filter(new l.a8(this.tileID.overscaledZ),H))continue;const W=a.getId(H,f),Y=new l.a9(H,k,C,P,W);Y.tile=M,t.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const a=l.aa(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const a=Date.now();let h=!1;if(this.expirationTime>a)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const f=this.expirationTime-n;f?this.expirationTime=a+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const f=this.buckets[h],w=f.layers[0].sourceLayer||"_geojsonTileLayer",T=a[w],k=t[w];if(!T||!k||Object.keys(k).length===0)continue;f.update(k,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=n&&n.style&&n.style.getLayer(h);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Z.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Z.now()+t}setDependencies(t,n){const a={};for(const h of n)a[h]=!0;this.dependencies[t]=a}hasDependency(t,n){for(const a of t){const h=this.dependencies[a];if(h){for(const f of n)if(h[f])return!0}}return!1}}class Pr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,a){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const f={value:n,timeout:void 0};if(a!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},a)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const a=t.wrapped().key,h=n===void 0?0:this.data[a].indexOf(n),f=this.data[a][h];return this.data[a].splice(h,1),f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const a in this.data)for(const h of this.data[a])t(h.value)||n.push(h);for(const a of n)this.remove(a.value.tileID,a)}}class Ps{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,a){const h=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},l.e(this.stateChanges[t][h],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==h&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const f in this.state[t][h])a[f]||(this.deletedStates[t][h][f]=null)}else for(const f in a)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][f]===null&&delete this.deletedStates[t][h][f]}removeFeatureState(t,n,a){if(this.deletedStates[t]===null)return;const h=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&n!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][a]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(a in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][a]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,n){const a=String(n),h=l.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][n];if(f===null)return{};for(const w in f)delete h[w]}return h}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const a={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const w in this.stateChanges[h])this.state[h][w]||(this.state[h][w]={}),l.e(this.state[h][w],this.stateChanges[h][w]),f[w]=this.state[h][w];a[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(this.deletedStates[h]===null)for(const w in this.state[h])f[w]={},this.state[h][w]={};else for(const w in this.deletedStates[h]){if(this.deletedStates[h][w]===null)this.state[h][w]={};else for(const T of Object.keys(this.deletedStates[h][w]))delete this.state[h][w][T];f[w]=this.state[h][w]}a[h]=a[h]||{},l.e(a[h],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const h in t)t[h].setFeatureState(a,n)}}class ir extends l.E{constructor(t,n,a){super(),this.id=t,this.dispatcher=a,this.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,f,w,T)=>{const k=new(Rn(f.type))(h,f,w,T);if(k.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${k.id}`);return k})(t,n,a,this),this._tiles={},this._cache=new Pr(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ps,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,a){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,a)}catch(h){t.state="errored",h.status!==404?this._source.fire(new l.j(h,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Le).map(t=>t.key)}getRenderableIds(t){const n=[];for(const a in this._tiles)this._isIdRenderable(a,t)&&n.push(this._tiles[a]);return t?n.sort((a,h)=>{const f=a.tileID,w=h.tileID,T=new l.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),k=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-w.overscaledZ||k.y-T.y||k.x-T.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Le).map(a=>a.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){return l._(this,void 0,void 0,function*(){const a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,t,n))})}_tileLoaded(t,n,a){t.timeAdded=Z.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const f=n[h];if(t.neighboringTiles&&t.neighboringTiles[f]){const w=this.getTileByID(f);a(t,w),a(w,t)}}function a(h,f){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let w=f.tileID.canonical.x-h.tileID.canonical.x;const T=f.tileID.canonical.y-h.tileID.canonical.y,k=Math.pow(2,h.tileID.canonical.z),C=f.tileID.key;w===0&&T===0||Math.abs(T)>1||(Math.abs(w)>1&&(Math.abs(w+k)===1?w+=k:Math.abs(w-k)===1&&(w-=k)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,w,T),h.neighboringTiles&&h.neighboringTiles[C]&&(h.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,a,h){for(const f in this._tiles){let w=this._tiles[f];if(h[f]||!w.hasData()||w.tileID.overscaledZ<=n||w.tileID.overscaledZ>a)continue;let T=w.tileID;for(;w&&w.tileID.overscaledZ>n+1;){const C=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[C.key],w&&w.hasData()&&(T=C)}let k=T;for(;k.overscaledZ>n;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]){h[T.key]=T;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=t.overscaledZ-1;a>=n;a--){const h=t.scaledTo(a),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(f)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const a={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),a[f.tileID.key]=f}this._tiles=a;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new l.Q(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(a=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(P=>this._source.hasTile(P)))):a=[];const h=t.coveringZoomLevel(this._source),f=Math.max(h-ir.maxOverzooming,this._source.minzoom),w=Math.max(h+ir.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const M of a)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);P[F.key]=F;const H=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));P[H.key]=H}a=a.concat(Object.values(P))}const T=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(a,h);if(gt(this._source.type)){const P={},M={},F=Object.keys(k),H=Z.now();for(const W of F){const Y=k[W],q=this._tiles[W];if(!q||q.fadeEndTime!==0&&q.fadeEndTime<=H)continue;const ie=this.findLoadedParent(Y,f);ie&&(this._addTile(ie.tileID),P[ie.tileID.key]=ie.tileID),M[W]=Y}this._retainLoadedChildren(M,h,w,k);for(const W in P)k[W]||(this._coveredTiles[W]=!0,k[W]=P[W]);if(n){const W={},Y={};for(const q of a)this._tiles[q.key].hasData()?W[q.key]=q:Y[q.key]=q;for(const q in Y){const ie=Y[q].children(this._source.maxzoom);this._tiles[ie[0].key]&&this._tiles[ie[1].key]&&this._tiles[ie[2].key]&&this._tiles[ie[3].key]&&(W[ie[0].key]=k[ie[0].key]=ie[0],W[ie[1].key]=k[ie[1].key]=ie[1],W[ie[2].key]=k[ie[2].key]=ie[2],W[ie[3].key]=k[ie[3].key]=ie[3],delete Y[q])}for(const q in Y){const ie=this.findLoadedParent(Y[q],this._source.minzoom);if(ie){W[ie.tileID.key]=k[ie.tileID.key]=ie.tileID;for(const he in W)W[he].isChildOf(ie.tileID)&&delete W[he]}}for(const q in this._tiles)W[q]||(this._coveredTiles[q]=!0)}}for(const P in k)this._tiles[P].clearFadeHold();const C=l.ab(this._tiles,k);for(const P of C){const M=this._tiles[P];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const a={},h={},f=Math.max(n-ir.maxOverzooming,this._source.minzoom),w=Math.max(n+ir.maxUnderzooming,this._source.minzoom),T={};for(const k of t){const C=this._addTile(k);a[k.key]=k,C.hasData()||n<this._source.maxzoom&&(T[k.key]=k)}this._retainLoadedChildren(T,n,w,a);for(const k of t){let C=this._tiles[k.key];if(C.hasData())continue;if(n+1>this._source.maxzoom){const M=k.children(this._source.maxzoom)[0],F=this.getTile(M);if(F&&F.hasData()){a[M.key]=M;continue}}else{const M=k.children(this._source.maxzoom);if(a[M[0].key]&&a[M[1].key]&&a[M[2].key]&&a[M[3].key])continue}let P=C.wasRequested();for(let M=k.overscaledZ-1;M>=f;--M){const F=k.scaledTo(M);if(h[F.key])break;if(h[F.key]=!0,C=this.getTile(F),!C&&P&&(C=this._addTile(F)),C){const H=C.hasData();if((P||H)&&(a[F.key]=F),P=C.wasRequested(),H)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let a,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){a=this._loadedParentTiles[h.key];break}n.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;h=f}for(const f of n)this._loadedParentTiles[f]=a}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const a=n;return n||(n=new tn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._tiles[t.key]=n,a||this._source.fire(new l.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const a=n.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,a){const h=[],f=this.transform;if(!f)return h;const w=a?f.getCameraQueryGeometry(t):t,T=t.map(W=>f.pointCoordinate(W,this.terrain)),k=w.map(W=>f.pointCoordinate(W,this.terrain)),C=this.getIds();let P=1/0,M=1/0,F=-1/0,H=-1/0;for(const W of k)P=Math.min(P,W.x),M=Math.min(M,W.y),F=Math.max(F,W.x),H=Math.max(H,W.y);for(let W=0;W<C.length;W++){const Y=this._tiles[C[W]];if(Y.holdingForFade())continue;const q=Y.tileID,ie=Math.pow(2,f.zoom-Y.tileID.overscaledZ),he=n*Y.queryPadding*l.W/Y.tileSize/ie,Q=[q.getTilePoint(new l.Y(P,M)),q.getTilePoint(new l.Y(F,H))];if(Q[0].x-he<l.W&&Q[0].y-he<l.W&&Q[1].x+he>=0&&Q[1].y+he>=0){const ae=T.map(de=>q.getTilePoint(de)),pe=k.map(de=>q.getTilePoint(de));h.push({tile:Y,tileID:q,queryGeometry:ae,cameraQueryGeometry:pe,scale:ie})}}return h}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(gt(this._source.type)){const t=Z.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,a){this._state.updateState(t=t||"_geojsonTileLayer",n,a)}removeFeatureState(t,n,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,a)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,a){const h=this._tiles[t];h&&h.setDependencies(n,a)}reloadTilesForDependencies(t,n){for(const a in this._tiles)this._tiles[a].hasDependency(t,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,n))}}function Le(d,t){const n=Math.abs(2*d.wrap)-+(d.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||a-n||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function gt(d){return d==="raster"||d==="image"||d==="video"}ir.maxOverzooming=10,ir.maxUnderzooming=3;class pt{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.ac(t,0,1);let n=1,a=this._distances[n];const h=t*this.paddedLength+this.padding;for(;a<h&&n<this._distances.length;)a=this._distances[++n];const f=n-1,w=this._distances[f],T=a-w,k=T>0?(h-w)/T:0;return this.points[f].mult(1-k).add(this.points[n].mult(k))}}function Ai(d,t){let n=!0;return d==="always"||d!=="never"&&t!=="never"||(n=!1),n}class rn{constructor(t,n,a){const h=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(n/a);for(let w=0;w<this.xCellCount*this.yCellCount;w++)h.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,a,h,f){this._forEachCell(n,a,h,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(f)}insertCircle(t,n,a,h){this._forEachCell(n-h,a-h,n+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(a),this.circles.push(h)}_insertBoxCell(t,n,a,h,f,w){this.boxCells[f].push(w)}_insertCircleCell(t,n,a,h,f,w){this.circleCells[f].push(w)}_query(t,n,a,h,f,w,T){if(a<0||t>this.width||h<0||n>this.height)return[];const k=[];if(t<=0&&n<=0&&this.width<=a&&this.height<=h){if(f)return[{key:null,x1:t,y1:n,x2:a,y2:h}];for(let C=0;C<this.boxKeys.length;C++)k.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const P=this.circles[3*C],M=this.circles[3*C+1],F=this.circles[3*C+2];k.push({key:this.circleKeys[C],x1:P-F,y1:M-F,x2:P+F,y2:M+F})}}else this._forEachCell(t,n,a,h,this._queryCell,k,{hitTest:f,overlapMode:w,seenUids:{box:{},circle:{}}},T);return k}query(t,n,a,h){return this._query(t,n,a,h,!1,null)}hitTest(t,n,a,h,f,w){return this._query(t,n,a,h,!0,f,w).length>0}hitTestCircle(t,n,a,h,f){const w=t-a,T=t+a,k=n-a,C=n+a;if(T<0||w>this.width||C<0||k>this.height)return!1;const P=[];return this._forEachCell(w,k,T,C,this._queryCellCircle,P,{hitTest:!0,overlapMode:h,circle:{x:t,y:n,radius:a},seenUids:{box:{},circle:{}}},f),P.length>0}_queryCell(t,n,a,h,f,w,T,k){const{seenUids:C,hitTest:P,overlapMode:M}=T,F=this.boxCells[f];if(F!==null){const W=this.bboxes;for(const Y of F)if(!C.box[Y]){C.box[Y]=!0;const q=4*Y,ie=this.boxKeys[Y];if(t<=W[q+2]&&n<=W[q+3]&&a>=W[q+0]&&h>=W[q+1]&&(!k||k(ie))&&(!P||!Ai(M,ie.overlapMode))&&(w.push({key:ie,x1:W[q],y1:W[q+1],x2:W[q+2],y2:W[q+3]}),P))return!0}}const H=this.circleCells[f];if(H!==null){const W=this.circles;for(const Y of H)if(!C.circle[Y]){C.circle[Y]=!0;const q=3*Y,ie=this.circleKeys[Y];if(this._circleAndRectCollide(W[q],W[q+1],W[q+2],t,n,a,h)&&(!k||k(ie))&&(!P||!Ai(M,ie.overlapMode))){const he=W[q],Q=W[q+1],ae=W[q+2];if(w.push({key:ie,x1:he-ae,y1:Q-ae,x2:he+ae,y2:Q+ae}),P)return!0}}}return!1}_queryCellCircle(t,n,a,h,f,w,T,k){const{circle:C,seenUids:P,overlapMode:M}=T,F=this.boxCells[f];if(F!==null){const W=this.bboxes;for(const Y of F)if(!P.box[Y]){P.box[Y]=!0;const q=4*Y,ie=this.boxKeys[Y];if(this._circleAndRectCollide(C.x,C.y,C.radius,W[q+0],W[q+1],W[q+2],W[q+3])&&(!k||k(ie))&&!Ai(M,ie.overlapMode))return w.push(!0),!0}}const H=this.circleCells[f];if(H!==null){const W=this.circles;for(const Y of H)if(!P.circle[Y]){P.circle[Y]=!0;const q=3*Y,ie=this.circleKeys[Y];if(this._circlesCollide(W[q],W[q+1],W[q+2],C.x,C.y,C.radius)&&(!k||k(ie))&&!Ai(M,ie.overlapMode))return w.push(!0),!0}}}_forEachCell(t,n,a,h,f,w,T,k){const C=this._convertToXCellCoord(t),P=this._convertToYCellCoord(n),M=this._convertToXCellCoord(a),F=this._convertToYCellCoord(h);for(let H=C;H<=M;H++)for(let W=P;W<=F;W++)if(f.call(this,t,n,a,h,this.xCellCount*W+H,w,T,k))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,a,h,f,w){const T=h-t,k=f-n,C=a+w;return C*C>T*T+k*k}_circleAndRectCollide(t,n,a,h,f,w,T){const k=(w-h)/2,C=Math.abs(t-(h+k));if(C>k+a)return!1;const P=(T-f)/2,M=Math.abs(n-(f+P));if(M>P+a)return!1;if(C<=k||M<=P)return!0;const F=C-k,H=M-P;return F*F+H*H<=a*a}}function ht(d,t,n,a,h){const f=l.F();return t?(l.J(f,f,[1/h,1/h,1]),n||l.ad(f,f,a.angle)):l.K(f,a.labelPlaneMatrix,d),f}function Fn(d,t,n,a,h){if(t){const f=l.ae(d);return l.J(f,f,[h,h,1]),n||l.ad(f,f,-a.angle),f}return a.glCoordMatrix}function Ri(d,t,n){let a;n?(a=[d.x,d.y,n(d.x,d.y),1],l.af(a,a,t)):(a=[d.x,d.y,0,1],Qe(a,a,t));const h=a[3];return{point:new l.P(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function J(d,t){return .5+d/t*.5}function z(d,t){const n=d[0]/d[3],a=d[1]/d[3];return n>=-t[0]&&n<=t[0]&&a>=-t[1]&&a<=t[1]}function R(d,t,n,a,h,f,w,T,k,C){const P=a?d.textSizeData:d.iconSizeData,M=l.ag(P,n.transform.zoom),F=[256/n.width*2+1,256/n.height*2+1],H=a?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;H.clear();const W=d.lineVertexArray,Y=a?d.text.placedSymbolArray:d.icon.placedSymbolArray,q=n.transform.width/n.transform.height;let ie=!1;for(let he=0;he<Y.length;he++){const Q=Y.get(he);if(Q.hidden||Q.writingMode===l.ah.vertical&&!ie){ye(Q.numGlyphs,H);continue}let ae;if(ie=!1,C?(ae=[Q.anchorX,Q.anchorY,C(Q.anchorX,Q.anchorY),1],l.af(ae,ae,t)):(ae=[Q.anchorX,Q.anchorY,0,1],Qe(ae,ae,t)),!z(ae,F)){ye(Q.numGlyphs,H);continue}const pe=J(n.transform.cameraToCenterDistance,ae[3]),de=l.ai(P,M,Q),ve=w?de/pe:de*pe,Se=new l.P(Q.anchorX,Q.anchorY),we=Ri(Se,h,C).point,Ce={projections:{},offsets:{}},Ne=re(Q,ve,!1,T,t,h,f,d.glyphOffsetArray,W,H,we,Se,Ce,q,k,C);ie=Ne.useVertical,(Ne.notEnoughRoom||ie||Ne.needsFlipping&&re(Q,ve,!0,T,t,h,f,d.glyphOffsetArray,W,H,we,Se,Ce,q,k,C).notEnoughRoom)&&ye(Q.numGlyphs,H)}a?d.text.dynamicLayoutVertexBuffer.updateData(H):d.icon.dynamicLayoutVertexBuffer.updateData(H)}function j(d,t,n,a,h,f,w,T,k,C,P,M,F){const H=T.glyphStartIndex+T.numGlyphs,W=T.lineStartIndex,Y=T.lineStartIndex+T.lineLength,q=t.getoffsetX(T.glyphStartIndex),ie=t.getoffsetX(H-1),he=be(d*q,n,a,h,f,w,T.segment,W,Y,k,C,P,M,F);if(!he)return null;const Q=be(d*ie,n,a,h,f,w,T.segment,W,Y,k,C,P,M,F);return Q?{first:he,last:Q}:null}function G(d,t,n,a){return d===l.ah.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*a?{useVertical:!0}:(d===l.ah.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function re(d,t,n,a,h,f,w,T,k,C,P,M,F,H,W,Y){const q=t/24,ie=d.lineOffsetX*q,he=d.lineOffsetY*q;let Q;if(d.numGlyphs>1){const ae=d.glyphStartIndex+d.numGlyphs,pe=d.lineStartIndex,de=d.lineStartIndex+d.lineLength,ve=j(q,T,ie,he,n,P,M,d,k,f,F,W,Y);if(!ve)return{notEnoughRoom:!0};const Se=Ri(ve.first.point,w,Y).point,we=Ri(ve.last.point,w,Y).point;if(a&&!n){const Ce=G(d.writingMode,Se,we,H);if(Ce)return Ce}Q=[ve.first];for(let Ce=d.glyphStartIndex+1;Ce<ae-1;Ce++)Q.push(be(q*T.getoffsetX(Ce),ie,he,n,P,M,d.segment,pe,de,k,f,F,W,Y));Q.push(ve.last)}else{if(a&&!n){const pe=Ri(M,h,Y).point,de=d.lineStartIndex+d.segment+1,ve=new l.P(k.getx(de),k.gety(de)),Se=Ri(ve,h,Y),we=Se.signedDistanceFromCamera>0?Se.point:ne(M,ve,pe,1,h,Y),Ce=G(d.writingMode,pe,we,H);if(Ce)return Ce}const ae=be(q*T.getoffsetX(d.glyphStartIndex),ie,he,n,P,M,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,k,f,F,W,Y);if(!ae)return{notEnoughRoom:!0};Q=[ae]}for(const ae of Q)l.aj(C,ae.point,ae.angle);return{}}function ne(d,t,n,a,h,f){const w=Ri(d.add(d.sub(t)._unit()),h,f).point,T=n.sub(w);return n.add(T._mult(a/T.mag()))}function oe(d,t){const{projectionCache:n,lineVertexArray:a,labelPlaneMatrix:h,tileAnchorPoint:f,distanceFromAnchor:w,getElevation:T,previousVertex:k,direction:C,absOffsetX:P}=t;if(n.projections[d])return n.projections[d];const M=new l.P(a.getx(d),a.gety(d)),F=Ri(M,h,T);if(F.signedDistanceFromCamera>0)return n.projections[d]=F.point,F.point;const H=d-C;return ne(w===0?f:new l.P(a.getx(H),a.gety(H)),M,k,P-w+1,h,T)}function te(d,t,n){return d._unit()._perp()._mult(t*n)}function ce(d,t,n,a,h,f,w,T){const{projectionCache:k,direction:C}=T;if(k.offsets[d])return k.offsets[d];const P=n.add(t);if(d+C<a||d+C>=h)return k.offsets[d]=P,P;const M=oe(d+C,T),F=te(M.sub(n),w,C),H=n.add(F),W=M.add(F);return k.offsets[d]=l.ak(f,P,H,W)||P,k.offsets[d]}function be(d,t,n,a,h,f,w,T,k,C,P,M,F,H){const W=a?d-t:d+t;let Y=W>0?1:-1,q=0;a&&(Y*=-1,q=Math.PI),Y<0&&(q+=Math.PI);let ie,he,Q=Y>0?T+w:T+w+1,ae=h,pe=h,de=0,ve=0;const Se=Math.abs(W),we=[];let Ce;for(;de+ve<=Se;){if(Q+=Y,Q<T||Q>=k)return null;de+=ve,pe=ae,he=ie;const De={projectionCache:M,lineVertexArray:C,labelPlaneMatrix:P,tileAnchorPoint:f,distanceFromAnchor:de,getElevation:H,previousVertex:pe,direction:Y,absOffsetX:Se};if(ae=oe(Q,De),n===0)we.push(pe),Ce=ae.sub(pe);else{let tt;const Ze=ae.sub(pe);tt=Ze.mag()===0?te(oe(Q+Y,De).sub(ae),n,Y):te(Ze,n,Y),he||(he=pe.add(tt)),ie=ce(Q,tt,ae,T,k,he,n,De),we.push(he),Ce=ie.sub(he)}ve=Ce.mag()}const Ne=Ce._mult((Se-de)/ve)._add(he||pe),rt=q+Math.atan2(ae.y-pe.y,ae.x-pe.x);return we.push(Ne),{point:Ne,angle:F?rt:0,path:we}}const ge=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ye(d,t){for(let n=0;n<d;n++){const a=t.length;t.resize(a+4),t.float32.set(ge,3*a)}}function Qe(d,t,n){const a=t[0],h=t[1];return d[0]=n[0]*a+n[4]*h+n[12],d[1]=n[1]*a+n[5]*h+n[13],d[3]=n[3]*a+n[7]*h+n[15],d}const et=100;class ut{constructor(t,n=new rn(t.width+200,t.height+200,25),a=new rn(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+et,this.screenBottomBoundary=t.height+et,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,a,h,f,w){const T=this.projectAndGetPerspectiveRatio(h,t.anchorPointX,t.anchorPointY,w),k=a*T.perspectiveRatio,C=t.x1*k+T.point.x,P=t.y1*k+T.point.y,M=t.x2*k+T.point.x,F=t.y2*k+T.point.y;return!this.isInsideGrid(C,P,M,F)||n!=="always"&&this.grid.hitTest(C,P,M,F,n,f)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,P,M,F],offscreen:this.isOffscreen(C,P,M,F)}}placeCollisionCircles(t,n,a,h,f,w,T,k,C,P,M,F,H,W){const Y=[],q=new l.P(n.anchorX,n.anchorY),ie=Ri(q,w,W),he=J(this.transform.cameraToCenterDistance,ie.signedDistanceFromCamera),Q=(P?f/he:f*he)/l.ao,ae=Ri(q,T,W).point,pe=j(Q,h,n.lineOffsetX*Q,n.lineOffsetY*Q,!1,ae,q,n,a,T,{projections:{},offsets:{}},!1,W);let de=!1,ve=!1,Se=!0;if(pe){const we=.5*F*he+H,Ce=new l.P(-100,-100),Ne=new l.P(this.screenRightBoundary,this.screenBottomBoundary),rt=new pt,De=pe.first,tt=pe.last;let Ze=[];for(let mt=De.path.length-1;mt>=1;mt--)Ze.push(De.path[mt]);for(let mt=1;mt<tt.path.length;mt++)Ze.push(tt.path[mt]);const ii=2.5*we;if(k){const mt=Ze.map(wt=>Ri(wt,k,W));Ze=mt.some(wt=>wt.signedDistanceFromCamera<=0)?[]:mt.map(wt=>wt.point)}let bt=[];if(Ze.length>0){const mt=Ze[0].clone(),wt=Ze[0].clone();for(let ki=1;ki<Ze.length;ki++)mt.x=Math.min(mt.x,Ze[ki].x),mt.y=Math.min(mt.y,Ze[ki].y),wt.x=Math.max(wt.x,Ze[ki].x),wt.y=Math.max(wt.y,Ze[ki].y);bt=mt.x>=Ce.x&&wt.x<=Ne.x&&mt.y>=Ce.y&&wt.y<=Ne.y?[Ze]:wt.x<Ce.x||mt.x>Ne.x||wt.y<Ce.y||mt.y>Ne.y?[]:l.al([Ze],Ce.x,Ce.y,Ne.x,Ne.y)}for(const mt of bt){rt.reset(mt,.25*we);let wt=0;wt=rt.length<=.5*we?1:Math.ceil(rt.paddedLength/ii)+1;for(let ki=0;ki<wt;ki++){const Xt=ki/Math.max(wt-1,1),pr=rt.lerp(Xt),Xi=pr.x+et,xi=pr.y+et;Y.push(Xi,xi,we,0);const nr=Xi-we,sr=xi-we,Zr=Xi+we,En=xi+we;if(Se=Se&&this.isOffscreen(nr,sr,Zr,En),ve=ve||this.isInsideGrid(nr,sr,Zr,En),t!=="always"&&this.grid.hitTestCircle(Xi,xi,we,t,M)&&(de=!0,!C))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!C&&de||!ve||he<this.perspectiveRatioCutoff?[]:Y,offscreen:Se,collisionDetected:de}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,h=1/0,f=-1/0,w=-1/0;for(const P of t){const M=new l.P(P.x+et,P.y+et);a=Math.min(a,M.x),h=Math.min(h,M.y),f=Math.max(f,M.x),w=Math.max(w,M.y),n.push(M)}const T=this.grid.query(a,h,f,w).concat(this.ignoredGrid.query(a,h,f,w)),k={},C={};for(const P of T){const M=P.key;if(k[M.bucketInstanceId]===void 0&&(k[M.bucketInstanceId]={}),k[M.bucketInstanceId][M.featureIndex])continue;const F=[new l.P(P.x1,P.y1),new l.P(P.x2,P.y1),new l.P(P.x2,P.y2),new l.P(P.x1,P.y2)];l.am(n,F)&&(k[M.bucketInstanceId][M.featureIndex]=!0,C[M.bucketInstanceId]===void 0&&(C[M.bucketInstanceId]=[]),C[M.bucketInstanceId].push(M.featureIndex))}return C}insertCollisionBox(t,n,a,h,f,w){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:f,collisionGroupID:w,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,a,h,f,w){const T=a?this.ignoredGrid:this.grid,k={bucketInstanceId:h,featureIndex:f,collisionGroupID:w,overlapMode:n};for(let C=0;C<t.length;C+=4)T.insertCircle(k,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,n,a,h){let f;return h?(f=[n,a,h(n,a),1],l.af(f,f,t)):(f=[n,a,0,1],Qe(f,f,t)),{point:new l.P((f[0]/f[3]+1)/2*this.transform.width+et,(-f[1]/f[3]+1)/2*this.transform.height+et),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,n,a,h){return a<et||t>=this.screenRightBoundary||h<et||n>this.screenBottomBoundary}isInsideGrid(t,n,a,h){return a>=0&&t<this.gridRightBoundary&&h>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=l.an([]);return l.H(t,t,[-100,-100,0]),t}}function lt(d,t,n){return t*(l.W/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class At{constructor(t,n,a,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):h&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Kt{constructor(t,n,a,h,f){this.text=new At(t?t.text:null,n,a,f),this.icon=new At(t?t.icon:null,n,h,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hi{constructor(t,n,a){this.text=t,this.icon=n,this.skipFade=a}}class Ei{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class ft{constructor(t,n,a,h,f){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=f}}class _i{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[t]}}function Oi(d,t,n,a,h){const{horizontalAlign:f,verticalAlign:w}=l.at(d);return new l.P(-(f-.5)*t+a[0]*h,-(w-.5)*n+a[1]*h)}function cr(d,t,n,a,h,f){const{x1:w,x2:T,y1:k,y2:C,anchorPointX:P,anchorPointY:M}=d,F=new l.P(t,n);return a&&F._rotate(h?f:-f),{x1:w+F.x,y1:k+F.y,x2:T+F.x,y2:C+F.y,anchorPointX:P,anchorPointY:M}}class vr{constructor(t,n,a,h,f){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new ut(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new _i(h),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,a,h){const f=a.getBucket(n),w=a.latestFeatureIndex;if(!f||!w||n.id!==f.layerIds[0])return;const T=a.collisionBoxArray,k=f.layers[0].layout,C=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),P=a.tileSize/l.W,M=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),F=k.get("text-pitch-alignment")==="map",H=k.get("text-rotation-alignment")==="map",W=lt(a,1,this.transform.zoom),Y=ht(M,F,H,this.transform,W);let q=null;if(F){const he=Fn(M,F,H,this.transform,W);q=l.K([],this.transform.labelPlaneMatrix,he)}this.retainedQueryData[f.bucketInstanceId]=new ft(f.bucketInstanceId,w,f.sourceLayerIndex,f.index,a.tileID);const ie={bucket:f,layout:k,posMatrix:M,textLabelPlaneMatrix:Y,labelToScreenMatrix:q,scale:C,textPixelRatio:P,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:l.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(h)for(const he of f.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ae,symbolInstanceEnd:pe}=he;t.push({sortKey:Q,symbolInstanceStart:ae,symbolInstanceEnd:pe,parameters:ie})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(t,n,a,h,f,w,T,k,C,P,M,F,H,W,Y,q){const ie=l.ap[t.textAnchor],he=[t.textOffset0,t.textOffset1],Q=Oi(ie,a,h,he,f),ae=this.collisionIndex.placeCollisionBox(cr(n,Q.x,Q.y,w,T,this.transform.angle),M,k,C,P.predicate,q);if((!Y||this.collisionIndex.placeCollisionBox(cr(Y,Q.x,Q.y,w,T,this.transform.angle),M,k,C,P.predicate,q).box.length!==0)&&ae.box.length>0){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:he,width:a,height:h,anchor:ie,textBoxScale:f,prevAnchor:pe},this.markUsedJustification(H,ie,F,W),H.allowVerticalPlacement&&(this.markUsedOrientation(H,W,F),this.placedOrientations[F.crossTileID]=W),{shift:Q,placedGlyphBoxes:ae}}}placeLayerBucketPart(t,n,a){const{bucket:h,layout:f,posMatrix:w,textLabelPlaneMatrix:T,labelToScreenMatrix:k,textPixelRatio:C,holdingForFade:P,collisionBoxArray:M,partiallyEvaluatedTextSize:F,collisionGroup:H}=t.parameters,W=f.get("text-optional"),Y=f.get("icon-optional"),q=l.aq(f,"text-overlap","text-allow-overlap"),ie=q==="always",he=l.aq(f,"icon-overlap","icon-allow-overlap"),Q=he==="always",ae=f.get("text-rotation-alignment")==="map",pe=f.get("text-pitch-alignment")==="map",de=f.get("icon-text-fit")!=="none",ve=f.get("symbol-z-order")==="viewport-y",Se=ie&&(Q||!h.hasIconData()||Y),we=Q&&(ie||!h.hasTextData()||W);!h.collisionArrays&&M&&h.deserializeCollisionBoxes(M);const Ce=this.retainedQueryData[h.bucketInstanceId].tileID,Ne=this.terrain?(De,tt)=>this.terrain.getElevation(Ce,De,tt):null,rt=(De,tt)=>{var Ze,ii;if(n[De.crossTileID])return;if(P)return void(this.placements[De.crossTileID]=new hi(!1,!1,!1));let bt=!1,mt=!1,wt=!0,ki=null,Xt={box:null,offscreen:null},pr={box:null,offscreen:null},Xi=null,xi=null,nr=null,sr=0,Zr=0,En=0;tt.textFeatureIndex?sr=tt.textFeatureIndex:De.useRuntimeCollisionCircles&&(sr=De.featureIndex),tt.verticalTextFeatureIndex&&(Zr=tt.verticalTextFeatureIndex);const xs=tt.textBox;if(xs){const Fi=ri=>{let Bi=l.ah.horizontal;if(h.allowVerticalPlacement&&!ri&&this.prevPlacement){const Ji=this.prevPlacement.placedOrientations[De.crossTileID];Ji&&(this.placedOrientations[De.crossTileID]=Ji,Bi=Ji,this.markUsedOrientation(h,Bi,De))}return Bi},Ii=(ri,Bi)=>{if(h.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&tt.verticalTextBox){for(const Ji of h.writingModes)if(Ji===l.ah.vertical?(Xt=Bi(),pr=Xt):Xt=ri(),Xt&&Xt.box&&Xt.box.length)break}else Xt=ri()},bi=De.textAnchorOffsetStartIndex,fr=De.textAnchorOffsetEndIndex;if(fr===bi){const ri=(Bi,Ji)=>{const ji=this.collisionIndex.placeCollisionBox(Bi,q,C,w,H.predicate,Ne);return ji&&ji.box&&ji.box.length&&(this.markUsedOrientation(h,Ji,De),this.placedOrientations[De.crossTileID]=Ji),ji};Ii(()=>ri(xs,l.ah.horizontal),()=>{const Bi=tt.verticalTextBox;return h.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&Bi?ri(Bi,l.ah.vertical):{box:null,offscreen:null}}),Fi(Xt&&Xt.box&&Xt.box.length)}else{let ri=l.ap[(ii=(Ze=this.prevPlacement)===null||Ze===void 0?void 0:Ze.variableOffsets[De.crossTileID])===null||ii===void 0?void 0:ii.anchor];const Bi=(ji,wc,wi)=>{const hl=ji.x2-ji.x1,Sc=ji.y2-ji.y1,Xn=De.textBoxScale,Jn=de&&he==="never"?wc:null;let gn={box:[],offscreen:!1},Ja=q==="never"?1:2,ul="never";ri&&Ja++;for(let Tc=0;Tc<Ja;Tc++){for(let Ya=bi;Ya<fr;Ya++){const kc=h.textAnchorOffsets.get(Ya);if(ri&&kc.textAnchor!==ri)continue;const $s=this.attemptAnchorPlacement(kc,ji,hl,Sc,Xn,ae,pe,C,w,H,ul,De,h,wi,Jn,Ne);if($s&&(gn=$s.placedGlyphBoxes,gn&&gn.box&&gn.box.length))return bt=!0,ki=$s.shift,gn}ri?ri=null:ul=q}return gn};Ii(()=>Bi(xs,tt.iconBox,l.ah.horizontal),()=>{const ji=tt.verticalTextBox;return h.allowVerticalPlacement&&!(Xt&&Xt.box&&Xt.box.length)&&De.numVerticalGlyphVertices>0&&ji?Bi(ji,tt.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),Xt&&(bt=Xt.box,wt=Xt.offscreen);const Ji=Fi(Xt&&Xt.box);if(!bt&&this.prevPlacement){const ji=this.prevPlacement.variableOffsets[De.crossTileID];ji&&(this.variableOffsets[De.crossTileID]=ji,this.markUsedJustification(h,ji.anchor,De,Ji))}}}if(Xi=Xt,bt=Xi&&Xi.box&&Xi.box.length>0,wt=Xi&&Xi.offscreen,De.useRuntimeCollisionCircles){const Fi=h.text.placedSymbolArray.get(De.centerJustifiedTextSymbolIndex),Ii=l.ai(h.textSizeData,F,Fi),bi=f.get("text-padding");xi=this.collisionIndex.placeCollisionCircles(q,Fi,h.lineVertexArray,h.glyphOffsetArray,Ii,w,T,k,a,pe,H.predicate,De.collisionCircleDiameter,bi,Ne),xi.circles.length&&xi.collisionDetected&&!a&&l.w("Collisions detected, but collision boxes are not shown"),bt=ie||xi.circles.length>0&&!xi.collisionDetected,wt=wt&&xi.offscreen}if(tt.iconFeatureIndex&&(En=tt.iconFeatureIndex),tt.iconBox){const Fi=Ii=>{const bi=de&&ki?cr(Ii,ki.x,ki.y,ae,pe,this.transform.angle):Ii;return this.collisionIndex.placeCollisionBox(bi,he,C,w,H.predicate,Ne)};pr&&pr.box&&pr.box.length&&tt.verticalIconBox?(nr=Fi(tt.verticalIconBox),mt=nr.box.length>0):(nr=Fi(tt.iconBox),mt=nr.box.length>0),wt=wt&&nr.offscreen}const bs=W||De.numHorizontalGlyphVertices===0&&De.numVerticalGlyphVertices===0,Pn=Y||De.numIconVertices===0;if(bs||Pn?Pn?bs||(mt=mt&&bt):bt=mt&&bt:mt=bt=mt&&bt,bt&&Xi&&Xi.box&&this.collisionIndex.insertCollisionBox(Xi.box,q,f.get("text-ignore-placement"),h.bucketInstanceId,pr&&pr.box&&Zr?Zr:sr,H.ID),mt&&nr&&this.collisionIndex.insertCollisionBox(nr.box,he,f.get("icon-ignore-placement"),h.bucketInstanceId,En,H.ID),xi&&(bt&&this.collisionIndex.insertCollisionCircles(xi.circles,q,f.get("text-ignore-placement"),h.bucketInstanceId,sr,H.ID),a)){const Fi=h.bucketInstanceId;let Ii=this.collisionCircleArrays[Fi];Ii===void 0&&(Ii=this.collisionCircleArrays[Fi]=new Ei);for(let bi=0;bi<xi.circles.length;bi+=4)Ii.circles.push(xi.circles[bi+0]),Ii.circles.push(xi.circles[bi+1]),Ii.circles.push(xi.circles[bi+2]),Ii.circles.push(xi.collisionDetected?1:0)}if(De.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[De.crossTileID]=new hi(bt||Se,mt||we,wt||h.justReloaded),n[De.crossTileID]=!0};if(ve){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const De=h.getSortedSymbolIndexes(this.transform.angle);for(let tt=De.length-1;tt>=0;--tt){const Ze=De[tt];rt(h.symbolInstances.get(Ze),h.collisionArrays[Ze])}}else for(let De=t.symbolInstanceStart;De<t.symbolInstanceEnd;De++)rt(h.symbolInstances.get(De),h.collisionArrays[De]);if(a&&h.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[h.bucketInstanceId];l.ar(De.invProjMatrix,w),De.viewportMatrix=this.collisionIndex.getViewportMatrix()}h.justReloaded=!1}markUsedJustification(t,n,a,h){let f;f=h===l.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[l.as(n)];const w=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const T of w)T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=f>=0&&T!==f?0:a.crossTileID)}markUsedOrientation(t,n,a){const h=n===l.ah.horizontal||n===l.ah.horizontalOnly?n:0,f=n===l.ah.vertical?n:0,w=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const T of w)t.text.placedSymbolArray.get(T).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const h=n?n.symbolFadeChange(t):1,f=n?n.opacities:{},w=n?n.variableOffsets:{},T=n?n.placedOrientations:{};for(const k in this.placements){const C=this.placements[k],P=f[k];P?(this.opacities[k]=new Kt(P,h,C.text,C.icon),a=a||C.text!==P.text.placed||C.icon!==P.icon.placed):(this.opacities[k]=new Kt(null,h,C.text,C.icon,C.skipFade),a=a||C.text||C.icon)}for(const k in f){const C=f[k];if(!this.opacities[k]){const P=new Kt(C,h,!1,!1);P.isHidden()||(this.opacities[k]=P,a=a||C.text.placed||C.icon.placed)}}for(const k in w)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=w[k]);for(const k in T)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=T[k]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const a={};for(const h of n){const f=h.getBucket(t);f&&h.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,a,h.collisionBoxArray)}}updateBucketOpacities(t,n,a){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const h=t.layers[0],f=h.layout,w=new Kt(null,0,!1,!1,!0),T=f.get("text-allow-overlap"),k=f.get("icon-allow-overlap"),C=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),P=f.get("text-rotation-alignment")==="map",M=f.get("text-pitch-alignment")==="map",F=f.get("icon-text-fit")!=="none",H=new Kt(null,0,T&&(k||!t.hasIconData()||f.get("icon-optional")),k&&(T||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&a&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(a);const W=(Y,q,ie)=>{for(let he=0;he<q/4;he++)Y.opacityVertexArray.emplaceBack(ie);Y.hasVisibleVertices=Y.hasVisibleVertices||ie!==Ms};for(let Y=0;Y<t.symbolInstances.length;Y++){const q=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:he,crossTileID:Q}=q;let ae=this.opacities[Q];n[Q]?ae=w:ae||(ae=H,this.opacities[Q]=ae),n[Q]=!0;const pe=q.numIconVertices>0,de=this.placedOrientations[q.crossTileID],ve=de===l.ah.vertical,Se=de===l.ah.horizontal||de===l.ah.horizontalOnly;if(ie>0||he>0){const we=xr(ae.text);W(t.text,ie,ve?Ms:we),W(t.text,he,Se?Ms:we);const Ce=ae.text.isHidden();[q.rightJustifiedTextSymbolIndex,q.centerJustifiedTextSymbolIndex,q.leftJustifiedTextSymbolIndex].forEach(De=>{De>=0&&(t.text.placedSymbolArray.get(De).hidden=Ce||ve?1:0)}),q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(q.verticalPlacedTextSymbolIndex).hidden=Ce||Se?1:0);const Ne=this.variableOffsets[q.crossTileID];Ne&&this.markUsedJustification(t,Ne.anchor,q,de);const rt=this.placedOrientations[q.crossTileID];rt&&(this.markUsedJustification(t,"left",q,rt),this.markUsedOrientation(t,rt,q))}if(pe){const we=xr(ae.icon),Ce=!(F&&q.verticalPlacedIconSymbolIndex&&ve);q.placedIconSymbolIndex>=0&&(W(t.icon,q.numIconVertices,Ce?we:Ms),t.icon.placedSymbolArray.get(q.placedIconSymbolIndex).hidden=ae.icon.isHidden()),q.verticalPlacedIconSymbolIndex>=0&&(W(t.icon,q.numVerticalIconVertices,Ce?Ms:we),t.icon.placedSymbolArray.get(q.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const we=t.collisionArrays[Y];if(we){let Ce=new l.P(0,0);if(we.textBox||we.verticalTextBox){let rt=!0;if(C){const De=this.variableOffsets[Q];De?(Ce=Oi(De.anchor,De.width,De.height,De.textOffset,De.textBoxScale),P&&Ce._rotate(M?this.transform.angle:-this.transform.angle)):rt=!1}we.textBox&&Ki(t.textCollisionBox.collisionVertexArray,ae.text.placed,!rt||ve,Ce.x,Ce.y),we.verticalTextBox&&Ki(t.textCollisionBox.collisionVertexArray,ae.text.placed,!rt||Se,Ce.x,Ce.y)}const Ne=!!(!Se&&we.verticalIconBox);we.iconBox&&Ki(t.iconCollisionBox.collisionVertexArray,ae.icon.placed,Ne,F?Ce.x:0,F?Ce.y:0),we.verticalIconBox&&Ki(t.iconCollisionBox.collisionVertexArray,ae.icon.placed,!Ne,F?Ce.x:0,F?Ce.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Y.invProjMatrix,t.placementViewportMatrix=Y.viewportMatrix,t.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function Ki(d,t,n,a,h){d.emplaceBack(t?1:0,n?1:0,a||0,h||0),d.emplaceBack(t?1:0,n?1:0,a||0,h||0),d.emplaceBack(t?1:0,n?1:0,a||0,h||0),d.emplaceBack(t?1:0,n?1:0,a||0,h||0)}const nn=Math.pow(2,25),Ul=Math.pow(2,24),sh=Math.pow(2,17),Gt=Math.pow(2,16),Ao=Math.pow(2,9),Eo=Math.pow(2,8),Mr=Math.pow(2,1);function xr(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,n=Math.floor(127*d.opacity);return n*nn+t*Ul+n*sh+t*Gt+n*Ao+t*Eo+n*Mr+t}const Ms=0;class Vr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,a,h,f){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(w,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((T,k)=>T.sortKey-k.sortKey));this._currentPartIndex<w.length;)if(n.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,f())return!0;return!1}}class Nr{constructor(t,n,a,h,f,w,T,k){this.placement=new vr(t,n,w,T,k),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,n,a){const h=Z.now(),f=()=>!this._forceFullPlacement&&Z.now()-h>2;for(;this._currentPlacementIndex>=0;){const w=n[t[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=T)&&(!w.maxzoom||w.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Vr(w)),this._inProgressLayer.continuePlacement(a[w.source],this.placement,this._showCollisionBoxes,w,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const cs=512/l.W/2;class fa{constructor(t,n,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};const h=new Map;for(let f=0;f<n.length;f++){const w=n.get(f),T=w.key,k=h.get(T);k?k.push(w):h.set(T,[w])}for(const[f,w]of h){const T={positions:w.map(k=>({x:Math.floor(k.anchorX*cs),y:Math.floor(k.anchorY*cs)})),crossTileIDs:w.map(k=>k.crossTileID)};if(T.positions.length>128){const k=new l.au(T.positions.length,16,Uint16Array);for(const{x:C,y:P}of T.positions)k.add(C,P);k.finish(),delete T.positions,T.index=k}this._symbolsByKey[f]=T}}getScaledCoordinates(t,n){const{x:a,y:h,z:f}=this.tileID.canonical,{x:w,y:T,z:k}=n.canonical,C=cs/Math.pow(2,k-f),P=(T*l.W+t.anchorY)*C,M=h*l.W*cs;return{x:Math.floor((w*l.W+t.anchorX)*C-a*l.W*cs),y:Math.floor(P-M)}}findMatches(t,n,a){const h=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let f=0;f<t.length;f++){const w=t.get(f);if(w.crossTileID)continue;const T=this._symbolsByKey[w.key];if(!T)continue;const k=this.getScaledCoordinates(w,n);if(T.index){const C=T.index.range(k.x-h,k.y-h,k.x+h,k.y+h).sort();for(const P of C){const M=T.crossTileIDs[P];if(!a[M]){a[M]=!0,w.crossTileID=M;break}}}else if(T.positions)for(let C=0;C<T.positions.length;C++){const P=T.positions[C],M=T.crossTileIDs[C];if(Math.abs(P.x-k.x)<=h&&Math.abs(P.y-k.y)<=h&&!a[M]){a[M]=!0,w.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Pi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const a in this.indexes){const h=this.indexes[a],f={};for(const w in h){const T=h[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+n),f[T.tileID.key]=T}this.indexes[a]=f}this.lng=t}addBucket(t,n,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<n.symbolInstances.length;f++)n.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const w=this.indexes[f];if(Number(f)>t.overscaledZ)for(const T in w){const k=w[T];k.tileID.isChildOf(t)&&k.findMatches(n.symbolInstances,t,h)}else{const T=w[t.scaledTo(Number(f)).key];T&&T.findMatches(n.symbolInstances,t,h)}}for(let f=0;f<n.symbolInstances.length;f++){const w=n.symbolInstances.get(f);w.crossTileID||(w.crossTileID=a.generate(),h[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new fa(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const a of n.getCrossTileIDsLists())for(const h of a)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let n=!1;for(const a in this.indexes){const h=this.indexes[a];for(const f in h)t[h[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[f]),delete h[f],n=!0)}return n}}class Tn{constructor(){this.layerIndexes={},this.crossTileIDs=new Pi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,a){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new zs);let f=!1;const w={};h.handleWrapJump(a);for(const T of n){const k=T.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(T.tileID,k,this.crossTileIDs)&&(f=!0),w[k.bucketInstanceId]=!0)}return h.removeStaleBuckets(w)&&(f=!0),f}pruneUnusedLayers(t){const n={};t.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const pi=(d,t)=>l.t(d,t&&t.filter(n=>n.identifier!=="source.canvas")),ma=l.av();class zr extends l.E{constructor(t,n={}){super(),this._rtlTextPluginStateChange=()=>{for(const a in this.sourceCaches){const h=this.sourceCaches[a].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[a].reload()}},this.map=t,this.dispatcher=new ot(Ee(),t._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(a,h)=>this.getGlyphs(a,h)),this.dispatcher.registerMessageHandler("getImages",(a,h)=>this.getImages(a,h)),this.imageManager=new Wt,this.imageManager.setEventedParent(this),this.glyphManager=new ct(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Ut(256,512),this.crossTileSymbolIndex=new Tn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.ax()),Pe().on("pluginStateChange",this._rtlTextPluginStateChange),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const h=this.sourceCaches[a.sourceId];if(!h)return;const f=h.getSource();if(f&&f.vectorLayerIds)for(const w in this._layers){const T=this._layers[w];T.source===f.id&&this._validateLayer(T)}})}loadURL(t,n={},a){this.fire(new l.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const h=this.map._requestManager.transformRequest(t,Ie.Style);this._loadStyleRequest=new AbortController,l.h(h,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,n,a)}).catch(f=>{this._loadStyleRequest=null,f&&this.fire(new l.j(f))})}loadJSON(t,n={},a){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Z.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(ma,{validate:!1})}_load(t,n,a){var h;const f=n.transformStyle?n.transformStyle(a,t):t;if(!n.validate||!pi(this,l.x(f))){this._loaded=!0,this.stylesheet=f;for(const w in f.sources)this.addSource(w,f.sources[w],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new Nt(this.stylesheet.light),this.map.setTerrain((h=this.stylesheet.terrain)!==null&&h!==void 0?h:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const t=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const a=l.az(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(t,n=!1,a=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,w,T,k){return l._(this,void 0,void 0,function*(){const C=_e(f),P=T>1?"@2x":"",M={},F={};for(const{id:H,url:W}of C){const Y=w.transformRequest(w.normalizeSpriteURL(W,P,".json"),Ie.SpriteJSON);M[H]=l.h(Y,k);const q=w.transformRequest(w.normalizeSpriteURL(W,P,".png"),Ie.SpriteImage);F[H]=Ye.getImage(q,k)}return yield Promise.all([...Object.values(M),...Object.values(F)]),function(H,W){return l._(this,void 0,void 0,function*(){const Y={};for(const q in H){Y[q]={};const ie=Z.getImageCanvasContext((yield W[q]).data),he=(yield H[q]).data;for(const Q in he){const{width:ae,height:pe,x:de,y:ve,sdf:Se,pixelRatio:we,stretchX:Ce,stretchY:Ne,content:rt}=he[Q];Y[q][Q]={data:null,pixelRatio:we,sdf:Se,stretchX:Ce,stretchY:Ne,content:rt,spriteData:{width:ae,height:pe,x:de,y:ve,context:ie}}}}return Y})}(M,F)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const w in f){this._spritesImagesIds[w]=[];const T=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter(k=>!(k in f)):[];for(const k of T)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in f[w]){const C=w==="default"?k:`${w}:${k}`;this._spritesImagesIds[w].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,f[w][k],!1):this.imageManager.addImage(C,f[w][k]),n&&(this._changedImages[C]=!0)}}}).catch(f=>{this._spriteRequest=null,h=f,this.fire(new l.j(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),a&&a(h)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const a=t.sourceLayer;if(!a)return;const h=n.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(a)===-1)&&this.fire(new l.j(new Error(`Source layer "${a}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const a=[];for(const h of t)n[h]&&a.push(n[h]);return a}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const h=this._layers[a];h.type!=="custom"&&(t[a]=h.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const h=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(h.length||f.length)&&this._updateWorkerLayers(h,f);for(const w in this._updatedSources){const T=this._updatedSources[w];if(T==="reload")this._reloadSource(w);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const a={};for(const h in this.sourceCaches){const f=this.sourceCaches[h];a[h]=f.used,f.used=!1}for(const h of this._order){const f=this._layers[h];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const h in a){const f=this.sourceCaches[h];a[h]!==f.used&&f.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const a=this.serialize();if(t=n.transformStyle?n.transformStyle(a,t):t,pi(this,l.x(t)))return!1;(t=l.aA(t)).layers=l.ay(t.layers);const h=l.aB(a,t),f=this._getOperationsToPerform(h);if(f.unimplemented.length>0)throw new Error(`Unimplemented: ${f.unimplemented.join(", ")}.`);if(f.operations.length===0)return!1;for(const w of f.operations)w();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const n=[],a=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":n.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":n.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setTransition":n.push(()=>{});break;default:a.push(h.command)}return{operations:n,unimplemented:a}}addImage(t,n){if(this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(l.x.source,`sources.${t}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const h=this.sourceCaches[t]=new ir(t,n,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===t)return this.fire(new l.j(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,a={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new l.j(new Error(`Layer "${h}" already exists on this map.`)));let f;if(t.type==="custom"){if(pi(this,l.aC(t)))return;f=l.az(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=l.aA(t),t=l.e(t,{source:h})),this._validate(l.x.layer,`layers.${h}`,t,{arrayIndex:-1},a))return;f=l.az(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:h}})}const w=n?this._order.indexOf(n):this._order.length;if(n&&w===-1)this.fire(new l.j(new Error(`Cannot add layer "${h}" before non-existing layer "${n}".`)));else{if(this._order.splice(w,0,h),this._layerOrderChanged=!0,this._layers[h]=f,this._removedLayers[h]&&f.source&&f.type!=="custom"){const T=this._removedLayers[h];delete this._removedLayers[h],T.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const a=this._order.indexOf(t);this._order.splice(a,1);const h=n?this._order.indexOf(n):this._order.length;n&&h===-1?this.fire(new l.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,a){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===n&&h.maxzoom===a||(n!=null&&(h.minzoom=n),a!=null&&(h.maxzoom=a),this._updateLayer(h)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,a={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!l.aD(h.filter,n))return n==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(l.x.filter,`layers.${h.id}.filter`,n,null,a)||(h.filter=l.aA(n),this._updateLayer(h)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.aA(this.getLayer(t).filter)}setLayoutProperty(t,n,a,h={}){this._checkLoaded();const f=this.getLayer(t);f?l.aD(f.getLayoutProperty(n),a)||(f.setLayoutProperty(n,a,h),this._updateLayer(f)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const a=this.getLayer(t);if(a)return a.getLayoutProperty(n);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,a,h={}){this._checkLoaded();const f=this.getLayer(t);f?l.aD(f.getPaintProperty(n),a)||(f.setPaintProperty(n,a,h)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const a=t.source,h=t.sourceLayer,f=this.sourceCaches[a];if(f===void 0)return void this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)));const w=f.getSource().type;w==="geojson"&&h?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||h?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(h,t.id,n)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const a=t.source,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)));const f=h.getSource().type,w=f==="vector"?t.sourceLayer:void 0;f!=="vector"||w?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(w,t.id,n):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,a=t.sourceLayer,h=this.sourceCaches[n];if(h!==void 0)return h.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),h.getFeatureState(a,t.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.aE(this.sourceCaches,f=>f.serialize()),n=this._serializeByIds(this._order),a=this.map.getTerrain()||void 0,h=this.stylesheet;return l.aF({version:h.version,name:h.name,metadata:h.metadata,light:h.light,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,sources:t,layers:n,terrain:a},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=w=>this._layers[w].type==="fill-extrusion",a={},h=[];for(let w=this._order.length-1;w>=0;w--){const T=this._order[w];if(n(T)){a[T]=w;for(const k of t){const C=k[T];if(C)for(const P of C)h.push(P)}}}h.sort((w,T)=>T.intersectionZ-w.intersectionZ);const f=[];for(let w=this._order.length-1;w>=0;w--){const T=this._order[w];if(n(T))for(let k=h.length-1;k>=0;k--){const C=h[k].feature;if(a[C.layer.id]<w)break;f.push(C),h.pop()}else for(const k of t){const C=k[T];if(C)for(const P of C)f.push(P.feature)}}return f}queryRenderedFeatures(t,n,a){n&&n.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",n.filter,null,n);const h={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const T of n.layers){const k=this._layers[T];if(!k)return this.fire(new l.j(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];h[k.source]=!0}}const f=[];n.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const T in this.sourceCaches)n.layers&&!h[T]||f.push(Er(this.sourceCaches[T],this._layers,w,t,n,a));return this.placement&&f.push(function(T,k,C,P,M,F,H){const W={},Y=F.queryRenderedSymbols(P),q=[];for(const ie of Object.keys(Y).map(Number))q.push(H[ie]);q.sort(ue);for(const ie of q){const he=ie.featureIndex.lookupSymbolFeatures(Y[ie.bucketInstanceId],k,ie.bucketIndex,ie.sourceLayerIndex,M.filter,M.layers,M.availableImages,T);for(const Q in he){const ae=W[Q]=W[Q]||[],pe=he[Q];pe.sort((de,ve)=>{const Se=ie.featureSortOrder;if(Se){const we=Se.indexOf(de.featureIndex);return Se.indexOf(ve.featureIndex)-we}return ve.featureIndex-de.featureIndex});for(const de of pe)ae.push(de)}}for(const ie in W)W[ie].forEach(he=>{const Q=he.feature,ae=C[T[ie].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ae});return W}(this._layers,w,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,n){n&&n.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[t];return a?function(h,f){const w=h.getRenderableIds().map(C=>h.getTileByID(C)),T=[],k={};for(let C=0;C<w.length;C++){const P=w[C],M=P.tileID.canonical.key;k[M]||(k[M]=!0,P.querySourceFeatures(T,f))}return T}(a,n):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const a=this.light.getLight();let h=!1;for(const w in t)if(!l.aD(t[w],a[w])){h=!0;break}if(!h)return;const f={now:Z.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(f)}_validate(t,n,a,h,f={}){return(!f||f.validate!==!1)&&pi(this,t.call(l.x,l.e({key:n,style:this.serialize(),value:a,styleSpec:l.v},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Pe().off("pluginStateChange",this._rtlTextPluginStateChange);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,a,h,f=!1){let w=!1,T=!1;const k={};for(const C of this._order){const P=this._layers[C];if(P.type!=="symbol")continue;if(!k[P.source]){const F=this.sourceCaches[P.source];k[P.source]=F.getRenderableIds(!0).map(H=>F.getTileByID(H)).sort((H,W)=>W.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(W.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(P,k[P.source],t.center.lng);w=w||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Z.now(),t.zoom))&&(this.pauseablePlacement=new Nr(t,this.map.terrain,this._order,f,n,a,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Z.now()),T=!0),w&&this.pauseablePlacement.placement.setStale()),T||w)for(const C of this._order){const P=this._layers[C];P.type==="symbol"&&this.placement.updateLayerOpacities(P,k[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Z.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n){return l._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[n.source];return h&&h.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(t,n){return l._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),h=this.sourceCaches[n.source];return h&&h.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(l.x.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,a={},h){this._checkLoaded();const f=[{id:t,url:n}],w=[..._e(this.stylesheet.sprite),...f];this._validate(l.x.sprite,"sprite",w,null,a)||(this.stylesheet.sprite=w,this._loadSprite(f,!0,h))}removeSprite(t){this._checkLoaded();const n=_e(this.stylesheet.sprite);if(n.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(const a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return _e(this.stylesheet.sprite)}setSprite(t,n={},a){this._checkLoaded(),t&&this._validate(l.x.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}var ga=l.X([{name:"a_pos",type:"Int16",components:2}]),sn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ls={prelude:Ht(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ht(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ht(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ht(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ht("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ht(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ht(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ht("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ht("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ht("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ht(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ht(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ht(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ht(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ht(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ht(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ht(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ht(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ht(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ht(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ht(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ht(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ht(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ht(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ht("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",sn),terrainDepth:Ht("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",sn),terrainCoords:Ht("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",sn)};function Ht(d,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/attribute ([\w]+) ([\w]+)/g),h=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f?f.concat(h):h,T={};return{fragmentSource:d=d.replace(n,(k,C,P,M,F)=>(T[F]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${P} ${M} ${F};
#else
uniform ${P} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${P} ${M} ${F} = u_${F};
#endif
`)),vertexSource:t=t.replace(n,(k,C,P,M,F)=>{const H=M==="float"?"vec2":"vec4",W=F.match(/color/)?"color":H;return T[F]?C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${P} ${H} a_${F};
varying ${P} ${M} ${F};
#else
uniform ${P} ${M} u_${F};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${P} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${W}(a_${F}, u_${F}_t);
#else
    ${P} ${M} ${F} = u_${F};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${P} ${H} a_${F};
#else
uniform ${P} ${M} u_${F};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${P} ${M} ${F} = a_${F};
#else
    ${P} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${P} ${M} ${F} = unpack_mix_${W}(a_${F}, u_${F}_t);
#else
    ${P} ${M} ${F} = u_${F};
#endif
`}),staticAttributes:a,staticUniforms:w}}class _a{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,a,h,f,w,T,k,C){this.context=t;let P=this.boundPaintVertexBuffers.length!==h.length;for(let M=0;!P&&M<h.length;M++)this.boundPaintVertexBuffers[M]!==h[M]&&(P=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||P||this.boundIndexBuffer!==f||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==C?this.freshBind(n,a,h,f,w,T,k,C):(t.bindVertexArray.set(this.vao),T&&T.bind(),f&&f.dynamicDraw&&f.bind(),k&&k.bind(),C&&C.bind())}freshBind(t,n,a,h,f,w,T,k){const C=t.numAttributes,P=this.context,M=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=k,n.enableAttributes(M,t);for(const F of a)F.enableAttributes(M,t);w&&w.enableAttributes(M,t),T&&T.enableAttributes(M,t),k&&k.enableAttributes(M,t),n.bind(),n.setVertexAttribPointers(M,t,f);for(const F of a)F.bind(),F.setVertexAttribPointers(M,t,f);w&&(w.bind(),w.setVertexAttribPointers(M,t,f)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(M,t,f)),k&&(k.bind(),k.setVertexAttribPointers(M,t,f)),P.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function hs(d){const t=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const a=d[n].split(" ");t.push(a.pop())}return t}class kn{constructor(t,n,a,h,f,w){const T=t.gl;this.program=T.createProgram();const k=hs(n.staticAttributes),C=a?a.getBinderAttributes():[],P=k.concat(C),M=Ls.prelude.staticUniforms?hs(Ls.prelude.staticUniforms):[],F=n.staticUniforms?hs(n.staticUniforms):[],H=a?a.getBinderUniforms():[],W=M.concat(F).concat(H),Y=[];for(const de of W)Y.indexOf(de)<0&&Y.push(de);const q=a?a.defines():[];f&&q.push("#define OVERDRAW_INSPECTOR;"),w&&q.push("#define TERRAIN3D;");const ie=q.concat(Ls.prelude.fragmentSource,n.fragmentSource).join(`
`),he=q.concat(Ls.prelude.vertexSource,n.vertexSource).join(`
`),Q=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(Q,ie),T.compileShader(Q),!T.getShaderParameter(Q,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(Q)}`);T.attachShader(this.program,Q);const ae=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(ae,he),T.compileShader(ae),!T.getShaderParameter(ae,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(ae)}`);T.attachShader(this.program,ae),this.attributes={};const pe={};this.numAttributes=P.length;for(let de=0;de<this.numAttributes;de++)P[de]&&(T.bindAttribLocation(this.program,de,P[de]),this.attributes[P[de]]=de);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(ae),T.deleteShader(Q);for(let de=0;de<Y.length;de++){const ve=Y[de];if(ve&&!pe[ve]){const Se=T.getUniformLocation(this.program,ve);Se&&(pe[ve]=Se)}}this.fixedUniforms=h(t,pe),this.terrainUniforms=((de,ve)=>({u_depth:new l.aG(de,ve.u_depth),u_terrain:new l.aG(de,ve.u_terrain),u_terrain_dim:new l.aH(de,ve.u_terrain_dim),u_terrain_matrix:new l.aI(de,ve.u_terrain_matrix),u_terrain_unpack:new l.aJ(de,ve.u_terrain_unpack),u_terrain_exaggeration:new l.aH(de,ve.u_terrain_exaggeration)}))(t,pe),this.binderUniforms=a?a.getUniforms(t,pe):[]}draw(t,n,a,h,f,w,T,k,C,P,M,F,H,W,Y,q,ie,he){const Q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(h),t.setColorMode(f),t.setCullFace(w),k){t.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,k.depthTexture),t.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,k.texture);for(const pe in this.terrainUniforms)this.terrainUniforms[pe].set(k[pe])}for(const pe in this.fixedUniforms)this.fixedUniforms[pe].set(T[pe]);Y&&Y.setUniforms(t,this.binderUniforms,H,{zoom:W});let ae=0;switch(n){case Q.LINES:ae=2;break;case Q.TRIANGLES:ae=3;break;case Q.LINE_STRIP:ae=1}for(const pe of F.get()){const de=pe.vaos||(pe.vaos={});(de[C]||(de[C]=new _a)).bind(t,this,P,Y?Y.getPaintVertexBuffers():[],M,pe.vertexOffset,q,ie,he),Q.drawElements(n,pe.primitiveLength*ae,Q.UNSIGNED_SHORT,pe.primitiveOffset*ae*2)}}}function ya(d,t,n){const a=1/lt(n,1,t.transform.tileZoom),h=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,t.transform.tileZoom)/h,w=f*(n.tileID.canonical.x+n.tileID.wrap*h),T=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[w>>16,T>>16],u_pixel_coord_lower:[65535&w,65535&T]}}const Ds=(d,t,n,a)=>{const h=t.style.light,f=h.properties.get("position"),w=[f.x,f.y,f.z],T=function(){var C=new l.A(9);return l.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();h.properties.get("anchor")==="viewport"&&function(C,P){var M=Math.sin(P),F=Math.cos(P);C[0]=F,C[1]=M,C[2]=0,C[3]=-M,C[4]=F,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(T,-t.transform.angle),function(C,P,M){var F=P[0],H=P[1],W=P[2];C[0]=F*M[0]+H*M[3]+W*M[6],C[1]=F*M[1]+H*M[4]+W*M[7],C[2]=F*M[2]+H*M[5]+W*M[8]}(w,w,T);const k=h.properties.get("color");return{u_matrix:d,u_lightpos:w,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+n,u_opacity:a}},ah=(d,t,n,a,h,f,w)=>l.e(Ds(d,t,n,a),ya(f,t,w),{u_height_factor:-Math.pow(2,h.overscaledZ)/w.tileSize/8}),Vl=d=>({u_matrix:d}),va=(d,t,n,a)=>l.e(Vl(d),ya(n,t,a)),oh=(d,t)=>({u_matrix:d,u_world:t}),Nl=(d,t,n,a,h)=>l.e(va(d,t,n,a),{u_world:h}),lh=(d,t,n,a)=>{const h=d.transform;let f,w;if(a.paint.get("circle-pitch-alignment")==="map"){const T=lt(n,1,h.zoom);f=!0,w=[T,T]}else f=!1,w=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(t.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:w}},ql=(d,t,n)=>{const a=lt(n,1,t.zoom),h=Math.pow(2,t.zoom-n.tileID.overscaledZ),f=n.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[t.pixelsToGLUnits[0]/(a*h),t.pixelsToGLUnits[1]/(a*h)],u_overscale_factor:f}},Zl=(d,t,n=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:n}),xa=d=>({u_matrix:d}),Gl=(d,t,n,a)=>({u_matrix:d,u_extrude_scale:lt(t,1,n),u_intensity:a});function Hl(d,t){const n=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new l.Y(0,a/n).toLngLat().lat,new l.Y(0,(a+1)/n).toLngLat().lat]}const ba=(d,t,n,a)=>{const h=d.transform;return{u_matrix:Rs(d,t,n,a),u_ratio:1/lt(t,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Wl=(d,t,n,a,h)=>l.e(ba(d,t,n,h),{u_image:0,u_image_height:a}),Bn=(d,t,n,a,h)=>{const f=d.transform,w=Lr(t,f);return{u_matrix:Rs(d,t,n,h),u_texsize:t.imageAtlasTexture.size,u_ratio:1/lt(t,1,f.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[w,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},wa=(d,t,n,a,h,f)=>{const w=d.lineAtlas,T=Lr(t,d.transform),k=n.layout.get("line-cap")==="round",C=w.getDash(a.from,k),P=w.getDash(a.to,k),M=C.width*h.fromScale,F=P.width*h.toScale;return l.e(ba(d,t,n,f),{u_patternscale_a:[T/M,-C.height/2],u_patternscale_b:[T/F,-P.height/2],u_sdfgamma:w.width/(256*Math.min(M,F)*d.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:P.y,u_mix:h.t})};function Lr(d,t){return 1/lt(d,1,t.tileZoom)}function Rs(d,t,n,a){return d.translatePosMatrix(a?a.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Sa=(d,t,n,a,h)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(w=h.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(f=h.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Os(h.paint.get("raster-hue-rotate"))};var f,w};function Os(d){d*=Math.PI/180;const t=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Fs=(d,t,n,a,h,f,w,T,k,C)=>{const P=h.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:P.width/P.height,u_fade_change:h.options.fadeDuration?h.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+k,u_pitch_with_map:+a,u_texsize:C,u_texture:0}},Bs=(d,t,n,a,h,f,w,T,k,C,P)=>{const M=h.transform;return l.e(Fs(d,t,n,a,h,f,w,T,k,C),{u_gamma_scale:a?Math.cos(M._pitch)*M.cameraToCenterDistance:1,u_device_pixel_ratio:h.pixelRatio,u_is_halo:+P})},js=(d,t,n,a,h,f,w,T,k,C)=>l.e(Bs(d,t,n,a,h,f,w,T,!0,k,!0),{u_texsize_icon:C,u_texture_icon:1}),ch=(d,t,n)=>({u_matrix:d,u_opacity:t,u_color:n}),hh=(d,t,n,a,h,f)=>l.e(function(w,T,k,C){const P=k.imageManager.getPattern(w.from.toString()),M=k.imageManager.getPattern(w.to.toString()),{width:F,height:H}=k.imageManager.getPixelSize(),W=Math.pow(2,C.tileID.overscaledZ),Y=C.tileSize*Math.pow(2,k.transform.tileZoom)/W,q=Y*(C.tileID.canonical.x+C.tileID.wrap*W),ie=Y*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,H],u_mix:T.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/lt(C,1,k.transform.tileZoom),u_pixel_coord_upper:[q>>16,ie>>16],u_pixel_coord_lower:[65535&q,65535&ie]}}(a,f,n,h),{u_matrix:d,u_opacity:t}),Kl={fillExtrusion:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_lightpos:new l.aK(d,t.u_lightpos),u_lightintensity:new l.aH(d,t.u_lightintensity),u_lightcolor:new l.aK(d,t.u_lightcolor),u_vertical_gradient:new l.aH(d,t.u_vertical_gradient),u_opacity:new l.aH(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_lightpos:new l.aK(d,t.u_lightpos),u_lightintensity:new l.aH(d,t.u_lightintensity),u_lightcolor:new l.aK(d,t.u_lightcolor),u_vertical_gradient:new l.aH(d,t.u_vertical_gradient),u_height_factor:new l.aH(d,t.u_height_factor),u_image:new l.aG(d,t.u_image),u_texsize:new l.aL(d,t.u_texsize),u_pixel_coord_upper:new l.aL(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(d,t.u_pixel_coord_lower),u_scale:new l.aK(d,t.u_scale),u_fade:new l.aH(d,t.u_fade),u_opacity:new l.aH(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_image:new l.aG(d,t.u_image),u_texsize:new l.aL(d,t.u_texsize),u_pixel_coord_upper:new l.aL(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(d,t.u_pixel_coord_lower),u_scale:new l.aK(d,t.u_scale),u_fade:new l.aH(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_world:new l.aL(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_world:new l.aL(d,t.u_world),u_image:new l.aG(d,t.u_image),u_texsize:new l.aL(d,t.u_texsize),u_pixel_coord_upper:new l.aL(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(d,t.u_pixel_coord_lower),u_scale:new l.aK(d,t.u_scale),u_fade:new l.aH(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new l.aH(d,t.u_camera_to_center_distance),u_scale_with_map:new l.aG(d,t.u_scale_with_map),u_pitch_with_map:new l.aG(d,t.u_pitch_with_map),u_extrude_scale:new l.aL(d,t.u_extrude_scale),u_device_pixel_ratio:new l.aH(d,t.u_device_pixel_ratio),u_matrix:new l.aI(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_camera_to_center_distance:new l.aH(d,t.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(d,t.u_pixels_to_tile_units),u_extrude_scale:new l.aL(d,t.u_extrude_scale),u_overscale_factor:new l.aH(d,t.u_overscale_factor)}),collisionCircle:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_inv_matrix:new l.aI(d,t.u_inv_matrix),u_camera_to_center_distance:new l.aH(d,t.u_camera_to_center_distance),u_viewport_size:new l.aL(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new l.aM(d,t.u_color),u_matrix:new l.aI(d,t.u_matrix),u_overlay:new l.aG(d,t.u_overlay),u_overlay_scale:new l.aH(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new l.aH(d,t.u_extrude_scale),u_intensity:new l.aH(d,t.u_intensity),u_matrix:new l.aI(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_world:new l.aL(d,t.u_world),u_image:new l.aG(d,t.u_image),u_color_ramp:new l.aG(d,t.u_color_ramp),u_opacity:new l.aH(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_image:new l.aG(d,t.u_image),u_latrange:new l.aL(d,t.u_latrange),u_light:new l.aL(d,t.u_light),u_shadow:new l.aM(d,t.u_shadow),u_highlight:new l.aM(d,t.u_highlight),u_accent:new l.aM(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_image:new l.aG(d,t.u_image),u_dimension:new l.aL(d,t.u_dimension),u_zoom:new l.aH(d,t.u_zoom),u_unpack:new l.aJ(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_ratio:new l.aH(d,t.u_ratio),u_device_pixel_ratio:new l.aH(d,t.u_device_pixel_ratio),u_units_to_pixels:new l.aL(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_ratio:new l.aH(d,t.u_ratio),u_device_pixel_ratio:new l.aH(d,t.u_device_pixel_ratio),u_units_to_pixels:new l.aL(d,t.u_units_to_pixels),u_image:new l.aG(d,t.u_image),u_image_height:new l.aH(d,t.u_image_height)}),linePattern:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_texsize:new l.aL(d,t.u_texsize),u_ratio:new l.aH(d,t.u_ratio),u_device_pixel_ratio:new l.aH(d,t.u_device_pixel_ratio),u_image:new l.aG(d,t.u_image),u_units_to_pixels:new l.aL(d,t.u_units_to_pixels),u_scale:new l.aK(d,t.u_scale),u_fade:new l.aH(d,t.u_fade)}),lineSDF:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_ratio:new l.aH(d,t.u_ratio),u_device_pixel_ratio:new l.aH(d,t.u_device_pixel_ratio),u_units_to_pixels:new l.aL(d,t.u_units_to_pixels),u_patternscale_a:new l.aL(d,t.u_patternscale_a),u_patternscale_b:new l.aL(d,t.u_patternscale_b),u_sdfgamma:new l.aH(d,t.u_sdfgamma),u_image:new l.aG(d,t.u_image),u_tex_y_a:new l.aH(d,t.u_tex_y_a),u_tex_y_b:new l.aH(d,t.u_tex_y_b),u_mix:new l.aH(d,t.u_mix)}),raster:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_tl_parent:new l.aL(d,t.u_tl_parent),u_scale_parent:new l.aH(d,t.u_scale_parent),u_buffer_scale:new l.aH(d,t.u_buffer_scale),u_fade_t:new l.aH(d,t.u_fade_t),u_opacity:new l.aH(d,t.u_opacity),u_image0:new l.aG(d,t.u_image0),u_image1:new l.aG(d,t.u_image1),u_brightness_low:new l.aH(d,t.u_brightness_low),u_brightness_high:new l.aH(d,t.u_brightness_high),u_saturation_factor:new l.aH(d,t.u_saturation_factor),u_contrast_factor:new l.aH(d,t.u_contrast_factor),u_spin_weights:new l.aK(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new l.aG(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(d,t.u_is_size_feature_constant),u_size_t:new l.aH(d,t.u_size_t),u_size:new l.aH(d,t.u_size),u_camera_to_center_distance:new l.aH(d,t.u_camera_to_center_distance),u_pitch:new l.aH(d,t.u_pitch),u_rotate_symbol:new l.aG(d,t.u_rotate_symbol),u_aspect_ratio:new l.aH(d,t.u_aspect_ratio),u_fade_change:new l.aH(d,t.u_fade_change),u_matrix:new l.aI(d,t.u_matrix),u_label_plane_matrix:new l.aI(d,t.u_label_plane_matrix),u_coord_matrix:new l.aI(d,t.u_coord_matrix),u_is_text:new l.aG(d,t.u_is_text),u_pitch_with_map:new l.aG(d,t.u_pitch_with_map),u_texsize:new l.aL(d,t.u_texsize),u_texture:new l.aG(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new l.aG(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(d,t.u_is_size_feature_constant),u_size_t:new l.aH(d,t.u_size_t),u_size:new l.aH(d,t.u_size),u_camera_to_center_distance:new l.aH(d,t.u_camera_to_center_distance),u_pitch:new l.aH(d,t.u_pitch),u_rotate_symbol:new l.aG(d,t.u_rotate_symbol),u_aspect_ratio:new l.aH(d,t.u_aspect_ratio),u_fade_change:new l.aH(d,t.u_fade_change),u_matrix:new l.aI(d,t.u_matrix),u_label_plane_matrix:new l.aI(d,t.u_label_plane_matrix),u_coord_matrix:new l.aI(d,t.u_coord_matrix),u_is_text:new l.aG(d,t.u_is_text),u_pitch_with_map:new l.aG(d,t.u_pitch_with_map),u_texsize:new l.aL(d,t.u_texsize),u_texture:new l.aG(d,t.u_texture),u_gamma_scale:new l.aH(d,t.u_gamma_scale),u_device_pixel_ratio:new l.aH(d,t.u_device_pixel_ratio),u_is_halo:new l.aG(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new l.aG(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(d,t.u_is_size_feature_constant),u_size_t:new l.aH(d,t.u_size_t),u_size:new l.aH(d,t.u_size),u_camera_to_center_distance:new l.aH(d,t.u_camera_to_center_distance),u_pitch:new l.aH(d,t.u_pitch),u_rotate_symbol:new l.aG(d,t.u_rotate_symbol),u_aspect_ratio:new l.aH(d,t.u_aspect_ratio),u_fade_change:new l.aH(d,t.u_fade_change),u_matrix:new l.aI(d,t.u_matrix),u_label_plane_matrix:new l.aI(d,t.u_label_plane_matrix),u_coord_matrix:new l.aI(d,t.u_coord_matrix),u_is_text:new l.aG(d,t.u_is_text),u_pitch_with_map:new l.aG(d,t.u_pitch_with_map),u_texsize:new l.aL(d,t.u_texsize),u_texsize_icon:new l.aL(d,t.u_texsize_icon),u_texture:new l.aG(d,t.u_texture),u_texture_icon:new l.aG(d,t.u_texture_icon),u_gamma_scale:new l.aH(d,t.u_gamma_scale),u_device_pixel_ratio:new l.aH(d,t.u_device_pixel_ratio),u_is_halo:new l.aG(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_opacity:new l.aH(d,t.u_opacity),u_color:new l.aM(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_opacity:new l.aH(d,t.u_opacity),u_image:new l.aG(d,t.u_image),u_pattern_tl_a:new l.aL(d,t.u_pattern_tl_a),u_pattern_br_a:new l.aL(d,t.u_pattern_br_a),u_pattern_tl_b:new l.aL(d,t.u_pattern_tl_b),u_pattern_br_b:new l.aL(d,t.u_pattern_br_b),u_texsize:new l.aL(d,t.u_texsize),u_mix:new l.aH(d,t.u_mix),u_pattern_size_a:new l.aL(d,t.u_pattern_size_a),u_pattern_size_b:new l.aL(d,t.u_pattern_size_b),u_scale_a:new l.aH(d,t.u_scale_a),u_scale_b:new l.aH(d,t.u_scale_b),u_pixel_coord_upper:new l.aL(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(d,t.u_tile_units_to_pixels)}),terrain:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_texture:new l.aG(d,t.u_texture),u_ele_delta:new l.aH(d,t.u_ele_delta)}),terrainDepth:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_ele_delta:new l.aH(d,t.u_ele_delta)}),terrainCoords:(d,t)=>({u_matrix:new l.aI(d,t.u_matrix),u_texture:new l.aG(d,t.u_texture),u_terrain_coords_id:new l.aH(d,t.u_terrain_coords_id),u_ele_delta:new l.aH(d,t.u_ele_delta)})};class uh{constructor(t,n,a){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const jn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ta{constructor(t,n,a,h){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=h,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let a=0;a<this.attributes.length;a++){const h=n.attributes[this.attributes[a].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,n,a){for(let h=0;h<this.attributes.length;h++){const f=this.attributes[h],w=n.attributes[f.name];w!==void 0&&t.vertexAttribPointer(w,f.components,t[jn[f.type]],!1,this.itemSize,f.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hr=new WeakMap;function rr(d){var t;if(hr.has(d))return hr.get(d);{const n=(t=d.getParameter(d.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return hr.set(d,n),n}}class Ot{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ka extends Ot{getDefault(){return l.aO.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ia extends Ot{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Po extends Ot{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Mo extends Ot{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ca extends Ot{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class zo extends Ot{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Lo extends Ot{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Aa extends Ot{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Xl extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Jl extends Ot{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class us extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class dh extends Ot{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ph extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class fh extends Ot{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class mh extends Ot{getDefault(){return l.aO.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class gh extends Ot{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class _h extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Do extends Ot{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ea extends Ot{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ro extends Ot{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Oo extends Ot{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ds extends Ot{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Yl extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ql extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fo extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Un extends Ot{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $l extends Ot{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ps extends Ot{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const a=this.gl;rr(a)?a.bindVertexArray(t):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class fs extends Ot{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ec extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Bo extends Ot{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class zt extends Ot{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Pa extends zt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class yh extends zt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class tc extends zt{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Us{constructor(t,n,a,h,f){this.context=t,this.width=n,this.height=a;const w=t.gl,T=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Pa(t,T),h)this.depthAttachment=f?new tc(t,T):new yh(t,T);else if(f)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class Si{constructor(t,n,a){this.blendFunction=t,this.blendColor=n,this.mask=a}}Si.Replace=[1,0],Si.disabled=new Si(Si.Replace,l.aO.transparent,[!1,!1,!1,!1]),Si.unblended=new Si(Si.Replace,l.aO.transparent,[!0,!0,!0,!0]),Si.alphaBlended=new Si([1,771],l.aO.transparent,[!0,!0,!0,!0]);class vh{constructor(t){var n,a;if(this.gl=t,this.clearColor=new ka(this),this.clearDepth=new Ia(this),this.clearStencil=new Po(this),this.colorMask=new Mo(this),this.depthMask=new Ca(this),this.stencilMask=new zo(this),this.stencilFunc=new Lo(this),this.stencilOp=new Aa(this),this.stencilTest=new Xl(this),this.depthRange=new Jl(this),this.depthTest=new us(this),this.depthFunc=new dh(this),this.blend=new ph(this),this.blendFunc=new fh(this),this.blendColor=new mh(this),this.blendEquation=new gh(this),this.cullFace=new _h(this),this.cullFaceSide=new Do(this),this.frontFace=new Ea(this),this.program=new Ro(this),this.activeTexture=new Oo(this),this.viewport=new ds(this),this.bindFramebuffer=new Yl(this),this.bindRenderbuffer=new Ql(this),this.bindTexture=new Fo(this),this.bindVertexBuffer=new Un(this),this.bindElementBuffer=new $l(this),this.bindVertexArray=new ps(this),this.pixelStoreUnpack=new fs(this),this.pixelStoreUnpackPremultiplyAlpha=new ec(this),this.pixelStoreUnpackFlipY=new Bo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),rr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:h==null?void 0:h.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new uh(this,t,n)}createVertexBuffer(t,n,a){return new Ta(this,t,n,a)}createRenderbuffer(t,n,a){const h=this.gl,f=h.createRenderbuffer();return this.bindRenderbuffer.set(f),h.renderbufferStorage(h.RENDERBUFFER,t,n,a),this.bindRenderbuffer.set(null),f}createFramebuffer(t,n,a,h){return new Us(this,t,n,a,h)}clear({color:t,depth:n,stencil:a}){const h=this.gl;let f=0;t&&(f|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(f|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(f|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),h.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.aD(t.blendFunction,Si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return rr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return rr(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Et{constructor(t,n,a){this.func=t,this.mask=n,this.range=a}}Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);const jo=7680;class ei{constructor(t,n,a,h,f,w){this.test=t,this.ref=n,this.mask=a,this.fail=h,this.depthFail=f,this.pass=w}}ei.disabled=new ei({func:519,mask:0},0,0,jo,jo,jo);class Qt{constructor(t,n,a){this.enable=t,this.mode=n,this.frontFace=a}}let Vn;function Ma(d,t,n,a,h,f,w){const T=d.context,k=T.gl,C=d.useProgram("collisionBox"),P=[];let M=0,F=0;for(let Q=0;Q<a.length;Q++){const ae=a[Q],pe=t.getTile(ae),de=pe.getBucket(n);if(!de)continue;let ve=ae.posMatrix;h[0]===0&&h[1]===0||(ve=d.translatePosMatrix(ae.posMatrix,pe,h,f));const Se=w?de.textCollisionBox:de.iconCollisionBox,we=de.collisionCircleArray;if(we.length>0){const Ce=l.F(),Ne=ve;l.aP(Ce,de.placementInvProjMatrix,d.transform.glCoordMatrix),l.aP(Ce,Ce,de.placementViewportMatrix),P.push({circleArray:we,circleOffset:F,transform:Ne,invTransform:Ce,coord:ae}),M+=we.length/4,F=M}Se&&C.draw(T,k.LINES,Et.disabled,ei.disabled,d.colorModeForRenderPass(),Qt.disabled,ql(ve,d.transform,pe),d.style.map.terrain&&d.style.map.terrain.getTerrainData(ae),n.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,d.transform.zoom,null,null,Se.collisionVertexBuffer)}if(!w||!P.length)return;const H=d.useProgram("collisionCircle"),W=new l.aQ;W.resize(4*M),W._trim();let Y=0;for(const Q of P)for(let ae=0;ae<Q.circleArray.length/4;ae++){const pe=4*ae,de=Q.circleArray[pe+0],ve=Q.circleArray[pe+1],Se=Q.circleArray[pe+2],we=Q.circleArray[pe+3];W.emplace(Y++,de,ve,Se,we,0),W.emplace(Y++,de,ve,Se,we,1),W.emplace(Y++,de,ve,Se,we,2),W.emplace(Y++,de,ve,Se,we,3)}(!Vn||Vn.length<2*M)&&(Vn=function(Q){const ae=2*Q,pe=new l.aS;pe.resize(ae),pe._trim();for(let de=0;de<ae;de++){const ve=6*de;pe.uint16[ve+0]=4*de+0,pe.uint16[ve+1]=4*de+1,pe.uint16[ve+2]=4*de+2,pe.uint16[ve+3]=4*de+2,pe.uint16[ve+4]=4*de+3,pe.uint16[ve+5]=4*de+0}return pe}(M));const q=T.createIndexBuffer(Vn,!0),ie=T.createVertexBuffer(W,l.aR.members,!0);for(const Q of P){const ae={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(he=d.transform).cameraToCenterDistance,u_viewport_size:[he.width,he.height]};H.draw(T,k.TRIANGLES,Et.disabled,ei.disabled,d.colorModeForRenderPass(),Qt.disabled,ae,d.style.map.terrain&&d.style.map.terrain.getTerrainData(Q.coord),n.id,ie,q,l.$.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,d.transform.zoom,null,null,null)}var he;ie.destroy(),q.destroy()}Qt.disabled=new Qt(!1,1029,2305),Qt.backCCW=new Qt(!0,1029,2305);const Uo=l.an(new Float32Array(16));function ic(d,t,n,a,h,f){const{horizontalAlign:w,verticalAlign:T}=l.at(d);return new l.P((-(w-.5)*t/h+a[0])*f,(-(T-.5)*n/h+a[1])*f)}function za(d,t,n,a,h,f,w,T,k,C,P){const M=d.text.placedSymbolArray,F=d.text.dynamicLayoutVertexArray,H=d.icon.dynamicLayoutVertexArray,W={};F.clear();for(let Y=0;Y<M.length;Y++){const q=M.get(Y),ie=q.hidden||!q.crossTileID||d.allowVerticalPlacement&&!q.placedOrientation?null:a[q.crossTileID];if(ie){const he=new l.P(q.anchorX,q.anchorY),Q=Ri(he,n?w:f,P),ae=J(h.cameraToCenterDistance,Q.signedDistanceFromCamera);let pe=l.ai(d.textSizeData,k,q)*ae/l.ao;n&&(pe*=d.tilePixelRatio/T);const{width:de,height:ve,anchor:Se,textOffset:we,textBoxScale:Ce}=ie,Ne=ic(Se,de,ve,we,Ce,pe),rt=n?Ri(he.add(Ne),f,P).point:Q.point.add(t?Ne.rotate(-h.angle):Ne),De=d.allowVerticalPlacement&&q.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let tt=0;tt<q.numGlyphs;tt++)l.aj(F,rt,De);C&&q.associatedIconIndex>=0&&(W[q.associatedIconIndex]={shiftedAnchor:rt,angle:De})}else ye(q.numGlyphs,F)}if(C){H.clear();const Y=d.icon.placedSymbolArray;for(let q=0;q<Y.length;q++){const ie=Y.get(q);if(ie.hidden)ye(ie.numGlyphs,H);else{const he=W[q];if(he)for(let Q=0;Q<ie.numGlyphs;Q++)l.aj(H,he.shiftedAnchor,he.angle);else ye(ie.numGlyphs,H)}}d.icon.dynamicLayoutVertexBuffer.updateData(H)}d.text.dynamicLayoutVertexBuffer.updateData(F)}function La(d,t,n){return n.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Da(d,t,n,a,h,f,w,T,k,C,P,M){const F=d.context,H=F.gl,W=d.transform,Y=T==="map",q=k==="map",ie=T!=="viewport"&&n.layout.get("symbol-placement")!=="point",he=Y&&!q&&!ie,Q=!n.layout.get("symbol-sort-key").isConstant();let ae=!1;const pe=d.depthModeForSublayer(0,Et.ReadOnly),de=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ve=[];for(const Se of a){const we=t.getTile(Se),Ce=we.getBucket(n);if(!Ce)continue;const Ne=h?Ce.text:Ce.icon;if(!Ne||!Ne.segments.get().length||!Ne.hasVisibleVertices)continue;const rt=Ne.programConfigurations.get(n.id),De=h||Ce.sdfIcons,tt=h?Ce.textSizeData:Ce.iconSizeData,Ze=q||W.pitch!==0,ii=d.useProgram(La(De,h,Ce),rt),bt=l.ag(tt,W.zoom),mt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Se);let wt,ki,Xt,pr,Xi=[0,0],xi=null;if(h)ki=we.glyphAtlasTexture,Xt=H.LINEAR,wt=we.glyphAtlasTexture.size,Ce.iconsInText&&(Xi=we.imageAtlasTexture.size,xi=we.imageAtlasTexture,pr=Ze||d.options.rotating||d.options.zooming||tt.kind==="composite"||tt.kind==="camera"?H.LINEAR:H.NEAREST);else{const ri=n.layout.get("icon-size").constantOr(0)!==1||Ce.iconsNeedLinear;ki=we.imageAtlasTexture,Xt=De||d.options.rotating||d.options.zooming||ri||Ze?H.LINEAR:H.NEAREST,wt=we.imageAtlasTexture.size}const nr=lt(we,1,d.transform.zoom),sr=ht(Se.posMatrix,q,Y,d.transform,nr),Zr=Fn(Se.posMatrix,q,Y,d.transform,nr),En=de&&Ce.hasTextData(),xs=n.layout.get("icon-text-fit")!=="none"&&En&&Ce.hasIconData();if(ie){const ri=d.style.map.terrain?(Ji,ji)=>d.style.map.terrain.getElevation(Se,Ji,ji):null,Bi=n.layout.get("text-rotation-alignment")==="map";R(Ce,Se.posMatrix,d,h,sr,Zr,q,C,Bi,ri)}const bs=d.translatePosMatrix(Se.posMatrix,we,f,w),Pn=ie||h&&de||xs?Uo:sr,Fi=d.translatePosMatrix(Zr,we,f,w,!0),Ii=De&&n.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let bi;bi=De?Ce.iconsInText?js(tt.kind,bt,he,q,d,bs,Pn,Fi,wt,Xi):Bs(tt.kind,bt,he,q,d,bs,Pn,Fi,h,wt,!0):Fs(tt.kind,bt,he,q,d,bs,Pn,Fi,h,wt);const fr={program:ii,buffers:Ne,uniformValues:bi,atlasTexture:ki,atlasTextureIcon:xi,atlasInterpolation:Xt,atlasInterpolationIcon:pr,isSDF:De,hasHalo:Ii};if(Q&&Ce.canOverlap){ae=!0;const ri=Ne.segments.get();for(const Bi of ri)ve.push({segments:new l.$([Bi]),sortKey:Bi.sortKey,state:fr,terrainData:mt})}else ve.push({segments:Ne.segments,sortKey:0,state:fr,terrainData:mt})}ae&&ve.sort((Se,we)=>Se.sortKey-we.sortKey);for(const Se of ve){const we=Se.state;if(F.activeTexture.set(H.TEXTURE0),we.atlasTexture.bind(we.atlasInterpolation,H.CLAMP_TO_EDGE),we.atlasTextureIcon&&(F.activeTexture.set(H.TEXTURE1),we.atlasTextureIcon&&we.atlasTextureIcon.bind(we.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),we.isSDF){const Ce=we.uniformValues;we.hasHalo&&(Ce.u_is_halo=1,rc(we.buffers,Se.segments,n,d,we.program,pe,P,M,Ce,Se.terrainData)),Ce.u_is_halo=0}rc(we.buffers,Se.segments,n,d,we.program,pe,P,M,we.uniformValues,Se.terrainData)}}function rc(d,t,n,a,h,f,w,T,k,C){const P=a.context;h.draw(P,P.gl.TRIANGLES,f,w,T,Qt.disabled,k,C,n.id,d.layoutVertexBuffer,d.indexBuffer,t,n.paint,a.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Ra(d,t,n,a,h){if(!n||!a||!a.imageAtlas)return;const f=a.imageAtlas.patternPositions;let w=f[n.to.toString()],T=f[n.from.toString()];if(!w&&T&&(w=T),!T&&w&&(T=w),!w||!T){const k=h.getPaintProperty(t);w=f[k],T=f[k]}w&&T&&d.setConstantPatternPositions(w,T)}function nc(d,t,n,a,h,f,w){const T=d.context.gl,k="fill-pattern",C=n.paint.get(k),P=C&&C.constantOr(1),M=n.getCrossfadeParameters();let F,H,W,Y,q;w?(H=P&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=T.LINES):(H=P?"fillPattern":"fill",F=T.TRIANGLES);const ie=C.constantOr(null);for(const he of a){const Q=t.getTile(he);if(P&&!Q.patternsLoaded())continue;const ae=Q.getBucket(n);if(!ae)continue;const pe=ae.programConfigurations.get(n.id),de=d.useProgram(H,pe),ve=d.style.map.terrain&&d.style.map.terrain.getTerrainData(he);P&&(d.context.activeTexture.set(T.TEXTURE0),Q.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),pe.updatePaintBuffers(M)),Ra(pe,k,ie,Q,n);const Se=ve?he:null,we=d.translatePosMatrix(Se?Se.posMatrix:he.posMatrix,Q,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(w){Y=ae.indexBuffer2,q=ae.segments2;const Ce=[T.drawingBufferWidth,T.drawingBufferHeight];W=H==="fillOutlinePattern"&&P?Nl(we,d,M,Q,Ce):oh(we,Ce)}else Y=ae.indexBuffer,q=ae.segments,W=P?va(we,d,M,Q):Vl(we);de.draw(d.context,F,h,d.stencilModeForClipping(he),f,Qt.disabled,W,ve,n.id,ae.layoutVertexBuffer,Y,q,n.paint,d.transform.zoom,pe)}}function Oa(d,t,n,a,h,f,w){const T=d.context,k=T.gl,C="fill-extrusion-pattern",P=n.paint.get(C),M=P.constantOr(1),F=n.getCrossfadeParameters(),H=n.paint.get("fill-extrusion-opacity"),W=P.constantOr(null);for(const Y of a){const q=t.getTile(Y),ie=q.getBucket(n);if(!ie)continue;const he=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Y),Q=ie.programConfigurations.get(n.id),ae=d.useProgram(M?"fillExtrusionPattern":"fillExtrusion",Q);M&&(d.context.activeTexture.set(k.TEXTURE0),q.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Q.updatePaintBuffers(F)),Ra(Q,C,W,q,n);const pe=d.translatePosMatrix(Y.posMatrix,q,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),de=n.paint.get("fill-extrusion-vertical-gradient"),ve=M?ah(pe,d,de,H,Y,F,q):Ds(pe,d,de,H);ae.draw(T,T.gl.TRIANGLES,h,f,w,Qt.backCCW,ve,he,n.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,n.paint,d.transform.zoom,Q,d.style.map.terrain&&ie.centroidVertexBuffer)}}function Fa(d,t,n,a,h,f,w){const T=d.context,k=T.gl,C=n.fbo;if(!C)return;const P=d.useProgram("hillshade"),M=d.style.map.terrain&&d.style.map.terrain.getTerrainData(t);T.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,C.colorAttachment.get()),P.draw(T,k.TRIANGLES,h,f,w,Qt.disabled,((F,H,W,Y)=>{const q=W.paint.get("hillshade-shadow-color"),ie=W.paint.get("hillshade-highlight-color"),he=W.paint.get("hillshade-accent-color");let Q=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=F.transform.angle);const ae=!F.options.moving;return{u_matrix:Y?Y.posMatrix:F.transform.calculatePosMatrix(H.tileID.toUnwrapped(),ae),u_image:0,u_latrange:Hl(0,H.tileID),u_light:[W.paint.get("hillshade-exaggeration"),Q],u_shadow:q,u_highlight:ie,u_accent:he}})(d,n,a,M?t:null),M,a.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Vo(d,t,n,a,h,f){const w=d.context,T=w.gl,k=t.dem;if(k&&k.data){const C=k.dim,P=k.stride,M=k.getPixels();if(w.activeTexture.set(T.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(P),t.demTexture){const H=t.demTexture;H.update(M,{premultiply:!1}),H.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else t.demTexture=new kt(w,M,T.RGBA,{premultiply:!1}),t.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);w.activeTexture.set(T.TEXTURE0);let F=t.fbo;if(!F){const H=new kt(w,{width:C,height:C,data:null},T.RGBA);H.bind(T.LINEAR,T.CLAMP_TO_EDGE),F=t.fbo=w.createFramebuffer(C,C,!0,!1),F.colorAttachment.set(H.texture)}w.bindFramebuffer.set(F.framebuffer),w.viewport.set([0,0,C,C]),d.useProgram("hillshadePrepare").draw(w,T.TRIANGLES,a,h,f,Qt.disabled,((H,W)=>{const Y=W.stride,q=l.F();return l.aN(q,0,l.W,-l.W,0,0,1),l.H(q,q,[0,-l.W,0]),{u_matrix:q,u_image:1,u_dimension:[Y,Y],u_zoom:H.overscaledZ,u_unpack:W.getUnpackVector()}})(t.tileID,k),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function sc(d,t,n,a,h,f){const w=a.paint.get("raster-fade-duration");if(!f&&w>0){const T=Z.now(),k=(T-d.timeAdded)/w,C=t?(T-t.timeAdded)/w:-1,P=n.getSource(),M=h.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(d.tileID.overscaledZ-M),H=F&&d.refreshedUponExpiration?1:l.ac(F?k:1-C,0,1);return d.refreshedUponExpiration&&k>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const ac=new l.aO(1,0,0,1),Ba=new l.aO(0,1,0,1),No=new l.aO(0,0,1,1),xh=new l.aO(1,0,1,1),oc=new l.aO(0,1,1,1);function yi(d,t,n,a){ur(d,0,t+n/2,d.transform.width,n,a)}function In(d,t,n,a){ur(d,t-n/2,0,n,d.transform.height,a)}function ur(d,t,n,a,h,f){const w=d.context,T=w.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*d.pixelRatio,n*d.pixelRatio,a*d.pixelRatio,h*d.pixelRatio),w.clear({color:f}),T.disable(T.SCISSOR_TEST)}function qo(d,t,n){const a=d.context,h=a.gl,f=n.posMatrix,w=d.useProgram("debug"),T=Et.disabled,k=ei.disabled,C=d.colorModeForRenderPass(),P="$debug",M=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);a.activeTexture.set(h.TEXTURE0);const F=t.getTileByID(n.key).latestRawTileData,H=Math.floor((F&&F.byteLength||0)/1024),W=t.getTile(n).tileSize,Y=512/Math.min(W,512)*(n.overscaledZ/d.transform.zoom)*.5;let q=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(q+=` => ${n.overscaledZ}`),function(ie,he){ie.initDebugOverlayCanvas();const Q=ie.debugOverlayCanvas,ae=ie.context.gl,pe=ie.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,Q.width,Q.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(he,5,5),pe.strokeText(he,5,5),ie.debugOverlayTexture.update(Q),ie.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(d,`${q} ${H}kB`),w.draw(a,h.TRIANGLES,T,k,Si.alphaBlended,Qt.disabled,Zl(f,l.aO.transparent,Y),null,P,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),w.draw(a,h.LINE_STRIP,T,k,C,Qt.disabled,Zl(f,l.aO.red),M,P,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function ja(d,t,n){const a=d.context,h=a.gl,f=d.colorModeForRenderPass(),w=new Et(h.LEQUAL,Et.ReadWrite,d.depthRangeFor3D),T=d.useProgram("terrain"),k=t.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,d.width,d.height]);for(const C of n){const P=d.renderToTexture.getTexture(C),M=t.getTerrainData(C.tileID);a.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,P.texture);const F={u_matrix:d.transform.calculatePosMatrix(C.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(d.transform.zoom)};T.draw(a,h.TRIANGLES,w,ei.disabled,f,Qt.backCCW,F,M,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class lc{constructor(t,n){this.context=new vh(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.F(),renderTime:0},this.setup(),this.numSublayers=ir.maxUnderzooming+ir.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Tn}resize(t,n,a){if(this.width=Math.floor(t*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,n=new l.aV;n.emplaceBack(0,0),n.emplaceBack(l.W,0),n.emplaceBack(0,l.W),n.emplaceBack(l.W,l.W),this.tileExtentBuffer=t.createVertexBuffer(n,ga.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const a=new l.aV;a.emplaceBack(0,0),a.emplaceBack(l.W,0),a.emplaceBack(0,l.W),a.emplaceBack(l.W,l.W),this.debugBuffer=t.createVertexBuffer(a,ga.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const h=new l.Z;h.emplaceBack(0,0,0,0),h.emplaceBack(l.W,0,l.W,0),h.emplaceBack(0,l.W,0,l.W),h.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=t.createVertexBuffer(h,Qi.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const f=new l.aV;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,ga.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const w=new l.aW;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const T=new l.aX;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const k=this.context.gl;this.stencilClearMode=new ei({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=l.F();l.aN(a,0,this.width,this.height,0,0,1),l.J(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,Et.disabled,this.stencilClearMode,Si.disabled,Qt.disabled,xa(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const a=this.context,h=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Si.disabled),a.setDepthMode(Et.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of n){const T=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);f.draw(a,h.TRIANGLES,Et.disabled,new ei({func:h.ALWAYS,mask:0},T,255,h.KEEP,h.KEEP,h.REPLACE),Si.disabled,Qt.disabled,xa(w.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new ei({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new ei({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,a=t.sort((w,T)=>T.overscaledZ-w.overscaledZ),h=a[a.length-1].overscaledZ,f=a[0].overscaledZ-h+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const w={};for(let T=0;T<f;T++)w[T+h]=new ei({func:n.GEQUAL,mask:255},T+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=f,[w,a]}return[{[h]:ei.disabled},a]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Si([t.CONSTANT_COLOR,t.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Si.unblended:Si.alphaBlended}depthModeForSublayer(t,n,a){if(!this.opaquePassEnabledForLayer())return Et.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Et(a||this.context.gl.LEQUAL,n,[h,h])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Z.now()),this.imageManager.beginFrame();const a=this.style._order,h=this.style.sourceCaches,f={},w={},T={};for(const k in h){const C=h[k];C.used&&C.prepare(this.context),f[k]=C.getVisibleCoordinates(),w[k]=f[k].slice().reverse(),T[k]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<a.length;k++)if(this.style._layers[a[k]].is3D()){this.opaquePassCutoff=k;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const k=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.aY(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(l.aZ(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,P){const M=C.context,F=M.gl,H=Si.unblended,W=new Et(F.LEQUAL,Et.ReadWrite,[0,1]),Y=P.getTerrainMesh(),q=P.sourceCache.getRenderableTiles(),ie=C.useProgram("terrainDepth");M.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),M.clear({color:l.aO.transparent,depth:1});for(const he of q){const Q=P.getTerrainData(he.tileID),ae={u_matrix:C.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(C.transform.zoom)};ie.draw(M,F.TRIANGLES,W,ei.disabled,H,Qt.backCCW,ae,Q,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,P){const M=C.context,F=M.gl,H=Si.unblended,W=new Et(F.LEQUAL,Et.ReadWrite,[0,1]),Y=P.getTerrainMesh(),q=P.getCoordsTexture(),ie=P.sourceCache.getRenderableTiles(),he=C.useProgram("terrainCoords");M.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),M.clear({color:l.aO.transparent,depth:1}),P.coordsIndex=[];for(const Q of ie){const ae=P.getTerrainData(Q.tileID);M.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,q.texture);const pe={u_matrix:C.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(C.transform.zoom)};he.draw(M,F.TRIANGLES,W,ei.disabled,H,Qt.backCCW,pe,ae,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),P.coordsIndex.push(Q.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const k of a){const C=this.style._layers[k];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const P=w[C.source];(C.type==="custom"||P.length)&&this.renderLayer(this,h[C.source],C,P)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[a[this.currentLayer]],C=h[k.source],P=f[k.source];this._renderTileClippingMasks(k,P),this.renderLayer(this,C,k,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const k=this.style._layers[a[this.currentLayer]],C=h[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const P=(k.type==="symbol"?T:w)[k.source];this._renderTileClippingMasks(k,f[k.source]),this.renderLayer(this,C,k,P)}if(this.options.showTileBoundaries){const k=function(C,P){let M=null;const F=Object.values(C._layers).flatMap(q=>q.source&&!q.isHidden(P)?[C.sourceCaches[q.source]]:[]),H=F.filter(q=>q.getSource().type==="vector"),W=F.filter(q=>q.getSource().type!=="vector"),Y=q=>{(!M||M.getSource().maxzoom<q.getSource().maxzoom)&&(M=q)};return H.forEach(q=>Y(q)),M||W.forEach(q=>Y(q)),M}(this.style,this.transform.zoom);k&&function(C,P,M){for(let F=0;F<M.length;F++)qo(C,P,M[F])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const C=k.transform.padding;yi(k,k.transform.height-(C.top||0),3,ac),yi(k,C.bottom||0,3,Ba),In(k,C.left||0,3,No),In(k,k.transform.width-(C.right||0),3,xh);const P=k.transform.centerPoint;(function(M,F,H,W){ur(M,F-1,H-10,2,20,W),ur(M,F-10,H-1,20,2,W)})(k,P.x,k.transform.height-P.y,oc)}(this),this.context.setDefault()}renderLayer(t,n,a,h){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(h||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(f,w,T,k,C){if(f.renderPass!=="translucent")return;const P=ei.disabled,M=f.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,H,W,Y,q,ie,he){const Q=H.transform,ae=q==="map",pe=ie==="map";for(const de of F){const ve=Y.getTile(de),Se=ve.getBucket(W);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const we=l.ag(Se.textSizeData,Q.zoom),Ce=lt(ve,1,H.transform.zoom),Ne=ht(de.posMatrix,pe,ae,H.transform,Ce),rt=W.layout.get("icon-text-fit")!=="none"&&Se.hasIconData();if(we){const De=Math.pow(2,Q.zoom-ve.tileID.overscaledZ);za(Se,ae,pe,he,Q,Ne,de.posMatrix,De,we,rt,H.style.map.terrain?(tt,Ze)=>H.style.map.terrain.getElevation(de,tt,Ze):null)}}}(k,f,T,w,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),C),T.paint.get("icon-opacity").constantOr(1)!==0&&Da(f,w,T,k,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),P,M),T.paint.get("text-opacity").constantOr(1)!==0&&Da(f,w,T,k,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),P,M),w.map.showCollisionBoxes&&(Ma(f,w,T,k,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),!0),Ma(f,w,T,k,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),!1))})(t,n,a,h,this.style.placement.variableOffsets);break;case"circle":(function(f,w,T,k){if(f.renderPass!=="translucent")return;const C=T.paint.get("circle-opacity"),P=T.paint.get("circle-stroke-width"),M=T.paint.get("circle-stroke-opacity"),F=!T.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(P.constantOr(1)===0||M.constantOr(1)===0))return;const H=f.context,W=H.gl,Y=f.depthModeForSublayer(0,Et.ReadOnly),q=ei.disabled,ie=f.colorModeForRenderPass(),he=[];for(let Q=0;Q<k.length;Q++){const ae=k[Q],pe=w.getTile(ae),de=pe.getBucket(T);if(!de)continue;const ve=de.programConfigurations.get(T.id),Se=f.useProgram("circle",ve),we=de.layoutVertexBuffer,Ce=de.indexBuffer,Ne=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ae),rt={programConfiguration:ve,program:Se,layoutVertexBuffer:we,indexBuffer:Ce,uniformValues:lh(f,ae,pe,T),terrainData:Ne};if(F){const De=de.segments.get();for(const tt of De)he.push({segments:new l.$([tt]),sortKey:tt.sortKey,state:rt})}else he.push({segments:de.segments,sortKey:0,state:rt})}F&&he.sort((Q,ae)=>Q.sortKey-ae.sortKey);for(const Q of he){const{programConfiguration:ae,program:pe,layoutVertexBuffer:de,indexBuffer:ve,uniformValues:Se,terrainData:we}=Q.state;pe.draw(H,W.TRIANGLES,Y,q,ie,Qt.disabled,Se,we,T.id,de,ve,Q.segments,T.paint,f.transform.zoom,ae)}})(t,n,a,h);break;case"heatmap":(function(f,w,T,k){if(T.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const C=f.context,P=C.gl,M=ei.disabled,F=new Si([P.ONE,P.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(H,W,Y){const q=H.gl;H.activeTexture.set(q.TEXTURE1),H.viewport.set([0,0,W.width/4,W.height/4]);let ie=Y.heatmapFbo;if(ie)q.bindTexture(q.TEXTURE_2D,ie.colorAttachment.get()),H.bindFramebuffer.set(ie.framebuffer);else{const he=q.createTexture();q.bindTexture(q.TEXTURE_2D,he),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ie=Y.heatmapFbo=H.createFramebuffer(W.width/4,W.height/4,!1,!1),function(Q,ae,pe,de){var ve,Se;const we=Q.gl,Ce=(ve=Q.HALF_FLOAT)!==null&&ve!==void 0?ve:we.UNSIGNED_BYTE,Ne=(Se=Q.RGBA16F)!==null&&Se!==void 0?Se:we.RGBA;we.texImage2D(we.TEXTURE_2D,0,Ne,ae.width/4,ae.height/4,0,we.RGBA,Ce,null),de.colorAttachment.set(pe)}(H,W,he,ie)}})(C,f,T),C.clear({color:l.aO.transparent});for(let H=0;H<k.length;H++){const W=k[H];if(w.hasRenderableParent(W))continue;const Y=w.getTile(W),q=Y.getBucket(T);if(!q)continue;const ie=q.programConfigurations.get(T.id),he=f.useProgram("heatmap",ie),{zoom:Q}=f.transform;he.draw(C,P.TRIANGLES,Et.disabled,M,F,Qt.disabled,Gl(W.posMatrix,Y,Q,T.paint.get("heatmap-intensity")),null,T.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,T.paint,f.transform.zoom,ie)}C.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(C,P){const M=C.context,F=M.gl,H=P.heatmapFbo;if(!H)return;M.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,H.colorAttachment.get()),M.activeTexture.set(F.TEXTURE1);let W=P.colorRampTexture;W||(W=P.colorRampTexture=new kt(M,P.colorRamp,F.RGBA)),W.bind(F.LINEAR,F.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(M,F.TRIANGLES,Et.disabled,ei.disabled,C.colorModeForRenderPass(),Qt.disabled,((Y,q,ie,he)=>{const Q=l.F();l.aN(Q,0,Y.width,Y.height,0,0,1);const ae=Y.context.gl;return{u_matrix:Q,u_world:[ae.drawingBufferWidth,ae.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(C,P),null,P.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,P.paint,C.transform.zoom)}(f,T))})(t,n,a,h);break;case"line":(function(f,w,T,k){if(f.renderPass!=="translucent")return;const C=T.paint.get("line-opacity"),P=T.paint.get("line-width");if(C.constantOr(1)===0||P.constantOr(1)===0)return;const M=f.depthModeForSublayer(0,Et.ReadOnly),F=f.colorModeForRenderPass(),H=T.paint.get("line-dasharray"),W=T.paint.get("line-pattern"),Y=W.constantOr(1),q=T.paint.get("line-gradient"),ie=T.getCrossfadeParameters(),he=Y?"linePattern":H?"lineSDF":q?"lineGradient":"line",Q=f.context,ae=Q.gl;let pe=!0;for(const de of k){const ve=w.getTile(de);if(Y&&!ve.patternsLoaded())continue;const Se=ve.getBucket(T);if(!Se)continue;const we=Se.programConfigurations.get(T.id),Ce=f.context.program.get(),Ne=f.useProgram(he,we),rt=pe||Ne.program!==Ce,De=f.style.map.terrain&&f.style.map.terrain.getTerrainData(de),tt=W.constantOr(null);if(tt&&ve.imageAtlas){const bt=ve.imageAtlas,mt=bt.patternPositions[tt.to.toString()],wt=bt.patternPositions[tt.from.toString()];mt&&wt&&we.setConstantPatternPositions(mt,wt)}const Ze=De?de:null,ii=Y?Bn(f,ve,T,ie,Ze):H?wa(f,ve,T,H,ie,Ze):q?Wl(f,ve,T,Se.lineClipsArray.length,Ze):ba(f,ve,T,Ze);if(Y)Q.activeTexture.set(ae.TEXTURE0),ve.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),we.updatePaintBuffers(ie);else if(H&&(rt||f.lineAtlas.dirty))Q.activeTexture.set(ae.TEXTURE0),f.lineAtlas.bind(Q);else if(q){const bt=Se.gradients[T.id];let mt=bt.texture;if(T.gradientVersion!==bt.version){let wt=256;if(T.stepInterpolant){const ki=w.getSource().maxzoom,Xt=de.canonical.z===ki?Math.ceil(1<<f.transform.maxZoom-de.canonical.z):1;wt=l.ac(l.aT(Se.maxLineLength/l.W*1024*Xt),256,Q.maxTextureSize)}bt.gradient=l.aU({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:bt.gradient||void 0,clips:Se.lineClipsArray}),bt.texture?bt.texture.update(bt.gradient):bt.texture=new kt(Q,bt.gradient,ae.RGBA),bt.version=T.gradientVersion,mt=bt.texture}Q.activeTexture.set(ae.TEXTURE0),mt.bind(T.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Ne.draw(Q,ae.TRIANGLES,M,f.stencilModeForClipping(de),F,Qt.disabled,ii,De,T.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,T.paint,f.transform.zoom,we,Se.layoutVertexBuffer2),pe=!1}})(t,n,a,h);break;case"fill":(function(f,w,T,k){const C=T.paint.get("fill-color"),P=T.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const M=f.colorModeForRenderPass(),F=T.paint.get("fill-pattern"),H=f.opaquePassEnabledForLayer()&&!F.constantOr(1)&&C.constantOr(l.aO.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===H){const W=f.depthModeForSublayer(1,f.renderPass==="opaque"?Et.ReadWrite:Et.ReadOnly);nc(f,w,T,k,W,M,!1)}if(f.renderPass==="translucent"&&T.paint.get("fill-antialias")){const W=f.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);nc(f,w,T,k,W,M,!0)}})(t,n,a,h);break;case"fill-extrusion":(function(f,w,T,k){const C=T.paint.get("fill-extrusion-opacity");if(C!==0&&f.renderPass==="translucent"){const P=new Et(f.context.gl.LEQUAL,Et.ReadWrite,f.depthRangeFor3D);if(C!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))Oa(f,w,T,k,P,ei.disabled,Si.disabled),Oa(f,w,T,k,P,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const M=f.colorModeForRenderPass();Oa(f,w,T,k,P,ei.disabled,M)}}})(t,n,a,h);break;case"hillshade":(function(f,w,T,k){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const C=f.context,P=f.depthModeForSublayer(0,Et.ReadOnly),M=f.colorModeForRenderPass(),[F,H]=f.renderPass==="translucent"?f.stencilConfigForOverlap(k):[{},k];for(const W of H){const Y=w.getTile(W);Y.needsHillshadePrepare!==void 0&&Y.needsHillshadePrepare&&f.renderPass==="offscreen"?Vo(f,Y,T,P,ei.disabled,M):f.renderPass==="translucent"&&Fa(f,W,Y,T,P,F[W.overscaledZ],M)}C.viewport.set([0,0,f.width,f.height])})(t,n,a,h);break;case"raster":(function(f,w,T,k){if(f.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!k.length)return;const C=f.context,P=C.gl,M=w.getSource(),F=f.useProgram("raster"),H=f.colorModeForRenderPass(),[W,Y]=M instanceof en?[{},k]:f.stencilConfigForOverlap(k),q=Y[Y.length-1].overscaledZ,ie=!f.options.moving;for(const he of Y){const Q=f.depthModeForSublayer(he.overscaledZ-q,T.paint.get("raster-opacity")===1?Et.ReadWrite:Et.ReadOnly,P.LESS),ae=w.getTile(he);ae.registerFadeDuration(T.paint.get("raster-fade-duration"));const pe=w.findLoadedParent(he,0),de=sc(ae,pe,w,T,f.transform,f.style.map.terrain);let ve,Se;const we=T.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;C.activeTexture.set(P.TEXTURE0),ae.texture.bind(we,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(P.TEXTURE1),pe?(pe.texture.bind(we,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),ve=Math.pow(2,pe.tileID.overscaledZ-ae.tileID.overscaledZ),Se=[ae.tileID.canonical.x*ve%1,ae.tileID.canonical.y*ve%1]):ae.texture.bind(we,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const Ce=f.style.map.terrain&&f.style.map.terrain.getTerrainData(he),Ne=Ce?he:null,rt=Ne?Ne.posMatrix:f.transform.calculatePosMatrix(he.toUnwrapped(),ie),De=Sa(rt,Se||[0,0],ve||1,de,T);M instanceof en?F.draw(C,P.TRIANGLES,Q,ei.disabled,H,Qt.disabled,De,Ce,T.id,M.boundsBuffer,f.quadTriangleIndexBuffer,M.boundsSegments):F.draw(C,P.TRIANGLES,Q,W[he.overscaledZ],H,Qt.disabled,De,Ce,T.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,n,a,h);break;case"background":(function(f,w,T,k){const C=T.paint.get("background-color"),P=T.paint.get("background-opacity");if(P===0)return;const M=f.context,F=M.gl,H=f.transform,W=H.tileSize,Y=T.paint.get("background-pattern");if(f.isPatternMissing(Y))return;const q=!Y&&C.a===1&&P===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==q)return;const ie=ei.disabled,he=f.depthModeForSublayer(0,q==="opaque"?Et.ReadWrite:Et.ReadOnly),Q=f.colorModeForRenderPass(),ae=f.useProgram(Y?"backgroundPattern":"background"),pe=k||H.coveringTiles({tileSize:W,terrain:f.style.map.terrain});Y&&(M.activeTexture.set(F.TEXTURE0),f.imageManager.bind(f.context));const de=T.getCrossfadeParameters();for(const ve of pe){const Se=k?ve.posMatrix:f.transform.calculatePosMatrix(ve.toUnwrapped()),we=Y?hh(Se,P,f,Y,{tileID:ve,tileSize:W},de):ch(Se,P,C),Ce=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ve);ae.draw(M,F.TRIANGLES,he,ie,Q,Qt.disabled,we,Ce,T.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,a,h);break;case"custom":(function(f,w,T){const k=f.context,C=T.implementation;if(f.renderPass==="offscreen"){const P=C.prerender;P&&(f.setCustomLayerDefaults(),k.setColorMode(f.colorModeForRenderPass()),P.call(C,k.gl,f.transform.customLayerMatrix()),k.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),k.setColorMode(f.colorModeForRenderPass()),k.setStencilMode(ei.disabled);const P=C.renderingMode==="3d"?new Et(f.context.gl.LEQUAL,Et.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Et.ReadOnly);k.setDepthMode(P),C.render(k.gl,f.transform.customLayerMatrix()),k.setDirty(),f.setBaseState(),k.bindFramebuffer.set(null)}})(t,0,a)}}translatePosMatrix(t,n,a,h,f){if(!a[0]&&!a[1])return t;const w=f?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(w){const C=Math.sin(w),P=Math.cos(w);a=[a[0]*P-a[1]*C,a[0]*C+a[1]*P]}const T=[f?a[0]:lt(n,a[0],this.transform.zoom),f?a[1]:lt(n,a[1],this.transform.zoom),0],k=new Float32Array(16);return l.H(k,t,T),k}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!n||!a}useProgram(t,n){this.cache=this.cache||{};const a=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new kn(this.context,Ls[t],n,Kl[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new kt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class Cn{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,a){const h=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const k=1/(T=l.af([],T,t))[3]/n*h;return l.a_(T,T,[k,k,1/T[3],k])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const k=function(F,H){var W=H[0],Y=H[1],q=H[2],ie=W*W+Y*Y+q*q;return ie>0&&(ie=1/Math.sqrt(ie)),F[0]=H[0]*ie,F[1]=H[1]*ie,F[2]=H[2]*ie,F}([],function(F,H,W){var Y=H[0],q=H[1],ie=H[2],he=W[0],Q=W[1],ae=W[2];return F[0]=q*ae-ie*Q,F[1]=ie*he-Y*ae,F[2]=Y*Q-q*he,F}([],dt([],f[T[0]],f[T[1]]),dt([],f[T[2]],f[T[1]]))),C=-((P=k)[0]*(M=f[T[1]])[0]+P[1]*M[1]+P[2]*M[2]);var P,M;return k.concat(C)});return new Cn(f,w)}}class An{constructor(t,n){this.min=t,this.max=n,this.center=function(a,h,f){return a[0]=.5*h[0],a[1]=.5*h[1],a[2]=.5*h[2],a}([],function(a,h,f){return a[0]=h[0]+f[0],a[1]=h[1]+f[1],a[2]=h[2]+f[2],a}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],a=yt(this.min),h=yt(this.max);for(let f=0;f<n.length;f++)a[f]=n[f]?this.min[f]:this.center[f],h[f]=n[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new An(a,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let h=0;h<t.planes.length;h++){const f=t.planes[h];let w=0;for(let T=0;T<n.length;T++)l.a$(f,n[T])>=0&&w++;if(w===0)return 0;w!==n.length&&(a=!1)}if(a)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let T=0;T<t.points.length;T++){const k=t.points[T][h]-this.min[h];f=Math.min(f,k),w=Math.max(w,k)}if(w<0||f>this.max[h]-this.min[h])return 0}return 1}}class ms{constructor(t=0,n=0,a=0,h=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=a,this.right=h}interpolate(t,n,a){return n.top!=null&&t.top!=null&&(this.top=l.z.number(t.top,n.top,a)),n.bottom!=null&&t.bottom!=null&&(this.bottom=l.z.number(t.bottom,n.bottom,a)),n.left!=null&&t.left!=null&&(this.left=l.z.number(t.left,n.left,a)),n.right!=null&&t.right!=null&&(this.right=l.z.number(t.right,n.right,a)),this}getCenter(t,n){const a=l.ac((this.left+t-this.right)/2,0,t),h=l.ac((this.top+n-this.bottom)/2,0,n);return new l.P(a,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ms(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Ua{constructor(t,n,a,h,f){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=h??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ms,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new Ua(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-l.b0(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new l.A(4);return l.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,h,f){var w=h[0],T=h[1],k=h[2],C=h[3],P=Math.sin(f),M=Math.cos(f);a[0]=w*M+k*P,a[1]=T*M+C*P,a[2]=w*-P+k*M,a[3]=T*-P+C*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=l.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,a){this._unmodified=!1,this._edgeInsets.interpolate(t,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new l.b1(0,t)];if(this._renderWorldCopies){const a=this.pointCoordinate(new l.P(0,0)),h=this.pointCoordinate(new l.P(this.width,0)),f=this.pointCoordinate(new l.P(this.width,this.height)),w=this.pointCoordinate(new l.P(0,this.height)),T=Math.floor(Math.min(a.x,h.x,f.x,w.x)),k=Math.floor(Math.max(a.x,h.x,f.x,w.x)),C=1;for(let P=T-C;P<=k+C;P++)P!==0&&n.push(new l.b1(P,t))}return n}coveringTiles(t){var n,a;let h=this.coveringZoomLevel(t);const f=h;if(t.minzoom!==void 0&&h<t.minzoom)return[];t.maxzoom!==void 0&&h>t.maxzoom&&(h=t.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),T=l.Y.fromLngLat(this.center),k=Math.pow(2,h),C=[k*w.x,k*w.y,0],P=[k*T.x,k*T.y,0],M=Cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let F=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=h);const H=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,W=Q=>({aabb:new An([Q*k,0,0],[(Q+1)*k,k,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),Y=[],q=[],ie=h,he=t.reparseOverscaled?f:h;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)Y.push(W(-Q)),Y.push(W(Q));for(Y.push(W(0));Y.length>0;){const Q=Y.pop(),ae=Q.x,pe=Q.y;let de=Q.fullyVisible;if(!de){const Ne=Q.aabb.intersects(M);if(Ne===0)continue;de=Ne===2}const ve=t.terrain?C:P,Se=Q.aabb.distanceX(ve),we=Q.aabb.distanceY(ve),Ce=Math.max(Math.abs(Se),Math.abs(we));if(Q.zoom===ie||Ce>H+(1<<ie-Q.zoom)-2&&Q.zoom>=F){const Ne=ie-Q.zoom,rt=C[0]-.5-(ae<<Ne),De=C[1]-.5-(pe<<Ne);q.push({tileID:new l.Q(Q.zoom===ie?he:Q.zoom,Q.wrap,Q.zoom,ae,pe),distanceSq:si([P[0]-.5-ae,P[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(rt*rt+De*De)})}else for(let Ne=0;Ne<4;Ne++){const rt=(ae<<1)+Ne%2,De=(pe<<1)+(Ne>>1),tt=Q.zoom+1;let Ze=Q.aabb.quadrant(Ne);if(t.terrain){const ii=new l.Q(tt,Q.wrap,tt,rt,De),bt=t.terrain.getMinMaxElevation(ii),mt=(n=bt.minElevation)!==null&&n!==void 0?n:this.elevation,wt=(a=bt.maxElevation)!==null&&a!==void 0?a:this.elevation;Ze=new An([Ze.min[0],Ze.min[1],mt],[Ze.max[0],Ze.max[1],wt])}Y.push({aabb:Ze,zoom:tt,x:rt,y:De,wrap:Q.wrap,fullyVisible:de})}}return q.sort((Q,ae)=>Q.distanceSq-ae.distanceSq).map(Q=>Q.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=l.ac(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.N(t.lng)*this.worldSize,l.O(n)*this.worldSize)}unproject(t){return new l.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),a=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-a))return;const h=this.getCameraPosition(),f=l.Y.fromLngLat(h.lngLat,h.altitude),w=l.Y.fromLngLat(n,a),T=f.x-w.x,k=f.y-w.y,C=f.z-w.z,P=Math.sqrt(T*T+k*k+C*C),M=this.scaleZoom(this.cameraToCenterDistance/P/this.tileSize);this._elevation=a,this._center=n,this.zoom=M}setLocationAtPoint(t,n){const a=this.pointCoordinate(n),h=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),w=new l.Y(f.x-(a.x-h.x),f.y-(a.y-h.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return l.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const F=n.pointCoordinate(t);if(F!=null)return F}const a=[t.x,t.y,0,1],h=[t.x,t.y,1,1];l.af(a,a,this.pixelMatrixInverse),l.af(h,h,this.pixelMatrixInverse);const f=a[3],w=h[3],T=a[1]/f,k=h[1]/w,C=a[2]/f,P=h[2]/w,M=C===P?0:(0-C)/(P-C);return new l.Y(l.z.number(a[0]/f,h[0]/w,M)/this.worldSize,l.z.number(T,k,M)/this.worldSize)}coordinatePoint(t,n=0,a=this.pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,n,1];return l.af(h,h,a),new l.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new qt().extend(this.pointLocation(new l.P(0,t))).extend(this.pointLocation(new l.P(this.width,t))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new qt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const a=t.key,h=n?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];const f=t.canonical,w=this.worldSize/this.zoomScale(f.z),T=f.x+Math.pow(2,f.z)*t.wrap,k=l.an(new Float64Array(16));return l.H(k,k,[T*w,f.y*w,0]),l.J(k,k,[w/l.W,w/l.W,1]),l.K(k,n?this.alignedProjMatrix:this.projMatrix,k),h[a]=new Float32Array(k),h[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,a,h,f=-90,w=90,T=-180,k=180;const C=this.size,P=this._unmodified;if(this.latRange){const H=this.latRange;f=l.O(H[1])*this.worldSize,w=l.O(H[0])*this.worldSize,t=w-f<C.y?C.y/(w-f):0}if(this.lngRange){const H=this.lngRange;T=l.b0(l.N(H[0])*this.worldSize,0,this.worldSize),k=l.b0(l.N(H[1])*this.worldSize,0,this.worldSize),k<T&&(k+=this.worldSize),n=k-T<C.x?C.x/(k-T):0}const M=this.point,F=Math.max(n||0,t||0);if(F)return this.center=this.unproject(new l.P(n?(k+T)/2:M.x,t?(w+f)/2:M.y)),this.zoom+=this.scaleZoom(F),this._unmodified=P,void(this._constraining=!1);if(this.latRange){const H=M.y,W=C.y/2;H-W<f&&(h=f+W),H+W>w&&(h=w-W)}if(this.lngRange){const H=(T+k)/2,W=l.b0(M.x,H-this.worldSize/2,H+this.worldSize/2),Y=C.x/2;W-Y<T&&(a=T+Y),W+Y>k&&(a=k-Y)}a===void 0&&h===void 0||(this.center=this.unproject(new l.P(a!==void 0?a:M.x,h!==void 0?h:M.y)).wrap()),this._unmodified=P,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b2(1,this.center.lat)*this.worldSize;let h=l.an(new Float64Array(16));l.J(h,h,[this.width/2,-this.height/2,1]),l.H(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=l.an(new Float64Array(16)),l.J(h,h,[1,-1,1]),l.H(h,h,[-1,-1,0]),l.J(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),T=f-w*this._pixelPerMeter/Math.cos(this._pitch),k=w<0?T:f,C=Math.PI/2+this._pitch,P=this._fov*(.5+t.y/this.height),M=Math.sin(P)*k/Math.sin(l.ac(Math.PI-C-P,.01,Math.PI-.01)),F=this.getHorizon(),H=2*Math.atan(F/this.cameraToCenterDistance)*(.5+t.y/(2*F)),W=Math.sin(H)*k/Math.sin(l.ac(Math.PI-C-H,.01,Math.PI-.01)),Y=Math.min(M,W),q=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+k),ie=this.height/50;h=new Float64Array(16),l.b3(h,this._fov,this.width/this.height,ie,q),h[8]=2*-t.x/this.width,h[9]=2*t.y/this.height,l.J(h,h,[1,-1,1]),l.H(h,h,[0,0,-this.cameraToCenterDistance]),l.b4(h,h,this._pitch),l.ad(h,h,this.angle),l.H(h,h,[-n,-a,0]),this.mercatorMatrix=l.J([],h,[this.worldSize,this.worldSize,this.worldSize]),l.J(h,h,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,h),l.H(h,h,[0,0,-this.elevation]),this.projMatrix=h,this.invProjMatrix=l.ar([],h),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,h);const he=this.width%2/2,Q=this.height%2/2,ae=Math.cos(this.angle),pe=Math.sin(this.angle),de=n-Math.round(n)+ae*he+pe*Q,ve=a-Math.round(a)+ae*Q+pe*he,Se=new Float64Array(h);if(l.H(Se,Se,[de>.5?de-1:de,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=Se,h=l.ar(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let a=n.x,h=n.y,f=n.x,w=n.y;for(const T of t)a=Math.min(a,T.x),h=Math.min(h,T.y),f=Math.max(f,T.x),w=Math.max(w,T.y);return[new l.P(a,h),new l.P(f,h),new l.P(f,w),new l.P(a,w),new l.P(a,h)]}}lngLatToCameraDepth(t,n){const a=this.locationCoordinate(t),h=[a.x*this.worldSize,a.y*this.worldSize,n,1];return l.af(h,h,this.projMatrix),h[2]/h[3]}}function Zo(d,t){let n,a=!1,h=null,f=null;const w=()=>{h=null,a&&(d.apply(f,n),h=setTimeout(w,t),a=!1)};return(...T)=>(a=!0,f=this,n=T,h||w(),h)}class Go{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=Zo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,h),w=Math.round(n.lng*f)/f,T=Math.round(n.lat*f)/f,k=this._map.getBearing(),C=this._map.getPitch();let P="";if(P+=t?`/${w}/${T}/${a}`:`${a}/${T}/${w}`,(k||C)&&(P+="/"+Math.round(10*k)/10),C&&(P+=`/${Math.round(C)}`),this._hashName){const M=this._hashName;let F=!1;const H=window.location.hash.slice(1).split("&").map(W=>{const Y=W.split("=")[0];return Y===M?(F=!0,`${Y}=${P}`):W}).filter(W=>W);return F||H.push(`${M}=${P}`),`#${H.join("&")}`}return`#${P}`}}const Vs={linearity:.3,easing:l.b5(0,0,.3,1)},cc=l.e({deceleration:2500,maxSpeed:1400},Vs),Nn=l.e({deceleration:20,maxSpeed:1400},Vs),hc=l.e({deceleration:1e3,maxSpeed:360},Vs),uc=l.e({deceleration:1e3,maxSpeed:90},Vs);class dc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Z.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=Z.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)n.zoom+=f.zoomDelta||0,n.bearing+=f.bearingDelta||0,n.pitch+=f.pitchDelta||0,f.panDelta&&n.pan._add(f.panDelta),f.around&&(n.around=f.around),f.pinchAround&&(n.pinchAround=f.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(n.pan.mag()){const f=qs(n.pan.mag(),a,l.e({},cc,t||{}));h.offset=n.pan.mult(f.amount/n.pan.mag()),h.center=this._map.transform.center,Ns(h,f)}if(n.zoom){const f=qs(n.zoom,a,Nn);h.zoom=this._map.transform.zoom+f.amount,Ns(h,f)}if(n.bearing){const f=qs(n.bearing,a,hc);h.bearing=this._map.transform.bearing+l.ac(f.amount,-179,179),Ns(h,f)}if(n.pitch){const f=qs(n.pitch,a,uc);h.pitch=this._map.transform.pitch+f.amount,Ns(h,f)}if(h.zoom||h.bearing){const f=n.pinchAround===void 0?n.around:n.pinchAround;h.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),l.e(h,{noMoveStart:!0})}}function Ns(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function qs(d,t,n){const{maxSpeed:a,linearity:h,deceleration:f}=n,w=l.ac(d*h/(t/1e3),-a,a),T=Math.abs(w)/(f*h);return{easing:n.easing,duration:1e3*T,amount:w*(T/2)}}class br extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a,h={}){const f=K.mousePos(n.getCanvas(),a),w=n.unproject(f);super(t,l.e({point:f,lngLat:w,originalEvent:a},h)),this._defaultPrevented=!1,this.target=n}}class gs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){const h=t==="touchend"?a.changedTouches:a.touches,f=K.touchPos(n.getCanvasContainer(),h),w=f.map(k=>n.unproject(k)),T=f.reduce((k,C,P,M)=>k.add(C.div(M.length)),new l.P(0,0));super(t,{points:f,point:T,lngLats:w,lngLat:n.unproject(T),originalEvent:a}),this._defaultPrevented=!1}}class qn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class pc{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new qn(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new br(t.type,this._map,t))}mouseup(t){this._map.fire(new br(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new br(t.type,this._map,t))}dblclick(t){return this._firePreventable(new br(t.type,this._map,t))}mouseover(t){this._map.fire(new br(t.type,this._map,t))}mouseout(t){this._map.fire(new br(t.type,this._map,t))}touchstart(t){return this._firePreventable(new gs(t.type,this._map,t))}touchmove(t){this._map.fire(new gs(t.type,this._map,t))}touchend(t){this._map.fire(new gs(t.type,this._map,t))}touchcancel(t){this._map.fire(new gs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new br(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new br(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.P.convert(t),this._map.terrain)}}class Ho{constructor(t,n){this._map=t,this._tr=new wr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(K.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=a,this._box||(this._box=K.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(h.x,a.x),w=Math.max(h.x,a.x),T=Math.min(h.y,a.y),k=Math.max(h.y,a.y);K.setTransform(this._box,`translate(${f}px,${T}px)`),this._box.style.width=w-f+"px",this._box.style.height=k-T+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const a=this._startPos,h=n;if(this.reset(),K.suppressClick(),a.x!==h.x||a.y!==h.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(a,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new l.k(t,{originalEvent:n}))}}function qr(d,t){if(d.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${t.length}`);const n={};for(let a=0;a<d.length;a++)n[d[a].identifier]=t[a];return n}class Zs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){const f=new l.P(0,0);for(const w of h)f._add(w);return f.div(h.length)}(n),this.touches=qr(a,n)))}touchmove(t,n,a){if(this.aborted||!this.centroid)return;const h=qr(a,n);for(const f in this.touches){const w=h[f];(!w||w.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,n,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Wo{constructor(t){this.singleTap=new Zs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,a){this.singleTap.touchstart(t,n,a)}touchmove(t,n,a){this.singleTap.touchmove(t,n,a)}touchend(t,n,a){const h=this.singleTap.touchend(t,n,a);if(h){const f=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(h)<30;if(f&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class bh{constructor(t){this._tr=new wr(t),this._zoomIn=new Wo({numTouches:1,numTaps:2}),this._zoomOut=new Wo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,a){this._zoomIn.touchstart(t,n,a),this._zoomOut.touchstart(t,n,a)}touchmove(t,n,a){this._zoomIn.touchmove(t,n,a),this._zoomOut.touchmove(t,n,a)}touchend(t,n,a){const h=this._zoomIn.touchend(t,n,a),f=this._zoomOut.touchend(t,n,a),w=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(h)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gs{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=n.length?n[0]:n;return!this._moved&&h.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(a,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&K.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fc={0:1,2:2};class Zn{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=K.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,a){const h=fc[a];return n.buttons===void 0||(n.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return K.mouseButton(t)===this._eventButton}}class fn{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Ve=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=function(t){t.preventDefault()}},Ko=({enable:d,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const a=new Zn({checkCorrectEvent:h=>K.mouseButton(h)===0&&h.ctrlKey||K.mouseButton(h)===2});return new Gs({clickTolerance:t,move:(h,f)=>({bearingDelta:(f.x-h.x)*n}),moveStateManager:a,enable:d,assignEvents:Ve})},_s=({enable:d,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new Zn({checkCorrectEvent:h=>K.mouseButton(h)===0&&h.ctrlKey||K.mouseButton(h)===2});return new Gs({clickTolerance:t,move:(h,f)=>({pitchDelta:(f.y-h.y)*n}),moveStateManager:a,enable:d,assignEvents:Ve})};class Hs{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,n,a){return this._calculateTransform(t,n,a)}touchmove(t,n,a){if(this._active&&!(a.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,n,a)}touchend(t,n,a){this._calculateTransform(t,n,a),this._active&&a.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,a){a.length>0&&(this._active=!0);const h=qr(a,n),f=new l.P(0,0),w=new l.P(0,0);let T=0;for(const C in h){const P=h[C],M=this._touches[C];M&&(f._add(P),w._add(P.sub(M)),T++,h[C]=P)}if(this._touches=h,T<this.minTouchs()||!w.mag())return;const k=w.div(T);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(T),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Va{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,a){if(!this._firstTwoTouches)return;t.preventDefault();const[h,f]=this._firstTwoTouches,w=Oe(a,n,h),T=Oe(a,n,f);if(!w||!T)return;const k=this._aroundCenter?null:w.add(T).div(2);return this._move([w,T],k,t)}touchend(t,n,a){if(!this._firstTwoTouches)return;const[h,f]=this._firstTwoTouches,w=Oe(a,n,h),T=Oe(a,n,f);w&&T||(this._active&&K.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Oe(d,t,n){for(let a=0;a<d.length;a++)if(d[a].identifier===n)return t[a]}function Na(d,t){return Math.log(d/t)/Math.LN2}class mc extends Va{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Na(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Na(this._distance,a),pinchAround:n}}}function gc(d,t){return 180*d.angleWith(t)/Math.PI}class qa extends Va{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,a){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:gc(this._vector,h),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,a=gc(t,this._startVector);return Math.abs(a)<n}}function Za(d){return Math.abs(d.y)>Math.abs(d.x)}class Xo extends Va{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,a){super.touchstart(t,n,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Za(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,f,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,a){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,f=n.mag()>=2;if(!h&&!f)return;if(!h||!f)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const w=t.y>0==n.y>0;return Za(t)&&Za(n)&&w}}const wh={panStep:100,bearingStep:15,pitchStep:10};class _c{constructor(t){this._tr=new wr(t);const n=wh;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,a=0,h=0,f=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(a=0,h=0),{cameraAnimation:T=>{const k=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:Gn,zoom:n?Math.round(k.zoom)+n*(t.shiftKey?2:1):k.zoom,bearing:k.bearing+a*this._bearingStep,pitch:k.pitch+h*this._pitchStep,offset:[-f*this._panStep,-w*this._panStep],center:k.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gn(d){return d*(2-d)}const ti=4.000244140625;class Ws{constructor(t,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new wr(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const a=Z.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%ti==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=K.mousePos(this._map.getCanvas(),t),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?l.M.convert(this._aroundCenter?a.center:a.unproject(n)):l.M.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>ti?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&k!==0&&(k=1/k);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*k))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,a=this._startZoom,h=this._easing;let f,w=!1;if(this._type==="wheel"&&a&&h){const T=Math.min((Z.now()-this._lastWheelEventTime)/200,1),k=h(T);f=l.z.number(a,n,k),T<1?this._frameId||(this._frameId=!0):w=!0}else f=n,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=l.b6;if(this._prevEase){const a=this._prevEase,h=(Z.now()-a.start)/a.duration,f=a.easing(h+.01)-a.easing(h),w=.27/Math.sqrt(f*f+1e-4)*.01,T=Math.sqrt(.0729-w*w);n=l.b5(w,T,.25,1)}return this._prevEase={start:Z.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ga{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yc{constructor(t){this._tr=new wr(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vc{constructor(){this._tap=new Wo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,a){if(!this._swipePoint)if(this._tapTime){const h=n[0],f=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(h)<30;f&&w?a.length>0&&(this._swipePoint=h,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,n,a)}touchmove(t,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const h=n[0],f=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,n,a)}touchend(t,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const h=this._tap.touchend(t,n,a);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jo{constructor(t,n,a){this._el=t,this._mousePan=n,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xc{constructor(t,n,a){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wr{constructor(t,n,a,h){this._el=t,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ks{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=K.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=n,this._container.appendChild(h);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=a,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(K.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ke=d=>d.zoom||d.drag||d.pitch||d.rotate;class st extends l.k{}function ys(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Yo{constructor(t,n){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,f)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=h.type==="renderFrame"?void 0:h,T={needsRenderFrame:!1},k={},C={},P=h.touches,M=P?this._getMapTouches(P):void 0,F=M?K.touchPos(this._map.getCanvas(),M):K.mousePos(this._map.getCanvas(),h);for(const{handlerName:Y,handler:q,allowed:ie}of this._handlers){if(!q.isEnabled())continue;let he;this._blockedByActive(C,ie,Y)?q.reset():q[f||h.type]&&(he=q[f||h.type](h,F,M),this.mergeHandlerResult(T,k,he,Y,w),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||q.isActive())&&(C[Y]=q)}const H={};for(const Y in this._previousActiveHandlers)C[Y]||(H[Y]=w);this._previousActiveHandlers=C,(Object.keys(H).length||ys(T))&&(this._changes.push([T,k,H]),this._triggerRenderFrame()),(Object.keys(C).length||ys(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=T;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dc(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,f,w]of this._listeners)K.addEventListener(h,f,h===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,n,a]of this._listeners)K.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new pc(n,t));const h=n.boxZoom=new Ho(n,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const f=n.cooperativeGestures=new Ks(n,t.cooperativeGestures);this._add("cooperativeGestures",f),t.cooperativeGestures&&f.enable();const w=new bh(n),T=new yc(n);n.doubleClickZoom=new Ga(T,w),this._add("tapZoom",w),this._add("clickZoom",T),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const k=new vc;this._add("tapDragZoom",k);const C=n.touchPitch=new Xo(n);this._add("touchPitch",C),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const P=Ko(t),M=_s(t);n.dragRotate=new xc(t,P,M),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const F=(({enable:he,clickTolerance:Q})=>{const ae=new Zn({checkCorrectEvent:pe=>K.mouseButton(pe)===0&&!pe.ctrlKey});return new Gs({clickTolerance:Q,move:(pe,de)=>({around:de,panDelta:de.sub(pe)}),activateOnStart:!0,moveStateManager:ae,enable:he,assignEvents:Ve})})(t),H=new Hs(t,n);n.dragPan=new Jo(a,F,H),this._add("mousePan",F),this._add("touchPan",H,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const W=new qa,Y=new mc;n.touchZoomRotate=new Wr(a,Y,W,k),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const q=n.scrollZoom=new Ws(n,()=>this._triggerRenderFrame());this._add("scrollZoom",q,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const ie=n.keyboard=new _c(n);this._add("keyboard",ie),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Hr(n))}_add(t,n,a){this._handlers.push({handlerName:t,handler:n,allowed:a}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ke(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,a){for(const h in t)if(h!==a&&(!n||n.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const a of t)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(t,n,a,h,f){if(!a)return;l.e(t,a);const w={handlerName:h,originalEvent:a.originalEvent||f};a.zoomDelta!==void 0&&(n.zoom=w),a.panDelta!==void 0&&(n.drag=w),a.pitchDelta!==void 0&&(n.pitch=w),a.bearingDelta!==void 0&&(n.rotate=w)}_applyChanges(){const t={},n={},a={};for(const[h,f,w]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),l.e(n,f),l.e(a,w);this._updateMapTransform(t,n,a),this._changes=[]}_updateMapTransform(t,n,a){const h=this._map,f=h._getTransformForUpdate(),w=h.terrain;if(!(ys(t)||w&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:T,zoomDelta:k,bearingDelta:C,pitchDelta:P,around:M,pinchAround:F}=t;F!==void 0&&(M=F),h._stop(!0),M=M||h.transform.centerPoint;const H=f.pointLocation(T?M.sub(T):M);C&&(f.bearing+=C),P&&(f.pitch+=P),k&&(f.zoom+=k),w?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(T)):f.setLocationAtPoint(H,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(H,M),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(h.terrain)})):f.setLocationAtPoint(H,M),h._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,a,!0)}_fireEvents(t,n,a){const h=Ke(this._eventsInProgress),f=Ke(t),w={};for(const P in t){const{originalEvent:M}=t[P];this._eventsInProgress[P]||(w[`${P}start`]=M),this._eventsInProgress[P]=t[P]}!h&&f&&this._fireEvent("movestart",f.originalEvent);for(const P in w)this._fireEvent(P,w[P]);f&&this._fireEvent("move",f.originalEvent);for(const P in t){const{originalEvent:M}=t[P];this._fireEvent(P,M)}const T={};let k;for(const P in this._eventsInProgress){const{handlerName:M,originalEvent:F}=this._eventsInProgress[P];this._handlersById[M].isActive()||(delete this._eventsInProgress[P],k=n[M]||F,T[`${P}end`]=k)}for(const P in T)this._fireEvent(P,T[P]);const C=Ke(this._eventsInProgress);if(a&&(h||f)&&!C){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!P||!P.essential&&Z.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:k})),M(this._map.getBearing())&&this._map.resetNorth()):(M(P.bearing||this._map.getBearing())&&(P.bearing=0),P.freezeElevation=!0,this._map.easeTo(P,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new l.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new st("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Qo extends l.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const a=Math.min((Z.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,a){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},n),a)}panTo(t,n,a){return this.easeTo(l.e({center:t},n),a)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,a){return this.easeTo(l.e({zoom:t},n),a)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,a){return this.easeTo(l.e({bearing:t},n),a)}resetNorth(t,n){return this.rotateTo(0,l.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=qt.convert(t);const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,n)}_cameraForBoxAndBearing(t,n,a,h){const f={top:0,bottom:0,right:0,left:0};if(typeof(h=l.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const Ne=h.padding;h.padding={top:Ne,bottom:Ne,right:Ne,left:Ne}}h.padding=l.e(f,h.padding);const w=this.transform,T=w.padding,k=new qt(t,n),C=w.project(k.getNorthWest()),P=w.project(k.getNorthEast()),M=w.project(k.getSouthEast()),F=w.project(k.getSouthWest()),H=l.b7(-a),W=C.rotate(H),Y=P.rotate(H),q=M.rotate(H),ie=F.rotate(H),he=new l.P(Math.max(W.x,Y.x,ie.x,q.x),Math.max(W.y,Y.y,ie.y,q.y)),Q=new l.P(Math.min(W.x,Y.x,ie.x,q.x),Math.min(W.y,Y.y,ie.y,q.y)),ae=he.sub(Q),pe=(w.width-(T.left+T.right+h.padding.left+h.padding.right))/ae.x,de=(w.height-(T.top+T.bottom+h.padding.top+h.padding.bottom))/ae.y;if(de<0||pe<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ve=Math.min(w.scaleZoom(w.scale*Math.min(pe,de)),h.maxZoom),Se=l.P.convert(h.offset),we=new l.P((h.padding.left-h.padding.right)/2,(h.padding.top-h.padding.bottom)/2).rotate(l.b7(a)),Ce=Se.add(we).mult(w.scale/w.zoomScale(ve));return{center:w.unproject(C.add(M).div(2).sub(Ce)),zoom:ve,bearing:a}}fitBounds(t,n,a){return this._fitInternal(this.cameraForBounds(t,n),n,a)}fitScreenCoordinates(t,n,a,h,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(t)),this.transform.pointLocation(l.P.convert(n)),a,h),h,f)}_fitInternal(t,n,a){return t?(delete(n=l.e(t,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(t,n){this.stop();const a=this._getTransformForUpdate();let h=!1,f=!1,w=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(h=!0,a.zoom=+t.zoom),t.center!==void 0&&(a.center=l.M.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(f=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(w=!0,a.pitch=+t.pitch),t.padding==null||a.isPaddingEqual(t.padding)||(a.padding=t.padding),this._applyUpdatedTransform(a),this.fire(new l.k("movestart",n)).fire(new l.k("move",n)),h&&this.fire(new l.k("zoomstart",n)).fire(new l.k("zoom",n)).fire(new l.k("zoomend",n)),f&&this.fire(new l.k("rotatestart",n)).fire(new l.k("rotate",n)).fire(new l.k("rotateend",n)),w&&this.fire(new l.k("pitchstart",n)).fire(new l.k("pitch",n)).fire(new l.k("pitchend",n)),this.fire(new l.k("moveend",n))}calculateCameraOptionsFromTo(t,n,a,h=0){const f=l.Y.fromLngLat(t,n),w=l.Y.fromLngLat(a,h),T=w.x-f.x,k=w.y-f.y,C=w.z-f.z,P=Math.hypot(T,k,C);if(P===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(T,k),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),H=180*Math.atan2(T,-k)/Math.PI;let W=180*Math.acos(M/P)/Math.PI;return W=C<0?90-W:90+W,{center:w.toLngLat(),zoom:F,pitch:W,bearing:H}}easeTo(t,n){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.b6},t)).animate===!1||!t.essential&&Z.prefersReducedMotion)&&(t.duration=0);const a=this._getTransformForUpdate(),h=this.getZoom(),f=this.getBearing(),w=this.getPitch(),T=this.getPadding(),k="zoom"in t?+t.zoom:h,C="bearing"in t?this._normalizeBearing(t.bearing,f):f,P="pitch"in t?+t.pitch:w,M="padding"in t?t.padding:a.padding,F=l.P.convert(t.offset);let H=a.centerPoint.add(F);const W=a.pointLocation(H),Y=l.M.convert(t.center||W);this._normalizeCenter(Y);const q=a.project(W),ie=a.project(Y).sub(q),he=a.zoomScale(k-h);let Q,ae;t.around&&(Q=l.M.convert(t.around),ae=a.locationPoint(Q));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==h,this._rotating=this._rotating||f!==C,this._pitching=this._pitching||P!==w,this._padding=!a.isPaddingEqual(M),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,pe),this.terrain&&this._prepareElevation(Y),this._ease(de=>{if(this._zooming&&(a.zoom=l.z.number(h,k,de)),this._rotating&&(a.bearing=l.z.number(f,C,de)),this._pitching&&(a.pitch=l.z.number(w,P,de)),this._padding&&(a.interpolatePadding(T,M,de),H=a.centerPoint.add(F)),this.terrain&&!t.freezeElevation&&this._updateElevation(de),Q)a.setLocationAtPoint(Q,ae);else{const ve=a.zoomScale(a.zoom-h),Se=k>h?Math.min(2,he):Math.max(.5,he),we=Math.pow(Se,1-de),Ce=a.unproject(q.add(ie.mult(de*we)).mult(ve));a.setLocationAtPoint(a.renderWorldCopies?Ce.wrap():Ce,H)}this._applyUpdatedTransform(a),this._fireMoveEvents(n)},de=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,de)},t),this}_prepareEase(t,n,a={}){this._moving=!0,n||a.moving||this.fire(new l.k("movestart",t)),this._zooming&&!a.zooming&&this.fire(new l.k("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new l.k("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new l.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(n-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:a,zoom:h,pitch:f,bearing:w,elevation:T}=this.transformCameraUpdate(n);a&&(n.center=a),h!==void 0&&(n.zoom=h),f!==void 0&&(n.pitch=f),w!==void 0&&(n.bearing=w),T!==void 0&&(n.elevation=T),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new l.k("move",t)),this._zooming&&this.fire(new l.k("zoom",t)),this._rotating&&this.fire(new l.k("rotate",t)),this._pitching&&this.fire(new l.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,h=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new l.k("zoomend",t)),h&&this.fire(new l.k("rotateend",t)),f&&this.fire(new l.k("pitchend",t)),this.fire(new l.k("moveend",t))}flyTo(t,n){if(!t.essential&&Z.prefersReducedMotion){const Ze=l.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ze,n)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b6},t);const a=this._getTransformForUpdate(),h=this.getZoom(),f=this.getBearing(),w=this.getPitch(),T=this.getPadding(),k="zoom"in t?l.ac(+t.zoom,a.minZoom,a.maxZoom):h,C="bearing"in t?this._normalizeBearing(t.bearing,f):f,P="pitch"in t?+t.pitch:w,M="padding"in t?t.padding:a.padding,F=a.zoomScale(k-h),H=l.P.convert(t.offset);let W=a.centerPoint.add(H);const Y=a.pointLocation(W),q=l.M.convert(t.center||Y);this._normalizeCenter(q);const ie=a.project(Y),he=a.project(q).sub(ie);let Q=t.curve;const ae=Math.max(a.width,a.height),pe=ae/F,de=he.mag();if("minZoom"in t){const Ze=l.ac(Math.min(t.minZoom,h,k),a.minZoom,a.maxZoom),ii=ae/a.zoomScale(Ze-h);Q=Math.sqrt(ii/de*2)}const ve=Q*Q;function Se(Ze){const ii=(pe*pe-ae*ae+(Ze?-1:1)*ve*ve*de*de)/(2*(Ze?pe:ae)*ve*de);return Math.log(Math.sqrt(ii*ii+1)-ii)}function we(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ce(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Ne=Se(!1);let rt=function(Ze){return Ce(Ne)/Ce(Ne+Q*Ze)},De=function(Ze){return ae*((Ce(Ne)*(we(ii=Ne+Q*Ze)/Ce(ii))-we(Ne))/ve)/de;var ii},tt=(Se(!0)-Ne)/Q;if(Math.abs(de)<1e-6||!isFinite(tt)){if(Math.abs(ae-pe)<1e-6)return this.easeTo(t,n);const Ze=pe<ae?-1:1;tt=Math.abs(Math.log(pe/ae))/Q,De=function(){return 0},rt=function(ii){return Math.exp(Ze*Q*ii)}}return t.duration="duration"in t?+t.duration:1e3*tt/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==C,this._pitching=P!==w,this._padding=!a.isPaddingEqual(M),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(q),this._ease(Ze=>{const ii=Ze*tt,bt=1/rt(ii);a.zoom=Ze===1?k:h+a.scaleZoom(bt),this._rotating&&(a.bearing=l.z.number(f,C,Ze)),this._pitching&&(a.pitch=l.z.number(w,P,Ze)),this._padding&&(a.interpolatePadding(T,M,Ze),W=a.centerPoint.add(H)),this.terrain&&!t.freezeElevation&&this._updateElevation(Ze);const mt=Ze===1?q:a.unproject(ie.add(he.mult(De(ii))).mult(bt));a.setLocationAtPoint(a.renderWorldCopies?mt.wrap():mt,W),this._applyUpdatedTransform(a),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,n)}if(!t){const a=this.handlers;a&&a.stop(!1)}return this}_ease(t,n,a){a.animate===!1||a.duration===0?(t(1),n()):(this._easeStart=Z.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=l.b0(t,-180,180);const a=Math.abs(t-n);return Math.abs(t-360-n)<a&&(t-=360),Math.abs(t+360-n)<a&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const a=t.lng-n.center.lng;t.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const dr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class $o{constructor(t=dr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=K.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=K.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const a=this._map._getUIString(`AttributionControl.${n}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const n=this._map.style.sourceCaches;for(const h in n){const f=n[h];if(f.used||f.usedForTerrain){const w=f.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,f)=>h.length-f.length),t=t.filter((h,f)=>{for(let w=f+1;w<t.length;w++)if(t[w].indexOf(h)>=0)return!1;return!0});const a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Kr{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=K.create("div","maplibregl-ctrl");const n=K.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){K.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const h of a)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xs=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class vi extends l.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const a={};for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),l.aN(h.posMatrix,0,l.W,0,l.W,0,1),this._tiles[h.key]=new tn(h,this.tileSize));for(const h in this._tiles)a[h]||delete this._tiles[h]}freeRtt(t){for(const n in this._tiles){const a=this._tiles[n];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const a of this._renderableTilesKeys){const h=this._tiles[a].tileID;if(h.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),l.aN(f.posMatrix,0,l.W,0,l.W,0,1),n[a]=f}else if(h.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const w=h.canonical.z-t.canonical.z,T=h.canonical.x-(h.canonical.x>>w<<w),k=h.canonical.y-(h.canonical.y>>w<<w),C=l.W>>w;l.aN(f.posMatrix,0,C,0,C,0,1),l.H(f.posMatrix,f.posMatrix,[-T*C,-k*C,0]),n[a]=f}else if(t.canonical.isChildOf(h.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const w=t.canonical.z-h.canonical.z,T=t.canonical.x-(t.canonical.x>>w<<w),k=t.canonical.y-(t.canonical.y>>w<<w),C=l.W>>w;l.aN(f.posMatrix,0,l.W,0,l.W,0,1),l.H(f.posMatrix,f.posMatrix,[T*C,k*C,0]),l.J(f.posMatrix,f.posMatrix,[1/2**w,1/2**w,0]),n[a]=f}}return n}getSourceTile(t,n){const a=this.sourceCache._source;let h=t.overscaledZ-this.deltaZoom;if(h>a.maxzoom&&(h=a.maxzoom),h<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&n)for(;h>=a.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(h--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class Ti{constructor(t,n,a){this.painter=t,this.sourceCache=new vi(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,a,h=l.W){var f;if(!(n>=0&&n<h&&a>=0&&a<h))return 0;const w=this.getTerrainData(t),T=(f=w.tile)===null||f===void 0?void 0:f.dem;if(!T)return 0;const k=function(W,Y,q){var ie=Y[0],he=Y[1];return W[0]=q[0]*ie+q[4]*he+q[12],W[1]=q[1]*ie+q[5]*he+q[13],W}([],[n/h*l.W,a/h*l.W],w.u_terrain_matrix),C=[k[0]*T.dim,k[1]*T.dim],P=Math.floor(C[0]),M=Math.floor(C[1]),F=C[0]-P,H=C[1]-M;return T.get(P,M)*(1-F)*(1-H)+T.get(P+1,M)*F*(1-H)+T.get(P,M+1)*(1-F)*H+T.get(P+1,M+1)*F*H}getElevationForLngLatZoom(t,n){const{tileID:a,mercatorX:h,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(a,h%l.W,f%l.W,l.W)}getElevation(t,n,a,h=l.W){return this.getDEMElevation(t,n,a,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,f=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new kt(h,f,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new kt(h,new l.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const h=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new kt(h,n.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),n.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){const h=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?f=t.canonical.z-h:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>f<<f),T=t.canonical.y-(t.canonical.y>>f<<f),k=l.b8(new Float64Array(16),[1/(l.W<<f),1/(l.W<<f),0]);l.H(k,k,[w*l.W,T*l.W,0]),this._demMatrixCache[t.key]={matrix:k,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,a=n.width/devicePixelRatio,h=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new kt(n.context,{width:a,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new kt(n.context,{width:a,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,h,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,w=0;f<this._coordsTextureSize;f++)for(let T=0;T<this._coordsTextureSize;T++,w+=4)n[w+0]=255&T,n[w+1]=255&f,n[w+2]=T>>8<<4|f>>8,n[w+3]=0;const a=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),h=new kt(t,a,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){const n=new Uint8Array(4),a=this.painter.context,h=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const f=n[0]+(n[2]>>4<<8),w=n[1]+((15&n[2])<<8),T=this.coordsIndex[255-n[3]],k=T&&this.sourceCache.getTileByID(T);if(!k)return null;const C=this._coordsTextureSize,P=(1<<k.tileID.canonical.z)*C;return new l.Y((k.tileID.canonical.x*C+f)/P+k.tileID.wrap,(k.tileID.canonical.y*C+w)/P,this.getElevation(k.tileID,f,w,C))}depthAtPoint(t){const n=new Uint8Array(4),a=this.painter.context,h=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new l.b9,a=new l.aX,h=this.meshSize,f=l.W/h,w=h*h;for(let M=0;M<=h;M++)for(let F=0;F<=h;F++)n.emplaceBack(F*f,M*f,0);for(let M=0;M<w;M+=h+1)for(let F=0;F<h;F++)a.emplaceBack(F+M,h+F+M+1,h+F+M+2),a.emplaceBack(F+M,h+F+M+2,F+M+1);const T=n.length,k=T+2*(h+1);for(const M of[0,1])for(let F=0;F<=h;F++)for(const H of[0,1])n.emplaceBack(F*f,M*l.W,H);for(let M=0;M<2*h;M+=2)a.emplaceBack(k+M,k+M+1,k+M+3),a.emplaceBack(k+M,k+M+3,k+M+2),a.emplaceBack(T+M,T+M+3,T+M+1),a.emplaceBack(T+M,T+M+2,T+M+3);const C=n.length,P=C+2*(h+1);for(const M of[0,1])for(let F=0;F<=h;F++)for(const H of[0,1])n.emplaceBack(M*l.W,F*f,H);for(let M=0;M<2*h;M+=2)a.emplaceBack(C+M,C+M+1,C+M+3),a.emplaceBack(C+M,C+M+3,C+M+2),a.emplaceBack(P+M,P+M+3,P+M+1),a.emplaceBack(P+M,P+M+2,P+M+3);return this._mesh={indexBuffer:t.createIndexBuffer(a),vertexBuffer:t.createVertexBuffer(n,Xs.members),segments:l.$.simpleSegment(0,0,n.length,a.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.ba/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var a;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(a=this.getMinMaxElevation(h).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,n){const a=l.Y.fromLngLat(t.wrap()),h=(1<<n)*l.W,f=a.x*h,w=a.y*h,T=Math.floor(f/l.W),k=Math.floor(w/l.W);return{tileID:new l.Q(n,0,n,T,k),mercatorX:f,mercatorY:w}}}class bc{constructor(t,n,a){this._context=t,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new kt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:t,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const an={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ha{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new bc(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in t.sourceCaches){this._coordsDescendingInv[a]={};const h=t.sourceCaches[a].getVisibleCoordinates();for(const f of h){const w=this.terrain.sourceCache.getTerrainCoords(f);for(const T in w)this._coordsDescendingInv[a][T]||(this._coordsDescendingInv[a][T]=[]),this._coordsDescendingInv[a][T].push(w[T])}}this._coordsDescendingInvStr={};for(const a of t._order){const h=t._layers[a],f=h.source;if(an[h.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const w in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][w]=this._coordsDescendingInv[f][w].map(T=>T.key).sort().join()}}for(const a of this._renderableTiles)for(const h in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[h][a.tileID.key];f&&f!==a.rttCoords[h]&&(a.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,a=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(an[n]&&(this._prevType&&an[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!h))return!0;if(an[this._prevType]||an[n]&&h){this._prevType=n;const f=this._stacks.length-1,w=this._stacks[f]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(ja(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[f]){const C=this.pool.getObjectForId(T.rtt[f].id);if(C.stamp===T.rtt[f].stamp){this.pool.useObject(C);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),T.rtt[f]={id:k.id,stamp:k.stamp},a.context.bindFramebuffer.set(k.fbo.framebuffer),a.context.clear({color:l.aO.transparent,stencil:0}),a.currentStencilSource=void 0;for(let C=0;C<w.length;C++){const P=a.style._layers[w[C]],M=P.source?this._coordsDescendingInv[P.source][T.tileID.key]:[T.tileID];a.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),a._renderTileClippingMasks(P,M),a.renderLayer(a,a.style.sourceCaches[P.source],P,M),P.source&&(T.rttCoords[P.source]=this._coordsDescendingInvStr[P.source][T.tileID.key])}}return ja(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),an[n]}return!1}}const el={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},tl=D,il={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:dr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},vs=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},rl={showCompass:!0,showZoom:!0,visualizePitch:!1};class nl{constructor(t,n,a=!1){this.mousedown=w=>{this.startMouse(l.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),K.mousePos(this.element,w)),K.addEventListener(window,"mousemove",this.mousemove),K.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,K.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),K.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const h=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Ko({clickTolerance:h,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:T,bearingDegreesPerPixelMoved:k=.8})=>{const C=new fn;return new Gs({clickTolerance:T,move:(P,M)=>({bearingDelta:(M.x-P.x)*k}),moveStateManager:C,enable:w,assignEvents:vs})})({clickTolerance:h,enable:!0}),this.map=t,a&&(this.mousePitch=_s({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:T,pitchDegreesPerPixelMoved:k=-.5})=>{const C=new fn;return new Gs({clickTolerance:T,move:(P,M)=>({pitchDelta:(M.y-P.y)*k}),moveStateManager:C,enable:w,assignEvents:vs})})({clickTolerance:f,enable:!0})),K.addEventListener(n,"mousedown",this.mousedown),K.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),K.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),K.disableDrag()}moveMouse(t,n){const a=this.map,{bearingDelta:h}=this.mouseRotate.dragMove(t,n)||{};if(h&&a.setBearing(a.getBearing()+h),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,n)||{};f&&a.setPitch(a.getPitch()+f)}}moveTouch(t,n){const a=this.map,{bearingDelta:h}=this.touchRotate.dragMove(t,n)||{};if(h&&a.setBearing(a.getBearing()+h),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,n)||{};f&&a.setPitch(a.getPitch()+f)}}off(){const t=this.element;K.removeEventListener(t,"mousedown",this.mousedown),K.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend),K.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){K.enableDrag(),K.removeEventListener(window,"mousemove",this.mousemove),K.removeEventListener(window,"mouseup",this.mouseup),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend)}}let mn;function Wa(d,t,n){if(d=new l.M(d.lng,d.lat),t){const a=new l.M(d.lng-360,d.lat),h=new l.M(d.lng+360,d.lat),f=n.locationPoint(d).distSqr(t);n.locationPoint(a).distSqr(t)<f?d=a:n.locationPoint(h).distSqr(t)<f&&(d=h)}for(;Math.abs(d.lng-n.center.lng)>180;){const a=n.locationPoint(d);if(a.x>=0&&a.y>=0&&a.x<=n.width&&a.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d}const Js={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ka(d,t,n){const a=d.classList;for(const h in Js)a.remove(`maplibregl-${n}-anchor-${h}`);a.add(`maplibregl-${n}-anchor-${t}`)}class Ys extends l.E{constructor(t){if(super(),this._onKeyPress=n=>{const a=n.code,h=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!a)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Wa(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,`${Js[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${h}`),Z.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div"),this._element.setAttribute("aria-label","Map marker");const n=K.createNS("http://www.w3.org/2000/svg","svg"),a=41,h=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${h}px`),n.setAttributeNS(null,"viewBox",`0 0 ${h} ${a}`);const f=K.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const w=K.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const T=K.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ie of k){const he=K.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ie.rx),he.setAttributeNS(null,"ry",ie.ry),T.appendChild(he)}const C=K.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const P=K.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(P);const M=K.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=K.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const H=K.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const W=K.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=K.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const q=K.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#FFFFFF"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962"),W.appendChild(Y),W.appendChild(q),w.appendChild(T),w.appendChild(C),w.appendChild(M),w.appendChild(H),w.appendChild(W),n.appendChild(w),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(n),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ka(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_updateOpacity(t=!1){var n;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const a=this._map,h=a.terrain.depthAtPoint(this._pos),f=a.terrain.getElevationForLngLatZoom(this._lngLat,a.transform.tileZoom);if(a.transform.lngLatToCameraDepth(this._lngLat,f)-h<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/a.transform._pixelPerMeter,T=Math.sin(a.getPitch()*Math.PI/180)*w,k=a.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),C=a.transform.lngLatToCameraDepth(this._lngLat,f+T);this._element.style.opacity=C-k>.006?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return t===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const sl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Hn=0,Wn=!1;const al={maxWidth:100,unit:"metric"};function Qs(d,t,n){const a=n&&n.maxWidth||100,h=d._container.clientHeight/2,f=d.unproject([0,h]),w=d.unproject([a,h]),T=f.distanceTo(w);if(n&&n.unit==="imperial"){const k=3.2808*T;k>5280?Kn(t,a,k/5280,d._getUIString("ScaleControl.Miles")):Kn(t,a,k,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Kn(t,a,T/1852,d._getUIString("ScaleControl.NauticalMiles")):T>=1e3?Kn(t,a,T/1e3,d._getUIString("ScaleControl.Kilometers")):Kn(t,a,T,d._getUIString("ScaleControl.Meters"))}function Kn(d,t,n,a){const h=function(f){const w=Math.pow(10,`${Math.floor(f)}`.length-1);let T=f/w;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(k){const C=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*C)/C}(T),w*T}(n);d.style.width=t*(h/n)+"px",d.innerHTML=`${h}&nbsp;${a}`}const ol={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ll=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xa(d){if(d){if(typeof d=="number"){const t=Math.round(Math.abs(d)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,d),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-d),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(d,0),right:new l.P(-d,0)}}if(d instanceof l.P||Array.isArray(d)){const t=l.P.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(d.center||[0,0]),top:l.P.convert(d.top||[0,0]),"top-left":l.P.convert(d["top-left"]||[0,0]),"top-right":l.P.convert(d["top-right"]||[0,0]),bottom:l.P.convert(d.bottom||[0,0]),"bottom-left":l.P.convert(d["bottom-left"]||[0,0]),"bottom-right":l.P.convert(d["bottom-right"]||[0,0]),left:l.P.convert(d.left||[0,0]),right:l.P.convert(d.right||[0,0])}}return Xa(new l.P(0,0))}const cl=D;y.AJAXError=l.bd,y.Evented=l.E,y.LngLat=l.M,y.MercatorCoordinate=l.Y,y.Point=l.P,y.addProtocol=l.be,y.config=l.a,y.removeProtocol=l.bf,y.AttributionControl=$o,y.BoxZoomHandler=Ho,y.CanvasSource=os,y.CooperativeGesturesHandler=Ks,y.DoubleClickZoomHandler=Ga,y.DragPanHandler=Jo,y.DragRotateHandler=xc,y.EdgeInsets=ms,y.FullscreenControl=class extends l.E{constructor(d={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){K.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=K.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);K.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},y.GeoJSONSource=Ct,y.GeolocateControl=class extends l.E{constructor(d){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new l.M(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,h=this._map.getBearing(),f=l.e({bearing:h},this.options.fitBoundsOptions),w=qt.fromLngLat(n,a);this._map.fitBounds(w,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new l.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Wn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=K.create("button","maplibregl-ctrl-geolocate",this._container),K.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ys({element:this._dotElement}),this._circleElement=K.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ys({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},sl,d)}onAdd(d){return this._map=d,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t=!1){return l._(this,void 0,void 0,function*(){if(mn!==void 0&&!t)return mn;if(window.navigator.permissions===void 0)return mn=!!window.navigator.geolocation,mn;try{mn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{mn=!!window.navigator.geolocation}return mn})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Hn=0,Wn=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),n=d.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),t=d.getSouthEast(),n=d.getNorthEast(),a=t.distanceTo(n),h=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Hn--,Wn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Hn++,Hn>1?(d={maximumAge:6e5,timeout:0},Wn=!0):(d=this.options.positionOptions,Wn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},y.Hash=Go,y.ImageSource=en,y.KeyboardHandler=_c,y.LngLatBounds=qt,y.LogoControl=Kr,y.Map=class extends Qo{constructor(d){if(l.bb.mark(l.bc.create),(d=l.e({},il,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ua(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Sh,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},el,d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this.transformCameraUpdate=d.transformCameraUpdate,this._imageQueueHandle=Ye.addThrottleControl(()=>this.isMoving()),this._requestManager=new vt(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=Zo(a=>{this._trackResize&&!this._removed&&this.resize(a)._update()},50);this._resizeObserver=new ResizeObserver(a=>{t?n(a):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Yo(this,d),this._hash=d.hash&&new Go(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,l.e({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new $o(typeof d.attributionControl=="boolean"?void 0:d.attributionControl)),d.maplibreLogo&&this.addControl(new Kr,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new l.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new l.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new l.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,t,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,t,n,a)}resize(d){var t;const n=this._containerDimensions(),a=n[0],h=n[1],f=this._getClampedPixelRatio(a,h);if(this._resizeCanvas(a,h,f),this.painter.resize(a,h,f),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const k=this._getClampedPixelRatio(a,h);this._resizeCanvas(a,h,k),this.painter.resize(a,h,k)}this.transform.resize(a,h),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,h);const w=!this._moving;return w&&(this.stop(),this.fire(new l.k("movestart",d)).fire(new l.k("move",d))),this.fire(new l.k("resize",d)),w&&this.fire(new l.k("moveend",d)),this}_getClampedPixelRatio(d,t){const{0:n,1:a}=this._maxCanvasSize,h=this.getPixelRatio(),f=d*h,w=t*h;return Math.min(f>n?n/f:1,w>a?a/w:1)*h}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(qt.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(l.M.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(l.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,t,n){if(d==="mouseenter"||d==="mouseover"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:f=>{const w=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];w.length?a||(a=!0,n.call(this,new br(d,this,f.originalEvent,{features:w}))):a=!1},mouseout:()=>{a=!1}}}}if(d==="mouseleave"||d==="mouseout"){let a=!1;return{layer:t,listener:n,delegates:{mousemove:w=>{(this.getLayer(t)?this.queryRenderedFeatures(w.point,{layers:[t]}):[]).length?a=!0:a&&(a=!1,n.call(this,new br(d,this,w.originalEvent)))},mouseout:w=>{a&&(a=!1,n.call(this,new br(d,this,w.originalEvent)))}}}}{const a=h=>{const f=this.getLayer(t)?this.queryRenderedFeatures(h.point,{layers:[t]}):[];f.length&&(h.features=f,n.call(this,h),delete h.features)};return{layer:t,listener:n,delegates:{[d]:a}}}}on(d,t,n){if(n===void 0)return super.on(d,t);const a=this._createDelegatedListener(d,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(a);for(const h in a.delegates)this.on(h,a.delegates[h]);return this}once(d,t,n){if(n===void 0)return super.once(d,t);const a=this._createDelegatedListener(d,t,n);for(const h in a.delegates)this.once(h,a.delegates[h]);return this}off(d,t,n){return n===void 0?super.off(d,t):(this._delegatedListeners&&this._delegatedListeners[d]&&(a=>{const h=this._delegatedListeners[d];for(let f=0;f<h.length;f++){const w=h[f];if(w.layer===t&&w.listener===n){for(const T in w.delegates)this.off(T,w.delegates[T]);return h.splice(f,1),this}}})(),this)}queryRenderedFeatures(d,t){if(!this.style)return[];let n;const a=d instanceof l.P||Array.isArray(d),h=a?d:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:d)||{},h instanceof l.P||typeof h[0]=="number")n=[l.P.convert(h)];else{const f=l.P.convert(h[0]),w=l.P.convert(h[1]);n=[f,new l.P(w.x,f.y),w,new l.P(f.x,w.y),f]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(d,t))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new zr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,t,n):this.style.loadJSON(d,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,Ie.Style);l.h(n,new AbortController).then(a=>{this._updateDiff(a.data,t)}).catch(a=>{a&&this.fire(new l.j(a))})}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d,t)&&this._update(!0)}catch(n){l.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style.sourceCaches[d];if(t!==void 0)return t.loaded();this.fire(new l.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const t=this.style.sourceCaches[d.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===d.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ti(this.painter,t,d),this.painter.renderToTexture=new Ha(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:d})),this}getTerrain(){var d,t;return(t=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const t in d){const n=d[t]._tiles;for(const a in n){const h=n[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,n={}){const{pixelRatio:a=1,sdf:h=!1,stretchX:f,stretchY:w,content:T}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:C,data:P}=t,M=t;return this.style.addImage(d,{data:new l.R({width:k,height:C},new Uint8Array(P)),pixelRatio:a,stretchX:f,stretchY:w,content:T,sdf:h,version:0,userImage:M}),M.onAdd&&M.onAdd(this,d),this}}{const{width:k,height:C,data:P}=Z.getImageData(t);this.style.addImage(d,{data:new l.R({width:k,height:C},P),pixelRatio:a,stretchX:f,stretchY:w,content:T,sdf:h,version:0})}}updateImage(d,t){const n=this.style.getImage(d);if(!n)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=t instanceof HTMLImageElement||l.b(t)?Z.getImageData(t):t,{width:h,height:f,data:w}=a;if(h===void 0||f===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==n.data.width||f!==n.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(t instanceof HTMLImageElement||l.b(t));return n.data.replace(w,T),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Ye.getImage(this._requestManager.transformRequest(d,Ie.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,t,n){return this.style.setLayerZoomRange(d,t,n),this._update(!0)}setFilter(d,t,n={}){return this.style.setFilter(d,t,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,n,a={}){return this.style.setPaintProperty(d,t,n,a),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,n,a={}){return this.style.setLayoutProperty(d,t,n,a),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setGlyphs(d,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,t,n,a=>{a||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,t,n=>{n||this._update(!0)}),this}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const t=this._canvasContainer=K.create("div","maplibregl-canvas-container",d);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=K.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const h=this._controlContainer=K.create("div","maplibregl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{f[w]=K.create("div",`maplibregl-ctrl-${w} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:d},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){const a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new lc(n,this.transform),Ae.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const h=this.transform.zoom,f=Z.now();this.style.zoomHistory.update(h,f);const w=new l.a8(h,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=w.crossFadingFactor();T===1&&T===this._crossFadingFactor||(n=!0,this._crossFadingFactor=T),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bb.mark(l.bc.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,l.bb.mark(l.bc.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ye.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),K.remove(this._canvasContainer),K.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bb.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Z.frameAsync(this._frameRequest).then(d=>{l.bb.frame(d),this._frameRequest=null,this._render(d)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return tl}getCameraTargetElevation(){return this.transform.elevation}},y.MapMouseEvent=br,y.MapTouchEvent=gs,y.MapWheelEvent=qn,y.Marker=Ys,y.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);t.title=a,t.setAttribute("aria-label",a)},this.options=l.e({},rl,d),this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),K.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),K.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=K.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const n=K.create("button",d,this._container);return n.type="button",n.addEventListener("click",t),n}},y.Popup=class extends l.E{constructor(d){super(),this.remove=()=>(this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=K.create("div","maplibregl-popup",this._map.getContainer()),this._tip=K.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wa(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let a=this.options.anchor;const h=Xa(this.options.offset);if(!a){const w=this._container.offsetWidth,T=this._container.offsetHeight;let k;k=n.y+h.bottom.y<T?["top"]:n.y>this._map.transform.height-T?["bottom"]:[],n.x<w/2?k.push("left"):n.x>this._map.transform.width-w/2&&k.push("right"),a=k.length===0?"bottom":k.join("-")}const f=n.add(h[a]).round();K.setTransform(this._container,`${Js[a]} translate(${f.x}px,${f.y}px)`),Ka(this._container,a,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(ol),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=l.M.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=d;a=n.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=K.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(ll);d&&d.focus()}},y.RasterDEMTileSource=Sn,y.RasterTileSource=tr,y.ScaleControl=class{constructor(d){this._onMove=()=>{Qs(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Qs(this._map,this._container,this.options)},this.options=l.e({},al,d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},y.ScrollZoomHandler=Ws,y.Style=zr,y.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=K.create("button","maplibregl-ctrl-terrain",this._container),K.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){K.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},y.TwoFingersTouchPitchHandler=Xo,y.TwoFingersTouchRotateHandler=qa,y.TwoFingersTouchZoomHandler=mc,y.TwoFingersTouchZoomRotateHandler=Wr,y.VectorTileSource=fe,y.VideoSource=as,y.addSourceType=(d,t)=>l._(void 0,void 0,void 0,function*(){if(Rn(d))throw new Error(`A source type called "${d}" already exists.`);((n,a)=>{ls[n]=a})(d,t)}),y.clearPrewarmedResources=function(){const d=li;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(gi),li=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},y.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},y.getRTLTextPluginStatus=function(){return Pe().getRTLTextPluginStatus()},y.getVersion=function(){return cl},y.getWorkerCount=function(){return oi.workerCount},y.getWorkerUrl=function(){return l.a.WORKER_URL},y.importScriptInWorkers=function(d){return jt().broadcast("importScript",d)},y.prewarm=function(){Ee().acquire(gi)},y.setMaxParallelImageRequests=function(d){l.a.MAX_PARALLEL_IMAGE_REQUESTS=d},y.setRTLTextPlugin=function(d,t){return Pe().setRTLTextPlugin(d,t)},y.setWorkerCount=function(d){oi.workerCount=d},y.setWorkerUrl=function(d){l.a.WORKER_URL=d}});var x=u;return x})})(_f);var Yg=_f.exports;const un=Jg(Yg);function Sp(_){let o;return u=>{if(u)for(let p in u){let b=o==null?void 0:o[p],x=u[p];b!==x&&_(p,x,b)}else if(o)for(let p in o)_(p,void 0,o[p]);o=u}}function Qg(_,...o){let u=[_];for(let p of o)if(p)Array.isArray(p)&&p[0]===_?u.push(...p.slice(1)):u.push(p);else continue;if(u.length!==1)return u.length===2?u[1]:u}function $g(_){return _===!0?["has","point_count"]:_===!1?["!",["has","point_count"]]:void 0}function Mu(_,o){return["case",["boolean",["feature-state","hover"],!1],o,_]}var Ol=e_;function e_(_){var o,u,p;if(_){if(Array.isArray(_)){for(o=[],u=_.length,p=0;p<u;p++){var b=_[p];b!=null&&o.push(b)}return o}if(typeof _=="object"){o={};var x=Object.keys(_);for(u=x.length,p=0;p<u;p++){var y=x[p],l=_[y];l!=null&&(o[y]=l)}return o}}}function Tp(_){let o=_[0],u,p,b=kp(_);return{c(){b.c(),u=ss()},m(x,y){b.m(x,y),Lt(x,u,y),p=!0},p(x,y){y[0]&1&&Ur(o,o=x[0])?(Br(),nt(b,1,1,Bt),jr(),b=kp(x),b.c(),Ge(b,1),b.m(u.parentNode,u)):b.p(x,y)},i(x){p||(Ge(b),p=!0)},o(x){nt(b),p=!1},d(x){x&&Pt(u),b.d(x)}}}function kp(_){let o;const u=_[36].default,p=la(u,_,_[35],null);return{c(){p&&p.c()},m(b,x){p&&p.m(b,x),o=!0},p(b,x){p&&p.p&&(!o||x[1]&16)&&ha(p,u,b,b[35],o?ca(u,b[35],x,null):ua(b[35]),null)},i(b){o||(Ge(p,b),o=!0)},o(b){nt(p,b),o=!1},d(b){p&&p.d(b)}}}function t_(_){let o,u,p=_[0]&&Tp(_);return{c(){p&&p.c(),o=ss()},m(b,x){p&&p.m(b,x),Lt(b,o,x),u=!0},p(b,x){b[0]?p?(p.p(b,x),x[0]&1&&Ge(p,1)):(p=Tp(b),p.c(),Ge(p,1),p.m(o.parentNode,o)):p&&(Br(),nt(p,1,1,()=>{p=null}),jr())},i(b){u||(Ge(p),u=!0)},o(b){nt(p),u=!1},d(b){b&&Pt(o),p&&p.d(b)}}}function i_(_,o,u){let p,b,x,y,l,D,U,N,Z,K,Ae,Te,{$$slots:je={},$$scope:Ue}=o,{id:He=eh("layer")}=o,{source:at=void 0}=o,{sourceLayer:Ye=void 0}=o,{beforeId:Ie=void 0}=o,{beforeLayerType:vt=void 0}=o,{type:Dt}=o,{paint:yt=void 0}=o,{layout:Je=void 0}=o,{filter:dt=void 0}=o,{applyToClusters:si=void 0}=o,{minzoom:_e=void 0}=o,{maxzoom:kt=void 0}=o,{manageHoverState:Mt=!1}=o,{hovered:Wt=null}=o,{interactive:ai=!0}=o,{hoverCursor:it=void 0}=o,{eventsIfTopMost:It=!1}=o;const ct=Cu(),{map:mi,source:Zt,self:Nt,minzoom:Ut,maxzoom:gi,eventTopMost:oi,layerInfo:Di}=Hg();Hi(_,mi,ue=>u(31,Z=ue)),Hi(_,Zt,ue=>u(32,K=ue)),Hi(_,Nt,ue=>u(0,N=ue)),Hi(_,Ut,ue=>u(34,Te=ue)),Hi(_,gi,ue=>u(33,Ae=ue)),ns(()=>{N&&Z&&(Di.delete(N),Z==null||Z.removeLayer(N))});let li;function ci(ue){var fe,tr;if(!ai||!N||!Z||It&&oi(ue)!==N)return;let Rt=ue.features??[],qt=(tr=(fe=Rt[0])==null?void 0:fe.properties)==null?void 0:tr.cluster_id,Yi={event:ue,map:Z,clusterId:qt,layer:N,source:l,features:Rt};ct(ue.type,Yi)}function Ee(ue){var fe,tr;if(!ai||!N||!Z||It&&oi(ue)!==N)return;it&&(Z.getCanvas().style.cursor=it);let Rt=ue.features??[];u(6,Wt=Rt[0]??null);let qt=(tr=(fe=Rt[0])==null?void 0:fe.properties)==null?void 0:tr.cluster_id;ct("mouseenter",{event:ue,map:Z,clusterId:qt,layer:N,source:l,features:Rt})}function ot(ue){var fe,tr,Sn;if(!ai||!Z)return;if(It&&oi(ue)!==N){u(6,Wt=null),Mt&&li!==void 0&&(Z==null||Z.setFeatureState({source:l,sourceLayer:Ye,id:li},{hover:!1}),li=void 0);return}Z.getCanvas().style.cursor=it;let Rt=ue.features??[],qt=(tr=(fe=Rt[0])==null?void 0:fe.properties)==null?void 0:tr.cluster_id,Yi=(Sn=Rt[0])==null?void 0:Sn.id;Yi!==li&&(Mt&&(li!==void 0&&(Z==null||Z.setFeatureState({source:l,id:li,sourceLayer:Ye},{hover:!1})),Z==null||Z.setFeatureState({source:l,id:Yi,sourceLayer:Ye},{hover:!0})),li=Yi,u(6,Wt=Rt[0]??null)),ct("mousemove",{event:ue,map:Z,clusterId:qt,layer:N,source:l,features:Rt})}function jt(ue){if(!(!ai||!N||!Z)){if(it&&(Z.getCanvas().style.cursor=""),u(6,Wt=null),Mt&&li!==void 0){const Rt={source:l,id:li,sourceLayer:Ye};Z==null||Z.setFeatureState(Rt,{hover:!1}),li=void 0}ct("mouseleave",{map:Z,layer:N,source:l})}}let er=!0;function Er(ue){Z&&(Z.off("click",ue,ci),Z.off("dblclick",ue,ci),Z.off("contextmenu",ue,ci),Z.off("mouseenter",ue,Ee),Z.off("mousemove",ue,ot),Z.off("mouseleave",ue,jt))}return ns(()=>{Z&&N&&Er(N)}),_.$$set=ue=>{"id"in ue&&u(7,He=ue.id),"source"in ue&&u(8,at=ue.source),"sourceLayer"in ue&&u(9,Ye=ue.sourceLayer),"beforeId"in ue&&u(10,Ie=ue.beforeId),"beforeLayerType"in ue&&u(11,vt=ue.beforeLayerType),"type"in ue&&u(12,Dt=ue.type),"paint"in ue&&u(13,yt=ue.paint),"layout"in ue&&u(14,Je=ue.layout),"filter"in ue&&u(15,dt=ue.filter),"applyToClusters"in ue&&u(16,si=ue.applyToClusters),"minzoom"in ue&&u(17,_e=ue.minzoom),"maxzoom"in ue&&u(18,kt=ue.maxzoom),"manageHoverState"in ue&&u(19,Mt=ue.manageHoverState),"hovered"in ue&&u(6,Wt=ue.hovered),"interactive"in ue&&u(20,ai=ue.interactive),"hoverCursor"in ue&&u(21,it=ue.hoverCursor),"eventsIfTopMost"in ue&&u(22,It=ue.eventsIfTopMost),"$$scope"in ue&&u(35,Ue=ue.$$scope)},_.$$.update=()=>{if(_.$$.dirty[0]&65536&&u(30,p=$g(si)),_.$$.dirty[0]&1073774592&&u(24,b=Qg("all",p,dt)),_.$$.dirty[0]&131072|_.$$.dirty[1]&8&&u(26,x=_e??Te),_.$$.dirty[0]&262144|_.$$.dirty[1]&4&&u(25,y=kt??Ae),_.$$.dirty[0]&256|_.$$.dirty[1]&2&&u(29,l=at||K),_.$$.dirty[0]&654343809|_.$$.dirty[1]&1&&Z&&N!==He&&l){N&&(Er(N),Di.delete(N));let ue=Ie;if(!Ie&&vt){let Rt=Z.getStyle().layers,qt=typeof vt=="function"?vt:fe=>fe.type===vt,Yi=Rt==null?void 0:Rt.find(qt);Yi&&(ue=Yi.id)}rs(Nt,N=He,N),Z.addLayer(Ol({id:N,type:Dt,source:l,"source-layer":Ye,filter:b,paint:yt,layout:Je,minzoom:x,maxzoom:y}),ue),u(23,er=!0),Z.on("click",N,ci),Z.on("dblclick",N,ci),Z.on("contextmenu",N,ci),Z.on("mouseenter",N,Ee),Z.on("mousemove",N,ot),Z.on("mouseleave",N,jt)}_.$$.dirty[0]&1048577&&N&&Di.set(N,{interactive:ai}),_.$$.dirty[0]&1|_.$$.dirty[1]&1&&u(28,D=N?Sp((ue,Rt)=>Z==null?void 0:Z.setPaintProperty(N,ue,Rt)):void 0),_.$$.dirty[0]&1|_.$$.dirty[1]&1&&u(27,U=N?Sp((ue,Rt)=>Z==null?void 0:Z.setLayoutProperty(N,ue,Rt)):void 0),_.$$.dirty[0]&268443648&&(D==null||D(yt)),_.$$.dirty[0]&134234112&&(U==null||U(Je)),_.$$.dirty[0]&100663297|_.$$.dirty[1]&1&&N&&(Z==null||Z.setLayerZoomRange(N,x,y)),_.$$.dirty[0]&25165825|_.$$.dirty[1]&1&&N&&(er?u(23,er=!1):Z==null||Z.setFilter(N,b))},[N,mi,Zt,Nt,Ut,gi,Wt,He,at,Ye,Ie,vt,Dt,yt,Je,dt,si,_e,kt,Mt,ai,it,It,er,b,y,x,U,D,l,p,Z,K,Ae,Te,Ue,je]}class vf extends pn{constructor(o){super(),dn(this,o,i_,t_,Ur,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}const r_="modulepreload",n_=function(_){return"/mk-kladilnici/"+_},Ip={},bo=function(o,u,p){let b=Promise.resolve();if(u&&u.length>0){const x=document.getElementsByTagName("link");b=Promise.all(u.map(y=>{if(y=n_(y),y in Ip)return;Ip[y]=!0;const l=y.endsWith(".css"),D=l?'[rel="stylesheet"]':"";if(!!p)for(let Z=x.length-1;Z>=0;Z--){const K=x[Z];if(K.href===y&&(!l||K.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${D}`))return;const N=document.createElement("link");if(N.rel=l?"stylesheet":r_,l||(N.as="script",N.crossOrigin=""),N.href=y,document.head.appendChild(N),l)return new Promise((Z,K)=>{N.addEventListener("load",Z),N.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${y}`)))})}))}return b.then(()=>o()).catch(x=>{const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=x,window.dispatchEvent(y),!y.defaultPrevented)throw x})};function s_(_){let o;const u=_[12].default,p=la(u,_,_[11],null);return{c(){p&&p.c()},m(b,x){p&&p.m(b,x),o=!0},p(b,[x]){p&&p.p&&(!o||x&2048)&&ha(p,u,b,b[11],o?ca(u,b[11],x,null):ua(b[11]),null)},i(b){o||(Ge(p,b),o=!0)},o(b){nt(p,b),o=!1},d(b){p&&p.d(b)}}}function a_(_,o,u){let p,b,x,{$$slots:y={},$$scope:l}=o,{lngLat:D}=o,{class:U=void 0}=o,{draggable:N=!1}=o,{feature:Z=null}=o,{offset:K=void 0}=o,{rotation:Ae=0}=o,{opacity:Te=1}=o;const je=Cu(),{map:Ue,layerEvent:He,self:at}=Wg();Hi(_,Ue,Je=>u(14,x=Je)),Hi(_,He,Je=>u(13,p=Je)),Hi(_,at,Je=>u(10,b=Je));const Ye=()=>yt("dragstart"),Ie=()=>{Dt(),yt("drag")},vt=()=>{Dt(),yt("dragend")};rs(at,b=new un.Marker(Ol({draggable:N,rotation:Ae,className:U,offset:K,opacity:Te.toString()})).setLngLat(D).addTo(x),b),N&&(b.on("dragstart",Ye),b.on("drag",Ie),b.on("dragend",vt)),ns(()=>b==null?void 0:b.remove());function Dt(){let Je=b==null?void 0:b.getLngLat();Je&&(Array.isArray(D)?u(3,D=[Je.lng,Je.lat]):D&&"lon"in D?u(3,D={lon:Je.lng,lat:Je.lat}):u(3,D=Je))}function yt(Je){let dt=b==null?void 0:b.getLngLat();if(!dt)return;const si=[dt.lng,dt.lat];let _e={map:x,marker:b,lngLat:si,features:[{type:"Feature",properties:(Z==null?void 0:Z.properties)??{},geometry:{type:"Point",coordinates:si}}]};rs(He,p={..._e,layerType:"marker",type:Je},p),je(Je,_e)}return _.$$set=Je=>{"lngLat"in Je&&u(3,D=Je.lngLat),"class"in Je&&u(4,U=Je.class),"draggable"in Je&&u(5,N=Je.draggable),"feature"in Je&&u(6,Z=Je.feature),"offset"in Je&&u(7,K=Je.offset),"rotation"in Je&&u(8,Ae=Je.rotation),"opacity"in Je&&u(9,Te=Je.opacity),"$$scope"in Je&&u(11,l=Je.$$scope)},_.$$.update=()=>{_.$$.dirty&1032&&(b==null||b.setLngLat(D)),_.$$.dirty&1152&&(b==null||b.setOffset(K??[0,0])),_.$$.dirty&1280&&(b==null||b.setRotation(Ae)),_.$$.dirty&1536&&(b==null||b.setOpacity(Te.toString()))},[Ue,He,at,D,U,N,Z,K,Ae,Te,b,l,y]}class o_ extends pn{constructor(o){super(),dn(this,o,a_,s_,Ur,{lngLat:3,class:4,draggable:5,feature:6,offset:7,rotation:8,opacity:9})}}function l_(_){let o;const u=_[15].default,p=la(u,_,_[23],null);return{c(){p&&p.c()},m(b,x){p&&p.m(b,x),o=!0},p(b,x){p&&p.p&&(!o||x&8388608)&&ha(p,u,b,b[23],o?ca(u,b[23],x,null):ua(b[23]),null)},i(b){o||(Ge(p,b),o=!0)},o(b){nt(p,b),o=!1},d(b){p&&p.d(b)}}}function c_(_){let o,u,p;function b(y){_[16](y)}let x={id:_[1],type:"fill",source:_[2],sourceLayer:_[3],beforeId:_[4],beforeLayerType:_[5],paint:_[6],layout:_[7],filter:_[8],minzoom:_[9],maxzoom:_[10],hoverCursor:_[11],manageHoverState:_[12],eventsIfTopMost:_[13],interactive:_[14],$$slots:{default:[l_]},$$scope:{ctx:_}};return _[0]!==void 0&&(x.hovered=_[0]),o=new vf({props:x}),Rl.push(()=>gf(o,"hovered",b)),o.$on("click",_[17]),o.$on("dblclick",_[18]),o.$on("contextmenu",_[19]),o.$on("mouseenter",_[20]),o.$on("mousemove",_[21]),o.$on("mouseleave",_[22]),{c(){Wi(o.$$.fragment)},m(y,l){zi(o,y,l),p=!0},p(y,[l]){const D={};l&2&&(D.id=y[1]),l&4&&(D.source=y[2]),l&8&&(D.sourceLayer=y[3]),l&16&&(D.beforeId=y[4]),l&32&&(D.beforeLayerType=y[5]),l&64&&(D.paint=y[6]),l&128&&(D.layout=y[7]),l&256&&(D.filter=y[8]),l&512&&(D.minzoom=y[9]),l&1024&&(D.maxzoom=y[10]),l&2048&&(D.hoverCursor=y[11]),l&4096&&(D.manageHoverState=y[12]),l&8192&&(D.eventsIfTopMost=y[13]),l&16384&&(D.interactive=y[14]),l&8388608&&(D.$$scope={dirty:l,ctx:y}),!u&&l&1&&(u=!0,D.hovered=y[0],mf(()=>u=!1)),o.$set(D)},i(y){p||(Ge(o.$$.fragment,y),p=!0)},o(y){nt(o.$$.fragment,y),p=!1},d(y){Li(o,y)}}}function h_(_,o,u){let{$$slots:p={},$$scope:b}=o,{id:x=eh("fill")}=o,{source:y=void 0}=o,{sourceLayer:l=void 0}=o,{beforeId:D=void 0}=o,{beforeLayerType:U=void 0}=o,{paint:N}=o,{layout:Z=void 0}=o,{filter:K=void 0}=o,{minzoom:Ae=void 0}=o,{maxzoom:Te=void 0}=o,{hoverCursor:je=void 0}=o,{manageHoverState:Ue=!1}=o,{hovered:He=null}=o,{eventsIfTopMost:at=!1}=o,{interactive:Ye=!0}=o;function Ie(_e){He=_e,u(0,He)}function vt(_e){hn.call(this,_,_e)}function Dt(_e){hn.call(this,_,_e)}function yt(_e){hn.call(this,_,_e)}function Je(_e){hn.call(this,_,_e)}function dt(_e){hn.call(this,_,_e)}function si(_e){hn.call(this,_,_e)}return _.$$set=_e=>{"id"in _e&&u(1,x=_e.id),"source"in _e&&u(2,y=_e.source),"sourceLayer"in _e&&u(3,l=_e.sourceLayer),"beforeId"in _e&&u(4,D=_e.beforeId),"beforeLayerType"in _e&&u(5,U=_e.beforeLayerType),"paint"in _e&&u(6,N=_e.paint),"layout"in _e&&u(7,Z=_e.layout),"filter"in _e&&u(8,K=_e.filter),"minzoom"in _e&&u(9,Ae=_e.minzoom),"maxzoom"in _e&&u(10,Te=_e.maxzoom),"hoverCursor"in _e&&u(11,je=_e.hoverCursor),"manageHoverState"in _e&&u(12,Ue=_e.manageHoverState),"hovered"in _e&&u(0,He=_e.hovered),"eventsIfTopMost"in _e&&u(13,at=_e.eventsIfTopMost),"interactive"in _e&&u(14,Ye=_e.interactive),"$$scope"in _e&&u(23,b=_e.$$scope)},[He,x,y,l,D,U,N,Z,K,Ae,Te,je,Ue,at,Ye,p,Ie,vt,Dt,yt,Je,dt,si,b]}class zu extends pn{constructor(o){super(),dn(this,o,h_,c_,Ur,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function u_(_,o,u){let p;const{map:b}=Io();Hi(_,b,D=>u(4,p=D));let{position:x="top-left"}=o,{container:y=void 0}=o,l=null;return ns(()=>{p!=null&&p.loaded()&&l&&p.removeControl(l)}),_.$$set=D=>{"position"in D&&u(1,x=D.position),"container"in D&&u(2,y=D.container)},_.$$.update=()=>{if(_.$$.dirty&30&&p&&!l){let D;typeof y=="string"?D=document.querySelector(y)??void 0:D=y,u(3,l=new un.FullscreenControl({container:D})),p.addControl(l,x)}},[b,x,y,l,p]}class d_ extends pn{constructor(o){super(),dn(this,o,u_,null,Ur,{position:1,container:2})}}function p_(_,o,u,p,b){let x=!1;_.getSource(o)&&(x=!0,_.removeSource(o));const y=()=>{p(o)&&(_.addSource(o,u),b())};if(x){const l=()=>{o&&(_.getSource(o)?setTimeout(l,1):y())};l()}else y()}function f_(_,o,u){Fg().then(()=>{let p=Eg(_);if(!p)return;p.getSource(o)===u&&p.removeSource(o)})}function Cp(_){let o=_[0],u,p,b=Ap(_);return{c(){b.c(),u=ss()},m(x,y){b.m(x,y),Lt(x,u,y),p=!0},p(x,y){y&1&&Ur(o,o=x[0])?(Br(),nt(b,1,1,Bt),jr(),b=Ap(x),b.c(),Ge(b,1),b.m(u.parentNode,u)):b.p(x,y)},i(x){p||(Ge(b),p=!0)},o(x){nt(b),p=!1},d(x){x&&Pt(u),b.d(x)}}}function Ap(_){let o;const u=_[15].default,p=la(u,_,_[14],null);return{c(){p&&p.c()},m(b,x){p&&p.m(b,x),o=!0},p(b,x){p&&p.p&&(!o||x&16384)&&ha(p,u,b,b[14],o?ca(u,b[14],x,null):ua(b[14]),null)},i(b){o||(Ge(p,b),o=!0)},o(b){nt(p,b),o=!1},d(b){p&&p.d(b)}}}function m_(_){let o,u,p=_[0]&&Cp(_);return{c(){p&&p.c(),o=ss()},m(b,x){p&&p.m(b,x),Lt(b,o,x),u=!0},p(b,[x]){b[0]?p?(p.p(b,x),x&1&&Ge(p,1)):(p=Cp(b),p.c(),Ge(p,1),p.m(o.parentNode,o)):p&&(Br(),nt(p,1,1,()=>{p=null}),jr())},i(b){u||(Ge(p),u=!0)},o(b){nt(p),u=!1},d(b){b&&Pt(o),p&&p.d(b)}}}function g_(_,o,u){let p,b,x,{$$slots:y={},$$scope:l}=o,{id:D=eh("geojson")}=o,{data:U}=o,{generateId:N=!1}=o,{promoteId:Z=void 0}=o,{filter:K=void 0}=o,{lineMetrics:Ae=void 0}=o,{cluster:Te=void 0}=o;const{map:je,cluster:Ue,self:He}=Gg();Hi(_,je,Ie=>u(13,b=Ie)),Hi(_,Ue,Ie=>u(16,x=Ie)),Hi(_,He,Ie=>u(0,p=Ie));let at,Ye=!0;return ns(()=>{p&&at&&b&&(f_(je,p,at),rs(He,p=null,p),u(11,at=void 0))}),_.$$set=Ie=>{"id"in Ie&&u(4,D=Ie.id),"data"in Ie&&u(5,U=Ie.data),"generateId"in Ie&&u(6,N=Ie.generateId),"promoteId"in Ie&&u(7,Z=Ie.promoteId),"filter"in Ie&&u(8,K=Ie.filter),"lineMetrics"in Ie&&u(9,Ae=Ie.lineMetrics),"cluster"in Ie&&u(10,Te=Ie.cluster),"$$scope"in Ie&&u(14,l=Ie.$$scope)},_.$$.update=()=>{_.$$.dirty&1024&&rs(Ue,x=Te,x),_.$$.dirty&12273&&b&&p!==D&&(rs(He,p=D,p),p_(b,p,Ol({type:"geojson",data:U,filter:K,lineMetrics:Ae,generateId:N,promoteId:Z,cluster:!!Te,clusterMinPoints:Te==null?void 0:Te.minPoints,clusterMaxZoom:Te==null?void 0:Te.maxZoom,clusterRadius:Te==null?void 0:Te.radius,clusterProperties:Te==null?void 0:Te.properties}),Ie=>b&&Ie===p,()=>{p&&(u(11,at=b==null?void 0:b.getSource(p)),u(12,Ye=!0))})),_.$$.dirty&8208&&(b==null||b.on("style.load",()=>{u(11,at=b==null?void 0:b.getSource(D))})),_.$$.dirty&6176&&at&&(Ye?u(12,Ye=!1):at.setData(U)),_.$$.dirty&3072&&(at==null||at.setClusterOptions(Ol({cluster:!!Te,clusterMaxZoom:Te==null?void 0:Te.maxZoom,clusterRadius:Te==null?void 0:Te.radius})))},[p,je,Ue,He,D,U,N,Z,K,Ae,Te,at,Ye,b,l,y]}class Lu extends pn{constructor(o){super(),dn(this,o,g_,m_,Ur,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function __(_,o,u){let p;const{map:b}=Io();Hi(_,b,K=>u(8,p=K));let{position:x="top-left"}=o,{positionOptions:y=void 0}=o,{fitBoundsOptions:l=void 0}=o,{trackUserLocation:D=!1}=o,{showAccuracyCircle:U=!0}=o,{showUserLocation:N=!0}=o,Z=null;return ns(()=>{p!=null&&p.loaded()&&Z&&p.removeControl(Z)}),_.$$set=K=>{"position"in K&&u(1,x=K.position),"positionOptions"in K&&u(2,y=K.positionOptions),"fitBoundsOptions"in K&&u(3,l=K.fitBoundsOptions),"trackUserLocation"in K&&u(4,D=K.trackUserLocation),"showAccuracyCircle"in K&&u(5,U=K.showAccuracyCircle),"showUserLocation"in K&&u(6,N=K.showUserLocation)},_.$$.update=()=>{_.$$.dirty&510&&p&&!Z&&(u(7,Z=new un.GeolocateControl({positionOptions:y,fitBoundsOptions:l,trackUserLocation:D,showAccuracyCircle:U,showUserLocation:N})),p.addControl(Z,x))},[b,x,y,l,D,U,N,Z,p]}class y_ extends pn{constructor(o){super(),dn(this,o,__,null,Ur,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function v_(_){let o;const u=_[15].default,p=la(u,_,_[23],null);return{c(){p&&p.c()},m(b,x){p&&p.m(b,x),o=!0},p(b,x){p&&p.p&&(!o||x&8388608)&&ha(p,u,b,b[23],o?ca(u,b[23],x,null):ua(b[23]),null)},i(b){o||(Ge(p,b),o=!0)},o(b){nt(p,b),o=!1},d(b){p&&p.d(b)}}}function x_(_){let o,u,p;function b(y){_[16](y)}let x={id:_[1],type:"line",source:_[2],sourceLayer:_[3],beforeId:_[4],beforeLayerType:_[5],paint:_[6],layout:_[7],filter:_[8],minzoom:_[9],maxzoom:_[10],hoverCursor:_[11],manageHoverState:_[12],eventsIfTopMost:_[13],interactive:_[14],$$slots:{default:[v_]},$$scope:{ctx:_}};return _[0]!==void 0&&(x.hovered=_[0]),o=new vf({props:x}),Rl.push(()=>gf(o,"hovered",b)),o.$on("click",_[17]),o.$on("dblclick",_[18]),o.$on("contextmenu",_[19]),o.$on("mouseenter",_[20]),o.$on("mousemove",_[21]),o.$on("mouseleave",_[22]),{c(){Wi(o.$$.fragment)},m(y,l){zi(o,y,l),p=!0},p(y,[l]){const D={};l&2&&(D.id=y[1]),l&4&&(D.source=y[2]),l&8&&(D.sourceLayer=y[3]),l&16&&(D.beforeId=y[4]),l&32&&(D.beforeLayerType=y[5]),l&64&&(D.paint=y[6]),l&128&&(D.layout=y[7]),l&256&&(D.filter=y[8]),l&512&&(D.minzoom=y[9]),l&1024&&(D.maxzoom=y[10]),l&2048&&(D.hoverCursor=y[11]),l&4096&&(D.manageHoverState=y[12]),l&8192&&(D.eventsIfTopMost=y[13]),l&16384&&(D.interactive=y[14]),l&8388608&&(D.$$scope={dirty:l,ctx:y}),!u&&l&1&&(u=!0,D.hovered=y[0],mf(()=>u=!1)),o.$set(D)},i(y){p||(Ge(o.$$.fragment,y),p=!0)},o(y){nt(o.$$.fragment,y),p=!1},d(y){Li(o,y)}}}function b_(_,o,u){let{$$slots:p={},$$scope:b}=o,{id:x=eh("line")}=o,{source:y=void 0}=o,{sourceLayer:l=void 0}=o,{beforeId:D=void 0}=o,{beforeLayerType:U=void 0}=o,{paint:N}=o,{layout:Z=void 0}=o,{filter:K=void 0}=o,{minzoom:Ae=void 0}=o,{maxzoom:Te=void 0}=o,{hoverCursor:je=void 0}=o,{manageHoverState:Ue=!1}=o,{hovered:He=null}=o,{eventsIfTopMost:at=!1}=o,{interactive:Ye=!0}=o;function Ie(_e){He=_e,u(0,He)}function vt(_e){hn.call(this,_,_e)}function Dt(_e){hn.call(this,_,_e)}function yt(_e){hn.call(this,_,_e)}function Je(_e){hn.call(this,_,_e)}function dt(_e){hn.call(this,_,_e)}function si(_e){hn.call(this,_,_e)}return _.$$set=_e=>{"id"in _e&&u(1,x=_e.id),"source"in _e&&u(2,y=_e.source),"sourceLayer"in _e&&u(3,l=_e.sourceLayer),"beforeId"in _e&&u(4,D=_e.beforeId),"beforeLayerType"in _e&&u(5,U=_e.beforeLayerType),"paint"in _e&&u(6,N=_e.paint),"layout"in _e&&u(7,Z=_e.layout),"filter"in _e&&u(8,K=_e.filter),"minzoom"in _e&&u(9,Ae=_e.minzoom),"maxzoom"in _e&&u(10,Te=_e.maxzoom),"hoverCursor"in _e&&u(11,je=_e.hoverCursor),"manageHoverState"in _e&&u(12,Ue=_e.manageHoverState),"hovered"in _e&&u(0,He=_e.hovered),"eventsIfTopMost"in _e&&u(13,at=_e.eventsIfTopMost),"interactive"in _e&&u(14,Ye=_e.interactive),"$$scope"in _e&&u(23,b=_e.$$scope)},[He,x,y,l,D,U,N,Z,K,Ae,Te,je,Ue,at,Ye,p,Ie,vt,Dt,yt,Je,dt,si,b]}class Du extends pn{constructor(o){super(),dn(this,o,b_,x_,Ur,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function w_(_){let o=_.getCenter(),u=Math.round(_.getZoom()*100)/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),x=Math.round(o.lat*b)/b,y=Math.round(o.lng*b)/b,l=`${u}/${x}/${y}`,D=_.getBearing(),U=_.getPitch();return(D||U)&&(l+=`/${Math.round(D*10)/10}`),U&&(l+=`/${Math.round(U)}`),`#${l}`}function S_(_){return _.replace("#","").split("/").map(parseFloat)}var Hc=Ru;function Ru(_,o){return _===o||_!==_&&o!==o?!0:typeof _!=typeof o||{}.toString.call(_)!={}.toString.call(o)||_!==Object(_)||!_?!1:Array.isArray(_)?Ep(_,o):{}.toString.call(_)=="[object Set]"?Ep(Array.from(_),Array.from(o)):{}.toString.call(_)=="[object Object]"?k_(_,o):T_(_,o)}function T_(_,o){return _.toString()===o.toString()}function Ep(_,o){var u=_.length;if(u!=o.length)return!1;for(var p=0;p<u;p++)if(!Ru(_[p],o[p]))return!1;return!0}function k_(_,o){var u=Object.keys(_),p=u.length;if(p!=Object.keys(o).length)return!1;for(var b=0;b<p;b++){var x=u[b];if(!(o.hasOwnProperty(x)&&Ru(_[x],o[x])))return!1}return!0}function I_(_,o,u){let p;const{map:b}=Io();Hi(_,b,N=>u(6,p=N));let{position:x="top-left"}=o,{showCompass:y=!0}=o,{showZoom:l=!0}=o,{visualizePitch:D=!1}=o,U=null;return ns(()=>{p!=null&&p.loaded()&&U&&p.removeControl(U)}),_.$$set=N=>{"position"in N&&u(1,x=N.position),"showCompass"in N&&u(2,y=N.showCompass),"showZoom"in N&&u(3,l=N.showZoom),"visualizePitch"in N&&u(4,D=N.visualizePitch)},_.$$.update=()=>{_.$$.dirty&126&&p&&!U&&(u(5,U=new un.NavigationControl({showCompass:y,showZoom:l,visualizePitch:D})),p.addControl(U,x))},[b,x,y,l,D,U,p]}class C_ extends pn{constructor(o){super(),dn(this,o,I_,null,Ur,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function A_(_,o,u){let p;const{map:b}=Io();Hi(_,b,U=>u(5,p=U));let{position:x="bottom-left"}=o,{maxWidth:y=void 0}=o,{unit:l="metric"}=o,D=null;return ns(()=>{p!=null&&p.loaded()&&D&&p.removeControl(D)}),_.$$set=U=>{"position"in U&&u(1,x=U.position),"maxWidth"in U&&u(2,y=U.maxWidth),"unit"in U&&u(3,l=U.unit)},_.$$.update=()=>{_.$$.dirty&62&&p&&!D&&(u(4,D=new un.ScaleControl({maxWidth:y,unit:l})),p.addControl(D,x))},[b,x,y,l,D,p]}class E_ extends pn{constructor(o){super(),dn(this,o,A_,null,Ur,{position:1,maxWidth:2,unit:3})}}const P_=_=>({map:_[0]&8,loadedImages:_[0]&16,allImagesLoaded:_[0]&32}),Pp=_=>({map:_[3],loadedImages:_[4],allImagesLoaded:_[5]});function Mp(_){let o,u,p=_[2]&&zp(_);const b=_[35].default,x=la(b,_,_[34],Pp);return{c(){p&&p.c(),o=di(),x&&x.c()},m(y,l){p&&p.m(y,l),Lt(y,o,l),x&&x.m(y,l),u=!0},p(y,l){y[2]?p?(p.p(y,l),l[0]&4&&Ge(p,1)):(p=zp(y),p.c(),Ge(p,1),p.m(o.parentNode,o)):p&&(Br(),nt(p,1,1,()=>{p=null}),jr()),x&&x.p&&(!u||l[0]&56|l[1]&8)&&ha(x,b,y,y[34],u?ca(b,y[34],l,P_):ua(y[34]),Pp)},i(y){u||(Ge(p),Ge(x,y),u=!0)},o(y){nt(p),nt(x,y),u=!1},d(y){y&&Pt(o),p&&p.d(y),x&&x.d(y)}}}function zp(_){let o,u,p,b,x,y,l,D;return o=new C_({props:{position:_[6]}}),p=new y_({props:{position:_[6],fitBoundsOptions:{maxZoom:12}}}),x=new d_({props:{position:_[6]}}),l=new E_({props:{position:_[6]}}),{c(){Wi(o.$$.fragment),u=di(),Wi(p.$$.fragment),b=di(),Wi(x.$$.fragment),y=di(),Wi(l.$$.fragment)},m(U,N){zi(o,U,N),Lt(U,u,N),zi(p,U,N),Lt(U,b,N),zi(x,U,N),Lt(U,y,N),zi(l,U,N),D=!0},p(U,N){const Z={};N[0]&64&&(Z.position=U[6]),o.$set(Z);const K={};N[0]&64&&(K.position=U[6]),p.$set(K);const Ae={};N[0]&64&&(Ae.position=U[6]),x.$set(Ae);const Te={};N[0]&64&&(Te.position=U[6]),l.$set(Te)},i(U){D||(Ge(o.$$.fragment,U),Ge(p.$$.fragment,U),Ge(x.$$.fragment,U),Ge(l.$$.fragment,U),D=!0)},o(U){nt(o.$$.fragment,U),nt(p.$$.fragment,U),nt(x.$$.fragment,U),nt(l.$$.fragment,U),D=!1},d(U){U&&(Pt(u),Pt(b),Pt(y)),Li(o,U),Li(p,U),Li(x,U),Li(l,U)}}}function M_(_){let o,u,p,b,x,y=_[3]&&_[0]&&Mp(_);return{c(){o=Tt("div"),y&&y.c(),$t(o,"class",u=yp(_[1])+" svelte-p00lfq"),xp(o,"expand-map",!_[1])},m(l,D){Lt(l,o,D),y&&y.m(o,null),p=!0,b||(x=Mg(_[9].call(null,o)),b=!0)},p(l,D){l[3]&&l[0]?y?(y.p(l,D),D[0]&9&&Ge(y,1)):(y=Mp(l),y.c(),Ge(y,1),y.m(o,null)):y&&(Br(),nt(y,1,1,()=>{y=null}),jr()),(!p||D[0]&2&&u!==(u=yp(l[1])+" svelte-p00lfq"))&&$t(o,"class",u),(!p||D[0]&2)&&xp(o,"expand-map",!l[1])},i(l){p||(Ge(y),p=!0)},o(l){nt(y),p=!1},d(l){l&&Pt(o),y&&y.d(),b=!1,x()}}}function z_(_,o,u){let p,b,x,y,{$$slots:l={},$$scope:D}=o,{map:U=null}=o,{class:N=void 0}=o,{style:Z}=o,{diffStyleUpdates:K=!1}=o,{center:Ae=void 0}=o,{zoom:Te=void 0}=o,{pitch:je=0}=o,{bearing:Ue=0}=o,{bounds:He=void 0}=o,{hash:at=!1}=o,{loaded:Ye=!1}=o,{minZoom:Ie=0}=o,{maxZoom:vt=22}=o,{zoomOnDoubleClick:Dt=!0}=o,{locale:yt=void 0}=o,{interactive:Je=!0}=o,{attributionControl:dt=!0}=o,{cooperativeGestures:si=!1}=o,{preserveDrawingBuffer:_e=!1}=o,{maxBounds:kt=void 0}=o,{images:Mt=[]}=o,{standardControls:Wt=!1}=o,{filterLayers:ai=void 0}=o,{transformRequest:it=void 0}=o;const It=Cu(),{map:ct,loadedImages:mi}=Zg();Hi(_,ct,Ee=>u(3,x=Ee)),Hi(_,mi,Ee=>u(4,y=Ee));let Zt=new Set;async function Nt(Ee){if(x!=null&&x.loaded())if("url"in Ee){Zt.add(Ee.id);try{let ot=await x.loadImage(Ee.url);x==null||x.addImage(Ee.id,ot.data,Ee.options),y.add(Ee.id),mi.set(y)}catch(ot){It("error",ot)}finally{Zt.delete(Ee.id)}}else x.addImage(Ee.id,Ee.data,Ee.options),y.add(Ee.id),mi.set(y)}let Ut,gi,oi,Di;function li(Ee){if(at){let ot=S_(window.location.hash);ot.length>=3&&(u(11,Te=ot[0]),u(10,Ae=[ot[2],ot[1]])),ot.length==5&&(u(15,Ue=ot[3]),u(14,je=ot[4]))}return rs(ct,x=new un.Map(Ol({container:Ee,style:Z,locale:yt,center:Ae,zoom:Te,pitch:je,bearing:Ue,minZoom:Ie,maxZoom:vt,interactive:Je,preserveDrawingBuffer:_e,maxBounds:kt,bounds:He,attributionControl:dt,transformRequest:it,cooperativeGestures:si})),x),x.on("load",ot=>{u(0,Ye=!0),It("load",x)}),x.on("error",ot=>It("error",{...ot,map:x})),x.on("movestart",ot=>It("movestart",{...ot,map:x})),x.on("moveend",ot=>{if(u(10,Ae=ot.target.getCenter()),u(11,Te=ot.target.getZoom()),u(12,He=ot.target.getBounds()),It("moveend",{...ot,map:x}),at){let jt=window.location.href.replace(/(#.+)?$/,w_(x));window.history.replaceState(window.history.state,"",jt)}}),x.on("zoomstart",ot=>It("zoomstart",{...ot,map:x})),x.on("zoom",ot=>{u(11,Te=ot.target.getZoom()),It("zoom",{...ot,map:x})}),x.on("zoomend",ot=>{u(11,Te=ot.target.getZoom()),It("zoomend",{...ot,map:x})}),x.on("style.load",()=>{if(x){const ot=x.getStyle();if(u(31,Ut=ot.layers.map(jt=>jt.id)),u(32,gi=Object.keys(ot.sources)),Di)for(const[jt,er]of Object.entries(Di))x.addSource(jt,er);if(oi)for(const jt of oi)x.addLayer(jt)}}),x.on("styledata",ot=>{if(x&&ai){const jt=x.getStyle().layers;if(jt)for(let er of jt)ai(er)||x.setLayoutProperty(er.id,"visibility","none")}It("styledata",{...ot,map:x})}),{destroy(){u(0,Ye=!1),x==null||x.remove(),rs(ct,x=null,x)}}}let ci=Z;return _.$$set=Ee=>{"map"in Ee&&u(13,U=Ee.map),"class"in Ee&&u(1,N=Ee.class),"style"in Ee&&u(16,Z=Ee.style),"diffStyleUpdates"in Ee&&u(17,K=Ee.diffStyleUpdates),"center"in Ee&&u(10,Ae=Ee.center),"zoom"in Ee&&u(11,Te=Ee.zoom),"pitch"in Ee&&u(14,je=Ee.pitch),"bearing"in Ee&&u(15,Ue=Ee.bearing),"bounds"in Ee&&u(12,He=Ee.bounds),"hash"in Ee&&u(18,at=Ee.hash),"loaded"in Ee&&u(0,Ye=Ee.loaded),"minZoom"in Ee&&u(19,Ie=Ee.minZoom),"maxZoom"in Ee&&u(20,vt=Ee.maxZoom),"zoomOnDoubleClick"in Ee&&u(21,Dt=Ee.zoomOnDoubleClick),"locale"in Ee&&u(22,yt=Ee.locale),"interactive"in Ee&&u(23,Je=Ee.interactive),"attributionControl"in Ee&&u(24,dt=Ee.attributionControl),"cooperativeGestures"in Ee&&u(25,si=Ee.cooperativeGestures),"preserveDrawingBuffer"in Ee&&u(26,_e=Ee.preserveDrawingBuffer),"maxBounds"in Ee&&u(27,kt=Ee.maxBounds),"images"in Ee&&u(28,Mt=Ee.images),"standardControls"in Ee&&u(2,Wt=Ee.standardControls),"filterLayers"in Ee&&u(29,ai=Ee.filterLayers),"transformRequest"in Ee&&u(30,it=Ee.transformRequest),"$$scope"in Ee&&u(34,D=Ee.$$scope)},_.$$.update=()=>{if(_.$$.dirty[0]&4&&u(6,p=typeof Wt=="boolean"?void 0:Wt),_.$$.dirty[0]&8&&u(13,U=x),_.$$.dirty[0]&268435465&&Ye&&x!=null&&x.loaded())for(let Ee of Mt)!Zt.has(Ee.id)&&!x.hasImage(Ee.id)&&Nt(Ee);if(_.$$.dirty[0]&268435472&&u(5,b=Mt.every(Ee=>y.has(Ee.id))),_.$$.dirty[0]&196616|_.$$.dirty[1]&7&&x&&!Hc(Z,ci)){const Ee=x.getStyle();if(Ut&&(oi=Ee.layers.filter(ot=>!Ut.includes(ot.id))),gi){const ot=Object.keys(Ee.sources).filter(jt=>!gi.includes(jt));Di={};for(const jt of ot)Di[jt]=Ee.sources[jt]}u(33,ci=Z),x.setStyle(Z,{diff:K})}_.$$.dirty[0]&1032&&Ae&&!Hc(Ae,x==null?void 0:x.getCenter())&&(x==null||x.panTo(Ae)),_.$$.dirty[0]&2056&&Te&&!Hc(Te,x==null?void 0:x.getZoom())&&(x==null||x.zoomTo(Te)),_.$$.dirty[0]&4104&&He&&!Hc(He,x==null?void 0:x.getBounds())&&(x==null||x.fitBounds(He)),_.$$.dirty[0]&2097160&&(Dt?x==null||x.doubleClickZoom.enable():x==null||x.doubleClickZoom.disable())},[Ye,N,Wt,x,y,b,p,ct,mi,li,Ae,Te,He,U,je,Ue,Z,K,at,Ie,vt,Dt,yt,Je,dt,si,_e,kt,Mt,ai,it,Ut,gi,ci,D,l]}class L_ extends pn{constructor(o){super(),dn(this,o,z_,M_,Ur,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,locale:22,interactive:23,attributionControl:24,cooperativeGestures:25,preserveDrawingBuffer:26,maxBounds:27,images:28,standardControls:2,filterLayers:29,transformRequest:30},null,[-1,-1])}}const D_=_=>({features:_[0]&16,data:_[0]&16,map:_[0]&4,close:_[0]&1}),Lp=_=>{var o;return{features:_[4],data:(o=_[4])==null?void 0:o[0],map:_[2],close:_[31]}};function Dp(_){let o,u,p=(_[4]||_[3]instanceof un.Marker)&&Rp(_);return{c(){o=Tt("div"),p&&p.c()},m(b,x){Lt(b,o,x),p&&p.m(o,null),_[32](o),u=!0},p(b,x){b[4]||b[3]instanceof un.Marker?p?(p.p(b,x),x[0]&24&&Ge(p,1)):(p=Rp(b),p.c(),Ge(p,1),p.m(o,null)):p&&(Br(),nt(p,1,1,()=>{p=null}),jr())},i(b){u||(Ge(p),u=!0)},o(b){nt(p),u=!1},d(b){b&&Pt(o),p&&p.d(),_[32](null)}}}function Rp(_){let o;const u=_[30].default,p=la(u,_,_[29],Lp);return{c(){p&&p.c()},m(b,x){p&&p.m(b,x),o=!0},p(b,x){p&&p.p&&(!o||x[0]&536870933)&&ha(p,u,b,b[29],o?ca(u,b[29],x,D_):ua(b[29]),Lp)},i(b){o||(Ge(p,b),o=!0)},o(b){nt(p,b),o=!1},d(b){p&&p.d(b)}}}function R_(_){let o,u,p=_[9].default&&Dp(_);return{c(){p&&p.c(),o=ss()},m(b,x){p&&p.m(b,x),Lt(b,o,x),u=!0},p(b,x){b[9].default?p?(p.p(b,x),x[0]&512&&Ge(p,1)):(p=Dp(b),p.c(),Ge(p,1),p.m(o.parentNode,o)):p&&(Br(),nt(p,1,1,()=>{p=null}),jr())},i(b){u||(Ge(p),u=!0)},o(b){nt(p),u=!1},d(b){b&&Pt(o),p&&p.d(b)}}}function O_(_,o,u){let p,b,x,y,l,D,{$$slots:U={},$$scope:N}=o;const Z=Pg(U);let{closeButton:K=void 0}=o,{closeOnClickOutside:Ae=!0}=o,{closeOnClickInside:Te=!1}=o,{closeOnMove:je=!1}=o,{openOn:Ue="click"}=o,{openIfTopMost:He=!0}=o,{focusAfterOpen:at=!0}=o,{anchor:Ye=void 0}=o,{offset:Ie=void 0}=o,{popupClass:vt=void 0}=o,{maxWidth:Dt=void 0}=o,{lngLat:yt=void 0}=o,{html:Je=void 0}=o,{open:dt=!1}=o;const{map:si,popupTarget:_e,layerEvent:kt,layer:Mt,eventTopMost:Wt}=Io();Hi(_,si,ue=>u(2,x=ue)),Hi(_,_e,ue=>u(3,l=ue)),Hi(_,kt,ue=>u(28,y=ue)),Hi(_,Mt,ue=>u(35,D=ue));const ai=["click","dblclick","contextmenu"];let it,It=!1,ct;function mi(){if(!it)return;let ue=it.getElement();!ue||ue===ct||(ct=ue,Ue==="hover"&&(ct.style.pointerEvents="none"),ct.addEventListener("mouseenter",()=>{u(24,It=!0)},{passive:!0}),ct.addEventListener("mouseleave",()=>{u(24,It=!1)},{passive:!0}),ct.addEventListener("click",()=>{Te&&u(0,dt=!1)},{passive:!0}))}uf(()=>{if(x)return x.on("click",ot),x.on("contextmenu",ot),typeof l=="string"&&(x.on("click",l,gi),x.on("dblclick",l,gi),x.on("contextmenu",l,gi),x.on("mousemove",l,Ee),x.on("mouseleave",l,ci),x.on("touchstart",l,Di),x.on("touchend",l,li)),()=>{x!=null&&x.loaded()&&(it==null||it.remove(),x.off("click",ot),x.off("contextmenu",ot),l instanceof un.Marker?l.getPopup()===it&&l.setPopup(void 0):typeof l=="string"&&(x.off("click",l,gi),x.off("dblclick",l,gi),x.off("contextmenu",l,gi),x.off("mousemove",l,Ee),x.off("mouseleave",l,ci),x.off("touchstart",l,Di),x.off("touchend",l,li)))}});function Zt(ue){return He?!("marker"in ue)&&!Kg(ue)&&Wt(ue)!==D:!1}let Nt=null,Ut="normal";function gi(ue){ue.type===Ue&&(Zt(ue)||("layerType"in ue?ue.layerType==="deckgl"?(u(10,yt=ue.coordinate),u(4,Nt=ue.object?[ue.object]:null)):(u(10,yt=ue.lngLat),u(4,Nt=ue.features??[])):(u(10,yt=ue.lngLat),u(4,Nt=ue.features??[])),setTimeout(()=>u(0,dt=!0))))}let oi=null;function Di(ue){oi=ue.point}function li(ue){if(!oi||Ue!=="hover")return;let Rt=oi.dist(ue.point);oi=null,Rt<3&&(u(10,yt=ue.lngLat),u(4,Nt=ue.features??[]),it.isOpen()?u(25,Ut="justOpened"):(u(25,Ut="opening"),u(0,dt=!0)))}function ci(ue){Ue!=="hover"||oi||Ut!=="normal"||(u(0,dt=!1),u(4,Nt=null))}function Ee(ue){if(!(Ue!=="hover"||oi||Ut!=="normal")){if(Zt(ue)){u(0,dt=!1),u(4,Nt=null);return}u(0,dt=!0),u(4,Nt=ue.features??[]),u(10,yt=ue.lngLat)}}function ot(ue){if(Ut==="justOpened"){u(25,Ut="normal");return}if(!Ae)return;let Rt=[ct,l instanceof un.Marker?l==null?void 0:l.getElement():null];dt&&it.isOpen()&&!Rt.some(qt=>qt==null?void 0:qt.contains(ue.originalEvent.target))&&(ue.type==="contextmenu"&&Ue==="contextmenu"||ue.type!=="contextmenu")&&u(0,dt=!1)}ns(()=>{x&&(it!=null&&it.isOpen())&&it.remove()});let jt;const er=()=>u(0,dt=!1);function Er(ue){Rl[ue?"unshift":"push"](()=>{jt=ue,u(1,jt)})}return _.$$set=ue=>{"closeButton"in ue&&u(11,K=ue.closeButton),"closeOnClickOutside"in ue&&u(12,Ae=ue.closeOnClickOutside),"closeOnClickInside"in ue&&u(13,Te=ue.closeOnClickInside),"closeOnMove"in ue&&u(14,je=ue.closeOnMove),"openOn"in ue&&u(15,Ue=ue.openOn),"openIfTopMost"in ue&&u(16,He=ue.openIfTopMost),"focusAfterOpen"in ue&&u(17,at=ue.focusAfterOpen),"anchor"in ue&&u(18,Ye=ue.anchor),"offset"in ue&&u(19,Ie=ue.offset),"popupClass"in ue&&u(20,vt=ue.popupClass),"maxWidth"in ue&&u(21,Dt=ue.maxWidth),"lngLat"in ue&&u(10,yt=ue.lngLat),"html"in ue&&u(22,Je=ue.html),"open"in ue&&u(0,dt=ue.open),"$$scope"in ue&&u(29,N=ue.$$scope)},_.$$.update=()=>{if(_.$$.dirty[0]&14336&&u(27,p=K??(!Ae&&!Te)),_.$$.dirty[0]&146685952&&(it||(u(23,it=new un.Popup({closeButton:p,closeOnClick:!1,closeOnMove:je,focusAfterOpen:at,maxWidth:Dt,className:vt,anchor:Ye,offset:Ie})),ct=it.getElement(),it.on("open",()=>{u(0,dt=!0),mi()}),it.on("close",ue=>{u(0,dt=!1)}))),_.$$.dirty[0]&8421384&&it&&l instanceof un.Marker&&(Ue==="click"?l.setPopup(it):l.getPopup()===it&&l.setPopup(void 0)),_.$$.dirty[0]&268468224&&ai.includes(Ue)&&(y==null?void 0:y.type)===Ue&&(gi(y),rs(kt,y=null,y)),_.$$.dirty[0]&268468224&&u(26,b=Ue==="hover"&&((y==null?void 0:y.type)==="mousemove"||(y==null?void 0:y.type)==="mouseenter")),_.$$.dirty[0]&352354304&&Ue==="hover"&&kt&&(b&&y&&(y.layerType==="deckgl"?(u(10,yt=y.coordinate),u(4,Nt=y.object?[y.object]:null)):(u(10,yt=y.lngLat),u(4,Nt=y.features??[]))),u(0,dt=(b||It)??!1)),_.$$.dirty[0]&12582914&&(jt?it.setDOMContent(jt):Je&&it.setHTML(Je)),_.$$.dirty[0]&8389632&&yt&&it.setLngLat(yt),_.$$.dirty[0]&41943045&&x){let ue=it.isOpen();dt&&!ue?(it.addTo(x),Ut==="opening"&&u(25,Ut="justOpened")):!dt&&ue&&it.remove()}},[dt,jt,x,l,Nt,si,_e,kt,Mt,Z,yt,K,Ae,Te,je,Ue,He,at,Ye,Ie,vt,Dt,Je,it,It,Ut,b,p,y,N,U,er,Er]}class th extends pn{constructor(o){super(),dn(this,o,O_,R_,Ur,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Bl=Uint8Array,xf=Uint16Array,F_=Int32Array,B_=new Bl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),j_=new Bl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bf=function(_,o){for(var u=new xf(31),p=0;p<31;++p)u[p]=o+=1<<_[p-1];for(var b=new F_(u[30]),p=1;p<30;++p)for(var x=u[p];x<u[p+1];++x)b[x]=x-u[p]<<5|p;return{b:u,r:b}},wf=bf(B_,2),U_=wf.b,V_=wf.r;U_[28]=258,V_[258]=28;bf(j_,0);var N_=new xf(32768);for(Yt=0;Yt<32768;++Yt)ts=(Yt&43690)>>1|(Yt&21845)<<1,ts=(ts&52428)>>2|(ts&13107)<<2,ts=(ts&61680)>>4|(ts&3855)<<4,N_[Yt]=((ts&65280)>>8|(ts&255)<<8)>>1;var ts,Yt,ih=new Bl(288);for(Yt=0;Yt<144;++Yt)ih[Yt]=8;var Yt;for(Yt=144;Yt<256;++Yt)ih[Yt]=9;var Yt;for(Yt=256;Yt<280;++Yt)ih[Yt]=7;var Yt;for(Yt=280;Yt<288;++Yt)ih[Yt]=8;var Yt,q_=new Bl(32);for(Yt=0;Yt<32;++Yt)q_[Yt]=5;var Yt,Z_=new Bl(0),G_=typeof TextDecoder<"u"&&new TextDecoder,H_=0;try{G_.decode(Z_,{stream:!0}),H_=1}catch{}const W_=_=>{let o;return _?o=_:typeof fetch>"u"?o=(...u)=>bo(()=>Promise.resolve().then(()=>jl),void 0).then(({default:p})=>p(...u)):o=fetch,(...u)=>o(...u)};class Ou extends Error{constructor(o,u="FunctionsError",p){super(o),this.name=u,this.context=p}}class K_ extends Ou{constructor(o){super("Failed to send a request to the Edge Function","FunctionsFetchError",o)}}class X_ extends Ou{constructor(o){super("Relay Error invoking the Edge Function","FunctionsRelayError",o)}}class J_ extends Ou{constructor(o){super("Edge Function returned a non-2xx status code","FunctionsHttpError",o)}}var Y_=function(_,o,u,p){function b(x){return x instanceof u?x:new u(function(y){y(x)})}return new(u||(u=Promise))(function(x,y){function l(N){try{U(p.next(N))}catch(Z){y(Z)}}function D(N){try{U(p.throw(N))}catch(Z){y(Z)}}function U(N){N.done?x(N.value):b(N.value).then(l,D)}U((p=p.apply(_,o||[])).next())})};class Q_{constructor(o,{headers:u={},customFetch:p}={}){this.url=o,this.headers=u,this.fetch=W_(p)}setAuth(o){this.headers.Authorization=`Bearer ${o}`}invoke(o,u={}){var p;return Y_(this,void 0,void 0,function*(){try{const{headers:b,method:x,body:y}=u;let l={},D;y&&(b&&!Object.prototype.hasOwnProperty.call(b,"Content-Type")||!b)&&(typeof Blob<"u"&&y instanceof Blob||y instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",D=y):typeof y=="string"?(l["Content-Type"]="text/plain",D=y):typeof FormData<"u"&&y instanceof FormData?D=y:(l["Content-Type"]="application/json",D=JSON.stringify(y)));const U=yield this.fetch(`${this.url}/${o}`,{method:x||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),b),body:D}).catch(Ae=>{throw new K_(Ae)}),N=U.headers.get("x-relay-error");if(N&&N==="true")throw new X_(U);if(!U.ok)throw new J_(U);let Z=((p=U.headers.get("Content-Type"))!==null&&p!==void 0?p:"text/plain").split(";")[0].trim(),K;return Z==="application/json"?K=yield U.json():Z==="application/octet-stream"?K=yield U.blob():Z==="multipart/form-data"?K=yield U.formData():K=yield U.text(),{data:K,error:null}}catch(b){return{data:null,error:b}}})}}var $_=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},wo=$_();const ey=wo.fetch,Fu=wo.fetch.bind(wo),Sf=wo.Headers,ty=wo.Request,iy=wo.Response,jl=Object.freeze(Object.defineProperty({__proto__:null,Headers:Sf,Request:ty,Response:iy,default:Fu,fetch:ey},Symbol.toStringTag,{value:"Module"}));class ry extends Error{constructor(o){super(o.message),this.name="PostgrestError",this.details=o.details,this.hint=o.hint,this.code=o.code}}class ny{constructor(o){this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=o.headers,this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=o.shouldThrowOnError,this.signal=o.signal,this.isMaybeSingle=o.isMaybeSingle,o.fetch?this.fetch=o.fetch:typeof fetch>"u"?this.fetch=Fu:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(o,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const p=this.fetch;let b=p(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async x=>{var y,l,D;let U=null,N=null,Z=null,K=x.status,Ae=x.statusText;if(x.ok){if(this.method!=="HEAD"){const He=await x.text();He===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?N=He:N=JSON.parse(He))}const je=(y=this.headers.Prefer)===null||y===void 0?void 0:y.match(/count=(exact|planned|estimated)/),Ue=(l=x.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");je&&Ue&&Ue.length>1&&(Z=parseInt(Ue[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(N)&&(N.length>1?(U={code:"PGRST116",details:`Results contain ${N.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},N=null,Z=null,K=406,Ae="Not Acceptable"):N.length===1?N=N[0]:N=null)}else{const je=await x.text();try{U=JSON.parse(je),Array.isArray(U)&&x.status===404&&(N=[],U=null,K=200,Ae="OK")}catch{x.status===404&&je===""?(K=204,Ae="No Content"):U={message:je}}if(U&&this.isMaybeSingle&&(!((D=U==null?void 0:U.details)===null||D===void 0)&&D.includes("0 rows"))&&(U=null,K=200,Ae="OK"),U&&this.shouldThrowOnError)throw new ry(U)}return{error:U,data:N,count:Z,status:K,statusText:Ae}});return this.shouldThrowOnError||(b=b.catch(x=>{var y,l,D;return{error:{message:`${(y=x==null?void 0:x.name)!==null&&y!==void 0?y:"FetchError"}: ${x==null?void 0:x.message}`,details:`${(l=x==null?void 0:x.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(D=x==null?void 0:x.code)!==null&&D!==void 0?D:""}`},data:null,count:null,status:0,statusText:""}})),b.then(o,u)}}class sy extends ny{select(o){let u=!1;const p=(o??"*").split("").map(b=>/\s/.test(b)&&!u?"":(b==='"'&&(u=!u),b)).join("");return this.url.searchParams.set("select",p),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(o,{ascending:u=!0,nullsFirst:p,foreignTable:b,referencedTable:x=b}={}){const y=x?`${x}.order`:"order",l=this.url.searchParams.get(y);return this.url.searchParams.set(y,`${l?`${l},`:""}${o}.${u?"asc":"desc"}${p===void 0?"":p?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:u,referencedTable:p=u}={}){const b=typeof p>"u"?"limit":`${p}.limit`;return this.url.searchParams.set(b,`${o}`),this}range(o,u,{foreignTable:p,referencedTable:b=p}={}){const x=typeof b>"u"?"offset":`${b}.offset`,y=typeof b>"u"?"limit":`${b}.limit`;return this.url.searchParams.set(x,`${o}`),this.url.searchParams.set(y,`${u-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:o=!1,verbose:u=!1,settings:p=!1,buffers:b=!1,wal:x=!1,format:y="text"}={}){var l;const D=[o?"analyze":null,u?"verbose":null,p?"settings":null,b?"buffers":null,x?"wal":null].filter(Boolean).join("|"),U=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${y}; for="${U}"; options=${D};`,y==="json"?this:this}rollback(){var o;return((o=this.headers.Prefer)!==null&&o!==void 0?o:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class _o extends sy{eq(o,u){return this.url.searchParams.append(o,`eq.${u}`),this}neq(o,u){return this.url.searchParams.append(o,`neq.${u}`),this}gt(o,u){return this.url.searchParams.append(o,`gt.${u}`),this}gte(o,u){return this.url.searchParams.append(o,`gte.${u}`),this}lt(o,u){return this.url.searchParams.append(o,`lt.${u}`),this}lte(o,u){return this.url.searchParams.append(o,`lte.${u}`),this}like(o,u){return this.url.searchParams.append(o,`like.${u}`),this}likeAllOf(o,u){return this.url.searchParams.append(o,`like(all).{${u.join(",")}}`),this}likeAnyOf(o,u){return this.url.searchParams.append(o,`like(any).{${u.join(",")}}`),this}ilike(o,u){return this.url.searchParams.append(o,`ilike.${u}`),this}ilikeAllOf(o,u){return this.url.searchParams.append(o,`ilike(all).{${u.join(",")}}`),this}ilikeAnyOf(o,u){return this.url.searchParams.append(o,`ilike(any).{${u.join(",")}}`),this}is(o,u){return this.url.searchParams.append(o,`is.${u}`),this}in(o,u){const p=u.map(b=>typeof b=="string"&&new RegExp("[,()]").test(b)?`"${b}"`:`${b}`).join(",");return this.url.searchParams.append(o,`in.(${p})`),this}contains(o,u){return typeof u=="string"?this.url.searchParams.append(o,`cs.${u}`):Array.isArray(u)?this.url.searchParams.append(o,`cs.{${u.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(u)}`),this}containedBy(o,u){return typeof u=="string"?this.url.searchParams.append(o,`cd.${u}`):Array.isArray(u)?this.url.searchParams.append(o,`cd.{${u.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(u)}`),this}rangeGt(o,u){return this.url.searchParams.append(o,`sr.${u}`),this}rangeGte(o,u){return this.url.searchParams.append(o,`nxl.${u}`),this}rangeLt(o,u){return this.url.searchParams.append(o,`sl.${u}`),this}rangeLte(o,u){return this.url.searchParams.append(o,`nxr.${u}`),this}rangeAdjacent(o,u){return this.url.searchParams.append(o,`adj.${u}`),this}overlaps(o,u){return typeof u=="string"?this.url.searchParams.append(o,`ov.${u}`):this.url.searchParams.append(o,`ov.{${u.join(",")}}`),this}textSearch(o,u,{config:p,type:b}={}){let x="";b==="plain"?x="pl":b==="phrase"?x="ph":b==="websearch"&&(x="w");const y=p===void 0?"":`(${p})`;return this.url.searchParams.append(o,`${x}fts${y}.${u}`),this}match(o){return Object.entries(o).forEach(([u,p])=>{this.url.searchParams.append(u,`eq.${p}`)}),this}not(o,u,p){return this.url.searchParams.append(o,`not.${u}.${p}`),this}or(o,{foreignTable:u,referencedTable:p=u}={}){const b=p?`${p}.or`:"or";return this.url.searchParams.append(b,`(${o})`),this}filter(o,u,p){return this.url.searchParams.append(o,`${u}.${p}`),this}}class ay{constructor(o,{headers:u={},schema:p,fetch:b}){this.url=o,this.headers=u,this.schema=p,this.fetch=b}select(o,{head:u=!1,count:p}={}){const b=u?"HEAD":"GET";let x=!1;const y=(o??"*").split("").map(l=>/\s/.test(l)&&!x?"":(l==='"'&&(x=!x),l)).join("");return this.url.searchParams.set("select",y),p&&(this.headers.Prefer=`count=${p}`),new _o({method:b,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(o,{count:u,defaultToNull:p=!0}={}){const b="POST",x=[];if(this.headers.Prefer&&x.push(this.headers.Prefer),u&&x.push(`count=${u}`),p||x.push("missing=default"),this.headers.Prefer=x.join(","),Array.isArray(o)){const y=o.reduce((l,D)=>l.concat(Object.keys(D)),[]);if(y.length>0){const l=[...new Set(y)].map(D=>`"${D}"`);this.url.searchParams.set("columns",l.join(","))}}return new _o({method:b,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}upsert(o,{onConflict:u,ignoreDuplicates:p=!1,count:b,defaultToNull:x=!0}={}){const y="POST",l=[`resolution=${p?"ignore":"merge"}-duplicates`];if(u!==void 0&&this.url.searchParams.set("on_conflict",u),this.headers.Prefer&&l.push(this.headers.Prefer),b&&l.push(`count=${b}`),x||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(o)){const D=o.reduce((U,N)=>U.concat(Object.keys(N)),[]);if(D.length>0){const U=[...new Set(D)].map(N=>`"${N}"`);this.url.searchParams.set("columns",U.join(","))}}return new _o({method:y,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}update(o,{count:u}={}){const p="PATCH",b=[];return this.headers.Prefer&&b.push(this.headers.Prefer),u&&b.push(`count=${u}`),this.headers.Prefer=b.join(","),new _o({method:p,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:this.fetch,allowEmpty:!1})}delete({count:o}={}){const u="DELETE",p=[];return o&&p.push(`count=${o}`),this.headers.Prefer&&p.unshift(this.headers.Prefer),this.headers.Prefer=p.join(","),new _o({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const oy="1.9.2",ly={"X-Client-Info":`postgrest-js/${oy}`};class Bu{constructor(o,{headers:u={},schema:p,fetch:b}={}){this.url=o,this.headers=Object.assign(Object.assign({},ly),u),this.schemaName=p,this.fetch=b}from(o){const u=new URL(`${this.url}/${o}`);return new ay(u,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new Bu(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,u={},{head:p=!1,count:b}={}){let x;const y=new URL(`${this.url}/rpc/${o}`);let l;p?(x="HEAD",Object.entries(u).forEach(([U,N])=>{y.searchParams.append(U,`${N}`)})):(x="POST",l=u);const D=Object.assign({},this.headers);return b&&(D.Prefer=`count=${b}`),new _o({method:x,url:y,headers:D,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}const cy="2.9.3",hy={"X-Client-Info":`realtime-js/${cy}`},uy="1.0.0",Tf=1e4,dy=1e3;var xo;(function(_){_[_.connecting=0]="connecting",_[_.open=1]="open",_[_.closing=2]="closing",_[_.closed=3]="closed"})(xo||(xo={}));var $r;(function(_){_.closed="closed",_.errored="errored",_.joined="joined",_.joining="joining",_.leaving="leaving"})($r||($r={}));var wn;(function(_){_.close="phx_close",_.error="phx_error",_.join="phx_join",_.reply="phx_reply",_.leave="phx_leave",_.access_token="access_token"})(wn||(wn={}));var wu;(function(_){_.websocket="websocket"})(wu||(wu={}));var aa;(function(_){_.Connecting="connecting",_.Open="open",_.Closing="closing",_.Closed="closed"})(aa||(aa={}));class kf{constructor(o,u){this.callback=o,this.timerCalc=u,this.timer=void 0,this.tries=0,this.callback=o,this.timerCalc=u}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class py{constructor(){this.HEADER_LENGTH=1}decode(o,u){return o.constructor===ArrayBuffer?u(this._binaryDecode(o)):u(typeof o=="string"?JSON.parse(o):{})}_binaryDecode(o){const u=new DataView(o),p=new TextDecoder;return this._decodeBroadcast(o,u,p)}_decodeBroadcast(o,u,p){const b=u.getUint8(1),x=u.getUint8(2);let y=this.HEADER_LENGTH+2;const l=p.decode(o.slice(y,y+b));y=y+b;const D=p.decode(o.slice(y,y+x));y=y+x;const U=JSON.parse(p.decode(o.slice(y,o.byteLength)));return{ref:null,topic:l,event:D,payload:U}}}class pu{constructor(o,u,p={},b=Tf){this.channel=o,this.event=u,this.payload=p,this.timeout=b,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(o){this.timeout=o,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(o){this.payload=Object.assign(Object.assign({},this.payload),o)}receive(o,u){var p;return this._hasReceived(o)&&u((p=this.receivedResp)===null||p===void 0?void 0:p.response),this.recHooks.push({status:o,callback:u}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const o=u=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=u,this._matchReceive(u)};this.channel._on(this.refEvent,{},o),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(o,u){this.refEvent&&this.channel._trigger(this.refEvent,{status:o,response:u})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:o,response:u}){this.recHooks.filter(p=>p.status===o).forEach(p=>p.callback(u))}_hasReceived(o){return this.receivedResp&&this.receivedResp.status===o}}var Op;(function(_){_.SYNC="sync",_.JOIN="join",_.LEAVE="leave"})(Op||(Op={}));class zl{constructor(o,u){this.channel=o,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const p=(u==null?void 0:u.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(p.state,{},b=>{const{onJoin:x,onLeave:y,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=zl.syncState(this.state,b,x,y),this.pendingDiffs.forEach(D=>{this.state=zl.syncDiff(this.state,D,x,y)}),this.pendingDiffs=[],l()}),this.channel._on(p.diff,{},b=>{const{onJoin:x,onLeave:y,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(b):(this.state=zl.syncDiff(this.state,b,x,y),l())}),this.onJoin((b,x,y)=>{this.channel._trigger("presence",{event:"join",key:b,currentPresences:x,newPresences:y})}),this.onLeave((b,x,y)=>{this.channel._trigger("presence",{event:"leave",key:b,currentPresences:x,leftPresences:y})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(o,u,p,b){const x=this.cloneDeep(o),y=this.transformState(u),l={},D={};return this.map(x,(U,N)=>{y[U]||(D[U]=N)}),this.map(y,(U,N)=>{const Z=x[U];if(Z){const K=N.map(Ue=>Ue.presence_ref),Ae=Z.map(Ue=>Ue.presence_ref),Te=N.filter(Ue=>Ae.indexOf(Ue.presence_ref)<0),je=Z.filter(Ue=>K.indexOf(Ue.presence_ref)<0);Te.length>0&&(l[U]=Te),je.length>0&&(D[U]=je)}else l[U]=N}),this.syncDiff(x,{joins:l,leaves:D},p,b)}static syncDiff(o,u,p,b){const{joins:x,leaves:y}={joins:this.transformState(u.joins),leaves:this.transformState(u.leaves)};return p||(p=()=>{}),b||(b=()=>{}),this.map(x,(l,D)=>{var U;const N=(U=o[l])!==null&&U!==void 0?U:[];if(o[l]=this.cloneDeep(D),N.length>0){const Z=o[l].map(Ae=>Ae.presence_ref),K=N.filter(Ae=>Z.indexOf(Ae.presence_ref)<0);o[l].unshift(...K)}p(l,N,D)}),this.map(y,(l,D)=>{let U=o[l];if(!U)return;const N=D.map(Z=>Z.presence_ref);U=U.filter(Z=>N.indexOf(Z.presence_ref)<0),o[l]=U,b(l,U,D),U.length===0&&delete o[l]}),o}static map(o,u){return Object.getOwnPropertyNames(o).map(p=>u(p,o[p]))}static transformState(o){return o=this.cloneDeep(o),Object.getOwnPropertyNames(o).reduce((u,p)=>{const b=o[p];return"metas"in b?u[p]=b.metas.map(x=>(x.presence_ref=x.phx_ref,delete x.phx_ref,delete x.phx_ref_prev,x)):u[p]=b,u},{})}static cloneDeep(o){return JSON.parse(JSON.stringify(o))}onJoin(o){this.caller.onJoin=o}onLeave(o){this.caller.onLeave=o}onSync(o){this.caller.onSync=o}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var fi;(function(_){_.abstime="abstime",_.bool="bool",_.date="date",_.daterange="daterange",_.float4="float4",_.float8="float8",_.int2="int2",_.int4="int4",_.int4range="int4range",_.int8="int8",_.int8range="int8range",_.json="json",_.jsonb="jsonb",_.money="money",_.numeric="numeric",_.oid="oid",_.reltime="reltime",_.text="text",_.time="time",_.timestamp="timestamp",_.timestamptz="timestamptz",_.timetz="timetz",_.tsrange="tsrange",_.tstzrange="tstzrange"})(fi||(fi={}));const Fp=(_,o,u={})=>{var p;const b=(p=u.skipTypes)!==null&&p!==void 0?p:[];return Object.keys(o).reduce((x,y)=>(x[y]=fy(y,_,o,b),x),{})},fy=(_,o,u,p)=>{const b=o.find(l=>l.name===_),x=b==null?void 0:b.type,y=u[_];return x&&!p.includes(x)?If(x,y):Su(y)},If=(_,o)=>{if(_.charAt(0)==="_"){const u=_.slice(1,_.length);return yy(o,u)}switch(_){case fi.bool:return my(o);case fi.float4:case fi.float8:case fi.int2:case fi.int4:case fi.int8:case fi.numeric:case fi.oid:return gy(o);case fi.json:case fi.jsonb:return _y(o);case fi.timestamp:return vy(o);case fi.abstime:case fi.date:case fi.daterange:case fi.int4range:case fi.int8range:case fi.money:case fi.reltime:case fi.text:case fi.time:case fi.timestamptz:case fi.timetz:case fi.tsrange:case fi.tstzrange:return Su(o);default:return Su(o)}},Su=_=>_,my=_=>{switch(_){case"t":return!0;case"f":return!1;default:return _}},gy=_=>{if(typeof _=="string"){const o=parseFloat(_);if(!Number.isNaN(o))return o}return _},_y=_=>{if(typeof _=="string")try{return JSON.parse(_)}catch(o){return console.log(`JSON parse error: ${o}`),_}return _},yy=(_,o)=>{if(typeof _!="string")return _;const u=_.length-1,p=_[u];if(_[0]==="{"&&p==="}"){let x;const y=_.slice(1,u);try{x=JSON.parse("["+y+"]")}catch{x=y?y.split(","):[]}return x.map(l=>If(o,l))}return _},vy=_=>typeof _=="string"?_.replace(" ","T"):_;var Bp;(function(_){_.ALL="*",_.INSERT="INSERT",_.UPDATE="UPDATE",_.DELETE="DELETE"})(Bp||(Bp={}));var jp;(function(_){_.BROADCAST="broadcast",_.PRESENCE="presence",_.POSTGRES_CHANGES="postgres_changes"})(jp||(jp={}));var Up;(function(_){_.SUBSCRIBED="SUBSCRIBED",_.TIMED_OUT="TIMED_OUT",_.CLOSED="CLOSED",_.CHANNEL_ERROR="CHANNEL_ERROR"})(Up||(Up={}));class ju{constructor(o,u={config:{}},p){this.topic=o,this.params=u,this.socket=p,this.bindings={},this.state=$r.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=o.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},u.config),this.timeout=this.socket.timeout,this.joinPush=new pu(this,wn.join,this.params,this.timeout),this.rejoinTimer=new kf(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=$r.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(b=>b.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=$r.closed,this.socket._remove(this)}),this._onError(b=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,b),this.state=$r.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=$r.errored,this.rejoinTimer.scheduleTimeout())}),this._on(wn.reply,{},(b,x)=>{this._trigger(this._replyEventName(x),b)}),this.presence=new zl(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(o,u=this.timeout){var p,b;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:x,presence:y}}=this.params;this._onError(U=>o&&o("CHANNEL_ERROR",U)),this._onClose(()=>o&&o("CLOSED"));const l={},D={broadcast:x,presence:y,postgres_changes:(b=(p=this.bindings.postgres_changes)===null||p===void 0?void 0:p.map(U=>U.filter))!==null&&b!==void 0?b:[]};this.socket.accessToken&&(l.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:D},l)),this.joinedOnce=!0,this._rejoin(u),this.joinPush.receive("ok",({postgres_changes:U})=>{var N;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),U===void 0){o&&o("SUBSCRIBED");return}else{const Z=this.bindings.postgres_changes,K=(N=Z==null?void 0:Z.length)!==null&&N!==void 0?N:0,Ae=[];for(let Te=0;Te<K;Te++){const je=Z[Te],{filter:{event:Ue,schema:He,table:at,filter:Ye}}=je,Ie=U&&U[Te];if(Ie&&Ie.event===Ue&&Ie.schema===He&&Ie.table===at&&Ie.filter===Ye)Ae.push(Object.assign(Object.assign({},je),{id:Ie.id}));else{this.unsubscribe(),o&&o("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Ae,o&&o("SUBSCRIBED");return}}).receive("error",U=>{o&&o("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(U).join(", ")||"error")))}).receive("timeout",()=>{o&&o("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(o,u={}){return await this.send({type:"presence",event:"track",payload:o},u.timeout||this.timeout)}async untrack(o={}){return await this.send({type:"presence",event:"untrack"},o)}on(o,u,p){return this._on(o,u,p)}async send(o,u={}){var p,b;if(!this._canPush()&&o.type==="broadcast"){const{event:x,payload:y}=o,l={method:"POST",headers:{apikey:(p=this.socket.apiKey)!==null&&p!==void 0?p:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:x,payload:y}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,l,(b=u.timeout)!==null&&b!==void 0?b:this.timeout)).ok?"ok":"error"}catch(D){return D.name==="AbortError"?"timed out":"error"}}else return new Promise(x=>{var y,l,D;const U=this._push(o.type,o,u.timeout||this.timeout);o.type==="broadcast"&&!(!((D=(l=(y=this.params)===null||y===void 0?void 0:y.config)===null||l===void 0?void 0:l.broadcast)===null||D===void 0)&&D.ack)&&x("ok"),U.receive("ok",()=>x("ok")),U.receive("timeout",()=>x("timed out"))})}updateJoinPayload(o){this.joinPush.updatePayload(o)}unsubscribe(o=this.timeout){this.state=$r.leaving;const u=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(wn.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(p=>{const b=new pu(this,wn.leave,{},o);b.receive("ok",()=>{u(),p("ok")}).receive("timeout",()=>{u(),p("timed out")}).receive("error",()=>{p("error")}),b.send(),this._canPush()||b.trigger("ok",{})})}_broadcastEndpointURL(){let o=this.socket.endPoint;return o=o.replace(/^ws/i,"http"),o=o.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),o.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(o,u,p){const b=new AbortController,x=setTimeout(()=>b.abort(),p),y=await this.socket.fetch(o,Object.assign(Object.assign({},u),{signal:b.signal}));return clearTimeout(x),y}_push(o,u,p=this.timeout){if(!this.joinedOnce)throw`tried to push '${o}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let b=new pu(this,o,u,p);return this._canPush()?b.send():(b.startTimeout(),this.pushBuffer.push(b)),b}_onMessage(o,u,p){return u}_isMember(o){return this.topic===o}_joinRef(){return this.joinPush.ref}_trigger(o,u,p){var b,x;const y=o.toLocaleLowerCase(),{close:l,error:D,leave:U,join:N}=wn;if(p&&[l,D,U,N].indexOf(y)>=0&&p!==this._joinRef())return;let K=this._onMessage(y,u,p);if(u&&!K)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(y)?(b=this.bindings.postgres_changes)===null||b===void 0||b.filter(Ae=>{var Te,je,Ue;return((Te=Ae.filter)===null||Te===void 0?void 0:Te.event)==="*"||((Ue=(je=Ae.filter)===null||je===void 0?void 0:je.event)===null||Ue===void 0?void 0:Ue.toLocaleLowerCase())===y}).map(Ae=>Ae.callback(K,p)):(x=this.bindings[y])===null||x===void 0||x.filter(Ae=>{var Te,je,Ue,He,at,Ye;if(["broadcast","presence","postgres_changes"].includes(y))if("id"in Ae){const Ie=Ae.id,vt=(Te=Ae.filter)===null||Te===void 0?void 0:Te.event;return Ie&&((je=u.ids)===null||je===void 0?void 0:je.includes(Ie))&&(vt==="*"||(vt==null?void 0:vt.toLocaleLowerCase())===((Ue=u.data)===null||Ue===void 0?void 0:Ue.type.toLocaleLowerCase()))}else{const Ie=(at=(He=Ae==null?void 0:Ae.filter)===null||He===void 0?void 0:He.event)===null||at===void 0?void 0:at.toLocaleLowerCase();return Ie==="*"||Ie===((Ye=u==null?void 0:u.event)===null||Ye===void 0?void 0:Ye.toLocaleLowerCase())}else return Ae.type.toLocaleLowerCase()===y}).map(Ae=>{if(typeof K=="object"&&"ids"in K){const Te=K.data,{schema:je,table:Ue,commit_timestamp:He,type:at,errors:Ye}=Te;K=Object.assign(Object.assign({},{schema:je,table:Ue,commit_timestamp:He,eventType:at,new:{},old:{},errors:Ye}),this._getPayloadRecords(Te))}Ae.callback(K,p)})}_isClosed(){return this.state===$r.closed}_isJoined(){return this.state===$r.joined}_isJoining(){return this.state===$r.joining}_isLeaving(){return this.state===$r.leaving}_replyEventName(o){return`chan_reply_${o}`}_on(o,u,p){const b=o.toLocaleLowerCase(),x={type:b,filter:u,callback:p};return this.bindings[b]?this.bindings[b].push(x):this.bindings[b]=[x],this}_off(o,u){const p=o.toLocaleLowerCase();return this.bindings[p]=this.bindings[p].filter(b=>{var x;return!(((x=b.type)===null||x===void 0?void 0:x.toLocaleLowerCase())===p&&ju.isEqual(b.filter,u))}),this}static isEqual(o,u){if(Object.keys(o).length!==Object.keys(u).length)return!1;for(const p in o)if(o[p]!==u[p])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(o){this._on(wn.close,{},o)}_onError(o){this._on(wn.error,{},u=>o(u))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(o=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=$r.joining,this.joinPush.resend(o))}_getPayloadRecords(o){const u={new:{},old:{}};return(o.type==="INSERT"||o.type==="UPDATE")&&(u.new=Fp(o.columns,o.record)),(o.type==="UPDATE"||o.type==="DELETE")&&(u.old=Fp(o.columns,o.old_record)),u}}const xy=()=>{},by=typeof WebSocket<"u";class wy{constructor(o,u){var p;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=hy,this.params={},this.timeout=Tf,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=xy,this.conn=null,this.sendBuffer=[],this.serializer=new py,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=x=>{let y;return x?y=x:typeof fetch>"u"?y=(...l)=>bo(()=>Promise.resolve().then(()=>jl),void 0).then(({default:D})=>D(...l)):y=fetch,(...l)=>y(...l)},this.endPoint=`${o}/${wu.websocket}`,u!=null&&u.transport?this.transport=u.transport:this.transport=null,u!=null&&u.params&&(this.params=u.params),u!=null&&u.headers&&(this.headers=Object.assign(Object.assign({},this.headers),u.headers)),u!=null&&u.timeout&&(this.timeout=u.timeout),u!=null&&u.logger&&(this.logger=u.logger),u!=null&&u.heartbeatIntervalMs&&(this.heartbeatIntervalMs=u.heartbeatIntervalMs);const b=(p=u==null?void 0:u.params)===null||p===void 0?void 0:p.apikey;b&&(this.accessToken=b,this.apiKey=b),this.reconnectAfterMs=u!=null&&u.reconnectAfterMs?u.reconnectAfterMs:x=>[1e3,2e3,5e3,1e4][x-1]||1e4,this.encode=u!=null&&u.encode?u.encode:(x,y)=>y(JSON.stringify(x)),this.decode=u!=null&&u.decode?u.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new kf(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(u==null?void 0:u.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(by){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Sy(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),bo(()=>import("./browser-pQL2mihb.js").then(o=>o.b),__vite__mapDeps([])).then(({default:o})=>{this.conn=new o(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(o,u){this.conn&&(this.conn.onclose=function(){},o?this.conn.close(o,u??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(o){const u=await o.unsubscribe();return this.channels.length===0&&this.disconnect(),u}async removeAllChannels(){const o=await Promise.all(this.channels.map(u=>u.unsubscribe()));return this.disconnect(),o}log(o,u,p){this.logger(o,u,p)}connectionState(){switch(this.conn&&this.conn.readyState){case xo.connecting:return aa.Connecting;case xo.open:return aa.Open;case xo.closing:return aa.Closing;default:return aa.Closed}}isConnected(){return this.connectionState()===aa.Open}channel(o,u={config:{}}){const p=new ju(`realtime:${o}`,u,this);return this.channels.push(p),p}push(o){const{topic:u,event:p,payload:b,ref:x}=o,y=()=>{this.encode(o,l=>{var D;(D=this.conn)===null||D===void 0||D.send(l)})};this.log("push",`${u} ${p} (${x})`,b),this.isConnected()?y():this.sendBuffer.push(y)}setAuth(o){this.accessToken=o,this.channels.forEach(u=>{o&&u.updateJoinPayload({access_token:o}),u.joinedOnce&&u._isJoined()&&u._push(wn.access_token,{access_token:o})})}_makeRef(){let o=this.ref+1;return o===this.ref?this.ref=0:this.ref=o,this.ref.toString()}_leaveOpenTopic(o){let u=this.channels.find(p=>p.topic===o&&(p._isJoined()||p._isJoining()));u&&(this.log("transport",`leaving duplicate topic "${o}"`),u.unsubscribe())}_remove(o){this.channels=this.channels.filter(u=>u._joinRef()!==o._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=o=>this._onConnError(o),this.conn.onmessage=o=>this._onConnMessage(o),this.conn.onclose=o=>this._onConnClose(o))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:uy}))}_onConnMessage(o){this.decode(o.data,u=>{let{topic:p,event:b,payload:x,ref:y}=u;(y&&y===this.pendingHeartbeatRef||b===(x==null?void 0:x.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${x.status||""} ${p} ${b} ${y&&"("+y+")"||""}`,x),this.channels.filter(l=>l._isMember(p)).forEach(l=>l._trigger(b,x,y)),this.stateChangeCallbacks.message.forEach(l=>l(u))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(o=>o())}_onConnClose(o){this.log("transport","close",o),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(u=>u(o))}_onConnError(o){this.log("transport",o.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(u=>u(o))}_triggerChanError(){this.channels.forEach(o=>o._trigger(wn.error))}_appendParams(o,u){if(Object.keys(u).length===0)return o;const p=o.match(/\?/)?"&":"?",b=new URLSearchParams(u);return`${o}${p}${b}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(o=>o()),this.sendBuffer=[])}_sendHeartbeat(){var o;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(o=this.conn)===null||o===void 0||o.close(dy,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Sy{constructor(o,u,p){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=xo.connecting,this.send=()=>{},this.url=null,this.url=o,this.close=p.close}}class Uu extends Error{constructor(o){super(o),this.__isStorageError=!0,this.name="StorageError"}}function Ar(_){return typeof _=="object"&&_!==null&&"__isStorageError"in _}class Ty extends Uu{constructor(o,u){super(o),this.name="StorageApiError",this.status=u}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Vp extends Uu{constructor(o,u){super(o),this.name="StorageUnknownError",this.originalError=u}}var ky=function(_,o,u,p){function b(x){return x instanceof u?x:new u(function(y){y(x)})}return new(u||(u=Promise))(function(x,y){function l(N){try{U(p.next(N))}catch(Z){y(Z)}}function D(N){try{U(p.throw(N))}catch(Z){y(Z)}}function U(N){N.done?x(N.value):b(N.value).then(l,D)}U((p=p.apply(_,o||[])).next())})};const Cf=_=>{let o;return _?o=_:typeof fetch>"u"?o=(...u)=>bo(()=>Promise.resolve().then(()=>jl),void 0).then(({default:p})=>p(...u)):o=fetch,(...u)=>o(...u)},Iy=()=>ky(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield bo(()=>Promise.resolve().then(()=>jl),void 0)).Response:Response});var Co=function(_,o,u,p){function b(x){return x instanceof u?x:new u(function(y){y(x)})}return new(u||(u=Promise))(function(x,y){function l(N){try{U(p.next(N))}catch(Z){y(Z)}}function D(N){try{U(p.throw(N))}catch(Z){y(Z)}}function U(N){N.done?x(N.value):b(N.value).then(l,D)}U((p=p.apply(_,o||[])).next())})};const fu=_=>_.msg||_.message||_.error_description||_.error||JSON.stringify(_),Cy=(_,o)=>Co(void 0,void 0,void 0,function*(){const u=yield Iy();_ instanceof u?_.json().then(p=>{o(new Ty(fu(p),_.status||500))}).catch(p=>{o(new Vp(fu(p),p))}):o(new Vp(fu(_),_))}),Ay=(_,o,u,p)=>{const b={method:_,headers:(o==null?void 0:o.headers)||{}};return _==="GET"?b:(b.headers=Object.assign({"Content-Type":"application/json"},o==null?void 0:o.headers),b.body=JSON.stringify(p),Object.assign(Object.assign({},b),u))};function rh(_,o,u,p,b,x){return Co(this,void 0,void 0,function*(){return new Promise((y,l)=>{_(u,Ay(o,p,b,x)).then(D=>{if(!D.ok)throw D;return p!=null&&p.noResolveJson?D:D.json()}).then(D=>y(D)).catch(D=>Cy(D,l))})})}function Tu(_,o,u,p){return Co(this,void 0,void 0,function*(){return rh(_,"GET",o,u,p)})}function As(_,o,u,p,b){return Co(this,void 0,void 0,function*(){return rh(_,"POST",o,p,b,u)})}function Ey(_,o,u,p,b){return Co(this,void 0,void 0,function*(){return rh(_,"PUT",o,p,b,u)})}function Af(_,o,u,p,b){return Co(this,void 0,void 0,function*(){return rh(_,"DELETE",o,p,b,u)})}var cn=function(_,o,u,p){function b(x){return x instanceof u?x:new u(function(y){y(x)})}return new(u||(u=Promise))(function(x,y){function l(N){try{U(p.next(N))}catch(Z){y(Z)}}function D(N){try{U(p.throw(N))}catch(Z){y(Z)}}function U(N){N.done?x(N.value):b(N.value).then(l,D)}U((p=p.apply(_,o||[])).next())})};const Py={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Np={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class My{constructor(o,u={},p,b){this.url=o,this.headers=u,this.bucketId=p,this.fetch=Cf(b)}uploadOrUpdate(o,u,p,b){return cn(this,void 0,void 0,function*(){try{let x;const y=Object.assign(Object.assign({},Np),b),l=Object.assign(Object.assign({},this.headers),o==="POST"&&{"x-upsert":String(y.upsert)});typeof Blob<"u"&&p instanceof Blob?(x=new FormData,x.append("cacheControl",y.cacheControl),x.append("",p)):typeof FormData<"u"&&p instanceof FormData?(x=p,x.append("cacheControl",y.cacheControl)):(x=p,l["cache-control"]=`max-age=${y.cacheControl}`,l["content-type"]=y.contentType);const D=this._removeEmptyFolders(u),U=this._getFinalPath(D),N=yield this.fetch(`${this.url}/object/${U}`,Object.assign({method:o,body:x,headers:l},y!=null&&y.duplex?{duplex:y.duplex}:{})),Z=yield N.json();return N.ok?{data:{path:D,id:Z.Id,fullPath:Z.Key},error:null}:{data:null,error:Z}}catch(x){if(Ar(x))return{data:null,error:x};throw x}})}upload(o,u,p){return cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",o,u,p)})}uploadToSignedUrl(o,u,p,b){return cn(this,void 0,void 0,function*(){const x=this._removeEmptyFolders(o),y=this._getFinalPath(x),l=new URL(this.url+`/object/upload/sign/${y}`);l.searchParams.set("token",u);try{let D;const U=Object.assign({upsert:Np.upsert},b),N=Object.assign(Object.assign({},this.headers),{"x-upsert":String(U.upsert)});typeof Blob<"u"&&p instanceof Blob?(D=new FormData,D.append("cacheControl",U.cacheControl),D.append("",p)):typeof FormData<"u"&&p instanceof FormData?(D=p,D.append("cacheControl",U.cacheControl)):(D=p,N["cache-control"]=`max-age=${U.cacheControl}`,N["content-type"]=U.contentType);const Z=yield this.fetch(l.toString(),{method:"PUT",body:D,headers:N}),K=yield Z.json();return Z.ok?{data:{path:x,fullPath:K.Key},error:null}:{data:null,error:K}}catch(D){if(Ar(D))return{data:null,error:D};throw D}})}createSignedUploadUrl(o){return cn(this,void 0,void 0,function*(){try{let u=this._getFinalPath(o);const p=yield As(this.fetch,`${this.url}/object/upload/sign/${u}`,{},{headers:this.headers}),b=new URL(this.url+p.url),x=b.searchParams.get("token");if(!x)throw new Uu("No token returned by API");return{data:{signedUrl:b.toString(),path:o,token:x},error:null}}catch(u){if(Ar(u))return{data:null,error:u};throw u}})}update(o,u,p){return cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",o,u,p)})}move(o,u){return cn(this,void 0,void 0,function*(){try{return{data:yield As(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:o,destinationKey:u},{headers:this.headers}),error:null}}catch(p){if(Ar(p))return{data:null,error:p};throw p}})}copy(o,u){return cn(this,void 0,void 0,function*(){try{return{data:{path:(yield As(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:o,destinationKey:u},{headers:this.headers})).Key},error:null}}catch(p){if(Ar(p))return{data:null,error:p};throw p}})}createSignedUrl(o,u,p){return cn(this,void 0,void 0,function*(){try{let b=this._getFinalPath(o),x=yield As(this.fetch,`${this.url}/object/sign/${b}`,Object.assign({expiresIn:u},p!=null&&p.transform?{transform:p.transform}:{}),{headers:this.headers});const y=p!=null&&p.download?`&download=${p.download===!0?"":p.download}`:"";return x={signedUrl:encodeURI(`${this.url}${x.signedURL}${y}`)},{data:x,error:null}}catch(b){if(Ar(b))return{data:null,error:b};throw b}})}createSignedUrls(o,u,p){return cn(this,void 0,void 0,function*(){try{const b=yield As(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:u,paths:o},{headers:this.headers}),x=p!=null&&p.download?`&download=${p.download===!0?"":p.download}`:"";return{data:b.map(y=>Object.assign(Object.assign({},y),{signedUrl:y.signedURL?encodeURI(`${this.url}${y.signedURL}${x}`):null})),error:null}}catch(b){if(Ar(b))return{data:null,error:b};throw b}})}download(o,u){return cn(this,void 0,void 0,function*(){const b=typeof(u==null?void 0:u.transform)<"u"?"render/image/authenticated":"object",x=this.transformOptsToQueryString((u==null?void 0:u.transform)||{}),y=x?`?${x}`:"";try{const l=this._getFinalPath(o);return{data:yield(yield Tu(this.fetch,`${this.url}/${b}/${l}${y}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(Ar(l))return{data:null,error:l};throw l}})}getPublicUrl(o,u){const p=this._getFinalPath(o),b=[],x=u!=null&&u.download?`download=${u.download===!0?"":u.download}`:"";x!==""&&b.push(x);const l=typeof(u==null?void 0:u.transform)<"u"?"render/image":"object",D=this.transformOptsToQueryString((u==null?void 0:u.transform)||{});D!==""&&b.push(D);let U=b.join("&");return U!==""&&(U=`?${U}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${p}${U}`)}}}remove(o){return cn(this,void 0,void 0,function*(){try{return{data:yield Af(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:o},{headers:this.headers}),error:null}}catch(u){if(Ar(u))return{data:null,error:u};throw u}})}list(o,u,p){return cn(this,void 0,void 0,function*(){try{const b=Object.assign(Object.assign(Object.assign({},Py),u),{prefix:o||""});return{data:yield As(this.fetch,`${this.url}/object/list/${this.bucketId}`,b,{headers:this.headers},p),error:null}}catch(b){if(Ar(b))return{data:null,error:b};throw b}})}_getFinalPath(o){return`${this.bucketId}/${o}`}_removeEmptyFolders(o){return o.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(o){const u=[];return o.width&&u.push(`width=${o.width}`),o.height&&u.push(`height=${o.height}`),o.resize&&u.push(`resize=${o.resize}`),o.format&&u.push(`format=${o.format}`),o.quality&&u.push(`quality=${o.quality}`),u.join("&")}}const zy="2.5.5",Ly={"X-Client-Info":`storage-js/${zy}`};var ho=function(_,o,u,p){function b(x){return x instanceof u?x:new u(function(y){y(x)})}return new(u||(u=Promise))(function(x,y){function l(N){try{U(p.next(N))}catch(Z){y(Z)}}function D(N){try{U(p.throw(N))}catch(Z){y(Z)}}function U(N){N.done?x(N.value):b(N.value).then(l,D)}U((p=p.apply(_,o||[])).next())})};class Dy{constructor(o,u={},p){this.url=o,this.headers=Object.assign(Object.assign({},Ly),u),this.fetch=Cf(p)}listBuckets(){return ho(this,void 0,void 0,function*(){try{return{data:yield Tu(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(o){if(Ar(o))return{data:null,error:o};throw o}})}getBucket(o){return ho(this,void 0,void 0,function*(){try{return{data:yield Tu(this.fetch,`${this.url}/bucket/${o}`,{headers:this.headers}),error:null}}catch(u){if(Ar(u))return{data:null,error:u};throw u}})}createBucket(o,u={public:!1}){return ho(this,void 0,void 0,function*(){try{return{data:yield As(this.fetch,`${this.url}/bucket`,{id:o,name:o,public:u.public,file_size_limit:u.fileSizeLimit,allowed_mime_types:u.allowedMimeTypes},{headers:this.headers}),error:null}}catch(p){if(Ar(p))return{data:null,error:p};throw p}})}updateBucket(o,u){return ho(this,void 0,void 0,function*(){try{return{data:yield Ey(this.fetch,`${this.url}/bucket/${o}`,{id:o,name:o,public:u.public,file_size_limit:u.fileSizeLimit,allowed_mime_types:u.allowedMimeTypes},{headers:this.headers}),error:null}}catch(p){if(Ar(p))return{data:null,error:p};throw p}})}emptyBucket(o){return ho(this,void 0,void 0,function*(){try{return{data:yield As(this.fetch,`${this.url}/bucket/${o}/empty`,{},{headers:this.headers}),error:null}}catch(u){if(Ar(u))return{data:null,error:u};throw u}})}deleteBucket(o){return ho(this,void 0,void 0,function*(){try{return{data:yield Af(this.fetch,`${this.url}/bucket/${o}`,{},{headers:this.headers}),error:null}}catch(u){if(Ar(u))return{data:null,error:u};throw u}})}}class Ry extends Dy{constructor(o,u={},p){super(o,u,p)}from(o){return new My(this.url,this.headers,o,this.fetch)}}const Oy="2.39.7";let Ml="";typeof Deno<"u"?Ml="deno":typeof document<"u"?Ml="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ml="react-native":Ml="node";const Fy={"X-Client-Info":`supabase-js-${Ml}/${Oy}`},By={headers:Fy},jy={schema:"public"},Uy={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Vy={};var Ny=function(_,o,u,p){function b(x){return x instanceof u?x:new u(function(y){y(x)})}return new(u||(u=Promise))(function(x,y){function l(N){try{U(p.next(N))}catch(Z){y(Z)}}function D(N){try{U(p.throw(N))}catch(Z){y(Z)}}function U(N){N.done?x(N.value):b(N.value).then(l,D)}U((p=p.apply(_,o||[])).next())})};const qy=_=>{let o;return _?o=_:typeof fetch>"u"?o=Fu:o=fetch,(...u)=>o(...u)},Zy=()=>typeof Headers>"u"?Sf:Headers,Gy=(_,o,u)=>{const p=qy(u),b=Zy();return(x,y)=>Ny(void 0,void 0,void 0,function*(){var l;const D=(l=yield o())!==null&&l!==void 0?l:_;let U=new b(y==null?void 0:y.headers);return U.has("apikey")||U.set("apikey",_),U.has("Authorization")||U.set("Authorization",`Bearer ${D}`),p(x,Object.assign(Object.assign({},y),{headers:U}))})};function Hy(_){return _.replace(/\/$/,"")}function Wy(_,o){const{db:u,auth:p,realtime:b,global:x}=_,{db:y,auth:l,realtime:D,global:U}=o;return{db:Object.assign(Object.assign({},y),u),auth:Object.assign(Object.assign({},l),p),realtime:Object.assign(Object.assign({},D),b),global:Object.assign(Object.assign({},U),x)}}function Ky(_){return Math.round(Date.now()/1e3)+_}function Xy(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(_){const o=Math.random()*16|0;return(_=="x"?o:o&3|8).toString(16)})}const bn=()=>typeof document<"u",ra={tested:!1,writable:!1},Ll=()=>{if(!bn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ra.tested)return ra.writable;const _=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(_,_),globalThis.localStorage.removeItem(_),ra.tested=!0,ra.writable=!0}catch{ra.tested=!0,ra.writable=!1}return ra.writable};function mu(_){const o={},u=new URL(_);if(u.hash&&u.hash[0]==="#")try{new URLSearchParams(u.hash.substring(1)).forEach((b,x)=>{o[x]=b})}catch{}return u.searchParams.forEach((p,b)=>{o[b]=p}),o}const Ef=_=>{let o;return _?o=_:typeof fetch>"u"?o=(...u)=>bo(()=>Promise.resolve().then(()=>jl),void 0).then(({default:p})=>p(...u)):o=fetch,(...u)=>o(...u)},Jy=_=>typeof _=="object"&&_!==null&&"status"in _&&"ok"in _&&"json"in _&&typeof _.json=="function",na=async(_,o,u)=>{await _.setItem(o,JSON.stringify(u))},Wc=async(_,o)=>{const u=await _.getItem(o);if(!u)return null;try{return JSON.parse(u)}catch{return u}},gu=async(_,o)=>{await _.removeItem(o)};function Yy(_){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let u="",p,b,x,y,l,D,U,N=0;for(_=_.replace("-","+").replace("_","/");N<_.length;)y=o.indexOf(_.charAt(N++)),l=o.indexOf(_.charAt(N++)),D=o.indexOf(_.charAt(N++)),U=o.indexOf(_.charAt(N++)),p=y<<2|l>>4,b=(l&15)<<4|D>>2,x=(D&3)<<6|U,u=u+String.fromCharCode(p),D!=64&&b!=0&&(u=u+String.fromCharCode(b)),U!=64&&x!=0&&(u=u+String.fromCharCode(x));return u}class nh{constructor(){this.promise=new nh.promiseConstructor((o,u)=>{this.resolve=o,this.reject=u})}}nh.promiseConstructor=Promise;function qp(_){const o=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,u=_.split(".");if(u.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!o.test(u[1]))throw new Error("JWT is not valid: payload is not in base64url format");const p=u[1];return JSON.parse(Yy(p))}async function Qy(_){return await new Promise(o=>{setTimeout(()=>o(null),_)})}function $y(_,o){return new Promise((p,b)=>{(async()=>{for(let x=0;x<1/0;x++)try{const y=await _(x);if(!o(x,null,y)){p(y);return}}catch(y){if(!o(x,y)){b(y);return}}})()})}function e0(_){return("0"+_.toString(16)).substr(-2)}function uo(){const o=new Uint32Array(56);if(typeof crypto>"u"){const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",p=u.length;let b="";for(let x=0;x<56;x++)b+=u.charAt(Math.floor(Math.random()*p));return b}return crypto.getRandomValues(o),Array.from(o,e0).join("")}async function t0(_){const u=new TextEncoder().encode(_),p=await crypto.subtle.digest("SHA-256",u),b=new Uint8Array(p);return Array.from(b).map(x=>String.fromCharCode(x)).join("")}function i0(_){return btoa(_).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function po(_){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),_;const u=await t0(_);return i0(u)}class Vu extends Error{constructor(o,u){super(o),this.__isAuthError=!0,this.name="AuthError",this.status=u}}function Ft(_){return typeof _=="object"&&_!==null&&"__isAuthError"in _}class r0 extends Vu{constructor(o,u){super(o,u),this.name="AuthApiError",this.status=u}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function n0(_){return Ft(_)&&_.name==="AuthApiError"}class Pf extends Vu{constructor(o,u){super(o),this.name="AuthUnknownError",this.originalError=u}}class da extends Vu{constructor(o,u,p){super(o),this.name=u,this.status=p}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class fo extends da{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class _u extends da{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Kc extends da{constructor(o){super(o,"AuthInvalidCredentialsError",400)}}class Xc extends da{constructor(o,u=null){super(o,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=u}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Zp extends da{constructor(o,u=null){super(o,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=u}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ku extends da{constructor(o,u){super(o,"AuthRetryableFetchError",u)}}function yu(_){return Ft(_)&&_.name==="AuthRetryableFetchError"}class s0 extends da{constructor(o,u,p){super(o,"AuthWeakPasswordError",u),this.reasons=p}}var a0=function(_,o){var u={};for(var p in _)Object.prototype.hasOwnProperty.call(_,p)&&o.indexOf(p)<0&&(u[p]=_[p]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,p=Object.getOwnPropertySymbols(_);b<p.length;b++)o.indexOf(p[b])<0&&Object.prototype.propertyIsEnumerable.call(_,p[b])&&(u[p[b]]=_[p[b]]);return u};const yo=_=>_.msg||_.message||_.error_description||_.error||JSON.stringify(_),o0=[502,503,504];async function Gp(_){if(!Jy(_))throw new ku(yo(_),0);if(o0.includes(_.status))throw new ku(yo(_),_.status);let o;try{o=await _.json()}catch(u){throw new Pf(yo(u),u)}throw typeof o=="object"&&o&&typeof o.weak_password=="object"&&o.weak_password&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.reasons.reduce((u,p)=>u&&typeof p=="string",!0)?new s0(yo(o),_.status,o.weak_password.reasons):new r0(yo(o),_.status||500)}const l0=(_,o,u,p)=>{const b={method:_,headers:(o==null?void 0:o.headers)||{}};return _==="GET"?b:(b.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},o==null?void 0:o.headers),b.body=JSON.stringify(p),Object.assign(Object.assign({},b),u))};async function Vt(_,o,u,p){var b;const x=Object.assign({},p==null?void 0:p.headers);p!=null&&p.jwt&&(x.Authorization=`Bearer ${p.jwt}`);const y=(b=p==null?void 0:p.query)!==null&&b!==void 0?b:{};p!=null&&p.redirectTo&&(y.redirect_to=p.redirectTo);const l=Object.keys(y).length?"?"+new URLSearchParams(y).toString():"",D=await c0(_,o,u+l,{headers:x,noResolveJson:p==null?void 0:p.noResolveJson},{},p==null?void 0:p.body);return p!=null&&p.xform?p==null?void 0:p.xform(D):{data:Object.assign({},D),error:null}}async function c0(_,o,u,p,b,x){const y=l0(o,p,b,x);let l;try{l=await _(u,y)}catch(D){throw console.error(D),new ku(yo(D),0)}if(l.ok||await Gp(l),p!=null&&p.noResolveJson)return l;try{return await l.json()}catch(D){await Gp(D)}}function sa(_){var o;let u=null;p0(_)&&(u=Object.assign({},_),_.expires_at||(u.expires_at=Ky(_.expires_in)));const p=(o=_.user)!==null&&o!==void 0?o:_;return{data:{session:u,user:p},error:null}}function Hp(_){const o=sa(_);return!o.error&&_.weak_password&&typeof _.weak_password=="object"&&Array.isArray(_.weak_password.reasons)&&_.weak_password.reasons.length&&_.weak_password.message&&typeof _.weak_password.message=="string"&&_.weak_password.reasons.reduce((u,p)=>u&&typeof p=="string",!0)&&(o.data.weak_password=_.weak_password),o}function Es(_){var o;return{data:{user:(o=_.user)!==null&&o!==void 0?o:_},error:null}}function h0(_){return{data:_,error:null}}function u0(_){const{action_link:o,email_otp:u,hashed_token:p,redirect_to:b,verification_type:x}=_,y=a0(_,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:o,email_otp:u,hashed_token:p,redirect_to:b,verification_type:x},D=Object.assign({},y);return{data:{properties:l,user:D},error:null}}function d0(_){return _}function p0(_){return _.access_token&&_.refresh_token&&_.expires_in}var f0=function(_,o){var u={};for(var p in _)Object.prototype.hasOwnProperty.call(_,p)&&o.indexOf(p)<0&&(u[p]=_[p]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,p=Object.getOwnPropertySymbols(_);b<p.length;b++)o.indexOf(p[b])<0&&Object.prototype.propertyIsEnumerable.call(_,p[b])&&(u[p[b]]=_[p[b]]);return u};class m0{constructor({url:o="",headers:u={},fetch:p}){this.url=o,this.headers=u,this.fetch=Ef(p),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(o,u="global"){try{return await Vt(this.fetch,"POST",`${this.url}/logout?scope=${u}`,{headers:this.headers,jwt:o,noResolveJson:!0}),{data:null,error:null}}catch(p){if(Ft(p))return{data:null,error:p};throw p}}async inviteUserByEmail(o,u={}){try{return await Vt(this.fetch,"POST",`${this.url}/invite`,{body:{email:o,data:u.data},headers:this.headers,redirectTo:u.redirectTo,xform:Es})}catch(p){if(Ft(p))return{data:{user:null},error:p};throw p}}async generateLink(o){try{const{options:u}=o,p=f0(o,["options"]),b=Object.assign(Object.assign({},p),u);return"newEmail"in p&&(b.new_email=p==null?void 0:p.newEmail,delete b.newEmail),await Vt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:b,headers:this.headers,xform:u0,redirectTo:u==null?void 0:u.redirectTo})}catch(u){if(Ft(u))return{data:{properties:null,user:null},error:u};throw u}}async createUser(o){try{return await Vt(this.fetch,"POST",`${this.url}/admin/users`,{body:o,headers:this.headers,xform:Es})}catch(u){if(Ft(u))return{data:{user:null},error:u};throw u}}async listUsers(o){var u,p,b,x,y,l,D;try{const U={nextPage:null,lastPage:0,total:0},N=await Vt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(p=(u=o==null?void 0:o.page)===null||u===void 0?void 0:u.toString())!==null&&p!==void 0?p:"",per_page:(x=(b=o==null?void 0:o.perPage)===null||b===void 0?void 0:b.toString())!==null&&x!==void 0?x:""},xform:d0});if(N.error)throw N.error;const Z=await N.json(),K=(y=N.headers.get("x-total-count"))!==null&&y!==void 0?y:0,Ae=(D=(l=N.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&D!==void 0?D:[];return Ae.length>0&&(Ae.forEach(Te=>{const je=parseInt(Te.split(";")[0].split("=")[1].substring(0,1)),Ue=JSON.parse(Te.split(";")[1].split("=")[1]);U[`${Ue}Page`]=je}),U.total=parseInt(K)),{data:Object.assign(Object.assign({},Z),U),error:null}}catch(U){if(Ft(U))return{data:{users:[]},error:U};throw U}}async getUserById(o){try{return await Vt(this.fetch,"GET",`${this.url}/admin/users/${o}`,{headers:this.headers,xform:Es})}catch(u){if(Ft(u))return{data:{user:null},error:u};throw u}}async updateUserById(o,u){try{return await Vt(this.fetch,"PUT",`${this.url}/admin/users/${o}`,{body:u,headers:this.headers,xform:Es})}catch(p){if(Ft(p))return{data:{user:null},error:p};throw p}}async deleteUser(o,u=!1){try{return await Vt(this.fetch,"DELETE",`${this.url}/admin/users/${o}`,{headers:this.headers,body:{should_soft_delete:u},xform:Es})}catch(p){if(Ft(p))return{data:{user:null},error:p};throw p}}async _listFactors(o){try{const{data:u,error:p}=await Vt(this.fetch,"GET",`${this.url}/admin/users/${o.userId}/factors`,{headers:this.headers,xform:b=>({data:{factors:b},error:null})});return{data:u,error:p}}catch(u){if(Ft(u))return{data:null,error:u};throw u}}async _deleteFactor(o){try{return{data:await Vt(this.fetch,"DELETE",`${this.url}/admin/users/${o.userId}/factors/${o.id}`,{headers:this.headers}),error:null}}catch(u){if(Ft(u))return{data:null,error:u};throw u}}}const Mf="0.0.0",g0="http://localhost:9999",_0="supabase.auth.token",y0={"X-Client-Info":`gotrue-js/${Mf}`},Wp=10,v0={getItem:_=>Ll()?globalThis.localStorage.getItem(_):null,setItem:(_,o)=>{Ll()&&globalThis.localStorage.setItem(_,o)},removeItem:_=>{Ll()&&globalThis.localStorage.removeItem(_)}};function Kp(_={}){return{getItem:o=>_[o]||null,setItem:(o,u)=>{_[o]=u},removeItem:o=>{delete _[o]}}}function x0(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const mo={debug:!!(globalThis&&Ll()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class zf extends Error{constructor(o){super(o),this.isAcquireTimeout=!0}}class b0 extends zf{}async function w0(_,o,u){mo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",_,o);const p=new globalThis.AbortController;return o>0&&setTimeout(()=>{p.abort(),mo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",_)},o),await globalThis.navigator.locks.request(_,o===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:p.signal},async b=>{if(b){mo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",_,b.name);try{return await u()}finally{mo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",_,b.name)}}else{if(o===0)throw mo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",_),new b0(`Acquiring an exclusive Navigator LockManager lock "${_}" immediately failed`);if(mo.debug)try{const x=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(x,null,"  "))}catch(x){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",x)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await u()}})}x0();const S0={url:g0,storageKey:_0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:y0,flowType:"implicit",debug:!1},Pl=30*1e3,Xp=3;async function Jp(_,o,u){return await u()}class Fl{constructor(o){var u,p;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Fl.nextInstanceID,Fl.nextInstanceID+=1,this.instanceID>0&&bn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const b=Object.assign(Object.assign({},S0),o);if(this.logDebugMessages=!!b.debug,typeof b.debug=="function"&&(this.logger=b.debug),this.persistSession=b.persistSession,this.storageKey=b.storageKey,this.autoRefreshToken=b.autoRefreshToken,this.admin=new m0({url:b.url,headers:b.headers,fetch:b.fetch}),this.url=b.url,this.headers=b.headers,this.fetch=Ef(b.fetch),this.lock=b.lock||Jp,this.detectSessionInUrl=b.detectSessionInUrl,this.flowType=b.flowType,b.lock?this.lock=b.lock:bn()&&(!((u=globalThis==null?void 0:globalThis.navigator)===null||u===void 0)&&u.locks)?this.lock=w0:this.lock=Jp,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?b.storage?this.storage=b.storage:Ll()?this.storage=v0:(this.memoryStorage={},this.storage=Kp(this.memoryStorage)):(this.memoryStorage={},this.storage=Kp(this.memoryStorage)),bn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(x){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",x)}(p=this.broadcastChannel)===null||p===void 0||p.addEventListener("message",async x=>{this._debug("received broadcast notification from other tab or client",x),await this._notifyAllSubscribers(x.data.event,x.data.session,!1)})}this.initialize()}_debug(...o){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Mf}) ${new Date().toISOString()}`,...o),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const o=bn()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",o),o||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:u,error:p}=await this._getSessionFromURL(o);if(p)return this._debug("#_initialize()","error detecting session from URL",p),(p==null?void 0:p.message)==="Identity is already linked"||(p==null?void 0:p.message)==="Identity is already linked to another user"?{error:p}:(await this._removeSession(),{error:p});const{session:b,redirectType:x}=u;return this._debug("#_initialize()","detected session in URL",b,"redirect type",x),await this._saveSession(b),setTimeout(async()=>{x==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",b):await this._notifyAllSubscribers("SIGNED_IN",b)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(o){return Ft(o)?{error:o}:{error:new Pf("Unexpected error during initialization",o)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(o){var u,p,b;try{await this._removeSession();let x;if("email"in o){const{email:N,password:Z,options:K}=o;let Ae=null,Te=null;if(this.flowType==="pkce"){const je=uo();await na(this.storage,`${this.storageKey}-code-verifier`,je),Ae=await po(je),Te=je===Ae?"plain":"s256"}x=await Vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:K==null?void 0:K.emailRedirectTo,body:{email:N,password:Z,data:(u=K==null?void 0:K.data)!==null&&u!==void 0?u:{},gotrue_meta_security:{captcha_token:K==null?void 0:K.captchaToken},code_challenge:Ae,code_challenge_method:Te},xform:sa})}else if("phone"in o){const{phone:N,password:Z,options:K}=o;x=await Vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:N,password:Z,data:(p=K==null?void 0:K.data)!==null&&p!==void 0?p:{},channel:(b=K==null?void 0:K.channel)!==null&&b!==void 0?b:"sms",gotrue_meta_security:{captcha_token:K==null?void 0:K.captchaToken}},xform:sa})}else throw new Kc("You must provide either an email or phone number and a password");const{data:y,error:l}=x;if(l||!y)return{data:{user:null,session:null},error:l};const D=y.session,U=y.user;return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",D)),{data:{user:U,session:D},error:null}}catch(x){if(Ft(x))return{data:{user:null,session:null},error:x};throw x}}async signInWithPassword(o){try{await this._removeSession();let u;if("email"in o){const{email:x,password:y,options:l}=o;u=await Vt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:x,password:y,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Hp})}else if("phone"in o){const{phone:x,password:y,options:l}=o;u=await Vt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:x,password:y,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Hp})}else throw new Kc("You must provide either an email or phone number and a password");const{data:p,error:b}=u;return b?{data:{user:null,session:null},error:b}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new _u}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:Object.assign({user:p.user,session:p.session},p.weak_password?{weakPassword:p.weak_password}:null),error:b})}catch(u){if(Ft(u))return{data:{user:null,session:null},error:u};throw u}}async signInWithOAuth(o){var u,p,b,x;return await this._removeSession(),await this._handleProviderSignIn(o.provider,{redirectTo:(u=o.options)===null||u===void 0?void 0:u.redirectTo,scopes:(p=o.options)===null||p===void 0?void 0:p.scopes,queryParams:(b=o.options)===null||b===void 0?void 0:b.queryParams,skipBrowserRedirect:(x=o.options)===null||x===void 0?void 0:x.skipBrowserRedirect})}async exchangeCodeForSession(o){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(o))}async _exchangeCodeForSession(o){const u=await Wc(this.storage,`${this.storageKey}-code-verifier`),[p,b]=(u??"").split("/"),{data:x,error:y}=await Vt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:o,code_verifier:p},xform:sa});return await gu(this.storage,`${this.storageKey}-code-verifier`),y?{data:{user:null,session:null,redirectType:null},error:y}:!x||!x.session||!x.user?{data:{user:null,session:null,redirectType:null},error:new _u}:(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),{data:Object.assign(Object.assign({},x),{redirectType:b??null}),error:y})}async signInWithIdToken(o){await this._removeSession();try{const{options:u,provider:p,token:b,access_token:x,nonce:y}=o,l=await Vt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:p,id_token:b,access_token:x,nonce:y,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},xform:sa}),{data:D,error:U}=l;return U?{data:{user:null,session:null},error:U}:!D||!D.session||!D.user?{data:{user:null,session:null},error:new _u}:(D.session&&(await this._saveSession(D.session),await this._notifyAllSubscribers("SIGNED_IN",D.session)),{data:D,error:U})}catch(u){if(Ft(u))return{data:{user:null,session:null},error:u};throw u}}async signInWithOtp(o){var u,p,b,x,y;try{if(await this._removeSession(),"email"in o){const{email:l,options:D}=o;let U=null,N=null;if(this.flowType==="pkce"){const K=uo();await na(this.storage,`${this.storageKey}-code-verifier`,K),U=await po(K),N=K===U?"plain":"s256"}const{error:Z}=await Vt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(u=D==null?void 0:D.data)!==null&&u!==void 0?u:{},create_user:(p=D==null?void 0:D.shouldCreateUser)!==null&&p!==void 0?p:!0,gotrue_meta_security:{captcha_token:D==null?void 0:D.captchaToken},code_challenge:U,code_challenge_method:N},redirectTo:D==null?void 0:D.emailRedirectTo});return{data:{user:null,session:null},error:Z}}if("phone"in o){const{phone:l,options:D}=o,{data:U,error:N}=await Vt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(b=D==null?void 0:D.data)!==null&&b!==void 0?b:{},create_user:(x=D==null?void 0:D.shouldCreateUser)!==null&&x!==void 0?x:!0,gotrue_meta_security:{captcha_token:D==null?void 0:D.captchaToken},channel:(y=D==null?void 0:D.channel)!==null&&y!==void 0?y:"sms"}});return{data:{user:null,session:null,messageId:U==null?void 0:U.message_id},error:N}}throw new Kc("You must provide either an email or phone number.")}catch(l){if(Ft(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(o){var u,p;try{o.type!=="email_change"&&o.type!=="phone_change"&&await this._removeSession();let b,x;"options"in o&&(b=(u=o.options)===null||u===void 0?void 0:u.redirectTo,x=(p=o.options)===null||p===void 0?void 0:p.captchaToken);const{data:y,error:l}=await Vt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},o),{gotrue_meta_security:{captcha_token:x}}),redirectTo:b,xform:sa});if(l)throw l;if(!y)throw new Error("An error occurred on token verification.");const D=y.session,U=y.user;return D!=null&&D.access_token&&(await this._saveSession(D),await this._notifyAllSubscribers(o.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",D)),{data:{user:U,session:D},error:null}}catch(b){if(Ft(b))return{data:{user:null,session:null},error:b};throw b}}async signInWithSSO(o){var u,p,b;try{await this._removeSession();let x=null,y=null;if(this.flowType==="pkce"){const l=uo();await na(this.storage,`${this.storageKey}-code-verifier`,l),x=await po(l),y=l===x?"plain":"s256"}return await Vt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in o?{provider_id:o.providerId}:null),"domain"in o?{domain:o.domain}:null),{redirect_to:(p=(u=o.options)===null||u===void 0?void 0:u.redirectTo)!==null&&p!==void 0?p:void 0}),!((b=o==null?void 0:o.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:o.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:x,code_challenge_method:y}),headers:this.headers,xform:h0})}catch(x){if(Ft(x))return{data:null,error:x};throw x}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async o=>{const{data:{session:u},error:p}=o;if(p)throw p;if(!u)throw new fo;const{error:b}=await Vt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:u.access_token});return{data:{user:null,session:null},error:b}})}catch(o){if(Ft(o))return{data:{user:null,session:null},error:o};throw o}}async resend(o){try{o.type!="email_change"&&o.type!="phone_change"&&await this._removeSession();const u=`${this.url}/resend`;if("email"in o){const{email:p,type:b,options:x}=o,{error:y}=await Vt(this.fetch,"POST",u,{headers:this.headers,body:{email:p,type:b,gotrue_meta_security:{captcha_token:x==null?void 0:x.captchaToken}},redirectTo:x==null?void 0:x.emailRedirectTo});return{data:{user:null,session:null},error:y}}else if("phone"in o){const{phone:p,type:b,options:x}=o,{data:y,error:l}=await Vt(this.fetch,"POST",u,{headers:this.headers,body:{phone:p,type:b,gotrue_meta_security:{captcha_token:x==null?void 0:x.captchaToken}}});return{data:{user:null,session:null,messageId:y==null?void 0:y.message_id},error:l}}throw new Kc("You must provide either an email or phone number and a type")}catch(u){if(Ft(u))return{data:{user:null,session:null},error:u};throw u}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async o=>o))}async _acquireLock(o,u){this._debug("#_acquireLock","begin",o);try{if(this.lockAcquired){const p=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),b=(async()=>(await p,await u()))();return this.pendingInLock.push((async()=>{try{await b}catch{}})()),b}return await this.lock(`lock:${this.storageKey}`,o,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const p=u();for(this.pendingInLock.push((async()=>{try{await p}catch{}})()),await p;this.pendingInLock.length;){const b=[...this.pendingInLock];await Promise.all(b),this.pendingInLock.splice(0,b.length)}return await p}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(o){this._debug("#_useSession","begin");try{const u=await this.__loadSession();return await o(u)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let o=null;const u=await Wc(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",u),u!==null&&(this._isValidSession(u)?o=u:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!o)return{data:{session:null},error:null};const p=o.expires_at?o.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${p?"":" not"} expired`,"expires_at",o.expires_at),!p)return{data:{session:o},error:null};const{session:b,error:x}=await this._callRefreshToken(o.refresh_token);return x?{data:{session:null},error:x}:{data:{session:b},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(o){return o?await this._getUser(o):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(o){try{return o?await Vt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:o,xform:Es}):await this._useSession(async u=>{var p,b;const{data:x,error:y}=u;if(y)throw y;return await Vt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(b=(p=x.session)===null||p===void 0?void 0:p.access_token)!==null&&b!==void 0?b:void 0,xform:Es})})}catch(u){if(Ft(u))return{data:{user:null},error:u};throw u}}async updateUser(o,u={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(o,u))}async _updateUser(o,u={}){try{return await this._useSession(async p=>{const{data:b,error:x}=p;if(x)throw x;if(!b.session)throw new fo;const y=b.session;let l=null,D=null;if(this.flowType==="pkce"&&o.email!=null){const Z=uo();await na(this.storage,`${this.storageKey}-code-verifier`,Z),l=await po(Z),D=Z===l?"plain":"s256"}const{data:U,error:N}=await Vt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:u==null?void 0:u.emailRedirectTo,body:Object.assign(Object.assign({},o),{code_challenge:l,code_challenge_method:D}),jwt:y.access_token,xform:Es});if(N)throw N;return y.user=U.user,await this._saveSession(y),await this._notifyAllSubscribers("USER_UPDATED",y),{data:{user:y.user},error:null}})}catch(p){if(Ft(p))return{data:{user:null},error:p};throw p}}_decodeJWT(o){return qp(o)}async setSession(o){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(o))}async _setSession(o){try{if(!o.access_token||!o.refresh_token)throw new fo;const u=Date.now()/1e3;let p=u,b=!0,x=null;const y=qp(o.access_token);if(y.exp&&(p=y.exp,b=p<=u),b){const{session:l,error:D}=await this._callRefreshToken(o.refresh_token);if(D)return{data:{user:null,session:null},error:D};if(!l)return{data:{user:null,session:null},error:null};x=l}else{const{data:l,error:D}=await this._getUser(o.access_token);if(D)throw D;x={access_token:o.access_token,refresh_token:o.refresh_token,user:l.user,token_type:"bearer",expires_in:p-u,expires_at:p},await this._saveSession(x),await this._notifyAllSubscribers("SIGNED_IN",x)}return{data:{user:x.user,session:x},error:null}}catch(u){if(Ft(u))return{data:{session:null,user:null},error:u};throw u}}async refreshSession(o){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(o))}async _refreshSession(o){try{return await this._useSession(async u=>{var p;if(!o){const{data:y,error:l}=u;if(l)throw l;o=(p=y.session)!==null&&p!==void 0?p:void 0}if(!(o!=null&&o.refresh_token))throw new fo;const{session:b,error:x}=await this._callRefreshToken(o.refresh_token);return x?{data:{user:null,session:null},error:x}:b?{data:{user:b.user,session:b},error:null}:{data:{user:null,session:null},error:null}})}catch(u){if(Ft(u))return{data:{user:null,session:null},error:u};throw u}}async _getSessionFromURL(o){try{if(!bn())throw new Xc("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Xc("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!o)throw new Zp("Not a valid PKCE flow url.");const u=mu(window.location.href);if(o){if(!u.code)throw new Zp("No code detected.");const{data:at,error:Ye}=await this._exchangeCodeForSession(u.code);if(Ye)throw Ye;const Ie=new URL(window.location.href);return Ie.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Ie.toString()),{data:{session:at.session,redirectType:null},error:null}}if(u.error||u.error_description||u.error_code)throw new Xc(u.error_description||"Error in URL with unspecified error_description",{error:u.error||"unspecified_error",code:u.error_code||"unspecified_code"});const{provider_token:p,provider_refresh_token:b,access_token:x,refresh_token:y,expires_in:l,expires_at:D,token_type:U}=u;if(!x||!l||!y||!U)throw new Xc("No session defined in URL");const N=Math.round(Date.now()/1e3),Z=parseInt(l);let K=N+Z;D&&(K=parseInt(D));const Ae=K-N;Ae*1e3<=Pl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${Ae}s, should have been closer to ${Z}s`);const Te=K-Z;N-Te>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Te,K,N):N-Te<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",Te,K,N);const{data:je,error:Ue}=await this._getUser(x);if(Ue)throw Ue;const He={provider_token:p,provider_refresh_token:b,access_token:x,expires_in:Z,expires_at:K,refresh_token:y,token_type:U,user:je.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:He,redirectType:u.type},error:null}}catch(u){if(Ft(u))return{data:{session:null,redirectType:null},error:u};throw u}}_isImplicitGrantFlow(){const o=mu(window.location.href);return!!(bn()&&(o.access_token||o.error_description))}async _isPKCEFlow(){const o=mu(window.location.href),u=await Wc(this.storage,`${this.storageKey}-code-verifier`);return!!(o.code&&u)}async signOut(o={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(o))}async _signOut({scope:o}={scope:"global"}){return await this._useSession(async u=>{var p;const{data:b,error:x}=u;if(x)return{error:x};const y=(p=b.session)===null||p===void 0?void 0:p.access_token;if(y){const{error:l}=await this.admin.signOut(y,o);if(l&&!(n0(l)&&(l.status===404||l.status===401)))return{error:l}}return o!=="others"&&(await this._removeSession(),await gu(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(o){const u=Xy(),p={id:u,callback:o,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",u),this.stateChangeEmitters.delete(u)}};return this._debug("#onAuthStateChange()","registered callback with id",u),this.stateChangeEmitters.set(u,p),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(u)})))(),{data:{subscription:p}}}async _emitInitialSession(o){return await this._useSession(async u=>{var p,b;try{const{data:{session:x},error:y}=u;if(y)throw y;await((p=this.stateChangeEmitters.get(o))===null||p===void 0?void 0:p.callback("INITIAL_SESSION",x)),this._debug("INITIAL_SESSION","callback id",o,"session",x)}catch(x){await((b=this.stateChangeEmitters.get(o))===null||b===void 0?void 0:b.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",o,"error",x),console.error(x)}})}async resetPasswordForEmail(o,u={}){let p=null,b=null;if(this.flowType==="pkce"){const x=uo();await na(this.storage,`${this.storageKey}-code-verifier`,`${x}/PASSWORD_RECOVERY`),p=await po(x),b=x===p?"plain":"s256"}try{return await Vt(this.fetch,"POST",`${this.url}/recover`,{body:{email:o,code_challenge:p,code_challenge_method:b,gotrue_meta_security:{captcha_token:u.captchaToken}},headers:this.headers,redirectTo:u.redirectTo})}catch(x){if(Ft(x))return{data:null,error:x};throw x}}async getUserIdentities(){var o;try{const{data:u,error:p}=await this.getUser();if(p)throw p;return{data:{identities:(o=u.user.identities)!==null&&o!==void 0?o:[]},error:null}}catch(u){if(Ft(u))return{data:null,error:u};throw u}}async linkIdentity(o){var u;try{const{data:p,error:b}=await this._useSession(async x=>{var y,l,D,U,N;const{data:Z,error:K}=x;if(K)throw K;const Ae=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,o.provider,{redirectTo:(y=o.options)===null||y===void 0?void 0:y.redirectTo,scopes:(l=o.options)===null||l===void 0?void 0:l.scopes,queryParams:(D=o.options)===null||D===void 0?void 0:D.queryParams,skipBrowserRedirect:!0});return await Vt(this.fetch,"GET",Ae,{headers:this.headers,jwt:(N=(U=Z.session)===null||U===void 0?void 0:U.access_token)!==null&&N!==void 0?N:void 0})});if(b)throw b;return bn()&&!(!((u=o.options)===null||u===void 0)&&u.skipBrowserRedirect)&&window.location.assign(p==null?void 0:p.url),{data:{provider:o.provider,url:p==null?void 0:p.url},error:null}}catch(p){if(Ft(p))return{data:{provider:o.provider,url:null},error:p};throw p}}async unlinkIdentity(o){try{return await this._useSession(async u=>{var p,b;const{data:x,error:y}=u;if(y)throw y;return await Vt(this.fetch,"DELETE",`${this.url}/user/identities/${o.identity_id}`,{headers:this.headers,jwt:(b=(p=x.session)===null||p===void 0?void 0:p.access_token)!==null&&b!==void 0?b:void 0})})}catch(u){if(Ft(u))return{data:null,error:u};throw u}}async _refreshAccessToken(o){const u=`#_refreshAccessToken(${o.substring(0,5)}...)`;this._debug(u,"begin");try{const p=Date.now();return await $y(async b=>(await Qy(b*200),this._debug(u,"refreshing attempt",b),await Vt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:o},headers:this.headers,xform:sa})),(b,x,y)=>y&&y.error&&yu(y.error)&&Date.now()+(b+1)*200-p<Pl)}catch(p){if(this._debug(u,"error",p),Ft(p))return{data:{session:null,user:null},error:p};throw p}finally{this._debug(u,"end")}}_isValidSession(o){return typeof o=="object"&&o!==null&&"access_token"in o&&"refresh_token"in o&&"expires_at"in o}async _handleProviderSignIn(o,u){const p=await this._getUrlForProvider(`${this.url}/authorize`,o,{redirectTo:u.redirectTo,scopes:u.scopes,queryParams:u.queryParams});return this._debug("#_handleProviderSignIn()","provider",o,"options",u,"url",p),bn()&&!u.skipBrowserRedirect&&window.location.assign(p),{data:{provider:o,url:p},error:null}}async _recoverAndRefresh(){var o;const u="#_recoverAndRefresh()";this._debug(u,"begin");try{const p=await Wc(this.storage,this.storageKey);if(this._debug(u,"session from storage",p),!this._isValidSession(p)){this._debug(u,"session is not valid"),p!==null&&await this._removeSession();return}const b=Math.round(Date.now()/1e3),x=((o=p.expires_at)!==null&&o!==void 0?o:1/0)<b+Wp;if(this._debug(u,`session has${x?"":" not"} expired with margin of ${Wp}s`),x){if(this.autoRefreshToken&&p.refresh_token){const{error:y}=await this._callRefreshToken(p.refresh_token);y&&(console.error(y),yu(y)||(this._debug(u,"refresh failed with a non-retryable error, removing the session",y),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",p)}catch(p){this._debug(u,"error",p),console.error(p);return}finally{this._debug(u,"end")}}async _callRefreshToken(o){var u,p;if(!o)throw new fo;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const b=`#_callRefreshToken(${o.substring(0,5)}...)`;this._debug(b,"begin");try{this.refreshingDeferred=new nh;const{data:x,error:y}=await this._refreshAccessToken(o);if(y)throw y;if(!x.session)throw new fo;await this._saveSession(x.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",x.session);const l={session:x.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(x){if(this._debug(b,"error",x),Ft(x)){const y={session:null,error:x};return yu(x)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(u=this.refreshingDeferred)===null||u===void 0||u.resolve(y),y}throw(p=this.refreshingDeferred)===null||p===void 0||p.reject(x),x}finally{this.refreshingDeferred=null,this._debug(b,"end")}}async _notifyAllSubscribers(o,u,p=!0){const b=`#_notifyAllSubscribers(${o})`;this._debug(b,"begin",u,`broadcast = ${p}`);try{this.broadcastChannel&&p&&this.broadcastChannel.postMessage({event:o,session:u});const x=[],y=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(o,u)}catch(D){x.push(D)}});if(await Promise.all(y),x.length>0){for(let l=0;l<x.length;l+=1)console.error(x[l]);throw x[0]}}finally{this._debug(b,"end")}}async _saveSession(o){this._debug("#_saveSession()",o),await na(this.storage,this.storageKey,o)}async _removeSession(){this._debug("#_removeSession()"),await gu(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const o=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{o&&bn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",o)}catch(u){console.error("removing visibilitychange callback failed",u)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const o=setInterval(()=>this._autoRefreshTokenTick(),Pl);this.autoRefreshTicker=o,o&&typeof o=="object"&&typeof o.unref=="function"?o.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(o),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const o=this.autoRefreshTicker;this.autoRefreshTicker=null,o&&clearInterval(o)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const o=Date.now();try{return await this._useSession(async u=>{const{data:{session:p}}=u;if(!p||!p.refresh_token||!p.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const b=Math.floor((p.expires_at*1e3-o)/Pl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${b} ticks, a tick lasts ${Pl}ms, refresh threshold is ${Xp} ticks`),b<=Xp&&await this._callRefreshToken(p.refresh_token)})}catch(u){console.error("Auto refresh tick failed with error. This is likely a transient error.",u)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(o){if(o.isAcquireTimeout||o instanceof zf)this._debug("auto refresh token tick lock not available");else throw o}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!bn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(o){console.error("_handleVisibilityChange",o)}}async _onVisibilityChanged(o){const u=`#_onVisibilityChanged(${o})`;this._debug(u,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),o||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(u,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(o,u,p){const b=[`provider=${encodeURIComponent(u)}`];if(p!=null&&p.redirectTo&&b.push(`redirect_to=${encodeURIComponent(p.redirectTo)}`),p!=null&&p.scopes&&b.push(`scopes=${encodeURIComponent(p.scopes)}`),this.flowType==="pkce"){const x=uo();await na(this.storage,`${this.storageKey}-code-verifier`,x);const y=await po(x),l=x===y?"plain":"s256";this._debug("PKCE","code verifier",`${x.substring(0,5)}...`,"code challenge",y,"method",l);const D=new URLSearchParams({code_challenge:`${encodeURIComponent(y)}`,code_challenge_method:`${encodeURIComponent(l)}`});b.push(D.toString())}if(p!=null&&p.queryParams){const x=new URLSearchParams(p.queryParams);b.push(x.toString())}return p!=null&&p.skipBrowserRedirect&&b.push(`skip_http_redirect=${p.skipBrowserRedirect}`),`${o}?${b.join("&")}`}async _unenroll(o){try{return await this._useSession(async u=>{var p;const{data:b,error:x}=u;return x?{data:null,error:x}:await Vt(this.fetch,"DELETE",`${this.url}/factors/${o.factorId}`,{headers:this.headers,jwt:(p=b==null?void 0:b.session)===null||p===void 0?void 0:p.access_token})})}catch(u){if(Ft(u))return{data:null,error:u};throw u}}async _enroll(o){try{return await this._useSession(async u=>{var p,b;const{data:x,error:y}=u;if(y)return{data:null,error:y};const{data:l,error:D}=await Vt(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:o.friendlyName,factor_type:o.factorType,issuer:o.issuer},headers:this.headers,jwt:(p=x==null?void 0:x.session)===null||p===void 0?void 0:p.access_token});return D?{data:null,error:D}:(!((b=l==null?void 0:l.totp)===null||b===void 0)&&b.qr_code&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(u){if(Ft(u))return{data:null,error:u};throw u}}async _verify(o){return this._acquireLock(-1,async()=>{try{return await this._useSession(async u=>{var p;const{data:b,error:x}=u;if(x)return{data:null,error:x};const{data:y,error:l}=await Vt(this.fetch,"POST",`${this.url}/factors/${o.factorId}/verify`,{body:{code:o.code,challenge_id:o.challengeId},headers:this.headers,jwt:(p=b==null?void 0:b.session)===null||p===void 0?void 0:p.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+y.expires_in},y)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",y),{data:y,error:l})})}catch(u){if(Ft(u))return{data:null,error:u};throw u}})}async _challenge(o){return this._acquireLock(-1,async()=>{try{return await this._useSession(async u=>{var p;const{data:b,error:x}=u;return x?{data:null,error:x}:await Vt(this.fetch,"POST",`${this.url}/factors/${o.factorId}/challenge`,{headers:this.headers,jwt:(p=b==null?void 0:b.session)===null||p===void 0?void 0:p.access_token})})}catch(u){if(Ft(u))return{data:null,error:u};throw u}})}async _challengeAndVerify(o){const{data:u,error:p}=await this._challenge({factorId:o.factorId});return p?{data:null,error:p}:await this._verify({factorId:o.factorId,challengeId:u.id,code:o.code})}async _listFactors(){const{data:{user:o},error:u}=await this.getUser();if(u)return{data:null,error:u};const p=(o==null?void 0:o.factors)||[],b=p.filter(x=>x.factor_type==="totp"&&x.status==="verified");return{data:{all:p,totp:b},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async o=>{var u,p;const{data:{session:b},error:x}=o;if(x)return{data:null,error:x};if(!b)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const y=this._decodeJWT(b.access_token);let l=null;y.aal&&(l=y.aal);let D=l;((p=(u=b.user.factors)===null||u===void 0?void 0:u.filter(Z=>Z.status==="verified"))!==null&&p!==void 0?p:[]).length>0&&(D="aal2");const N=y.amr||[];return{data:{currentLevel:l,nextLevel:D,currentAuthenticationMethods:N},error:null}}))}}Fl.nextInstanceID=0;class T0 extends Fl{constructor(o){super(o)}}var k0=function(_,o,u,p){function b(x){return x instanceof u?x:new u(function(y){y(x)})}return new(u||(u=Promise))(function(x,y){function l(N){try{U(p.next(N))}catch(Z){y(Z)}}function D(N){try{U(p.throw(N))}catch(Z){y(Z)}}function U(N){N.done?x(N.value):b(N.value).then(l,D)}U((p=p.apply(_,o||[])).next())})};class I0{constructor(o,u,p){var b,x,y,l,D,U,N,Z;if(this.supabaseUrl=o,this.supabaseKey=u,!o)throw new Error("supabaseUrl is required.");if(!u)throw new Error("supabaseKey is required.");const K=Hy(o);this.realtimeUrl=`${K}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${K}/auth/v1`,this.storageUrl=`${K}/storage/v1`,this.functionsUrl=`${K}/functions/v1`;const Ae=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,Te={db:jy,realtime:Vy,auth:Object.assign(Object.assign({},Uy),{storageKey:Ae}),global:By},je=Wy(p??{},Te);this.storageKey=(x=(b=je.auth)===null||b===void 0?void 0:b.storageKey)!==null&&x!==void 0?x:"",this.headers=(l=(y=je.global)===null||y===void 0?void 0:y.headers)!==null&&l!==void 0?l:{},this.auth=this._initSupabaseAuthClient((D=je.auth)!==null&&D!==void 0?D:{},this.headers,(U=je.global)===null||U===void 0?void 0:U.fetch),this.fetch=Gy(u,this._getAccessToken.bind(this),(N=je.global)===null||N===void 0?void 0:N.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},je.realtime)),this.rest=new Bu(`${K}/rest/v1`,{headers:this.headers,schema:(Z=je.db)===null||Z===void 0?void 0:Z.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Q_(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ry(this.storageUrl,this.headers,this.fetch)}from(o){return this.rest.from(o)}schema(o){return this.rest.schema(o)}rpc(o,u={},p={}){return this.rest.rpc(o,u,p)}channel(o,u={config:{}}){return this.realtime.channel(o,u)}getChannels(){return this.realtime.getChannels()}removeChannel(o){return this.realtime.removeChannel(o)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var o,u;return k0(this,void 0,void 0,function*(){const{data:p}=yield this.auth.getSession();return(u=(o=p.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:null})}_initSupabaseAuthClient({autoRefreshToken:o,persistSession:u,detectSessionInUrl:p,storage:b,storageKey:x,flowType:y,debug:l},D,U){const N={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new T0({url:this.authUrl,headers:Object.assign(Object.assign({},N),D),storageKey:x,autoRefreshToken:o,persistSession:u,detectSessionInUrl:p,storage:b,flowType:y,debug:l,fetch:U})}_initRealtimeClient(o){return new wy(this.realtimeUrl,Object.assign(Object.assign({},o),{params:Object.assign({apikey:this.supabaseKey},o==null?void 0:o.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((u,p)=>{this._handleTokenChanged(u,"CLIENT",p==null?void 0:p.access_token)})}_handleTokenChanged(o,u,p){(o==="TOKEN_REFRESHED"||o==="SIGNED_IN")&&this.changedAccessToken!==p?(this.realtime.setAuth(p??null),this.changedAccessToken=p):o==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),u=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const C0=(_,o,u)=>new I0(_,o,u);function Yp(_){var u,p;const o=(p=(u=_[19])==null?void 0:u[0])==null?void 0:p.properties;_[20]=o}function Qp(_){var u,p;const o=(p=(u=_[19])==null?void 0:u[0])==null?void 0:p.properties;_[20]=o}function $p(_){var u,p;const o=(p=(u=_[19])==null?void 0:u[0])==null?void 0:p.properties;_[20]=o}function ef(_,o,u){const p=_.slice();return p[22]=o[u],p}function A0(_){let o;return{c(){o=Tt("h3"),o.textContent="Error fetching data"},m(u,p){Lt(u,o,p)},p:Bt,d(u){u&&Pt(o)}}}function E0(_){let o,u,p,b,x,y,l;return{c(){o=Tt("div"),u=Tt("div"),p=Tt("div"),p.textContent="Вкупно кладилници",b=di(),x=Tt("div"),x.textContent=`${_[25]}`,y=di(),l=Tt("div"),l.textContent="Вкупно заведени кладилници",$t(p,"class","stat-title"),$t(x,"class","stat-value"),$t(l,"class","stat-desc"),$t(u,"class","stat"),$t(o,"class","stats shadow svelte-igl2sg")},m(D,U){Lt(D,o,U),_t(o,u),_t(u,p),_t(u,b),_t(u,x),_t(u,y),_t(u,l)},p:Bt,d(D){D&&Pt(o)}}}function P0(_){return{c:Bt,m:Bt,p:Bt,d:Bt}}function M0(_){let o;return{c(){o=Tt("h3"),o.textContent="Error fetching data"},m(u,p){Lt(u,o,p)},p:Bt,d(u){u&&Pt(o)}}}function z0(_){let o,u,p,b,x,y,l;return{c(){o=Tt("div"),u=Tt("div"),p=Tt("div"),p.textContent="Вкупно училишта",b=di(),x=Tt("div"),x.textContent=`${_[25]}`,y=di(),l=Tt("div"),l.textContent="Вкупно мапирани училишта",$t(p,"class","stat-title"),$t(x,"class","stat-value"),$t(l,"class","stat-desc"),$t(u,"class","stat"),$t(o,"class","stats shadow svelte-igl2sg")},m(D,U){Lt(D,o,U),_t(o,u),_t(u,p),_t(u,b),_t(u,x),_t(u,y),_t(u,l)},p:Bt,d(D){D&&Pt(o)}}}function L0(_){return{c:Bt,m:Bt,p:Bt,d:Bt}}function tf(_){let o,u,p={ctx:_,current:null,token:null,hasCatch:!0,pending:Q0,then:R0,catch:D0,value:17,error:21,blocks:[,,,]};return Yc(_[6](),p),{c(){o=ss(),p.block.c()},m(b,x){Lt(b,o,x),p.block.m(b,p.anchor=x),p.mount=()=>o.parentNode,p.anchor=o,u=!0},p(b,x){_=b,Qc(p,_,x)},i(b){u||(Ge(p.block),u=!0)},o(b){for(let x=0;x<3;x+=1){const y=p.blocks[x];nt(y)}u=!1},d(b){b&&Pt(o),p.block.d(b),p.token=null,p=null}}}function D0(_){let o;return{c(){o=Tt("p"),o.textContent=`${_[21].message}`},m(u,p){Lt(u,o,p)},p:Bt,i:Bt,o:Bt,d(u){u&&Pt(o)}}}function R0(_){let o,u;return o=new L_({props:{center:[21.7289728,41.7146641],zoom:7,class:"map",standardControls:!0,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",$$slots:{default:[Y0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&67108926&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function O0(_){let o;return{c(){o=Tt("div"),o.textContent=`${JSON.stringify(_[22])}`,$t(o,"class","text-lg font-bold"),$c(o,"color","black")},m(u,p){Lt(u,o,p)},p:Bt,d(u){u&&Pt(o)}}}function F0(_){let o,u;return o=new th({props:{offset:[0,-10],$$slots:{default:[O0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&67108864&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function rf(_){let o,u;return o=new o_({props:{lngLat:_[22].geometry.coordinates,$$slots:{default:[F0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&67108864&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function B0(_){let o,u,p={ctx:_,current:null,token:null,hasCatch:!0,pending:J0,then:U0,catch:j0,value:18,error:21,blocks:[,,,]};return Yc(_[7](),p),{c(){o=ss(),p.block.c()},m(b,x){Lt(b,o,x),p.block.m(b,p.anchor=x),p.mount=()=>o.parentNode,p.anchor=o,u=!0},p(b,x){_=b,Qc(p,_,x)},i(b){u||(Ge(p.block),u=!0)},o(b){for(let x=0;x<3;x+=1){const y=p.blocks[x];nt(y)}u=!1},d(b){b&&Pt(o),p.block.d(b),p.token=null,p=null}}}function j0(_){let o;return{c(){o=Tt("p"),o.textContent=`${_[21].message}`},m(u,p){Lt(u,o,p)},p:Bt,i:Bt,o:Bt,d(u){u&&Pt(o)}}}function U0(_){let o,u,p,b,x=(_[2]||_[1])&&nf(_),y=_[3]&&of(_);return p=new Lu({props:{id:"info",data:ev(_[17],_[18]),$$slots:{default:[X0]},$$scope:{ctx:_}}}),{c(){x&&x.c(),o=di(),y&&y.c(),u=di(),Wi(p.$$.fragment)},m(l,D){x&&x.m(l,D),Lt(l,o,D),y&&y.m(l,D),Lt(l,u,D),zi(p,l,D),b=!0},p(l,D){l[2]||l[1]?x?(x.p(l,D),D&6&&Ge(x,1)):(x=nf(l),x.c(),Ge(x,1),x.m(o.parentNode,o)):x&&(Br(),nt(x,1,1,()=>{x=null}),jr()),l[3]?y?(y.p(l,D),D&8&&Ge(y,1)):(y=of(l),y.c(),Ge(y,1),y.m(u.parentNode,u)):y&&(Br(),nt(y,1,1,()=>{y=null}),jr());const U={};D&67108864&&(U.$$scope={dirty:D,ctx:l}),p.$set(U)},i(l){b||(Ge(x),Ge(y),Ge(p.$$.fragment,l),b=!0)},o(l){nt(x),nt(y),nt(p.$$.fragment,l),b=!1},d(l){l&&(Pt(o),Pt(u)),x&&x.d(l),y&&y.d(l),Li(p,l)}}}function nf(_){let o,u;return o=new Lu({props:{id:"circles",data:_[4],$$slots:{default:[G0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&16&&(x.data=p[4]),b&67108886&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function sf(_){let o,u,p,b;return o=new zu({props:{paint:{"fill-color":Mu("#32DE8A","#32DE8A"),"fill-opacity":.5},beforeLayerType:"symbol",manageHoverState:!0,filter:["==","type","betting_place"],$$slots:{default:[N0]},$$scope:{ctx:_}}}),p=new Du({props:{layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#32DE8A","line-width":3},beforeLayerType:"symbol",filter:["==","type","betting_place"]}}),{c(){Wi(o.$$.fragment),u=di(),Wi(p.$$.fragment)},m(x,y){zi(o,x,y),Lt(x,u,y),zi(p,x,y),b=!0},p(x,y){const l={};y&67108864&&(l.$$scope={dirty:y,ctx:x}),o.$set(l)},i(x){b||(Ge(o.$$.fragment,x),Ge(p.$$.fragment,x),b=!0)},o(x){nt(o.$$.fragment,x),nt(p.$$.fragment,x),b=!1},d(x){x&&Pt(u),Li(o,x),Li(p,x)}}}function V0(_){$p(_);let o,u,p=JSON.stringify(_[20])+"",b;return{c(){o=Tt("p"),u=Tt("b"),b=Dn(p),$c(o,"color","black")},m(x,y){Lt(x,o,y),_t(o,u),_t(u,b)},p(x,y){$p(x),y&524288&&p!==(p=JSON.stringify(x[20])+"")&&To(b,p)},d(x){x&&Pt(o)}}}function N0(_){let o,u;return o=new th({props:{openOn:"click",closeOnClickInside:!0,$$slots:{default:[V0,({features:p})=>({19:p}),({features:p})=>p?524288:0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&67633152&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function af(_){let o,u=JSON.stringify(_[4])+"",p,b,x,y,l,D;return x=new zu({props:{paint:{"fill-color":Mu("#3F88C5","#44BBA4"),"fill-opacity":.5},beforeLayerType:"symbol",manageHoverState:!0,filter:["==","type","school"],$$slots:{default:[Z0]},$$scope:{ctx:_}}}),l=new Du({props:{layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3F88C5","line-width":3},beforeLayerType:"symbol",filter:["==","type","school"]}}),{c(){o=Tt("h3"),p=Dn(u),b=di(),Wi(x.$$.fragment),y=di(),Wi(l.$$.fragment)},m(U,N){Lt(U,o,N),_t(o,p),Lt(U,b,N),zi(x,U,N),Lt(U,y,N),zi(l,U,N),D=!0},p(U,N){(!D||N&16)&&u!==(u=JSON.stringify(U[4])+"")&&To(p,u);const Z={};N&67108864&&(Z.$$scope={dirty:N,ctx:U}),x.$set(Z)},i(U){D||(Ge(x.$$.fragment,U),Ge(l.$$.fragment,U),D=!0)},o(U){nt(x.$$.fragment,U),nt(l.$$.fragment,U),D=!1},d(U){U&&(Pt(o),Pt(b),Pt(y)),Li(x,U),Li(l,U)}}}function q0(_){Qp(_);let o,u,p=JSON.stringify(_[20])+"",b;return{c(){o=Tt("p"),u=Tt("b"),b=Dn(p),$c(o,"color","black")},m(x,y){Lt(x,o,y),_t(o,u),_t(u,b)},p(x,y){Qp(x),y&524288&&p!==(p=JSON.stringify(x[20])+"")&&To(b,p)},d(x){x&&Pt(o)}}}function Z0(_){let o,u;return o=new th({props:{openOn:"click",closeOnClickInside:!0,$$slots:{default:[q0,({features:p})=>({19:p}),({features:p})=>p?524288:0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&67633152&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function G0(_){let o,u,p,b=_[2]&&sf(_),x=_[1]&&af(_);return{c(){b&&b.c(),o=di(),x&&x.c(),u=ss()},m(y,l){b&&b.m(y,l),Lt(y,o,l),x&&x.m(y,l),Lt(y,u,l),p=!0},p(y,l){y[2]?b?(b.p(y,l),l&4&&Ge(b,1)):(b=sf(y),b.c(),Ge(b,1),b.m(o.parentNode,o)):b&&(Br(),nt(b,1,1,()=>{b=null}),jr()),y[1]?x?(x.p(y,l),l&2&&Ge(x,1)):(x=af(y),x.c(),Ge(x,1),x.m(u.parentNode,u)):x&&(Br(),nt(x,1,1,()=>{x=null}),jr())},i(y){p||(Ge(b),Ge(x),p=!0)},o(y){nt(b),nt(x),p=!1},d(y){y&&(Pt(o),Pt(u)),b&&b.d(y),x&&x.d(y)}}}function of(_){let o,u=JSON.stringify(_[5])+"",p,b,x,y;return x=new Lu({props:{data:_[5],id:"lines-distance",$$slots:{default:[K0]},$$scope:{ctx:_}}}),{c(){o=Tt("h3"),p=Dn(u),b=di(),Wi(x.$$.fragment)},m(l,D){Lt(l,o,D),_t(o,p),Lt(l,b,D),zi(x,l,D),y=!0},p(l,D){(!y||D&32)&&u!==(u=JSON.stringify(l[5])+"")&&To(p,u);const U={};D&32&&(U.data=l[5]),D&67108864&&(U.$$scope={dirty:D,ctx:l}),x.$set(U)},i(l){y||(Ge(x.$$.fragment,l),y=!0)},o(l){nt(x.$$.fragment,l),y=!1},d(l){l&&(Pt(o),Pt(b)),Li(x,l)}}}function H0(_){Yp(_);let o,u,p=JSON.stringify(_[20])+"",b;return{c(){o=Tt("p"),u=Tt("b"),b=Dn(p),$c(o,"color","black")},m(x,y){Lt(x,o,y),_t(o,u),_t(u,b)},p(x,y){Yp(x),y&524288&&p!==(p=JSON.stringify(x[20])+"")&&To(b,p)},d(x){x&&Pt(o)}}}function W0(_){let o,u;return o=new th({props:{openOn:"click",closeOnClickInside:!0,$$slots:{default:[H0,({features:p})=>({19:p}),({features:p})=>p?524288:0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&67633152&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function K0(_){let o,u;return o=new Du({props:{layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3F88C5","line-width":3},beforeLayerType:"symbol",$$slots:{default:[W0]},$$scope:{ctx:_}}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p(p,b){const x={};b&67108864&&(x.$$scope={dirty:b,ctx:p}),o.$set(x)},i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function X0(_){let o,u;return o=new zu({props:{paint:{"fill-color":Mu("#C7FFED","#C7FFED"),"fill-opacity":.5},beforeLayerType:"symbol",manageHoverState:!0}}),{c(){Wi(o.$$.fragment)},m(p,b){zi(o,p,b),u=!0},p:Bt,i(p){u||(Ge(o.$$.fragment,p),u=!0)},o(p){nt(o.$$.fragment,p),u=!1},d(p){Li(o,p)}}}function J0(_){let o;return{c(){o=Tt("p"),o.textContent="Downloading..."},m(u,p){Lt(u,o,p)},p:Bt,i:Bt,o:Bt,d(u){u&&Pt(o)}}}function Y0(_){let o,u,p,b=bp(_[17].places.features),x=[];for(let D=0;D<b.length;D+=1)x[D]=rf(ef(_,b,D));const y=D=>nt(x[D],1,1,()=>{x[D]=null});let l=B0(_);return{c(){for(let D=0;D<x.length;D+=1)x[D].c();o=di(),l&&l.c(),u=ss()},m(D,U){for(let N=0;N<x.length;N+=1)x[N]&&x[N].m(D,U);Lt(D,o,U),l&&l.m(D,U),Lt(D,u,U),p=!0},p(D,U){if(U&64){b=bp(D[17].places.features);let N;for(N=0;N<b.length;N+=1){const Z=ef(D,b,N);x[N]?(x[N].p(Z,U),Ge(x[N],1)):(x[N]=rf(Z),x[N].c(),Ge(x[N],1),x[N].m(o.parentNode,o))}for(Br(),N=b.length;N<x.length;N+=1)y(N);jr()}l.p(D,U)},i(D){if(!p){for(let U=0;U<b.length;U+=1)Ge(x[U]);Ge(l),p=!0}},o(D){x=x.filter(Boolean);for(let U=0;U<x.length;U+=1)nt(x[U]);nt(l),p=!1},d(D){D&&(Pt(o),Pt(u)),zg(x,D),l&&l.d(D)}}}function Q0(_){let o;return{c(){o=Tt("p"),o.textContent="waiting"},m(u,p){Lt(u,o,p)},p:Bt,i:Bt,o:Bt,d(u){u&&Pt(o)}}}function $0(_){let o,u,p,b,x,y,l,D,U,N,Z,K,Ae,Te,je,Ue,He,at,Ye,Ie,vt,Dt,yt,Je,dt,si,_e,kt,Mt,Wt,ai,it={ctx:_,current:null,token:null,hasCatch:!0,pending:P0,then:E0,catch:A0,value:25};Yc(_[8](),it);let It={ctx:_,current:null,token:null,hasCatch:!0,pending:L0,then:z0,catch:M0,value:25};Yc(_[9](),It);let ct=_[0]&&tf(_);return{c(){o=Tt("main"),u=Tt("h1"),u.textContent="Кладиници и Училишта",p=di(),it.block.c(),b=di(),It.block.c(),x=di(),y=Tt("div"),l=Tt("h3"),D=Dn("Радиус: "),U=Dn(_[0]),N=Dn(" метри"),Z=di(),K=Tt("input"),Ae=di(),Te=Tt("label"),je=Tt("span"),je.textContent="Кругчиња училишта?",Ue=di(),He=Tt("input"),at=di(),Ye=Tt("label"),Ie=Tt("span"),Ie.textContent="Кругчиња кладилници?",vt=di(),Dt=Tt("input"),yt=di(),Je=Tt("label"),dt=Tt("span"),dt.textContent="Покажи растојанија помеѓу местата?",si=di(),_e=Tt("input"),kt=di(),ct&&ct.c(),$t(K,"type","range"),$t(K,"min","0"),$t(K,"max","2000"),$t(K,"class","range range-primary"),$t(je,"class","label-text"),$t(He,"type","checkbox"),$t(He,"class","checkbox checkbox-primary"),$t(Te,"class","label cursor-pointer"),$t(Ie,"class","label-text"),$t(Dt,"type","checkbox"),$t(Dt,"class","checkbox checkbox-primary"),$t(Ye,"class","label cursor-pointer"),$t(dt,"class","label-text"),$t(_e,"type","checkbox"),$t(_e,"class","checkbox checkbox-primary"),$t(Je,"class","label cursor-pointer"),$t(y,"class","form-control")},m(mi,Zt){Lt(mi,o,Zt),_t(o,u),_t(o,p),it.block.m(o,it.anchor=null),it.mount=()=>o,it.anchor=b,_t(o,b),It.block.m(o,It.anchor=null),It.mount=()=>o,It.anchor=x,_t(o,x),_t(o,y),_t(y,l),_t(l,D),_t(l,U),_t(l,N),_t(y,Z),_t(y,K),vp(K,_[0]),_t(y,Ae),_t(y,Te),_t(Te,je),_t(Te,Ue),_t(Te,He),He.checked=_[1],_t(y,at),_t(y,Ye),_t(Ye,Ie),_t(Ye,vt),_t(Ye,Dt),Dt.checked=_[2],_t(y,yt),_t(y,Je),_t(Je,dt),_t(Je,si),_t(Je,_e),_e.checked=_[3],_t(o,kt),ct&&ct.m(o,null),Mt=!0,Wt||(ai=[El(K,"change",_[10]),El(K,"input",_[10]),El(He,"change",_[11]),El(Dt,"change",_[12]),El(_e,"change",_[13])],Wt=!0)},p(mi,[Zt]){_=mi,Qc(it,_,Zt),Qc(It,_,Zt),(!Mt||Zt&1)&&To(U,_[0]),Zt&1&&vp(K,_[0]),Zt&2&&(He.checked=_[1]),Zt&4&&(Dt.checked=_[2]),Zt&8&&(_e.checked=_[3]),_[0]?ct?(ct.p(_,Zt),Zt&1&&Ge(ct,1)):(ct=tf(_),ct.c(),Ge(ct,1),ct.m(o,null)):ct&&(Br(),nt(ct,1,1,()=>{ct=null}),jr())},i(mi){Mt||(Ge(ct),Mt=!0)},o(mi){nt(ct),Mt=!1},d(mi){mi&&Pt(o),it.block.d(),it.token=null,it=null,It.block.d(),It.token=null,It=null,ct&&ct.d(),Wt=!1,So(ai)}}}function ev(_,o){return _.places.features=_.places.features.concat(o.places.features),_.places}function tv(_,o,u){let p=500,b=!1,x=!1,y=!1,l,D;const U=C0("https://jwgzmsqtacrmbpnzmxky.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3Z3ptc3F0YWNybWJwbnpteGt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDg0MzYwMjYsImV4cCI6MjAyNDAxMjAyNn0.E77waVrgzNb1R0fnV9QyjS-iri9j53r_JB2OYNrYEbk");async function N(){const{data:Ie}=await U.rpc("all_records_geojson");return console.log(Ie),{places:Ie??[]}}async function Z(){const{data:Ie}=await U.rpc("all_records_school_geojson");return console.log(Ie),{places:Ie??[]}}async function K(){const{count:Ie,error:vt}=await U.from("betting_places").select("*",{count:"exact",head:!0});return Ie}async function Ae(){const{count:Ie,error:vt}=await U.from("export_osm").select("*",{count:"exact",head:!0});return Ie}async function Te(){console.log("CIRCLES EXECUTED");const{data:Ie}=await U.rpc("circle_radius_all",{radius:p});return console.log(Ie),{places:Ie??[]}}async function je(){console.log("LINES EXECUTED");const{data:Ie}=await U.rpc("line_geometry_between_places",{radius:p});return console.log(Ie),{places:Ie??[]}}uf(async()=>{await Te()});function Ue(){p=Lg(this.value),u(0,p)}function He(){b=this.checked,u(1,b)}function at(){x=this.checked,u(2,x)}function Ye(){y=this.checked,u(3,y)}return _.$$.update=()=>{_.$$.dirty&1&&je().then(Ie=>{u(5,D=Ie.places),Te().then(vt=>{console.log("CHANGED STATE"),u(4,l=vt.places)})})},[p,b,x,y,l,D,N,Z,K,Ae,Ue,He,at,Ye]}class iv extends pn{constructor(o){super(),dn(this,o,tv,$0,Ur,{})}}new iv({target:document.getElementById("app")});export{Jg as g};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
